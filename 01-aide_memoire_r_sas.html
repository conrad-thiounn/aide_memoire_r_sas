<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.2.269" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

<meta name="author" content="Nassab ABDALLAH" />
<meta name="author" content="Damien EUZENAT" />
<meta name="author" content="Sébastien LI-THIAO-TE" />
<meta name="description" content="Un aide-mémoire pour les statisticiens traduisant des codes standards en SAS et en R, suivant 4 environnements (R base, tidyverse, data.table, arrow/duckdb)." />

<title>Aide-mémoire SAS - R – Aide-mémoire SAS - R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<!-- htmldependencies:E3FAD763 -->
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>


</head>

<body>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" 
        data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" 
        aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation"
        onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"
  >
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"></h1>
      <button type="button" 
        class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="/">
      Aide-mémoire SAS - R
      </a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/01-aide_memoire_r_sas.html" class="sidebar-item-text sidebar-link active">Aide-mémoire</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/03-mise_en_garde.html" class="sidebar-item-text sidebar-link">Mise en garde</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/Trucs et astuces en R.html" class="sidebar-item-text sidebar-link">Trucs et astuces</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/04-specificites_sas_r.html" class="sidebar-item-text sidebar-link">Spécificités de SAS et R</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/02-avantages_inconvenients_env_R.html" class="sidebar-item-text sidebar-link">Avantages et inconvénients des environnements R</a>
  </div>
</li>
    </ul>
    </div>
    <div id="quarto-toc-target"></div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Aide-mémoire <code>SAS</code> - <code>R</code></h1>
  <div class="quarto-categories">
    <div class="quarto-category">SAS</div>
    <div class="quarto-category">R</div>
  </div>
  </div>

<div>
  <div class="description">
    <p>Un aide-mémoire pour les statisticiens traduisant des codes standards en <code>SAS</code> et en <code>R</code>, suivant 4 environnements (<code>R base</code>, <code>tidyverse</code>, <code>data.table</code>, <code>arrow/duckdb</code>).</p>
  </div>
</div>

<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Auteur·rice·s</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    Nassab ABDALLAH 
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Dares/SCS, <a href="mailto:nassab.abdallah@travail.gouv.fr" class="email">nassab.abdallah@travail.gouv.fr</a>
          </p>
      </div>
      <div class="quarto-title-meta-contents">
    Damien EUZENAT 
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Dares/DIP, <a href="mailto:damien.euzenat@travail.gouv.fr" class="email">damien.euzenat@travail.gouv.fr</a>
          </p>
      </div>
      <div class="quarto-title-meta-contents">
    Sébastien LI-THIAO-TE 
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Dares/DFA, <a href="mailto:sebastien.li-thiao-te@travail.gouv.fr" class="email">sebastien.li-thiao-te@travail.gouv.fr</a>
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Date de publication</div>
    <div class="quarto-title-meta-contents">
      <p class="date">27 juin 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>
<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Sur cette page</h2>
   
  <ul>
  <li><a href="#importation-des-packages" id="toc-importation-des-packages"><span class="toc-section-number">1</span> <span class="header-section-number">1</span> Importation des packages</a>
  <ul>
  <li><a href="#installation-des-packages" id="toc-installation-des-packages"><span class="toc-section-number">1.1</span> <span class="header-section-number">1.1</span> Installation des packages</a></li>
  <li><a href="#importation-des-packages-1" id="toc-importation-des-packages-1"><span class="toc-section-number">1.2</span> <span class="header-section-number">1.2</span> Importation des packages</a></li>
  </ul></li>
  <li><a href="#importation-des-données" id="toc-importation-des-données"><span class="toc-section-number">2</span> <span class="header-section-number">2</span> Importation des données</a>
  <ul>
  <li><a href="#mode-demploi-de-laide-mémoire" id="toc-mode-demploi-de-laide-mémoire"><span class="toc-section-number">2.1</span> <span class="header-section-number">2.1</span> Mode d’emploi de l’aide-mémoire</a></li>
  <li><a href="#création-dune-base-de-données-dexemple" id="toc-création-dune-base-de-données-dexemple"><span class="toc-section-number">2.2</span> <span class="header-section-number">2.2</span> Création d’une base de données d’exemple</a></li>
  <li><a href="#manipulation-du-format-de-la-base-de-données" id="toc-manipulation-du-format-de-la-base-de-données"><span class="toc-section-number">2.3</span> <span class="header-section-number">2.3</span> Manipulation du format de la base de données</a></li>
  <li><a href="#importation-de-données-extérieures" id="toc-importation-de-données-extérieures"><span class="toc-section-number">2.4</span> <span class="header-section-number">2.4</span> Importation de données extérieures</a>
  <ul>
  <li><a href="#la-fonction-readlines-de-r" id="toc-la-fonction-readlines-de-r"><span class="toc-section-number">2.4.1</span> <span class="header-section-number">2.4.1</span> La fonction ReadLines() de <code>R</code></a></li>
  <li><a href="#spécificité-des-environnements" id="toc-spécificité-des-environnements"><span class="toc-section-number">2.4.2</span> <span class="header-section-number">2.4.2</span> Spécificité des environnements</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#préambule" id="toc-préambule"><span class="toc-section-number">3</span> <span class="header-section-number">3</span> Préambule</a>
  <ul>
  <li><a href="#chemin-du-bureau-de-lutilisateur" id="toc-chemin-du-bureau-de-lutilisateur"><span class="toc-section-number">3.1</span> <span class="header-section-number">3.1</span> Chemin du bureau de l’utilisateur</a></li>
  <li><a href="#affichage-de-lannée" id="toc-affichage-de-lannée"><span class="toc-section-number">3.2</span> <span class="header-section-number">3.2</span> Affichage de l’année</a></li>
  <li><a href="#construction-des-instructions-if-else" id="toc-construction-des-instructions-if-else"><span class="toc-section-number">3.3</span> <span class="header-section-number">3.3</span> Construction des instructions if / else</a></li>
  <li><a href="#répertoire-de-travail" id="toc-répertoire-de-travail"><span class="toc-section-number">3.4</span> <span class="header-section-number">3.4</span> Répertoire de travail</a></li>
  <li><a href="#autres-points-à-connaître" id="toc-autres-points-à-connaître"><span class="toc-section-number">3.5</span> <span class="header-section-number">3.5</span> Autres points à connaître</a></li>
  </ul></li>
  <li><a href="#informations-sur-la-base-de-données" id="toc-informations-sur-la-base-de-données"><span class="toc-section-number">4</span> <span class="header-section-number">4</span> Informations sur la base de données</a>
  <ul>
  <li><a href="#avoir-une-vue-densemble-des-données" id="toc-avoir-une-vue-densemble-des-données"><span class="toc-section-number">4.1</span> <span class="header-section-number">4.1</span> Avoir une vue d’ensemble des données</a></li>
  <li><a href="#extraire-les-x-premières-lignes-de-la-base-10-par-défaut" id="toc-extraire-les-x-premières-lignes-de-la-base-10-par-défaut"><span class="toc-section-number">4.2</span> <span class="header-section-number">4.2</span> Extraire les x premières lignes de la base (10 par défaut)</a></li>
  <li><a href="#extraire-les-x-dernières-lignes-de-la-base-10-par-défaut" id="toc-extraire-les-x-dernières-lignes-de-la-base-10-par-défaut"><span class="toc-section-number">4.3</span> <span class="header-section-number">4.3</span> Extraire les x dernières lignes de la base (10 par défaut)</a></li>
  <li><a href="#nombre-de-lignes-et-de-colonnes-dans-la-base" id="toc-nombre-de-lignes-et-de-colonnes-dans-la-base"><span class="toc-section-number">4.4</span> <span class="header-section-number">4.4</span> Nombre de lignes et de colonnes dans la base</a></li>
  <li><a href="#liste-des-variables-de-la-base" id="toc-liste-des-variables-de-la-base"><span class="toc-section-number">4.5</span> <span class="header-section-number">4.5</span> Liste des variables de la base</a></li>
  <li><a href="#mettre-les-noms-des-variables-en-minuscule" id="toc-mettre-les-noms-des-variables-en-minuscule"><span class="toc-section-number">4.6</span> <span class="header-section-number">4.6</span> Mettre les noms des variables en minuscule</a></li>
  <li><a href="#nombre-didentifiants-uniques-et-de-lignes-dans-la-base" id="toc-nombre-didentifiants-uniques-et-de-lignes-dans-la-base"><span class="toc-section-number">4.7</span> <span class="header-section-number">4.7</span> Nombre d’identifiants uniques et de lignes dans la base</a></li>
  <li><a href="#quelle-est-la-position-de-la-variable-date_entree" id="toc-quelle-est-la-position-de-la-variable-date_entree"><span class="toc-section-number">4.8</span> <span class="header-section-number">4.8</span> Quelle est la position de la variable date_entree ?</a></li>
  <li><a href="#variables-qui-débutent-par-note" id="toc-variables-qui-débutent-par-note"><span class="toc-section-number">4.9</span> <span class="header-section-number">4.9</span> Variables qui débutent par “note”</a></li>
  </ul></li>
  <li><a href="#type-des-variables-int-char-bool-etc." id="toc-type-des-variables-int-char-bool-etc."><span class="toc-section-number">5</span> <span class="header-section-number">5</span> Type des variables (int, char, bool, etc.)</a>
  <ul>
  <li><a href="#afficher-le-type-des-variables" id="toc-afficher-le-type-des-variables"><span class="toc-section-number">5.1</span> <span class="header-section-number">5.1</span> Afficher le type des variables</a></li>
  <li><a href="#convertir-le-type-dune-seule-variable" id="toc-convertir-le-type-dune-seule-variable"><span class="toc-section-number">5.2</span> <span class="header-section-number">5.2</span> Convertir le type d’une seule variable</a></li>
  <li><a href="#convertir-le-type-de-plusieurs-variables" id="toc-convertir-le-type-de-plusieurs-variables"><span class="toc-section-number">5.3</span> <span class="header-section-number">5.3</span> Convertir le type de plusieurs variables</a></li>
  </ul></li>
  <li><a href="#sélectionner-des-lignes-et-des-colonnes" id="toc-sélectionner-des-lignes-et-des-colonnes"><span class="toc-section-number">6</span> <span class="header-section-number">6</span> Sélectionner des lignes et des colonnes</a>
  <ul>
  <li><a href="#sélectionner-de-colonnes-par-position" id="toc-sélectionner-de-colonnes-par-position"><span class="toc-section-number">6.1</span> <span class="header-section-number">6.1</span> Sélectionner de colonnes par position</a></li>
  <li><a href="#sélectionner-des-colonnes-par-nom" id="toc-sélectionner-des-colonnes-par-nom"><span class="toc-section-number">6.2</span> <span class="header-section-number">6.2</span> Sélectionner des colonnes par nom</a></li>
  <li><a href="#sélectionner-des-colonnes-par-un-vecteur-de-noms" id="toc-sélectionner-des-colonnes-par-un-vecteur-de-noms"><span class="toc-section-number">6.3</span> <span class="header-section-number">6.3</span> Sélectionner des colonnes par un vecteur de noms</a></li>
  <li><a href="#sauf-certaines-variables" id="toc-sauf-certaines-variables"><span class="toc-section-number">6.4</span> <span class="header-section-number">6.4</span> Sauf certaines variables</a></li>
  <li><a href="#sélectionner-la-3e-colonne" id="toc-sélectionner-la-3e-colonne"><span class="toc-section-number">6.5</span> <span class="header-section-number">6.5</span> Sélectionner la 3e colonne</a></li>
  <li><a href="#sélectionner-plusieurs-colonnes" id="toc-sélectionner-plusieurs-colonnes"><span class="toc-section-number">6.6</span> <span class="header-section-number">6.6</span> Sélectionner plusieurs colonnes</a></li>
  <li><a href="#sélectionner-les-colonnes-qui-débutent-par-le-mot-note" id="toc-sélectionner-les-colonnes-qui-débutent-par-le-mot-note"><span class="toc-section-number">6.7</span> <span class="header-section-number">6.7</span> Sélectionner les colonnes qui débutent par le mot Note</a></li>
  <li><a href="#sélectionner-les-colonnes-qui-ne-débutent-pas-par-le-mot-note" id="toc-sélectionner-les-colonnes-qui-ne-débutent-pas-par-le-mot-note"><span class="toc-section-number">6.8</span> <span class="header-section-number">6.8</span> Sélectionner les colonnes qui ne débutent pas par le mot Note</a></li>
  <li><a href="#sélectionner-lensemble-des-variables-numériques-de-la-base" id="toc-sélectionner-lensemble-des-variables-numériques-de-la-base"><span class="toc-section-number">6.9</span> <span class="header-section-number">6.9</span> Sélectionner l’ensemble des variables numériques de la base</a></li>
  <li><a href="#sélectionner-lensemble-des-variables-de-format-date" id="toc-sélectionner-lensemble-des-variables-de-format-date"><span class="toc-section-number">6.10</span> <span class="header-section-number">6.10</span> Sélectionner l’ensemble des variables de format “Date”</a></li>
  <li><a href="#sélectionner-des-lignes" id="toc-sélectionner-des-lignes"><span class="toc-section-number">6.11</span> <span class="header-section-number">6.11</span> Sélectionner des lignes</a>
  <ul>
  <li><a href="#e-ligne" id="toc-e-ligne"><span class="toc-section-number">6.11.1</span> <span class="header-section-number">6.11.1</span> 3e ligne</a></li>
  <li><a href="#sélectionner-les-3-premières-lignes-et-les-3-premières-colonnes-de-la-base" id="toc-sélectionner-les-3-premières-lignes-et-les-3-premières-colonnes-de-la-base"><span class="toc-section-number">6.11.2</span> <span class="header-section-number">6.11.2</span> Sélectionner les 3 premières lignes et les 3 premières colonnes de la base</a></li>
  <li><a href="#entrées-en-2023" id="toc-entrées-en-2023"><span class="toc-section-number">6.11.3</span> <span class="header-section-number">6.11.3</span> Entrées en 2023</a></li>
  </ul></li>
  <li><a href="#sélectionner-suivant-de-multiples-conditions" id="toc-sélectionner-suivant-de-multiples-conditions"><span class="toc-section-number">6.12</span> <span class="header-section-number">6.12</span> Sélectionner suivant de multiples conditions</a></li>
  <li><a href="#sélectionner-des-lignes-par-référence-lignes-de-lidentifiant-087" id="toc-sélectionner-des-lignes-par-référence-lignes-de-lidentifiant-087"><span class="toc-section-number">6.13</span> <span class="header-section-number">6.13</span> Sélectionner des lignes par référence : lignes de l’identifiant 087</a></li>
  <li><a href="#sélectionner-des-lignes-et-des-colonnes-1" id="toc-sélectionner-des-lignes-et-des-colonnes-1"><span class="toc-section-number">6.14</span> <span class="header-section-number">6.14</span> Sélectionner des lignes et des colonnes</a></li>
  </ul></li>
  <li><a href="#manipuler-des-lignes-et-des-colonnes" id="toc-manipuler-des-lignes-et-des-colonnes"><span class="toc-section-number">7</span> <span class="header-section-number">7</span> Manipuler des lignes et des colonnes</a>
  <ul>
  <li><a href="#renommer-des-variables" id="toc-renommer-des-variables"><span class="toc-section-number">7.1</span> <span class="header-section-number">7.1</span> Renommer des variables</a></li>
  <li><a href="#créer-des-variables-avec-des-conditions" id="toc-créer-des-variables-avec-des-conditions"><span class="toc-section-number">7.2</span> <span class="header-section-number">7.2</span> Créer des variables avec des conditions</a></li>
  <li><a href="#formater-les-modalités-des-valeurs" id="toc-formater-les-modalités-des-valeurs"><span class="toc-section-number">7.3</span> <span class="header-section-number">7.3</span> Formater les modalités des valeurs</a></li>
  <li><a href="#utiliser-les-formats" id="toc-utiliser-les-formats"><span class="toc-section-number">7.4</span> <span class="header-section-number">7.4</span> Utiliser les formats</a></li>
  <li><a href="#transformer-le-format-dune-variable" id="toc-transformer-le-format-dune-variable"><span class="toc-section-number">7.5</span> <span class="header-section-number">7.5</span> Transformer le format d’une variable</a></li>
  <li><a href="#créer-et-supprimer-plusieurs-variables" id="toc-créer-et-supprimer-plusieurs-variables"><span class="toc-section-number">7.6</span> <span class="header-section-number">7.6</span> Créer, et supprimer plusieurs variables</a></li>
  <li><a href="#on-souhaite-réexprimer-toutes-les-notes-sur-100-et-non-sur-20" id="toc-on-souhaite-réexprimer-toutes-les-notes-sur-100-et-non-sur-20"><span class="toc-section-number">7.7</span> <span class="header-section-number">7.7</span> On souhaite réexprimer toutes les notes sur 100 et non sur 20</a></li>
  <li><a href="#mettre-un-0-devant-un-nombre" id="toc-mettre-un-0-devant-un-nombre"><span class="toc-section-number">7.8</span> <span class="header-section-number">7.8</span> Mettre un 0 devant un nombre</a></li>
  <li><a href="#arrondir-une-valeur-numérique" id="toc-arrondir-une-valeur-numérique"><span class="toc-section-number">7.9</span> <span class="header-section-number">7.9</span> Arrondir une valeur numérique</a></li>
  </ul></li>
  <li><a href="#manipuler-des-dates" id="toc-manipuler-des-dates"><span class="toc-section-number">8</span> <span class="header-section-number">8</span> Manipuler des dates</a>
  <ul>
  <li><a href="#créer-des-dates" id="toc-créer-des-dates"><span class="toc-section-number">8.1</span> <span class="header-section-number">8.1</span> Créer des dates</a></li>
  <li><a href="#manipuler-des-dates-1" id="toc-manipuler-des-dates-1"><span class="toc-section-number">8.2</span> <span class="header-section-number">8.2</span> Manipuler des dates</a></li>
  </ul></li>
  <li><a href="#manipuler-des-chaînes-de-caractères" id="toc-manipuler-des-chaînes-de-caractères"><span class="toc-section-number">9</span> <span class="header-section-number">9</span> Manipuler des chaînes de caractères</a>
  <ul>
  <li><a href="#majuscule-minuscule" id="toc-majuscule-minuscule"><span class="toc-section-number">9.1</span> <span class="header-section-number">9.1</span> Majuscule, minuscule</a>
  <ul>
  <li><a href="#majuscule" id="toc-majuscule"><span class="toc-section-number">9.1.1</span> <span class="header-section-number">9.1.1</span> Majuscule</a></li>
  <li><a href="#minuscule" id="toc-minuscule"><span class="toc-section-number">9.1.2</span> <span class="header-section-number">9.1.2</span> Minuscule</a></li>
  <li><a href="#première-lettre-en-majuscule" id="toc-première-lettre-en-majuscule"><span class="toc-section-number">9.1.3</span> <span class="header-section-number">9.1.3</span> Première lettre en majuscule</a></li>
  </ul></li>
  <li><a href="#nombre-de-caractères-dans-une-chaîne-de-caractères" id="toc-nombre-de-caractères-dans-une-chaîne-de-caractères"><span class="toc-section-number">9.2</span> <span class="header-section-number">9.2</span> Nombre de caractères dans une chaîne de caractères</a></li>
  <li><a href="#remplacer-une-chaîne-de-caractères-par-une-autre" id="toc-remplacer-une-chaîne-de-caractères-par-une-autre"><span class="toc-section-number">9.3</span> <span class="header-section-number">9.3</span> Remplacer une chaîne de caractères par une autre</a></li>
  <li><a href="#manipuler-des-chaînes-de-caractères-1" id="toc-manipuler-des-chaînes-de-caractères-1"><span class="toc-section-number">9.4</span> <span class="header-section-number">9.4</span> Manipuler des chaînes de caractères</a>
  <ul>
  <li><a href="#textes-sur-lesquels-les-fonctions-seront-appliquées" id="toc-textes-sur-lesquels-les-fonctions-seront-appliquées"><span class="toc-section-number">9.4.1</span> <span class="header-section-number">9.4.1</span> Textes sur lesquels les fonctions seront appliquées</a></li>
  <li><a href="#extraire-des-éléments-dune-chaîne-de-caractères" id="toc-extraire-des-éléments-dune-chaîne-de-caractères"><span class="toc-section-number">9.4.2</span> <span class="header-section-number">9.4.2</span> Extraire des éléments d’une chaîne de caractères</a></li>
  <li><a href="#enlever-les-blancs-superflus-dune-chaîne-de-caractères" id="toc-enlever-les-blancs-superflus-dune-chaîne-de-caractères"><span class="toc-section-number">9.4.3</span> <span class="header-section-number">9.4.3</span> Enlever les blancs superflus d’une chaîne de caractères</a></li>
  <li><a href="#concaténer-des-chaînes-de-caractères" id="toc-concaténer-des-chaînes-de-caractères"><span class="toc-section-number">9.4.4</span> <span class="header-section-number">9.4.4</span> Concaténer des chaînes de caractères</a></li>
  <li><a href="#transformer-plusieurs-caractères-différents" id="toc-transformer-plusieurs-caractères-différents"><span class="toc-section-number">9.4.5</span> <span class="header-section-number">9.4.5</span> Transformer plusieurs caractères différents</a></li>
  </ul></li>
  <li><a href="#découper-une-chaîne-de-caractères-selon-un-caractère-donné" id="toc-découper-une-chaîne-de-caractères-selon-un-caractère-donné"><span class="toc-section-number">9.5</span> <span class="header-section-number">9.5</span> Découper une chaîne de caractères selon un caractère donné</a></li>
  <li><a href="#inverser-une-chaîne-de-caractères" id="toc-inverser-une-chaîne-de-caractères"><span class="toc-section-number">9.6</span> <span class="header-section-number">9.6</span> Inverser une chaîne de caractères</a></li>
  </ul></li>
  <li><a href="#les-tris" id="toc-les-tris"><span class="toc-section-number">10</span> <span class="header-section-number">10</span> Les tris</a>
  <ul>
  <li><a href="#trier-les-colonnes-de-la-base" id="toc-trier-les-colonnes-de-la-base"><span class="toc-section-number">10.1</span> <span class="header-section-number">10.1</span> Trier les colonnes de la base</a>
  <ul>
  <li><a href="#mettre-identifiant-et-date_entree-au-début-de-la-base" id="toc-mettre-identifiant-et-date_entree-au-début-de-la-base"><span class="toc-section-number">10.1.1</span> <span class="header-section-number">10.1.1</span> Mettre identifiant et date_entree au début de la base</a></li>
  <li><a href="#mettre-la-variable-poids_sondage-au-début-de-la-base" id="toc-mettre-la-variable-poids_sondage-au-début-de-la-base"><span class="toc-section-number">10.1.2</span> <span class="header-section-number">10.1.2</span> Mettre la variable poids_sondage au début de la base</a></li>
  <li><a href="#mettre-la-variable-poids_sondage-à-la-fin-de-la-base" id="toc-mettre-la-variable-poids_sondage-à-la-fin-de-la-base"><span class="toc-section-number">10.1.3</span> <span class="header-section-number">10.1.3</span> Mettre la variable poids_sondage à la fin de la base</a></li>
  </ul></li>
  <li><a href="#trier-les-lignes" id="toc-trier-les-lignes"><span class="toc-section-number">10.2</span> <span class="header-section-number">10.2</span> Trier les lignes</a>
  <ul>
  <li><a href="#tri-par-ordre-croissant-didentifiant-et-date_entree" id="toc-tri-par-ordre-croissant-didentifiant-et-date_entree"><span class="toc-section-number">10.2.1</span> <span class="header-section-number">10.2.1</span> Tri par ordre croissant d’identifiant et date_entree</a></li>
  <li><a href="#tri-par-ordre-décroissant" id="toc-tri-par-ordre-décroissant"><span class="toc-section-number">10.2.2</span> <span class="header-section-number">10.2.2</span> Tri par ordre décroissant</a></li>
  </ul></li>
  <li><a href="#incidence-des-valeurs-manquantes-dans-les-tris" id="toc-incidence-des-valeurs-manquantes-dans-les-tris"><span class="toc-section-number">10.3</span> <span class="header-section-number">10.3</span> Incidence des valeurs manquantes dans les tris</a></li>
  <li><a href="#trier-par-ordre-croissant-de-toutes-les-variables-de-la-base" id="toc-trier-par-ordre-croissant-de-toutes-les-variables-de-la-base"><span class="toc-section-number">10.4</span> <span class="header-section-number">10.4</span> Trier par ordre croissant de toutes les variables de la base</a></li>
  </ul></li>
  <li><a href="#gestion-par-groupe" id="toc-gestion-par-groupe"><span class="toc-section-number">11</span> <span class="header-section-number">11</span> Gestion par groupe</a>
  <ul>
  <li><a href="#numéroter-les-lignes" id="toc-numéroter-les-lignes"><span class="toc-section-number">11.1</span> <span class="header-section-number">11.1</span> Numéroter les lignes</a></li>
  <li><a href="#première-et-dernière-ligne-par-identifiant" id="toc-première-et-dernière-ligne-par-identifiant"><span class="toc-section-number">11.2</span> <span class="header-section-number">11.2</span> Première et dernière ligne par identifiant</a>
  <ul>
  <li><a href="#première-ligne-par-identifiant" id="toc-première-ligne-par-identifiant"><span class="toc-section-number">11.2.1</span> <span class="header-section-number">11.2.1</span> Première ligne par identifiant</a></li>
  <li><a href="#dernière-ligne-par-identifiant" id="toc-dernière-ligne-par-identifiant"><span class="toc-section-number">11.2.2</span> <span class="header-section-number">11.2.2</span> Dernière ligne par identifiant</a></li>
  </ul></li>
  <li><a href="#le-premier-contrat-le-dernier-contrat-ni-le-premier-ni-le-dernier-contrat-de-chaque-individu" id="toc-le-premier-contrat-le-dernier-contrat-ni-le-premier-ni-le-dernier-contrat-de-chaque-individu"><span class="toc-section-number">11.3</span> <span class="header-section-number">11.3</span> Le premier contrat, le dernier contrat, ni le premier ni le dernier contrat de chaque individu</a></li>
  <li><a href="#créer-une-base-avec-les-seuls-premiers-contrats-et-une-base-avec-les-seuls-derniers-contrats" id="toc-créer-une-base-avec-les-seuls-premiers-contrats-et-une-base-avec-les-seuls-derniers-contrats"><span class="toc-section-number">11.4</span> <span class="header-section-number">11.4</span> Créer une base avec les seuls premiers contrats, et une base avec les seuls derniers contrats</a></li>
  <li><a href="#sélection-de-lignes-par-identifiant" id="toc-sélection-de-lignes-par-identifiant"><span class="toc-section-number">11.5</span> <span class="header-section-number">11.5</span> Sélection de lignes par identifiant</a>
  <ul>
  <li><a href="#les-2-premières-lignes-de-chaque-identifiant" id="toc-les-2-premières-lignes-de-chaque-identifiant"><span class="toc-section-number">11.5.1</span> <span class="header-section-number">11.5.1</span> Les 2 premières lignes de chaque identifiant</a></li>
  <li><a href="#les-2-dernières-lignes-de-chaque-identifiant" id="toc-les-2-dernières-lignes-de-chaque-identifiant"><span class="toc-section-number">11.5.2</span> <span class="header-section-number">11.5.2</span> Les 2 dernières lignes de chaque identifiant</a></li>
  <li><a href="#e-ligne-de-lindividu-et-rien-si-lindividu-a-1-seule-ligne" id="toc-e-ligne-de-lindividu-et-rien-si-lindividu-a-1-seule-ligne"><span class="toc-section-number">11.5.3</span> <span class="header-section-number">11.5.3</span> 2e ligne de l’individu (et rien si l’individu a 1 seule ligne)</a></li>
  <li><a href="#lavant-dernière-ligne-de-lindividu-et-rien-si-lindividu-a-1-seul-contrat" id="toc-lavant-dernière-ligne-de-lindividu-et-rien-si-lindividu-a-1-seul-contrat"><span class="toc-section-number">11.5.4</span> <span class="header-section-number">11.5.4</span> L’avant-dernière ligne de l’individu (et rien si l’individu a 1 seul contrat)</a></li>
  </ul></li>
  <li><a href="#sélection-par-groupement" id="toc-sélection-par-groupement"><span class="toc-section-number">11.6</span> <span class="header-section-number">11.6</span> Sélection par groupement</a>
  <ul>
  <li><a href="#personnes-qui-ont-eu-au-moins-une-entrée-en-2022" id="toc-personnes-qui-ont-eu-au-moins-une-entrée-en-2022"><span class="toc-section-number">11.6.1</span> <span class="header-section-number">11.6.1</span> Personnes qui ont eu au moins une entrée en 2022</a></li>
  <li><a href="#personnes-qui-ont-suivi-à-la-fois-une-formation-qualifiée-et-une-formation-non-qualifiée" id="toc-personnes-qui-ont-suivi-à-la-fois-une-formation-qualifiée-et-une-formation-non-qualifiée"><span class="toc-section-number">11.6.2</span> <span class="header-section-number">11.6.2</span> Personnes qui ont suivi à la fois une formation qualifiée et une formation non qualifiée</a></li>
  <li><a href="#personnes-qui-ont-suivi-deux-contrats-et-seulement-deux-dont-lun-au-moins-ayant-débuté-en-2022" id="toc-personnes-qui-ont-suivi-deux-contrats-et-seulement-deux-dont-lun-au-moins-ayant-débuté-en-2022"><span class="toc-section-number">11.6.3</span> <span class="header-section-number">11.6.3</span> Personnes qui ont suivi deux contrats, et seulement deux, dont l’un au moins ayant débuté en 2022</a></li>
  </ul></li>
  <li><a href="#ajouter-une-colonne-désignant-la-note-moyenne-et-la-somme-de-note_contenu-par-individu" id="toc-ajouter-une-colonne-désignant-la-note-moyenne-et-la-somme-de-note_contenu-par-individu"><span class="toc-section-number">11.7</span> <span class="header-section-number">11.7</span> Ajouter une colonne désignant la note moyenne et la somme de Note_Contenu, par individu</a></li>
  <li><a href="#ajout-dune-variable-dentrée-initiale-par-individu" id="toc-ajout-dune-variable-dentrée-initiale-par-individu"><span class="toc-section-number">11.8</span> <span class="header-section-number">11.8</span> Ajout d’une variable d’entrée initiale par individu</a></li>
  <li><a href="#changement-détat-rleid-à-faire" id="toc-changement-détat-rleid-à-faire"><span class="toc-section-number">11.9</span> <span class="header-section-number">11.9</span> Changement d’état (rleid) À FAIRE</a></li>
  <li><a href="#variable-retardée-lag" id="toc-variable-retardée-lag"><span class="toc-section-number">11.10</span> <span class="header-section-number">11.10</span> Variable retardée (lag)</a></li>
  </ul></li>
  <li><a href="#gestion-par-rangées-de-lignes" id="toc-gestion-par-rangées-de-lignes"><span class="toc-section-number">12</span> <span class="header-section-number">12</span> Gestion par rangées de lignes</a>
  <ul>
  <li><a href="#sélectionner-les-lignes-avec-au-moins-une-note-inférieure-à-10" id="toc-sélectionner-les-lignes-avec-au-moins-une-note-inférieure-à-10"><span class="toc-section-number">12.1</span> <span class="header-section-number">12.1</span> Sélectionner les lignes avec au moins une note inférieure à 10</a></li>
  <li><a href="#sélectionner-les-lignes-avec-toutes-les-notes-supérieurs-à-10" id="toc-sélectionner-les-lignes-avec-toutes-les-notes-supérieurs-à-10"><span class="toc-section-number">12.2</span> <span class="header-section-number">12.2</span> Sélectionner les lignes avec toutes les notes supérieurs à 10</a></li>
  <li><a href="#moyenne-par-ligne" id="toc-moyenne-par-ligne"><span class="toc-section-number">12.3</span> <span class="header-section-number">12.3</span> Moyenne par ligne</a>
  <ul>
  <li><a href="#moyenne-par-ligne-1" id="toc-moyenne-par-ligne-1"><span class="toc-section-number">12.3.1</span> <span class="header-section-number">12.3.1</span> Moyenne par ligne</a></li>
  <li><a href="#moyenne-des-moyennes-ligne" id="toc-moyenne-des-moyennes-ligne"><span class="toc-section-number">12.3.2</span> <span class="header-section-number">12.3.2</span> Moyenne des moyennes ligne</a></li>
  <li><a href="#la-moyenne-par-ligne-est-est-elle-supérieure-à-la-moyenne" id="toc-la-moyenne-par-ligne-est-est-elle-supérieure-à-la-moyenne"><span class="toc-section-number">12.3.3</span> <span class="header-section-number">12.3.3</span> La moyenne par ligne est est-elle supérieure à la moyenne ?</a></li>
  </ul></li>
  <li><a href="#moyenne-pondérée-par-ligne" id="toc-moyenne-pondérée-par-ligne"><span class="toc-section-number">12.4</span> <span class="header-section-number">12.4</span> Moyenne pondérée par ligne</a></li>
  </ul></li>
  <li><a href="#transposer-une-base" id="toc-transposer-une-base"><span class="toc-section-number">13</span> <span class="header-section-number">13</span> Transposer une base</a>
  <ul>
  <li><a href="#transposer-une-base-1" id="toc-transposer-une-base-1"><span class="toc-section-number">13.1</span> <span class="header-section-number">13.1</span> Transposer une base</a></li>
  <li><a href="#passer-dune-base-en-largeur-wide-à-une-base-en-longueur-long" id="toc-passer-dune-base-en-largeur-wide-à-une-base-en-longueur-long"><span class="toc-section-number">13.2</span> <span class="header-section-number">13.2</span> Passer d’une base en largeur (wide) à une base en longueur (long)</a></li>
  <li><a href="#passer-dune-base-en-longueur-long-à-une-base-en-largeur-wide" id="toc-passer-dune-base-en-longueur-long-à-une-base-en-largeur-wide"><span class="toc-section-number">13.3</span> <span class="header-section-number">13.3</span> Passer d’une base en longueur (long) à une base en largeur (wide)</a></li>
  </ul></li>
  <li><a href="#variable-retardée-lag-et-avancée-lead" id="toc-variable-retardée-lag-et-avancée-lead"><span class="toc-section-number">14</span> <span class="header-section-number">14</span> Variable retardée (lag) et avancée (lead)</a>
  <ul>
  <li><a href="#variable-retardée-lag-1" id="toc-variable-retardée-lag-1"><span class="toc-section-number">14.1</span> <span class="header-section-number">14.1</span> Variable retardée (lag)</a></li>
  <li><a href="#variable-avancée-lead" id="toc-variable-avancée-lead"><span class="toc-section-number">14.2</span> <span class="header-section-number">14.2</span> Variable avancée (lead)</a></li>
  </ul></li>
  <li><a href="#les-valeurs-manquantes" id="toc-les-valeurs-manquantes"><span class="toc-section-number">15</span> <span class="header-section-number">15</span> Les valeurs manquantes</a>
  <ul>
  <li><a href="#repérer-les-valeurs-manquantes-variables-âge-et-niveau" id="toc-repérer-les-valeurs-manquantes-variables-âge-et-niveau"><span class="toc-section-number">15.1</span> <span class="header-section-number">15.1</span> Repérer les valeurs manquantes (variables Âge et Niveau)</a></li>
  <li><a href="#nombre-et-proportion-de-valeurs-manquantes-par-variable" id="toc-nombre-et-proportion-de-valeurs-manquantes-par-variable"><span class="toc-section-number">15.2</span> <span class="header-section-number">15.2</span> Nombre et proportion de valeurs manquantes par variable</a>
  <ul>
  <li><a href="#pour-les-variables-numériques-ou-dates" id="toc-pour-les-variables-numériques-ou-dates"><span class="toc-section-number">15.2.1</span> <span class="header-section-number">15.2.1</span> Pour les variables numériques ou dates</a></li>
  <li><a href="#pour-lensemble-des-variables" id="toc-pour-lensemble-des-variables"><span class="toc-section-number">15.2.2</span> <span class="header-section-number">15.2.2</span> Pour l’ensemble des variables</a></li>
  </ul></li>
  <li><a href="#incidence-des-valeurs-manquantes" id="toc-incidence-des-valeurs-manquantes"><span class="toc-section-number">15.3</span> <span class="header-section-number">15.3</span> Incidence des valeurs manquantes</a></li>
  <li><a href="#remplacer-les-valeurs-manquantes-dune-seule-variable-par-0" id="toc-remplacer-les-valeurs-manquantes-dune-seule-variable-par-0"><span class="toc-section-number">15.4</span> <span class="header-section-number">15.4</span> Remplacer les valeurs manquantes d’une seule variable par 0</a></li>
  <li><a href="#remplacer-toutes-les-valeurs-numériques-manquantes-par-0" id="toc-remplacer-toutes-les-valeurs-numériques-manquantes-par-0"><span class="toc-section-number">15.5</span> <span class="header-section-number">15.5</span> Remplacer toutes les valeurs numériques manquantes par 0</a></li>
  </ul></li>
  <li><a href="#les-doublons" id="toc-les-doublons"><span class="toc-section-number">16</span> <span class="header-section-number">16</span> Les doublons</a>
  <ul>
  <li><a href="#doublons-pour-toutes-les-colonnes" id="toc-doublons-pour-toutes-les-colonnes"><span class="toc-section-number">16.1</span> <span class="header-section-number">16.1</span> Doublons pour toutes les colonnes</a></li>
  <li><a href="#doublons-pour-une-ou-plusieurs-colonnes" id="toc-doublons-pour-une-ou-plusieurs-colonnes"><span class="toc-section-number">16.2</span> <span class="header-section-number">16.2</span> Doublons pour une ou plusieurs colonnes</a></li>
  <li><a href="#récupérer-toutes-les-lignes-pour-les-identifiants-en-doublon" id="toc-récupérer-toutes-les-lignes-pour-les-identifiants-en-doublon"><span class="toc-section-number">16.3</span> <span class="header-section-number">16.3</span> Récupérer toutes les lignes pour les identifiants en doublon</a></li>
  <li><a href="#récupérer-toutes-les-lignes-pour-les-identifiants-sans-doublon" id="toc-récupérer-toutes-les-lignes-pour-les-identifiants-sans-doublon"><span class="toc-section-number">16.4</span> <span class="header-section-number">16.4</span> Récupérer toutes les lignes pour les identifiants sans doublon</a></li>
  <li><a href="#suppression-des-doublons-pour-lensemble-des-variables" id="toc-suppression-des-doublons-pour-lensemble-des-variables"><span class="toc-section-number">16.5</span> <span class="header-section-number">16.5</span> Suppression des doublons pour l’ensemble des variables</a></li>
  <li><a href="#suppression-des-doublons-pour-une-seule-variable" id="toc-suppression-des-doublons-pour-une-seule-variable"><span class="toc-section-number">16.6</span> <span class="header-section-number">16.6</span> Suppression des doublons pour une seule variable</a></li>
  <li><a href="#identifiants-uniques" id="toc-identifiants-uniques"><span class="toc-section-number">16.7</span> <span class="header-section-number">16.7</span> Identifiants uniques</a></li>
  <li><a href="#nombre-de-lignes-uniques-sans-doublon" id="toc-nombre-de-lignes-uniques-sans-doublon"><span class="toc-section-number">16.8</span> <span class="header-section-number">16.8</span> Nombre de lignes uniques, sans doublon</a></li>
  </ul></li>
  <li><a href="#les-jointures-de-bases" id="toc-les-jointures-de-bases"><span class="toc-section-number">17</span> <span class="header-section-number">17</span> Les jointures de bases</a>
  <ul>
  <li><a href="#importation-de-bases-pour-les-jointures" id="toc-importation-de-bases-pour-les-jointures"><span class="toc-section-number">17.1</span> <span class="header-section-number">17.1</span> Importation de bases pour les jointures</a></li>
  <li><a href="#inner-join-les-seuls-identifiants-communs-aux-deux-bases" id="toc-inner-join-les-seuls-identifiants-communs-aux-deux-bases"><span class="toc-section-number">17.2</span> <span class="header-section-number">17.2</span> Inner join : les seuls identifiants communs aux deux bases</a></li>
  <li><a href="#left-join-les-identifiants-de-la-base-de-gauche" id="toc-left-join-les-identifiants-de-la-base-de-gauche"><span class="toc-section-number">17.3</span> <span class="header-section-number">17.3</span> Left join : les identifiants de la base de gauche</a></li>
  <li><a href="#right-join-les-identifiants-de-la-base-de-droite" id="toc-right-join-les-identifiants-de-la-base-de-droite"><span class="toc-section-number">17.4</span> <span class="header-section-number">17.4</span> Right join : les identifiants de la base de droite</a></li>
  <li><a href="#full-join-les-identifiants-des-deux-bases" id="toc-full-join-les-identifiants-des-deux-bases"><span class="toc-section-number">17.5</span> <span class="header-section-number">17.5</span> Full join : les identifiants des deux bases</a></li>
  <li><a href="#jointure-de-3-bases-ou-plus-en-une-seule-opération-exemple-avec-inner-join" id="toc-jointure-de-3-bases-ou-plus-en-une-seule-opération-exemple-avec-inner-join"><span class="toc-section-number">17.6</span> <span class="header-section-number">17.6</span> Jointure de 3 bases ou plus en une seule opération (exemple avec inner join)</a></li>
  <li><a href="#jointure-sur-inégalités" id="toc-jointure-sur-inégalités"><span class="toc-section-number">17.7</span> <span class="header-section-number">17.7</span> Jointure sur inégalités</a></li>
  <li><a href="#cross-join-toutes-les-combinaisons-possibles-de-csp-sexe-et-diplôme" id="toc-cross-join-toutes-les-combinaisons-possibles-de-csp-sexe-et-diplôme"><span class="toc-section-number">17.8</span> <span class="header-section-number">17.8</span> Cross join : toutes les combinaisons possibles de CSP, sexe et diplôme</a></li>
  <li><a href="#semi-join" id="toc-semi-join"><span class="toc-section-number">17.9</span> <span class="header-section-number">17.9</span> Semi join</a></li>
  <li><a href="#anti-join" id="toc-anti-join"><span class="toc-section-number">17.10</span> <span class="header-section-number">17.10</span> Anti join</a></li>
  <li><a href="#autres-fonctions-utiles" id="toc-autres-fonctions-utiles"><span class="toc-section-number">17.11</span> <span class="header-section-number">17.11</span> Autres fonctions utiles</a>
  <ul>
  <li><a href="#concaténation-des-identifiants" id="toc-concaténation-des-identifiants"><span class="toc-section-number">17.11.1</span> <span class="header-section-number">17.11.1</span> Concaténation des identifiants</a></li>
  <li><a href="#identifiants-uniques-des-2-bases" id="toc-identifiants-uniques-des-2-bases"><span class="toc-section-number">17.11.2</span> <span class="header-section-number">17.11.2</span> Identifiants uniques des 2 bases</a></li>
  <li><a href="#identifiants-communs-des-2-bases" id="toc-identifiants-communs-des-2-bases"><span class="toc-section-number">17.11.3</span> <span class="header-section-number">17.11.3</span> Identifiants communs des 2 bases</a></li>
  <li><a href="#identifiants-dans-jointure-mais-pas-diplome" id="toc-identifiants-dans-jointure-mais-pas-diplome"><span class="toc-section-number">17.11.4</span> <span class="header-section-number">17.11.4</span> Identifiants dans Jointure mais pas Diplome</a></li>
  <li><a href="#identifiants-dans-diplome-mais-pas-jointure" id="toc-identifiants-dans-diplome-mais-pas-jointure"><span class="toc-section-number">17.11.5</span> <span class="header-section-number">17.11.5</span> Identifiants dans Diplome mais pas Jointure</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#concaténer-et-empiler-des-bases" id="toc-concaténer-et-empiler-des-bases"><span class="toc-section-number">18</span> <span class="header-section-number">18</span> Concaténer et empiler des bases</a>
  <ul>
  <li><a href="#concaténer-deux-bases-de-données" id="toc-concaténer-deux-bases-de-données"><span class="toc-section-number">18.1</span> <span class="header-section-number">18.1</span> Concaténer deux bases de données</a>
  <ul>
  <li><a href="#nombre-de-colonnes-identique-dans-chaque-base" id="toc-nombre-de-colonnes-identique-dans-chaque-base"><span class="toc-section-number">18.1.1</span> <span class="header-section-number">18.1.1</span> Nombre de colonnes identique dans chaque base</a></li>
  <li><a href="#nombre-de-colonnes-différent-dans-chaque-base" id="toc-nombre-de-colonnes-différent-dans-chaque-base"><span class="toc-section-number">18.1.2</span> <span class="header-section-number">18.1.2</span> Nombre de colonnes différent dans chaque base</a></li>
  </ul></li>
  <li><a href="#empiler-deux-bases-de-données" id="toc-empiler-deux-bases-de-données"><span class="toc-section-number">18.2</span> <span class="header-section-number">18.2</span> Empiler deux bases de données</a></li>
  <li><a href="#ajouter-une-ligne-de-valeurs-manquantes-à-une-base-de-données" id="toc-ajouter-une-ligne-de-valeurs-manquantes-à-une-base-de-données"><span class="toc-section-number">18.3</span> <span class="header-section-number">18.3</span> Ajouter une ligne de valeurs manquantes à une base de données</a></li>
  </ul></li>
  <li><a href="#statistiques-descriptives" id="toc-statistiques-descriptives"><span class="toc-section-number">19</span> <span class="header-section-number">19</span> Statistiques descriptives</a>
  <ul>
  <li><a href="#moyenne" id="toc-moyenne"><span class="toc-section-number">19.1</span> <span class="header-section-number">19.1</span> Moyenne</a></li>
  <li><a href="#moyenne-par-sélection" id="toc-moyenne-par-sélection"><span class="toc-section-number">19.2</span> <span class="header-section-number">19.2</span> Moyenne par sélection</a></li>
  <li><a href="#moyenne-pondérée" id="toc-moyenne-pondérée"><span class="toc-section-number">19.3</span> <span class="header-section-number">19.3</span> Moyenne pondérée</a></li>
  <li><a href="#moyenne-pondérée-par-sélection" id="toc-moyenne-pondérée-par-sélection"><span class="toc-section-number">19.4</span> <span class="header-section-number">19.4</span> Moyenne pondérée par sélection</a></li>
  <li><a href="#moyenne-de-plusieurs-variables" id="toc-moyenne-de-plusieurs-variables"><span class="toc-section-number">19.5</span> <span class="header-section-number">19.5</span> Moyenne de plusieurs variables</a></li>
  <li><a href="#moyenne-pondérée-de-plusieurs-variables" id="toc-moyenne-pondérée-de-plusieurs-variables"><span class="toc-section-number">19.6</span> <span class="header-section-number">19.6</span> Moyenne pondérée de plusieurs variables</a></li>
  <li><a href="#nombreuses-statistiques-somme-moyenne-médiane-mode-etc." id="toc-nombreuses-statistiques-somme-moyenne-médiane-mode-etc."><span class="toc-section-number">19.7</span> <span class="header-section-number">19.7</span> Nombreuses statistiques (somme, moyenne, médiane, mode, etc.)</a></li>
  <li><a href="#nombreuses-statistiques-pondérées-somme-moyenne-médiane-mode-etc." id="toc-nombreuses-statistiques-pondérées-somme-moyenne-médiane-mode-etc."><span class="toc-section-number">19.8</span> <span class="header-section-number">19.8</span> Nombreuses statistiques pondérées (somme, moyenne, médiane, mode, etc.)</a></li>
  <li><a href="#variance-et-variance-pondérée" id="toc-variance-et-variance-pondérée"><span class="toc-section-number">19.9</span> <span class="header-section-number">19.9</span> Variance et variance pondérée</a>
  <ul>
  <li><a href="#variance" id="toc-variance"><span class="toc-section-number">19.9.1</span> <span class="header-section-number">19.9.1</span> Variance</a></li>
  <li><a href="#variance-pondérée" id="toc-variance-pondérée"><span class="toc-section-number">19.9.2</span> <span class="header-section-number">19.9.2</span> Variance pondérée</a></li>
  <li><a href="#calcul-manuel-de-la-variance-pondérée" id="toc-calcul-manuel-de-la-variance-pondérée"><span class="toc-section-number">19.9.3</span> <span class="header-section-number">19.9.3</span> Calcul “manuel” de la variance pondérée</a></li>
  </ul></li>
  <li><a href="#déciles-et-quantiles" id="toc-déciles-et-quantiles"><span class="toc-section-number">19.10</span> <span class="header-section-number">19.10</span> Déciles et quantiles</a></li>
  <li><a href="#déciles-et-quantiles-pondérés" id="toc-déciles-et-quantiles-pondérés"><span class="toc-section-number">19.11</span> <span class="header-section-number">19.11</span> Déciles et quantiles pondérés</a></li>
  <li><a href="#rang-de-la-note" id="toc-rang-de-la-note"><span class="toc-section-number">19.12</span> <span class="header-section-number">19.12</span> Rang de la note</a></li>
  <li><a href="#covariance-et-corrélation-linéaire" id="toc-covariance-et-corrélation-linéaire"><span class="toc-section-number">19.13</span> <span class="header-section-number">19.13</span> Covariance et corrélation linéaire</a>
  <ul>
  <li><a href="#covariance-entre-deux-notes" id="toc-covariance-entre-deux-notes"><span class="toc-section-number">19.13.1</span> <span class="header-section-number">19.13.1</span> Covariance entre deux notes</a></li>
  <li><a href="#corrélation-linéaire-entre-deux-notes" id="toc-corrélation-linéaire-entre-deux-notes"><span class="toc-section-number">19.13.2</span> <span class="header-section-number">19.13.2</span> Corrélation linéaire entre deux notes</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#tableaux-de-fréquence-proc-freq-de-sas-pour-1-variable" id="toc-tableaux-de-fréquence-proc-freq-de-sas-pour-1-variable"><span class="toc-section-number">20</span> <span class="header-section-number">20</span> Tableaux de fréquence (proc freq de <code>SAS</code>) pour 1 variable</a>
  <ul>
  <li><a href="#tableaux-de-fréquence-pour-1-variable" id="toc-tableaux-de-fréquence-pour-1-variable"><span class="toc-section-number">20.1</span> <span class="header-section-number">20.1</span> Tableaux de fréquence pour 1 variable</a></li>
  <li><a href="#tableaux-de-fréquence-avec-les-valeurs-manquantes" id="toc-tableaux-de-fréquence-avec-les-valeurs-manquantes"><span class="toc-section-number">20.2</span> <span class="header-section-number">20.2</span> Tableaux de fréquence avec les valeurs manquantes</a></li>
  <li><a href="#tableaux-de-fréquence-triés-par-la-modalité-la-plus-courante" id="toc-tableaux-de-fréquence-triés-par-la-modalité-la-plus-courante"><span class="toc-section-number">20.3</span> <span class="header-section-number">20.3</span> Tableaux de fréquence triés par la modalité la plus courante</a></li>
  <li><a href="#tableaux-de-fréquence-avec-la-pondération" id="toc-tableaux-de-fréquence-avec-la-pondération"><span class="toc-section-number">20.4</span> <span class="header-section-number">20.4</span> Tableaux de fréquence avec la pondération</a></li>
  </ul></li>
  <li><a href="#tableaux-de-contingence-proc-freq-de-sas-pour-2-variables" id="toc-tableaux-de-contingence-proc-freq-de-sas-pour-2-variables"><span class="toc-section-number">21</span> <span class="header-section-number">21</span> Tableaux de contingence (proc freq de <code>SAS</code>) pour 2 variables</a>
  <ul>
  <li><a href="#tableaux-de-contingence-pour-2-variables" id="toc-tableaux-de-contingence-pour-2-variables"><span class="toc-section-number">21.1</span> <span class="header-section-number">21.1</span> Tableaux de contingence pour 2 variables</a></li>
  <li><a href="#tableau-de-contingence-avec-pondération" id="toc-tableau-de-contingence-avec-pondération"><span class="toc-section-number">21.2</span> <span class="header-section-number">21.2</span> Tableau de contingence avec pondération</a></li>
  <li><a href="#copier-coller-le-tableau-dans-un-tableur-excel-etc." id="toc-copier-coller-le-tableau-dans-un-tableur-excel-etc."><span class="toc-section-number">21.3</span> <span class="header-section-number">21.3</span> Copier-coller le tableau dans un tableur (Excel, etc.)</a></li>
  <li><a href="#tests-dassociaton-chi-deux-etc." id="toc-tests-dassociaton-chi-deux-etc."><span class="toc-section-number">21.4</span> <span class="header-section-number">21.4</span> Tests d’associaton (Chi-Deux, etc.)</a></li>
  <li><a href="#solutions-avec-package-r-permettant-de-pondérer" id="toc-solutions-avec-package-r-permettant-de-pondérer"><span class="toc-section-number">21.5</span> <span class="header-section-number">21.5</span> Solutions avec package <code>R</code> permettant de pondérer</a>
  <ul>
  <li><a href="#package-descr" id="toc-package-descr"><span class="toc-section-number">21.5.1</span> <span class="header-section-number">21.5.1</span> Package descr</a></li>
  <li><a href="#package-flextable" id="toc-package-flextable"><span class="toc-section-number">21.5.2</span> <span class="header-section-number">21.5.2</span> Package flextable</a></li>
  <li><a href="#package-questionr" id="toc-package-questionr"><span class="toc-section-number">21.5.3</span> <span class="header-section-number">21.5.3</span> Package questionr</a></li>
  <li><a href="#package-survey" id="toc-package-survey"><span class="toc-section-number">21.5.4</span> <span class="header-section-number">21.5.4</span> Package survey</a></li>
  <li><a href="#package-procs" id="toc-package-procs"><span class="toc-section-number">21.5.5</span> <span class="header-section-number">21.5.5</span> Package procs</a></li>
  </ul></li>
  <li><a href="#solutions-avec-package-r-ne-permettant-apparemment-pas-de-pondérer" id="toc-solutions-avec-package-r-ne-permettant-apparemment-pas-de-pondérer"><span class="toc-section-number">21.6</span> <span class="header-section-number">21.6</span> Solutions avec package R ne permettant apparemment pas de pondérer</a>
  <ul>
  <li><a href="#package-janitor" id="toc-package-janitor"><span class="toc-section-number">21.6.1</span> <span class="header-section-number">21.6.1</span> Package Janitor</a></li>
  <li><a href="#package-crosstable" id="toc-package-crosstable"><span class="toc-section-number">21.6.2</span> <span class="header-section-number">21.6.2</span> Package crosstable</a></li>
  <li><a href="#package-gmodels" id="toc-package-gmodels"><span class="toc-section-number">21.6.3</span> <span class="header-section-number">21.6.3</span> Package gmodels</a></li>
  <li><a href="#package-gtsummary" id="toc-package-gtsummary"><span class="toc-section-number">21.6.4</span> <span class="header-section-number">21.6.4</span> Package gtsummary</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#statistiques-agrégées-par-groupe" id="toc-statistiques-agrégées-par-groupe"><span class="toc-section-number">22</span> <span class="header-section-number">22</span> Statistiques agrégées par groupe</a>
  <ul>
  <li><a href="#une-seule-variable-de-groupement-une-seule-variable" id="toc-une-seule-variable-de-groupement-une-seule-variable"><span class="toc-section-number">22.1</span> <span class="header-section-number">22.1</span> Une seule variable de groupement, une seule variable</a></li>
  <li><a href="#plusieurs-variables" id="toc-plusieurs-variables"><span class="toc-section-number">22.2</span> <span class="header-section-number">22.2</span> Plusieurs variables</a></li>
  <li><a href="#tableaux-croisés-à-2-variables-de-groupement" id="toc-tableaux-croisés-à-2-variables-de-groupement"><span class="toc-section-number">22.3</span> <span class="header-section-number">22.3</span> Tableaux croisés à 2 variables de groupement</a></li>
  <li><a href="#tableaux-croisés-à-3-variables-de-groupement-ou-plus-1-variable-en-ligne-2-en-colonne" id="toc-tableaux-croisés-à-3-variables-de-groupement-ou-plus-1-variable-en-ligne-2-en-colonne"><span class="toc-section-number">22.4</span> <span class="header-section-number">22.4</span> Tableaux croisés à 3 variables de groupement ou plus : 1 variable en ligne, 2 en colonne</a></li>
  </ul></li>
  <li><a href="#boucles" id="toc-boucles"><span class="toc-section-number">23</span> <span class="header-section-number">23</span> Boucles</a>
  <ul>
  <li><a href="#boucles-imbriquées" id="toc-boucles-imbriquées"><span class="toc-section-number">23.1</span> <span class="header-section-number">23.1</span> Boucles imbriquées</a></li>
  <li><a href="#boucles-imbriquées-second-exemple" id="toc-boucles-imbriquées-second-exemple"><span class="toc-section-number">23.2</span> <span class="header-section-number">23.2</span> Boucles imbriquées (second exemple)</a></li>
  <li><a href="#boucles-for" id="toc-boucles-for"><span class="toc-section-number">23.3</span> <span class="header-section-number">23.3</span> Boucles for</a></li>
  <li><a href="#boucles-for-second-exemple" id="toc-boucles-for-second-exemple"><span class="toc-section-number">23.4</span> <span class="header-section-number">23.4</span> Boucles for (second exemple)</a></li>
  <li><a href="#autres-transcriptions-de-fonctions-sas-vers-r" id="toc-autres-transcriptions-de-fonctions-sas-vers-r"><span class="toc-section-number">23.5</span> <span class="header-section-number">23.5</span> Autres transcriptions de fonctions <code>SAS</code> vers <code>R</code></a></li>
  </ul></li>
  <li><a href="#débogage" id="toc-débogage"><span class="toc-section-number">24</span> <span class="header-section-number">24</span> Débogage</a>
  <ul>
  <li><a href="#outils-daide-au-débogage" id="toc-outils-daide-au-débogage"><span class="toc-section-number">24.1</span> <span class="header-section-number">24.1</span> Outils d’aide au débogage</a></li>
  </ul></li>
  <li><a href="#points-de-vigilance-en-sas" id="toc-points-de-vigilance-en-sas"><span class="toc-section-number">25</span> <span class="header-section-number">25</span> Points de vigilance en <code>SAS</code></a>
  <ul>
  <li><a href="#emploi-des-guillemets-et-double-guillemets" id="toc-emploi-des-guillemets-et-double-guillemets"><span class="toc-section-number">25.1</span> <span class="header-section-number">25.1</span> Emploi des guillemets et double guillemets</a></li>
  <li><a href="#macro-variable-définie-avec-un-statut-global-avant-son-appel-dans-le-cadre-dun-statut-local" id="toc-macro-variable-définie-avec-un-statut-global-avant-son-appel-dans-le-cadre-dun-statut-local"><span class="toc-section-number">25.2</span> <span class="header-section-number">25.2</span> Macro-variable définie avec un statut global avant son appel dans le cadre d’un statut local</a></li>
  </ul></li>
  <li><a href="#fin-du-programme" id="toc-fin-du-programme"><span class="toc-section-number">26</span> <span class="header-section-number">26</span> Fin du programme</a>
  <ul>
  <li><a href="#taille-des-objets-en-mémoire" id="toc-taille-des-objets-en-mémoire"><span class="toc-section-number">26.1</span> <span class="header-section-number">26.1</span> Taille des objets en mémoire</a></li>
  <li><a href="#supprimer-des-bases" id="toc-supprimer-des-bases"><span class="toc-section-number">26.2</span> <span class="header-section-number">26.2</span> Supprimer des bases</a></li>
  </ul></li>
  </ul>
</nav>
<p>L’aide-mémoire a pour but de fournir des codes écrits en <code>SAS</code> et d’en donner la traduction en <code>R</code> de différentes manières possibles :</p>
<ul>
<li><p><code>R base</code></p></li>
<li><p><code>tidyverse</code></p></li>
<li><p><code>data.table</code></p></li>
<li><p><code>arrow/duckdb</code></p></li>
</ul>
<p>Les codes traduits sont typiques de la production statistique ou la réalisation d’études descriptives.</p>
<p>Ce document s’adresse notamment aux utilisateurs de <code>SAS</code> qui veulent connaître la traduction du code <code>SAS</code> en <code>R</code>, aux utilisateurs de <code>R</code> qui ont besoin de comprendre le code <code>SAS</code>, ainsi qu’aux utilisateurs d’un environnement <code>R</code> qui sont intéressés par la traduction dans un autre environnement <code>R</code>.</p>
<p>Il se veut complémentaire de la documentation en ligne en français Utilit’R, née à l’Insee (<a href="https://www.book.utilitr.org/" class="uri">https://www.book.utilitr.org/</a>). Le lecteur est invité à s’y référer pour obtenir des informations importantes sur l’utilisation de <code>R</code> et qui ne sont pas discutées dans ce document, comme l’importation de données en <code>R</code> (<a href="https://www.book.utilitr.org/03_fiches_thematiques/fiche_import_fichiers_plats" class="uri">https://www.book.utilitr.org/03_fiches_thematiques/fiche_import_fichiers_plats</a>).</p>
<p>Enfin, si vous souhaitez collaborer à cet aide-mémoire ou nous faire part de votre avis, n’hésitez pas à nous contacter via nos adresses email.</p>
<section id="importation-des-packages" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Importation des packages</h1>
<section id="installation-des-packages" class="level2" data-number="1.1">
<h2 data-number="1.1"><span class="header-section-number">1.1</span> Installation des packages</h2>
<p>Des informations sur l’installation des packages en <code>R</code> sont disponibles sur le site Utilit’R : <a href="https://book.utilitr.org/01_R_Insee/Fiche_installer_packages.html" class="uri">https://book.utilitr.org/01_R_Insee/Fiche_installer_packages.html</a>.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-1-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb1"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Sans objet pour SAS */</span></span></code></pre></div>
</div>
<div id="tabset-1-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les packages doivent au préalable être installés sur le disque dur</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour installer un package :</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;nom_du_package&quot;)</span></span></code></pre></div>
</div>
</div>
<div id="tabset-1-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les packages doivent au préalable être installés sur le disque dur</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour installer un package :</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;nom_du_package&quot;)</span></span></code></pre></div>
</div>
</div>
<div id="tabset-1-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les packages doivent au préalable être installés sur le disque dur</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour installer un package :</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;nom_du_package&quot;)</span></span></code></pre></div>
</div>
</div>
<div id="tabset-1-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les packages doivent au préalable être installés sur le disque dur</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour installer un package :</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;nom_du_package&quot;)</span></span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="importation-des-packages-1" class="level2" data-number="1.2">
<h2 data-number="1.2"><span class="header-section-number">1.2</span> Importation des packages</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-2-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="sourceCode" id="cb6"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Sans objet pour SAS */</span></span></code></pre></div>
</div>
<div id="tabset-2-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans objet pour R-Base</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Cependant, on importe le package lubridate pour faciliter la gestion des dates</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
</div>
</div>
<div id="tabset-2-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chargement des packages</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Le tidyverse proprement dit</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Les packages importés par le tidyverse sont :</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - dplyr (manipulation de données)</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># - tidyr (réorganisation de bases de données)</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># - readr (importation de données)</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># - purrr (permet de réaliser des boucles)</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># - tibble (format de données tibble, complémentaire du data.frame)</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># - stringr (manipulation de chaînes de caractères)</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># - ggplot2 (création de graphiques)</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># - forcats (gestion des formats &quot;factors&quot;)</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour manipuler les dates</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour utiliser le pipe %&gt;%</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Documentation de tidyverse</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="fu">vignette</span>(<span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-2-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour manipuler les dates</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Documentation de data.table</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>?<span class="st">&#39;[.data.table&#39;</span></span></code></pre></div>
</div>
</div>
<div id="tabset-2-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#library(duckdb)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#library(arrow)</span></span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="importation-des-données" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Importation des données</h1>
<section id="mode-demploi-de-laide-mémoire" class="level2" data-number="2.1">
<h2 data-number="2.1"><span class="header-section-number">2.1</span> Mode d’emploi de l’aide-mémoire</h2>
<p>Les codes informatiques sont appliqués sur une base de données illustrative fictive. Cette base est importée à cette étape. Aussi, pour répliquer les codes sur sa machine, le lecteur doit d’abord exécuter le code d’importation de la base de données ci-dessous.</p>
<p>Les codes sont majoritairement exécutables indépendamment les uns des autres. Les codes de la partie “Les jointures de bases” nécessitent cependant l’importation des bases réalisée lors de la première section de la partie.</p>
</section>
<section id="création-dune-base-de-données-dexemple" class="level2" data-number="2.2">
<h2 data-number="2.2"><span class="header-section-number">2.2</span> Création d’une base de données d’exemple</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-5" role="tab" aria-controls="tabset-3-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-3-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="sourceCode" id="cb11"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Données fictives sur des formations */</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">infile</span> <span class="kw">cards</span> dsd dlm=<span class="st">&#39;|&#39;</span>;</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Identifiant $<span class="dv">3</span>. Sexe <span class="dv">1</span>. CSP $<span class="dv">1</span>. Niveau $<span class="dv">30</span>. Date_naissance ddmmyy10. Date_entree ddmmyy10. Duree Note_Contenu Note_Formateur Note_Moyens</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>         Note_Accompagnement Note_Materiel poids_sondage <span class="dv">4.1</span> CSPF $<span class="dv">25</span>. Sexef $<span class="dv">5</span>.;</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">input</span> Identifiant $ Sexe CSP $ Niveau $ Date_naissance :ddmmyy10. Date_entree :ddmmyy10. Duree Note_Contenu Note_Formateur Note_Moyens</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        Note_Accompagnement Note_Materiel poids_sondage CSPF $ Sexef $;</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">cards</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">173</span>|<span class="dv">2</span>|<span class="dv">1</span>|Qualifié|<span class="dv">17</span>/<span class="dv">06</span>/<span class="dv">1998</span>|<span class="dv">01</span>/<span class="dv">01</span>/<span class="dv">2021</span>|<span class="dv">308</span>|<span class="dv">12</span>|<span class="dv">6</span>|<span class="dv">17</span>|<span class="dv">4</span>|<span class="dv">19</span>|<span class="dv">117.1</span>|Cadre|Femme</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">173</span>|<span class="dv">2</span>|<span class="dv">1</span>|Qualifié|<span class="dv">17</span>/<span class="dv">06</span>/<span class="dv">1998</span>|<span class="dv">01</span>/<span class="dv">01</span>/<span class="dv">2022</span>|<span class="dv">365</span>|<span class="dv">6</span>||<span class="dv">12</span>|<span class="dv">7</span>|<span class="dv">14</span>|<span class="dv">98.3</span>|Cadre|Femme</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">173</span>|<span class="dv">2</span>|<span class="dv">1</span>|Qualifié|<span class="dv">17</span>/<span class="dv">06</span>/<span class="dv">1998</span>|<span class="dv">06</span>/<span class="dv">01</span>/<span class="dv">2022</span>|<span class="dv">185</span>|<span class="dv">8</span>|<span class="dv">10</span>|<span class="dv">11</span>|<span class="dv">1</span>|<span class="dv">9</span>|<span class="dv">214.6</span>|Cadre|Femme</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">173</span>|<span class="dv">2</span>|<span class="dv">1</span>|Non qualifié|<span class="dv">17</span>/<span class="dv">06</span>/<span class="dv">1998</span>|<span class="dv">02</span>/<span class="dv">01</span>/<span class="dv">2023</span>|<span class="dv">365</span>|<span class="dv">14</span>|<span class="dv">15</span>|<span class="dv">15</span>|<span class="dv">10</span>|<span class="dv">8</span>|<span class="dv">84.7</span>|Cadre|Femme</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">174</span>|<span class="dv">1</span>|<span class="dv">1</span>|Qualifié|<span class="dv">08</span>/<span class="dv">12</span>/<span class="dv">1984</span>|<span class="dv">17</span>/<span class="dv">08</span>/<span class="dv">2021</span>|<span class="dv">183</span>|<span class="dv">17</span>|<span class="dv">18</span>|<span class="dv">20</span>|<span class="dv">15</span>|<span class="dv">12</span>|<span class="dv">65.9</span>|Cadre|Homme</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="dv">175</span>|<span class="dv">1</span>|<span class="dv">1</span>|Qualifié|<span class="dv">16</span>/<span class="dv">09</span>/<span class="dv">1989</span>|<span class="dv">21</span>/<span class="dv">12</span>/<span class="dv">2022</span>|<span class="dv">730</span>|<span class="dv">5</span>|<span class="dv">5</span>|<span class="dv">8</span>|<span class="dv">4</span>|<span class="dv">9</span>|<span class="dv">148.2</span>|Cadre|Homme</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="dv">198</span>|<span class="dv">2</span>|<span class="dv">3</span>|Non qualifié|<span class="dv">17</span>/<span class="dv">03</span>/<span class="dv">1987</span>|<span class="dv">28</span>/<span class="dv">07</span>/<span class="dv">2022</span>|<span class="dv">30</span>|<span class="dv">10</span>|<span class="dv">10</span>|<span class="dv">10</span>|<span class="dv">16</span>|<span class="dv">8</span>|<span class="dv">89.6</span>|Employé|Femme</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="dv">198</span>|<span class="dv">2</span>|<span class="dv">3</span>|Qualifié|<span class="dv">17</span>/<span class="dv">03</span>/<span class="dv">1987</span>|<span class="dv">17</span>/<span class="dv">11</span>/<span class="dv">2022</span>|<span class="dv">164</span>|<span class="dv">11</span>|<span class="dv">7</span>|<span class="dv">6</span>|<span class="dv">14</span>|<span class="dv">13</span>|<span class="dv">100.3</span>|Employé|Femme</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="dv">198</span>|<span class="dv">2</span>|<span class="dv">3</span>|Qualifié|<span class="dv">17</span>/<span class="dv">03</span>/<span class="dv">1987</span>|<span class="dv">21</span>/<span class="dv">02</span>/<span class="dv">2023</span>|<span class="dv">365</span>|<span class="dv">9</span>|<span class="dv">20</span>|<span class="dv">3</span>|<span class="dv">4</span>|<span class="dv">17</span>|<span class="dv">49.3</span>|Employé|Femme</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="dv">168</span>|<span class="dv">1</span>|<span class="dv">2</span>|Qualifié|<span class="dv">30</span>/<span class="dv">07</span>/<span class="dv">2002</span>|<span class="dv">04</span>/<span class="dv">09</span>/<span class="dv">2019</span>|<span class="dv">365</span>|<span class="dv">18</span>|<span class="dv">11</span>|<span class="dv">20</span>|<span class="dv">13</span>|<span class="dv">15</span>|<span class="dv">148.2</span>|Profession intermédiaire|Homme</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="dv">211</span>|<span class="dv">2</span>|<span class="dv">3</span>|Non qualifié||<span class="dv">17</span>/<span class="dv">12</span>/<span class="dv">2021</span>|<span class="dv">135</span>|<span class="dv">16</span>|<span class="dv">16</span>|<span class="dv">15</span>|<span class="dv">12</span>|<span class="dv">9</span>|<span class="dv">86.4</span>|Employé|Femme</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="dv">278</span>|<span class="dv">1</span>|<span class="dv">5</span>|Qualifié|<span class="dv">10</span>/<span class="dv">08</span>/<span class="dv">1948</span>|<span class="dv">07</span>/<span class="dv">06</span>/<span class="dv">2018</span>|<span class="dv">365</span>|<span class="dv">14</span>|<span class="dv">10</span>|<span class="dv">6</span>|<span class="dv">8</span>|<span class="dv">12</span>|<span class="dv">99.2</span>|Retraité|Homme</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="dv">347</span>|<span class="dv">2</span>|<span class="dv">5</span>|Qualifié|<span class="dv">13</span>/<span class="dv">09</span>/<span class="dv">1955</span>||<span class="dv">180</span>|<span class="dv">12</span>|<span class="dv">5</span>|<span class="dv">7</span>|<span class="dv">11</span>|<span class="dv">12</span>|<span class="dv">105.6</span>|Retraité|Femme</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="dv">112</span>|<span class="dv">1</span>|<span class="dv">3</span>|Non qualifié|<span class="dv">13</span>/<span class="dv">09</span>/<span class="dv">2001</span>|<span class="dv">02</span>/<span class="dv">03</span>/<span class="dv">2022</span>|<span class="dv">212</span>|<span class="dv">3</span>|<span class="dv">10</span>|<span class="dv">11</span>|<span class="dv">9</span>|<span class="dv">8</span>|<span class="dv">123.1</span>|Employé|Homme</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="dv">112</span>|<span class="dv">1</span>|<span class="dv">3</span>|Non qualifié|<span class="dv">13</span>/<span class="dv">09</span>/<span class="dv">2001</span>|<span class="dv">01</span>/<span class="dv">03</span>/<span class="dv">2021</span>|<span class="dv">365</span>|<span class="dv">7</span>|<span class="dv">13</span>|<span class="dv">8</span>|<span class="dv">19</span>|<span class="dv">2</span>|<span class="dv">137.4</span>|Employé|Homme</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="dv">112</span>|<span class="dv">1</span>|<span class="dv">3</span>|Qualifié|<span class="dv">13</span>/<span class="dv">09</span>/<span class="dv">2001</span>|<span class="dv">01</span>/<span class="dv">12</span>/<span class="dv">2023</span>|<span class="dv">365</span>|<span class="dv">9</span>|||||<span class="dv">187.6</span>|Employé|Homme</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="dv">087</span>|<span class="dv">2</span>|<span class="dv">4</span>|Non qualifié|||<span class="dv">365</span>||<span class="dv">10</span>||||<span class="dv">87.3</span>|Ouvrier|Femme</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="dv">087</span>|<span class="dv">2</span>|<span class="dv">4</span>|Non qualifié||<span class="dv">31</span>/<span class="dv">10</span>/<span class="dv">2020</span>|<span class="dv">365</span>|||<span class="dv">11</span>|||<span class="dv">87.3</span>|Ouvrier|Femme</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="dv">099</span>|<span class="dv">1</span>|<span class="dv">4</span>|Qualifié|<span class="dv">06</span>/<span class="dv">06</span>/<span class="dv">1998</span>|<span class="dv">01</span>/<span class="dv">03</span>/<span class="dv">2021</span>|<span class="dv">364</span>|<span class="dv">12</span>|<span class="dv">11</span>|<span class="dv">10</span>|<span class="dv">12</span>|<span class="dv">13</span>|<span class="dv">169.3</span>|Ouvrier|Homme</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="dv">099</span>|<span class="dv">1</span>|<span class="dv">4</span>|Qualifié|<span class="dv">06</span>/<span class="dv">06</span>/<span class="dv">1998</span>|<span class="dv">01</span>/<span class="dv">03</span>/<span class="dv">2022</span>|<span class="dv">364</span>|<span class="dv">12</span>|<span class="dv">11</span>|<span class="dv">10</span>|<span class="dv">12</span>|<span class="dv">13</span>|<span class="dv">169.3</span>|Ouvrier|Homme</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="dv">099</span>|<span class="dv">1</span>|<span class="dv">4</span>|Qualifié|<span class="dv">06</span>/<span class="dv">06</span>/<span class="dv">1998</span>|<span class="dv">01</span>/<span class="dv">03</span>/<span class="dv">2023</span>|<span class="dv">364</span>|<span class="dv">12</span>|<span class="dv">11</span>|<span class="dv">10</span>|<span class="dv">12</span>|<span class="dv">13</span>|<span class="dv">169.3</span>|Ouvrier|Homme</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="dv">187</span>|<span class="dv">2</span>|<span class="dv">2</span>|Qualifié|<span class="dv">05</span>/<span class="dv">12</span>/<span class="dv">1986</span>|<span class="dv">01</span>/<span class="dv">01</span>/<span class="dv">2022</span>|<span class="dv">364</span>|<span class="dv">10</span>|<span class="dv">10</span>|<span class="dv">10</span>|<span class="dv">10</span>|<span class="dv">10</span>|<span class="dv">169.3</span>|Profession intermédiaire|Femme</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  <span class="dv">187</span>|<span class="dv">2</span>|<span class="dv">2</span>|Qualifié|<span class="dv">05</span>/<span class="dv">12</span>/<span class="dv">1986</span>|<span class="dv">01</span>/<span class="dv">01</span>/<span class="dv">2023</span>|<span class="dv">364</span>|<span class="dv">10</span>|<span class="dv">10</span>|<span class="dv">10</span>|<span class="dv">10</span>|<span class="dv">10</span>|<span class="dv">234.1</span>|Profession intermédiaire|Femme</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="dv">689</span>|<span class="dv">1</span>|<span class="dv">1</span>||<span class="dv">01</span>/<span class="dv">12</span>/<span class="dv">2000</span>|<span class="dv">06</span>/<span class="dv">11</span>/<span class="dv">2017</span>|<span class="dv">123</span>|<span class="dv">9</span>|<span class="dv">7</span>|<span class="dv">8</span>|<span class="dv">13</span>|<span class="dv">16</span>|<span class="dv">189.3</span>|Cadre|Homme</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="dv">765</span>|<span class="dv">1</span>|<span class="dv">4</span>|Non qualifié|<span class="dv">26</span>/<span class="dv">12</span>/<span class="dv">1995</span>|<span class="dv">17</span>/<span class="dv">04</span>/<span class="dv">2020</span>|<span class="dv">160</span>|<span class="dv">13</span>|<span class="dv">10</span>|<span class="dv">12</span>|<span class="dv">18</span>|<span class="dv">10</span>|<span class="dv">45.9</span>|Ouvrier|Homme</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="dv">765</span>|<span class="dv">1</span>|<span class="dv">4</span>|Non qualifié|<span class="dv">26</span>/<span class="dv">12</span>/<span class="dv">1995</span>|<span class="dv">17</span>/<span class="dv">04</span>/<span class="dv">2020</span>|<span class="dv">160</span>|<span class="dv">13</span>|<span class="dv">10</span>|<span class="dv">12</span>|<span class="dv">18</span>|<span class="dv">10</span>|<span class="dv">45.9</span>|Ouvrier|Homme</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="dv">765</span>|<span class="dv">1</span>|<span class="dv">4</span>|Non qualifié|<span class="dv">26</span>/<span class="dv">12</span>/<span class="dv">1995</span>|<span class="dv">17</span>/<span class="dv">04</span>/<span class="dv">2020</span>|<span class="dv">160</span>|<span class="dv">13</span>|<span class="dv">10</span>|<span class="dv">12</span>|<span class="dv">18</span>|<span class="dv">10</span>|<span class="dv">45.9</span>|Ouvrier|Homme</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  ;</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="co">/* Date de sortie du dispositif : ajout de la durée à la date d&#39;entrée */</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> date_sortie ddmmyy10.;</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  date_sortie = <span class="fu">intnx</span>(<span class="st">&#39;day&#39;</span>, date_entree, duree);</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-3-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Données fictives sur des formations</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Identifiant =</span> <span class="fu">c</span>(<span class="st">&quot;173&quot;</span>, <span class="st">&quot;173&quot;</span>, <span class="st">&quot;173&quot;</span>, <span class="st">&quot;173&quot;</span>, <span class="st">&quot;174&quot;</span>, <span class="st">&quot;175&quot;</span>, <span class="st">&quot;198&quot;</span>, <span class="st">&quot;198&quot;</span>, <span class="st">&quot;198&quot;</span>, <span class="st">&quot;168&quot;</span>, <span class="st">&quot;211&quot;</span>, <span class="st">&quot;278&quot;</span>, <span class="st">&quot;347&quot;</span>, <span class="st">&quot;112&quot;</span>, <span class="st">&quot;112&quot;</span>, <span class="st">&quot;112&quot;</span>, <span class="st">&quot;087&quot;</span>, <span class="st">&quot;087&quot;</span>, <span class="st">&quot;099&quot;</span>, <span class="st">&quot;099&quot;</span>, <span class="st">&quot;099&quot;</span>, <span class="st">&quot;187&quot;</span>, <span class="st">&quot;187&quot;</span>, <span class="st">&quot;689&quot;</span>, <span class="st">&quot;765&quot;</span>, <span class="st">&quot;765&quot;</span>, <span class="st">&quot;765&quot;</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sexe =</span> <span class="fu">c</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">CSP =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Niveau =</span> <span class="fu">c</span>(<span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Date_naissance =</span> <span class="fu">c</span>(<span class="st">&quot;17/06/1998&quot;</span>, <span class="st">&quot;17/06/1998&quot;</span>, <span class="st">&quot;17/06/1998&quot;</span>, <span class="st">&quot;17/06/1998&quot;</span>, <span class="st">&quot;08/12/1984&quot;</span>, <span class="st">&quot;16/09/1989&quot;</span>, <span class="st">&quot;17/03/1987&quot;</span>, <span class="st">&quot;17/03/1987&quot;</span>, <span class="st">&quot;17/03/1987&quot;</span>, <span class="st">&quot;30/07/2002&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;10/08/1948&quot;</span>, </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;13/09/1955&quot;</span>, <span class="st">&quot;13/09/2001&quot;</span>, <span class="st">&quot;13/09/2001&quot;</span>, <span class="st">&quot;13/09/2001&quot;</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;06/06/1998&quot;</span>, <span class="st">&quot;06/06/1998&quot;</span>, <span class="st">&quot;06/06/1998&quot;</span>, <span class="st">&quot;05/12/1986&quot;</span>, <span class="st">&quot;05/12/1986&quot;</span>, <span class="st">&quot;01/12/2000&quot;</span>, <span class="st">&quot;26/12/1995&quot;</span>, <span class="st">&quot;26/12/1995&quot;</span>, <span class="st">&quot;26/12/1995&quot;</span>),</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Date_entree =</span> <span class="fu">c</span>(<span class="st">&quot;01/01/2021&quot;</span>, <span class="st">&quot;01/01/2022&quot;</span>, <span class="st">&quot;06/01/2022&quot;</span>, <span class="st">&quot;02/01/2023&quot;</span>, <span class="st">&quot;17/08/2021&quot;</span>, <span class="st">&quot;21/12/2022&quot;</span>, <span class="st">&quot;28/07/2022&quot;</span>, <span class="st">&quot;17/11/2022&quot;</span>, <span class="st">&quot;21/02/2023&quot;</span>, <span class="st">&quot;04/09/2019&quot;</span>, <span class="st">&quot;17/12/2021&quot;</span>, <span class="st">&quot;07/06/2018&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;02/03/2022&quot;</span>, <span class="st">&quot;01/03/2021&quot;</span>, <span class="st">&quot;01/12/2023&quot;</span>, <span class="cn">NA</span>, </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;31/10/2020&quot;</span>, <span class="st">&quot;01/03/2021&quot;</span>, <span class="st">&quot;01/03/2022&quot;</span>, <span class="st">&quot;01/03/2023&quot;</span>, <span class="st">&quot;01/01/2022&quot;</span>, <span class="st">&quot;01/01/2023&quot;</span>, <span class="st">&quot;06/11/2017&quot;</span>, <span class="st">&quot;17/04/2020&quot;</span>, <span class="st">&quot;17/04/2020&quot;</span>, <span class="st">&quot;17/04/2020&quot;</span>),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Duree =</span> <span class="fu">c</span>(<span class="st">&quot;308&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;185&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;183&quot;</span>, <span class="st">&quot;730&quot;</span>, <span class="st">&quot;30&quot;</span>, <span class="st">&quot;164&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;135&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;180&quot;</span>, <span class="st">&quot;212&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;364&quot;</span>, <span class="st">&quot;364&quot;</span>, <span class="st">&quot;364&quot;</span>, <span class="st">&quot;364&quot;</span>, <span class="st">&quot;364&quot;</span>, <span class="st">&quot;123&quot;</span>, <span class="st">&quot;160&quot;</span>, <span class="st">&quot;160&quot;</span>, <span class="st">&quot;160&quot;</span>),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Note_Contenu =</span> <span class="fu">c</span>(<span class="st">&quot;12&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;14&quot;</span>, <span class="st">&quot;17&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;14&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;13&quot;</span>),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Note_Formateur =</span> <span class="fu">c</span>(<span class="st">&quot;6&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;20&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;10&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>),</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Note_Moyens =</span> <span class="fu">c</span>(<span class="st">&quot;17&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;20&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;20&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>),</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Note_Accompagnement =</span> <span class="fu">c</span>(<span class="st">&quot;4&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;14&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;19&quot;</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;18&quot;</span>),</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">Note_Materiel =</span> <span class="fu">c</span>(<span class="st">&quot;19&quot;</span>, <span class="st">&quot;14&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;17&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>),</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">poids_sondage =</span> <span class="fu">c</span>(<span class="st">&quot;117.1&quot;</span>, <span class="st">&quot;98.3&quot;</span>, <span class="st">&quot;214.6&quot;</span>, <span class="st">&quot;84.7&quot;</span>, <span class="st">&quot;65.9&quot;</span>, <span class="st">&quot;148.2&quot;</span>, <span class="st">&quot;89.6&quot;</span>, <span class="st">&quot;100.3&quot;</span>, <span class="st">&quot;49.3&quot;</span>, <span class="st">&quot;148.2&quot;</span>, <span class="st">&quot;86.4&quot;</span>, <span class="st">&quot;99.2&quot;</span>, <span class="st">&quot;105.6&quot;</span>, <span class="st">&quot;123.1&quot;</span>, <span class="st">&quot;137.4&quot;</span>, <span class="st">&quot;187.6&quot;</span>, <span class="st">&quot;87.3&quot;</span>, <span class="st">&quot;87.3&quot;</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;169.3&quot;</span>, <span class="st">&quot;169.3&quot;</span>, <span class="st">&quot;169.3&quot;</span>, <span class="st">&quot;169.3&quot;</span>, <span class="st">&quot;234.1&quot;</span>, <span class="st">&quot;189.3&quot;</span>, <span class="st">&quot;45.9&quot;</span>, <span class="st">&quot;45.9&quot;</span>, <span class="st">&quot;45.9&quot;</span>),</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">CSPF =</span> <span class="fu">c</span>(<span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Cadre&quot;</span>,<span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Profession intermédiaire&quot;</span>, <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Retraité&quot;</span>, <span class="st">&quot;Retraité&quot;</span>, <span class="st">&quot;Employé&quot;</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Profession intermédiaire&quot;</span>, <span class="st">&quot;Profession intermédiaire&quot;</span>, <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>,</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;Ouvrier&quot;</span>),</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sexef =</span> <span class="fu">c</span>(<span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Mise en forme des données</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co"># R est sensible à la casse, il est pertinent d&#39;harmoniser les noms des variables en minuscule</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(donnees_rbase) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">colnames</span>(donnees_rbase))</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="co"># On a importé toutes les variables en format caractère</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="co"># On convertit certaines variables en format numérique</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>enNumerique <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;duree&quot;</span>, <span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>donnees_rbase[, enNumerique] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(donnees_rbase[, enNumerique], as.integer)</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>poids_sondage <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(donnees_rbase<span class="sc">$</span>poids_sondage)</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="co"># On récupère les variables dont le nom débute par le mot &quot;date&quot;</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>enDate <span class="ot">&lt;-</span> <span class="fu">names</span>(donnees_rbase)[<span class="fu">grepl</span>(<span class="st">&quot;date&quot;</span>, <span class="fu">tolower</span>(<span class="fu">names</span>(donnees_rbase)))]</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="co"># On remplace / par - dans les dates</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>donnees_rbase[, enDate] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(donnees_rbase[, enDate], <span class="cf">function</span>(x) <span class="fu">gsub</span>(<span class="st">&quot;/&quot;</span>, <span class="st">&quot;-&quot;</span>, x))</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="co"># On exprime les dates en format Date</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>donnees_rbase[, enDate] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(donnees_rbase[, enDate], lubridate<span class="sc">::</span>dmy)</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Date de sortie du dispositif</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>date_sortie <span class="ot">&lt;-</span> donnees_rbase<span class="sc">$</span>date_entree <span class="sc">+</span> lubridate<span class="sc">::</span><span class="fu">days</span>(donnees_rbase<span class="sc">$</span>duree)</span></code></pre></div>
</div>
</div>
<div id="tabset-3-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Données fictives sur des formations</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Données fictives sur des formations</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Identifiant =</span> <span class="fu">c</span>(<span class="st">&quot;173&quot;</span>, <span class="st">&quot;173&quot;</span>, <span class="st">&quot;173&quot;</span>, <span class="st">&quot;173&quot;</span>, <span class="st">&quot;174&quot;</span>, <span class="st">&quot;175&quot;</span>, <span class="st">&quot;198&quot;</span>, <span class="st">&quot;198&quot;</span>, <span class="st">&quot;198&quot;</span>, <span class="st">&quot;168&quot;</span>, <span class="st">&quot;211&quot;</span>, <span class="st">&quot;278&quot;</span>, <span class="st">&quot;347&quot;</span>, <span class="st">&quot;112&quot;</span>, <span class="st">&quot;112&quot;</span>, <span class="st">&quot;112&quot;</span>, <span class="st">&quot;087&quot;</span>, <span class="st">&quot;087&quot;</span>, <span class="st">&quot;099&quot;</span>, <span class="st">&quot;099&quot;</span>, <span class="st">&quot;099&quot;</span>, <span class="st">&quot;187&quot;</span>, <span class="st">&quot;187&quot;</span>, <span class="st">&quot;689&quot;</span>, <span class="st">&quot;765&quot;</span>, <span class="st">&quot;765&quot;</span>, <span class="st">&quot;765&quot;</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sexe =</span> <span class="fu">c</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">CSP =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Niveau =</span> <span class="fu">c</span>(<span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>),</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Date_naissance =</span> <span class="fu">c</span>(<span class="st">&quot;17/06/1998&quot;</span>, <span class="st">&quot;17/06/1998&quot;</span>, <span class="st">&quot;17/06/1998&quot;</span>, <span class="st">&quot;17/06/1998&quot;</span>, <span class="st">&quot;08/12/1984&quot;</span>, <span class="st">&quot;16/09/1989&quot;</span>, <span class="st">&quot;17/03/1987&quot;</span>, <span class="st">&quot;17/03/1987&quot;</span>, <span class="st">&quot;17/03/1987&quot;</span>, <span class="st">&quot;30/07/2002&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;10/08/1948&quot;</span>, </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;13/09/1955&quot;</span>, <span class="st">&quot;13/09/2001&quot;</span>, <span class="st">&quot;13/09/2001&quot;</span>, <span class="st">&quot;13/09/2001&quot;</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;06/06/1998&quot;</span>, <span class="st">&quot;06/06/1998&quot;</span>, <span class="st">&quot;06/06/1998&quot;</span>, <span class="st">&quot;05/12/1986&quot;</span>, <span class="st">&quot;05/12/1986&quot;</span>, <span class="st">&quot;01/12/2000&quot;</span>, <span class="st">&quot;26/12/1995&quot;</span>, <span class="st">&quot;26/12/1995&quot;</span>, <span class="st">&quot;26/12/1995&quot;</span>),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Date_entree =</span> <span class="fu">c</span>(<span class="st">&quot;01/01/2021&quot;</span>, <span class="st">&quot;01/01/2022&quot;</span>, <span class="st">&quot;06/01/2022&quot;</span>, <span class="st">&quot;02/01/2023&quot;</span>, <span class="st">&quot;17/08/2021&quot;</span>, <span class="st">&quot;21/12/2022&quot;</span>, <span class="st">&quot;28/07/2022&quot;</span>, <span class="st">&quot;17/11/2022&quot;</span>, <span class="st">&quot;21/02/2023&quot;</span>, <span class="st">&quot;04/09/2019&quot;</span>, <span class="st">&quot;17/12/2021&quot;</span>, <span class="st">&quot;07/06/2018&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;02/03/2022&quot;</span>, <span class="st">&quot;01/03/2021&quot;</span>, <span class="st">&quot;01/12/2023&quot;</span>, <span class="cn">NA</span>, </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;31/10/2020&quot;</span>, <span class="st">&quot;01/03/2021&quot;</span>, <span class="st">&quot;01/03/2022&quot;</span>, <span class="st">&quot;01/03/2023&quot;</span>, <span class="st">&quot;01/01/2022&quot;</span>, <span class="st">&quot;01/01/2023&quot;</span>, <span class="st">&quot;06/11/2017&quot;</span>, <span class="st">&quot;17/04/2020&quot;</span>, <span class="st">&quot;17/04/2020&quot;</span>, <span class="st">&quot;17/04/2020&quot;</span>),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Duree =</span> <span class="fu">c</span>(<span class="st">&quot;308&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;185&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;183&quot;</span>, <span class="st">&quot;730&quot;</span>, <span class="st">&quot;30&quot;</span>, <span class="st">&quot;164&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;135&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;180&quot;</span>, <span class="st">&quot;212&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;364&quot;</span>, <span class="st">&quot;364&quot;</span>, <span class="st">&quot;364&quot;</span>, <span class="st">&quot;364&quot;</span>, <span class="st">&quot;364&quot;</span>, <span class="st">&quot;123&quot;</span>, <span class="st">&quot;160&quot;</span>, <span class="st">&quot;160&quot;</span>, <span class="st">&quot;160&quot;</span>),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Note_Contenu =</span> <span class="fu">c</span>(<span class="st">&quot;12&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;14&quot;</span>, <span class="st">&quot;17&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;14&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;13&quot;</span>),</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Note_Formateur =</span> <span class="fu">c</span>(<span class="st">&quot;6&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;20&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;10&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">Note_Moyens =</span> <span class="fu">c</span>(<span class="st">&quot;17&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;20&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;20&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Note_Accompagnement =</span> <span class="fu">c</span>(<span class="st">&quot;4&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;14&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;19&quot;</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;18&quot;</span>),</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Note_Materiel =</span> <span class="fu">c</span>(<span class="st">&quot;19&quot;</span>, <span class="st">&quot;14&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;17&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>),</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">poids_sondage =</span> <span class="fu">c</span>(<span class="st">&quot;117.1&quot;</span>, <span class="st">&quot;98.3&quot;</span>, <span class="st">&quot;214.6&quot;</span>, <span class="st">&quot;84.7&quot;</span>, <span class="st">&quot;65.9&quot;</span>, <span class="st">&quot;148.2&quot;</span>, <span class="st">&quot;89.6&quot;</span>, <span class="st">&quot;100.3&quot;</span>, <span class="st">&quot;49.3&quot;</span>, <span class="st">&quot;148.2&quot;</span>, <span class="st">&quot;86.4&quot;</span>, <span class="st">&quot;99.2&quot;</span>, <span class="st">&quot;105.6&quot;</span>, <span class="st">&quot;123.1&quot;</span>, <span class="st">&quot;137.4&quot;</span>, <span class="st">&quot;187.6&quot;</span>, <span class="st">&quot;87.3&quot;</span>, <span class="st">&quot;87.3&quot;</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;169.3&quot;</span>, <span class="st">&quot;169.3&quot;</span>, <span class="st">&quot;169.3&quot;</span>, <span class="st">&quot;169.3&quot;</span>, <span class="st">&quot;234.1&quot;</span>, <span class="st">&quot;189.3&quot;</span>, <span class="st">&quot;45.9&quot;</span>, <span class="st">&quot;45.9&quot;</span>, <span class="st">&quot;45.9&quot;</span>),</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">CSPF =</span> <span class="fu">c</span>(<span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Cadre&quot;</span>,<span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Profession intermédiaire&quot;</span>, <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Retraité&quot;</span>, <span class="st">&quot;Retraité&quot;</span>, <span class="st">&quot;Employé&quot;</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Profession intermédiaire&quot;</span>, <span class="st">&quot;Profession intermédiaire&quot;</span>, <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;Ouvrier&quot;</span>),</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sexef =</span> <span class="fu">c</span>(<span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Mise en forme des données</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="co"># R est sensible à la casse, il est pertinent d&#39;harmoniser les noms des variables en minuscule</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">rename_with</span>(tolower)</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="co"># On a importé toutes les variables en format caractère</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="co"># On convertit certaines variables en format numérique</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>enNumerique <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;duree&quot;</span>, <span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="co"># On convertit certaines variables au format date</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="co"># On récupère d&#39;abord les variables dont le nom débute par le mot &quot;date&quot;</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>enDate <span class="ot">&lt;-</span> <span class="fu">names</span>(donnees_tidyverse)[<span class="fu">grepl</span>(<span class="st">&quot;^date&quot;</span>, <span class="fu">tolower</span>(<span class="fu">names</span>(donnees_tidyverse)))]</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Conversion proprement dite</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span>  </span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(enNumerique), as.integer)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">poids_sondage =</span> <span class="fu">as.numeric</span>(poids_sondage)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(enDate), lubridate<span class="sc">::</span>dmy))</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Date de sortie du dispositif</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_sortie =</span> date_entree <span class="sc">+</span> lubridate<span class="sc">::</span><span class="fu">days</span>(duree))</span></code></pre></div>
</div>
</div>
<div id="tabset-3-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Données fictives sur des formations</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Données fictives sur des formations</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>donnees_datatable <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Identifiant =</span> <span class="fu">c</span>(<span class="st">&quot;173&quot;</span>, <span class="st">&quot;173&quot;</span>, <span class="st">&quot;173&quot;</span>, <span class="st">&quot;173&quot;</span>, <span class="st">&quot;174&quot;</span>, <span class="st">&quot;175&quot;</span>, <span class="st">&quot;198&quot;</span>, <span class="st">&quot;198&quot;</span>, <span class="st">&quot;198&quot;</span>, <span class="st">&quot;168&quot;</span>, <span class="st">&quot;211&quot;</span>, <span class="st">&quot;278&quot;</span>, <span class="st">&quot;347&quot;</span>, <span class="st">&quot;112&quot;</span>, <span class="st">&quot;112&quot;</span>, <span class="st">&quot;112&quot;</span>, <span class="st">&quot;087&quot;</span>, <span class="st">&quot;087&quot;</span>, <span class="st">&quot;099&quot;</span>, <span class="st">&quot;099&quot;</span>, <span class="st">&quot;099&quot;</span>, <span class="st">&quot;187&quot;</span>, <span class="st">&quot;187&quot;</span>, <span class="st">&quot;689&quot;</span>, <span class="st">&quot;765&quot;</span>, <span class="st">&quot;765&quot;</span>, <span class="st">&quot;765&quot;</span>),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sexe =</span> <span class="fu">c</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">CSP =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;4&quot;</span>),</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Niveau =</span> <span class="fu">c</span>(<span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>, <span class="st">&quot;Non qualifié&quot;</span>),</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Date_naissance =</span> <span class="fu">c</span>(<span class="st">&quot;17/06/1998&quot;</span>, <span class="st">&quot;17/06/1998&quot;</span>, <span class="st">&quot;17/06/1998&quot;</span>, <span class="st">&quot;17/06/1998&quot;</span>, <span class="st">&quot;08/12/1984&quot;</span>, <span class="st">&quot;16/09/1989&quot;</span>, <span class="st">&quot;17/03/1987&quot;</span>, <span class="st">&quot;17/03/1987&quot;</span>, <span class="st">&quot;17/03/1987&quot;</span>, <span class="st">&quot;30/07/2002&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;10/08/1948&quot;</span>, </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;13/09/1955&quot;</span>, <span class="st">&quot;13/09/2001&quot;</span>, <span class="st">&quot;13/09/2001&quot;</span>, <span class="st">&quot;13/09/2001&quot;</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;06/06/1998&quot;</span>, <span class="st">&quot;06/06/1998&quot;</span>, <span class="st">&quot;06/06/1998&quot;</span>, <span class="st">&quot;05/12/1986&quot;</span>, <span class="st">&quot;05/12/1986&quot;</span>, <span class="st">&quot;01/12/2000&quot;</span>, <span class="st">&quot;26/12/1995&quot;</span>, <span class="st">&quot;26/12/1995&quot;</span>, <span class="st">&quot;26/12/1995&quot;</span>),</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Date_entree =</span> <span class="fu">c</span>(<span class="st">&quot;01/01/2021&quot;</span>, <span class="st">&quot;01/01/2022&quot;</span>, <span class="st">&quot;06/01/2022&quot;</span>, <span class="st">&quot;02/01/2023&quot;</span>, <span class="st">&quot;17/08/2021&quot;</span>, <span class="st">&quot;21/12/2022&quot;</span>, <span class="st">&quot;28/07/2022&quot;</span>, <span class="st">&quot;17/11/2022&quot;</span>, <span class="st">&quot;21/02/2023&quot;</span>, <span class="st">&quot;04/09/2019&quot;</span>, <span class="st">&quot;17/12/2021&quot;</span>, <span class="st">&quot;07/06/2018&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;02/03/2022&quot;</span>, <span class="st">&quot;01/03/2021&quot;</span>, <span class="st">&quot;01/12/2023&quot;</span>, <span class="cn">NA</span>, </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;31/10/2020&quot;</span>, <span class="st">&quot;01/03/2021&quot;</span>, <span class="st">&quot;01/03/2022&quot;</span>, <span class="st">&quot;01/03/2023&quot;</span>, <span class="st">&quot;01/01/2022&quot;</span>, <span class="st">&quot;01/01/2023&quot;</span>, <span class="st">&quot;06/11/2017&quot;</span>, <span class="st">&quot;17/04/2020&quot;</span>, <span class="st">&quot;17/04/2020&quot;</span>, <span class="st">&quot;17/04/2020&quot;</span>),</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Duree =</span> <span class="fu">c</span>(<span class="st">&quot;308&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;185&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;183&quot;</span>, <span class="st">&quot;730&quot;</span>, <span class="st">&quot;30&quot;</span>, <span class="st">&quot;164&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;135&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;180&quot;</span>, <span class="st">&quot;212&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;365&quot;</span>, <span class="st">&quot;364&quot;</span>, <span class="st">&quot;364&quot;</span>, <span class="st">&quot;364&quot;</span>, <span class="st">&quot;364&quot;</span>, <span class="st">&quot;364&quot;</span>, <span class="st">&quot;123&quot;</span>, <span class="st">&quot;160&quot;</span>, <span class="st">&quot;160&quot;</span>, <span class="st">&quot;160&quot;</span>),</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Note_Contenu =</span> <span class="fu">c</span>(<span class="st">&quot;12&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;14&quot;</span>, <span class="st">&quot;17&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;14&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;13&quot;</span>),</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Note_Formateur =</span> <span class="fu">c</span>(<span class="st">&quot;6&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;20&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;10&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>),</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">Note_Moyens =</span> <span class="fu">c</span>(<span class="st">&quot;17&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;20&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;20&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>),</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Note_Accompagnement =</span> <span class="fu">c</span>(<span class="st">&quot;4&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;14&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;19&quot;</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;18&quot;</span>),</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Note_Materiel =</span> <span class="fu">c</span>(<span class="st">&quot;19&quot;</span>, <span class="st">&quot;14&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;17&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;10&quot;</span>),</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">poids_sondage =</span> <span class="fu">c</span>(<span class="st">&quot;117.1&quot;</span>, <span class="st">&quot;98.3&quot;</span>, <span class="st">&quot;214.6&quot;</span>, <span class="st">&quot;84.7&quot;</span>, <span class="st">&quot;65.9&quot;</span>, <span class="st">&quot;148.2&quot;</span>, <span class="st">&quot;89.6&quot;</span>, <span class="st">&quot;100.3&quot;</span>, <span class="st">&quot;49.3&quot;</span>, <span class="st">&quot;148.2&quot;</span>, <span class="st">&quot;86.4&quot;</span>, <span class="st">&quot;99.2&quot;</span>, <span class="st">&quot;105.6&quot;</span>, <span class="st">&quot;123.1&quot;</span>, <span class="st">&quot;137.4&quot;</span>, <span class="st">&quot;187.6&quot;</span>, <span class="st">&quot;87.3&quot;</span>, <span class="st">&quot;87.3&quot;</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;169.3&quot;</span>, <span class="st">&quot;169.3&quot;</span>, <span class="st">&quot;169.3&quot;</span>, <span class="st">&quot;169.3&quot;</span>, <span class="st">&quot;234.1&quot;</span>, <span class="st">&quot;189.3&quot;</span>, <span class="st">&quot;45.9&quot;</span>, <span class="st">&quot;45.9&quot;</span>, <span class="st">&quot;45.9&quot;</span>),</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">CSPF =</span> <span class="fu">c</span>(<span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Cadre&quot;</span>,<span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Profession intermédiaire&quot;</span>, <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Retraité&quot;</span>, <span class="st">&quot;Retraité&quot;</span>, <span class="st">&quot;Employé&quot;</span>,</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Profession intermédiaire&quot;</span>, <span class="st">&quot;Profession intermédiaire&quot;</span>, <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;Ouvrier&quot;</span>,</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;Ouvrier&quot;</span>),</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sexef =</span> <span class="fu">c</span>(<span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>,</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Femme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;Homme&quot;</span>)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Mise en forme des données</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co"># R est sensible à la casse, il est pertinent d&#39;harmoniser les noms des variables en minuscule</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(donnees_datatable) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">colnames</span>(donnees_datatable))</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="co"># On a importé toutes les variables en format caractère</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="co"># On convertit certaines variables en format numérique</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>enNumerique <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;duree&quot;</span>, <span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Ne pas oublier le . devant SDcols !!!!</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">lapply</span>(.SD, as.integer), .SDcols <span class="ot">=</span> enNumerique]</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="co"># En data.table, les instructions débutant par set modifient les éléments par référence, c&#39;est-à-dire sans copie.</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Ceci est plus efficace pour manipuler des données volumineuses.</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> enNumerique) {</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set</span>(donnees_datatable, <span class="at">j =</span> j, <span class="at">value =</span> <span class="fu">as.numeric</span>(donnees_datatable[[j]]))</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, poids_sondage <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(poids_sondage)]</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="co"># On récupère les variables dont le nom débute par le mot &quot;date&quot;</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>varDates <span class="ot">&lt;-</span> <span class="fu">names</span>(donnees_datatable)[<span class="fu">grepl</span>(<span class="st">&quot;date&quot;</span>, <span class="fu">tolower</span>(<span class="fu">names</span>(donnees_datatable)))]</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a><span class="co"># On remplace / par - dans les dates</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, (varDates) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">gsub</span>(<span class="st">&quot;/&quot;</span>, <span class="st">&quot;-&quot;</span>, x)), .SDcols <span class="ot">=</span> varDates]</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="co"># On exprime les dates en format Date</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, (varDates) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, lubridate<span class="sc">::</span>dmy), .SDcols <span class="ot">=</span> varDates]</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Date de sortie du dispositif</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, date_sortie <span class="sc">:</span><span class="er">=</span> date_entree <span class="sc">+</span> lubridate<span class="sc">::</span><span class="fu">days</span>(duree)]</span></code></pre></div>
</div>
</div>
<div id="tabset-3-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-3-5-tab">
<p>Duckdb est un serveur SQL séparé de la session R. Les calculs sont effectués <em>en dehors</em> de <code>R</code> et l’espace mémoire est distinct de celui de <code>R</code>. Au lieu d’accéder directement aux données, il faut passer par un objet <em>connection</em> qui contient l’adresse du serveur, un peu comme lorsque l’on se connecte à un serveur web. Ici en particulier, il est nécessaire de transférer les données vers <code>duckdb</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ouvrir une connexion au serveur duckdb</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>()); </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># On &quot;copie&quot; les données dans une table du nom table_duckdb</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Données fictives sur des formations</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>con <span class="sc">%&gt;%</span> duckdb<span class="sc">::</span><span class="fu">duckdb_register</span>(<span class="at">name =</span> <span class="st">&quot;table_duckdb&quot;</span>, <span class="at">df =</span> donnees_tidyverse)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>con <span class="sc">%&gt;%</span> <span class="fu">tbl</span>(<span class="st">&quot;table_duckdb&quot;</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fermer la connexion au serveur duckdb</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>DBI<span class="sc">::</span><span class="fu">dbDisconnect</span>(con, <span class="at">shutdown =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<p>Pour la suite, on suppose que la connexion est ouverte sous le nom <code>con</code>, et que les données sont accessibles par la requête <code>requete_duckdb</code>. Le code modifiera la requête, mais pas la table dans le serveur SQL.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>()); </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>con <span class="sc">%&gt;%</span> duckdb<span class="sc">::</span><span class="fu">duckdb_register</span>(<span class="at">name =</span> <span class="st">&quot;table_duckdb&quot;</span>, <span class="at">df =</span> donnees_tidyverse)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="ot">&lt;-</span> con <span class="sc">%&gt;%</span> <span class="fu">tbl</span>(<span class="st">&quot;table_duckdb&quot;</span>)</span></code></pre></div>
</div>
<p>N.B. Duckdb est envisagé pour des traitements sans charger des données en mémoire, par exemple en lisant directement un fichier <code>.parquet</code> sur le disque dur. Dans ce cas, les opérations sont effectuées à la volée, mais n’affectent pas les fichiers source.</p>
</div>
</div>
</div>
</section>
<section id="manipulation-du-format-de-la-base-de-données" class="level2" data-number="2.3">
<h2 data-number="2.3"><span class="header-section-number">2.3</span> Manipulation du format de la base de données</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-5" role="tab" aria-controls="tabset-4-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-4-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>Sans objet pour <code>SAS</code>.</p>
</div>
<div id="tabset-4-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On vérifie que la base importée est bien un data.frame</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.data.frame</span>(donnees_rbase)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Format de la base</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(donnees_rbase)</span></code></pre></div>
</div>
</div>
<div id="tabset-4-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On vérifie que la base importée est bien un tibble</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is_tibble</span>(donnees_tidyverse)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformation en tibble, le format de Tidyverse</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(donnees_tidyverse)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Format de la base</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(donnees_tidyverse)</span></code></pre></div>
</div>
</div>
<div id="tabset-4-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On vérifie que la base est bien un data.table</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.data.table</span>(donnees_datatable)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformation en data.frame</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setDF</span>(donnees_datatable)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">is.data.frame</span>(donnees_datatable)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformation en data.table</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># En data.table, les instructions débutant par set modifient les éléments par référence, c&#39;est-à-dire sans copie.</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ceci est plus efficace pour manipuler des données volumineuses.</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="fu">setDT</span>(donnees_datatable)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">is.data.table</span>(donnees_datatable)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre possibilité</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>donnees_datatable <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(donnees_datatable)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Est-ce une liste ?</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="fu">is.list</span>(donnees_datatable)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Format de la base</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(donnees_datatable)</span></code></pre></div>
</div>
</div>
<div id="tabset-4-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-4-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="importation-de-données-extérieures" class="level2" data-number="2.4">
<h2 data-number="2.4"><span class="header-section-number">2.4</span> Importation de données extérieures</h2>
<p>Importer des données extérieures dans <code>SAS</code> ou <code>R</code> est sans doute la première tâche à laquelle est confronté l’utilisateur de ces logiciels. Ce point important est décrit sur le site Utilit’R : <a href="https://www.book.utilitr.org/03_fiches_thematiques/fiche_import_fichiers_plats" class="uri">https://www.book.utilitr.org/03_fiches_thematiques/fiche_import_fichiers_plats</a>.</p>
<p>Pour importer des fichiers :</p>
<ul>
<li>plats (.csv, .tsv, .txt) : <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_import_fichiers_plats.html" class="uri">https://book.utilitr.org/03_Fiches_thematiques/Fiche_import_fichiers_plats.html</a></li>
<li><code>SAS</code> : <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_import_tables_sas.html" class="uri">https://book.utilitr.org/03_Fiches_thematiques/Fiche_import_tables_sas.html</a></li>
<li>issus de tableurs (Excel, Calc) : <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_import_tableurs.html" class="uri">https://book.utilitr.org/03_Fiches_thematiques/Fiche_import_tableurs.html</a></li>
<li>parquet : <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_import_fichiers_parquet.html" class="uri">https://book.utilitr.org/03_Fiches_thematiques/Fiche_import_fichiers_parquet.html</a></li>
</ul>
<p>Quelques éléments additionnels non couverts dans Utilit’R sont présentés ici.</p>
<section id="la-fonction-readlines-de-r" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1"><span class="header-section-number">2.4.1</span> La fonction ReadLines() de <code>R</code></h3>
<p>La fonction readLines() de <code>R</code> peut s’avérer utile lors de l’importation de fichiers très volumineux. Elle permet de n’importer que les premières lignes du fichier, sans importer l’ensemble de la base, et ainsi de visualiser rapidement le contenu des données et la nature de l’éventuel séparateur de colonnes.</p>
<p>Les options de la fonction utiles sont :</p>
<ul>
<li>con : chemin du fichier à importer</li>
<li>n : nombre maximal de lignes du fichier lues</li>
<li>encoding : définir l’encodage du fichier (“UTF-8” ou “Latin-1”)</li>
</ul>
</section>
<section id="spécificité-des-environnements" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2"><span class="header-section-number">2.4.2</span> Spécificité des environnements</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-4" role="tab" aria-controls="tabset-5-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-5" role="tab" aria-controls="tabset-5-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-5-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="sourceCode" id="cb20"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* À écrire */</span></span></code></pre></div>
</div>
<div id="tabset-5-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p>On utilisera les fonctions read.table, read.csv et read.csv2.</p>
<div class="cell">

</div>
</div>
<div id="tabset-5-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<p>On utilisera les fonctions du package readr : <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_import_fichiers_plats.html#importer-un-fichier-avec-le-package-readr" class="uri">https://book.utilitr.org/03_Fiches_thematiques/Fiche_import_fichiers_plats.html#importer-un-fichier-avec-le-package-readr</a>.</p>
<div class="cell">

</div>
</div>
<div id="tabset-5-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-5-4-tab">
<p>On utilisera la fonction fread : <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_import_fichiers_plats.html#importer-un-fichier-avec-le-package-data.table" class="uri">https://book.utilitr.org/03_Fiches_thematiques/Fiche_import_fichiers_plats.html#importer-un-fichier-avec-le-package-data.table</a>.</p>
<p>Une option utile non présentée dans le lien est : keepLeadingZeros. Si cette option est valorisée à TRUE, les valeurs numériques précédées par des 0 seront importées sous forme caractère et le zéro initial sera conservé.</p>
<div class="cell">

</div>
</div>
<div id="tabset-5-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-5-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="préambule" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Préambule</h1>
<section id="chemin-du-bureau-de-lutilisateur" class="level2" data-number="3.1">
<h2 data-number="3.1"><span class="header-section-number">3.1</span> Chemin du bureau de l’utilisateur</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-4" role="tab" aria-controls="tabset-6-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-5" role="tab" aria-controls="tabset-6-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-6-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="sourceCode" id="cb21"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* On vide la log */</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">dm</span> <span class="st">&quot;log; clear; &quot;</span>;</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">/* On récupère déjà l&#39;identifiant de l&#39;utilisateur (systèmes Windows) */</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> user = <span class="kw">&amp;sysuserid;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">/* Chemin proprement dit */</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> bureau = C:\Users\<span class="kw">&amp;user.</span>\Desktop;</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="kw">libname</span> bur <span class="st">&quot;&amp;bureau.&quot;</span>;</span></code></pre></div>
</div>
<div id="tabset-6-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On récupère déjà l&#39;identifiant de l&#39;utilisateur</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>user <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;USERNAME&quot;</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Chemin proprement dit</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>chemin <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;C:/Users&quot;</span>, user, <span class="st">&quot;Desktop&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-6-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On récupère déjà l&#39;identifiant de l&#39;utilisateur</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>user <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;USERNAME&quot;</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Chemin proprement dit</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>chemin <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;C:/Users&quot;</span>, user, <span class="st">&quot;Desktop&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-6-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-6-4-tab">
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On récupère déjà l&#39;identifiant de l&#39;utilisateur</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>user <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;USERNAME&quot;</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Chemin proprement dit</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>chemin <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;C:/Users&quot;</span>, user, <span class="st">&quot;Desktop&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-6-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-6-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="affichage-de-lannée" class="level2" data-number="3.2">
<h2 data-number="3.2"><span class="header-section-number">3.2</span> Affichage de l’année</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-4" role="tab" aria-controls="tabset-7-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-5" role="tab" aria-controls="tabset-7-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-7-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="sourceCode" id="cb25"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Année courante */</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> an = <span class="kw">%sysfunc</span>(<span class="fu">year</span>(<span class="kw">%sysfunc</span>(<span class="fu">today</span>())));</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">/* &amp; (esperluette) indique à SAS qu&#39;il doit remplacer an par sa valeur définie par le %let */</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> Année : <span class="kw">&amp;an.</span>;</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">/* Autre possibilité */</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> _null_;<span class="kw">call</span> symput(<span class="st">&#39;annee&#39;</span>, strip(<span class="fu">year</span>(<span class="fu">today</span>())))<span class="kw">;run</span>;</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> Année (autre méthode) : <span class="kw">&amp;annee.</span>;</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">/* Année passée */</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> Année passée : <span class="kw">%eval</span>(<span class="kw">&amp;an.</span> - <span class="dv">1</span>);</span></code></pre></div>
</div>
<div id="tabset-7-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Année courante</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>annee <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">year</span>(<span class="fu">Sys.Date</span>())</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;Année : %04d&quot;</span>, annee)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;Année : &quot;</span>, annee))</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre possibilité</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;Année : &quot;</span>, <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">&quot;%Y&quot;</span>)))</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Année passée</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>annee_1 <span class="ot">&lt;-</span> annee <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">&quot;Année passée : &quot;</span>, annee_1)</span></code></pre></div>
</div>
</div>
<div id="tabset-7-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Année courante</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>annee <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">year</span>(<span class="fu">Sys.Date</span>())</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;Année : %04d&quot;</span>, annee)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;Année : &quot;</span>, annee))</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre possibilité</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;Année : &quot;</span>, <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">&quot;%Y&quot;</span>)))</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Année passée</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>annee_1 <span class="ot">&lt;-</span> annee <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">&quot;Année passée : &quot;</span>, annee_1)</span></code></pre></div>
</div>
</div>
<div id="tabset-7-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-7-4-tab">
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Année courante</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>annee <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">year</span>(<span class="fu">Sys.Date</span>())</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;Année : %04d&quot;</span>, annee)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;Année : &quot;</span>, annee))</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre possibilité</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;Année : &quot;</span>, <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">&quot;%Y&quot;</span>)))</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Année passée</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>annee_1 <span class="ot">&lt;-</span> annee <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">&quot;Année passée : &quot;</span>, annee_1)</span></code></pre></div>
</div>
</div>
<div id="tabset-7-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-7-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="construction-des-instructions-if-else" class="level2" data-number="3.3">
<h2 data-number="3.3"><span class="header-section-number">3.3</span> Construction des instructions if / else</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-3" role="tab" aria-controls="tabset-8-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-4" role="tab" aria-controls="tabset-8-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-5" role="tab" aria-controls="tabset-8-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-8-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="sourceCode" id="cb29"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> Annee(an);</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%if</span> <span class="kw">&amp;an.</span> &gt;= <span class="dv">2024</span> <span class="kw">%then</span> <span class="kw">%put</span> Nous sommes en <span class="dv">2024</span> ou après !;</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%else</span> <span class="kw">%put</span> Nous sommes avant <span class="dv">2024</span> !;</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="kw">%mend</span> Annee;</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>%Annee(&amp;an.);</span></code></pre></div>
</div>
<div id="tabset-8-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Construction incorrecte ! Le else doit être sur la même ligne que le {</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#if (annee &gt;= 2024) {</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  print(&quot;Nous sommes en 2024 ou après&quot;)</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">#else {</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  print(&quot;Nous sommes avant 2024&quot;)</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Construction correcte ! Le else doit être sur la même ligne que le {</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (annee <span class="sc">&gt;=</span> <span class="dv">2024</span>) {</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Nous sommes en 2024 ou après&quot;</span>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Nous sommes avant 2024 !&quot;</span>)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="tabset-8-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-8-3-tab">
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Construction incorrecte ! Le else doit être sur la même ligne que le {</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#if (annee &gt;= 2024) {</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  print(&quot;Nous sommes en 2024 ou après&quot;)</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#else {</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  print(&quot;Nous sommes avant 2024&quot;)</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Construction correcte ! Le else doit être sur la même ligne que le {</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (annee <span class="sc">&gt;=</span> <span class="dv">2024</span>) {</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Nous sommes en 2024 ou après&quot;</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Nous sommes avant 2024 !&quot;</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="tabset-8-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-8-4-tab">
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Construction incorrecte ! Le else doit être sur la même ligne que le {</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">#if (annee &gt;= 2024) {</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  print(&quot;Nous sommes en 2024 ou après&quot;)</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">#else {</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  print(&quot;Nous sommes avant 2024&quot;)</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Construction correcte ! Le else doit être sur la même ligne que le {</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (annee <span class="sc">&gt;=</span> <span class="dv">2024</span>) {</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Nous sommes en 2024 ou après&quot;</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Nous sommes avant 2024 !&quot;</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="tabset-8-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-8-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="répertoire-de-travail" class="level2" data-number="3.4">
<h2 data-number="3.4"><span class="header-section-number">3.4</span> Répertoire de travail</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-3" role="tab" aria-controls="tabset-9-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-4" role="tab" aria-controls="tabset-9-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-5" role="tab" aria-controls="tabset-9-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-9-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="sourceCode" id="cb33"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Afficher le répertoire de travail par défaut (la Work) */</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> chemin_work = <span class="kw">%sysfunc</span>(<span class="fu">pathname</span>(work));</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> <span class="kw">&amp;chemin_work.</span>;</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> path <span class="kw">from</span> dictionary.libnames <span class="kw">where</span> <span class="kw">libname</span> = <span class="st">&quot;WORK&quot;</span>;</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">/* Définir le répertoire de travail, si besoin */</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co">/* libname &quot;nom du répertoire&quot;; */</span></span></code></pre></div>
</div>
<div id="tabset-9-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher le répertoire de travail</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir le répertoire de travail, si besoin</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">#setwd(dir = &quot;nom du répertoire&quot;)</span></span></code></pre></div>
</div>
</div>
<div id="tabset-9-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-9-3-tab">
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher le répertoire de travail</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir le répertoire de travail, si besoin</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#setwd(dir = &quot;nom du répertoire&quot;)</span></span></code></pre></div>
</div>
</div>
<div id="tabset-9-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-9-4-tab">
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher le répertoire de travail</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir le répertoire de travail, si besoin</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">#setwd(dir = &quot;nom du répertoire&quot;)</span></span></code></pre></div>
</div>
</div>
<div id="tabset-9-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-9-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="autres-points-à-connaître" class="level2" data-number="3.5">
<h2 data-number="3.5"><span class="header-section-number">3.5</span> Autres points à connaître</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-3" role="tab" aria-controls="tabset-10-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-4" role="tab" aria-controls="tabset-10-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-5" role="tab" aria-controls="tabset-10-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-10-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<p>Mise en garde : certains codes <code>SAS</code> pourraient aussi avec profit être écrits en langage SAS IML (Interactive Matrix Language). Cet aide-mémoire n’ayant pas vocation à être un dictionnaire <code>SAS</code>, cette méthode d’écriture n’est pas proposée ici.</p>
</div>
<div id="tabset-10-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<p><code>R base</code> est réputé plus lent que ses concurrents, ce qui est souvent vrai. Mais certaines fonctions en R-Base être très rapides (rowsum, rowSums, tapply, etc.)</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Le pipe permet d&#39;enchaîner des opérations sur une même base.</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Il n&#39;est pas réservé au tidyverse, et peut être utilisé avec R-Base et data.table.</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">|&gt;</span> <span class="fu">sum</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-10-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-10-3-tab">
<p><code>tidyverse</code> promeut l’utilisation du pipe (%&gt;%), qui permet d’enchaîner des opérations sur une même base modifiée successivement. 2 types de pipes existent, le pipe de magrittr (%&gt;%) et le pipe de R-Base (|&gt;, à partir de la version 4.1) Les fonctionnalités simples des deux opérateurs sont identiques, mais il existe des différences. Dans cet aide-mémoire, le pipe de magrittr (%&gt;%) est privilégié.</p>
<p>Le tidyverse peut s’utiliser sans pipe, mais le pipe simplifie la gestion des programmes. Les autres environnements (<code>R base</code>, <code>data.table</code>) peuvent aussi se présenter avec le pipe.</p>
</div>
<div id="tabset-10-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-10-4-tab">
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Principe de base de data.table</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">#dt[i, j, by]</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># i : sélection de lignes (instructions )</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># j : sélection et manipulation de colonnes</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># by : groupements</span></span></code></pre></div>
</div>
</div>
<div id="tabset-10-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-10-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="informations-sur-la-base-de-données" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Informations sur la base de données</h1>
<section id="avoir-une-vue-densemble-des-données" class="level2" data-number="4.1">
<h2 data-number="4.1"><span class="header-section-number">4.1</span> Avoir une vue d’ensemble des données</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-3" role="tab" aria-controls="tabset-11-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-4" role="tab" aria-controls="tabset-11-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-5" role="tab" aria-controls="tabset-11-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-11-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="sourceCode" id="cb39"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Statistiques globales sur les variables numériques */</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">n</span> <span class="fu">mean</span> median <span class="fu">min</span> p10 p25 median p75 p90 <span class="fu">max</span>;<span class="fu">var</span> _numeric_<span class="kw">;run</span>;</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">/* Statistiques globales sur les variables caractères */</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;tables _character_ / missing<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-11-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Informations sur les variables</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(donnees_rbase)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistiques descriptives des variables de la base</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(donnees_rbase)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>Hmisc<span class="sc">::</span><span class="fu">describe</span>(donnees_rbase)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualiser la base de données</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(donnees_rbase)</span></code></pre></div>
</div>
</div>
<div id="tabset-11-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-11-3-tab">
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Informations sur les variables</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistiques descriptives des variables de la base</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualiser la base de données</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">View</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-11-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-11-4-tab">
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Informations sur les variables</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(donnees_datatable)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistiques descriptives des variables de la base</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(donnees_datatable)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualiser la base de données</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(donnees_datatable)</span></code></pre></div>
</div>
</div>
<div id="tabset-11-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-11-5-tab">
<p>On accède aux données du serveur SQL DuckDB au travers de l’objet <code>requete_duckdb</code>, qui est une requête (avec l’adresse du serveur) et non pas un <code>dataframe</code> ou un <code>tibble</code>. Comme l’accès n’est pas direct, la plupart des fonctions du tidyverse fonctionnent, mais opèrent sur “l’adresse du serveur DuckDB” au lieu d’opérer sur les valeurs (nombres, chaînes de caractères). A part <code>glimpse</code>, la plupart des fonctions ne renvoient pas un résultat exploitable.</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Informations sur les variables</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># requete_duckdb %&gt;% str() </span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>() <span class="co"># préférer glimpse()</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># requete_duckdb %&gt;% summary()</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># requete_duckdb %&gt;% View() </span></span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="extraire-les-x-premières-lignes-de-la-base-10-par-défaut" class="level2" data-number="4.2">
<h2 data-number="4.2"><span class="header-section-number">4.2</span> Extraire les x premières lignes de la base (10 par défaut)</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-3" role="tab" aria-controls="tabset-12-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-4" role="tab" aria-controls="tabset-12-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-5" role="tab" aria-controls="tabset-12-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-12-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="sourceCode" id="cb44"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> <span class="kw">x</span> = <span class="dv">10</span>;</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span> = donnees_sas (firstobs = <span class="dv">1</span> obs = <span class="kw">&amp;x.</span>)<span class="kw">;run</span>;</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">/* Ou alors */</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Lignes<span class="kw">&amp;x.</span>;<span class="kw">set</span> donnees_sas (firstobs = <span class="dv">1</span> obs = <span class="kw">&amp;x.</span>)<span class="kw">;proc</span> print<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-12-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase[<span class="dv">1</span><span class="sc">:</span>x, ]</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(donnees_rbase, x)</span></code></pre></div>
</div>
</div>
<div id="tabset-12-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-12-3-tab">
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>x)</span></code></pre></div>
</div>
</div>
<div id="tabset-12-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-12-4-tab">
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">first</span>(.SD, <span class="dv">10</span>)]</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, .SD[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]]</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(donnees_datatable, <span class="dv">10</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(donnees_datatable, <span class="dv">10</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-12-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-12-5-tab">
<p>DuckDB affiche les dix premières lignes par défaut lorsque l’on évalue une requête, comme indiqué dans le code ci-dessous.</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Ceci est équivalent au code suivant</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># requete_duckdb %&gt;% print(n=10)</span></span></code></pre></div>
</div>
<p>Attention, comme il n’y a pas d’ordre en SQL, il faut ordonner les lignes si on veut un résultat reproductible. C’est une opération qui peut être couteuse en temps CPU.</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(duree) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span></code></pre></div>
</div>
<p>L’objet <code>requete_duckdb</code> est bien une requête (i.e. une liste à deux éléments) même si on peut en afficher le résultat avec la fonction <code>print</code>. Notamment, les informations restent dans la mémoire de DuckDB. Il faut demander explicitement le transfert du résultat vers la session R avec la fonction <code>collect()</code>. On obtient alors un objet de type <code>data.frame</code> ou au lieu de <code>tbl_duckdb_connection</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(requete_duckdb)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>resultat_tibble <span class="ot">&lt;-</span> requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">collect</span>()</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(resultat_tibble)</span></code></pre></div>
</div>
<p>La fonction <code>collect()</code> transfère l’ensemble des données. Pour obtenir uniquement 10 lignes, il faut utiliser l’une des fonctions <code>slice_*</code> (cf <a href="https://dplyr.tidyverse.org/reference/slice.html">documentation</a>). On conseille <code>slice_min</code> ou <code>slice_max</code> qui indiquent explicitement l’ordre utilisé.</p>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(duree, <span class="at">n=</span><span class="dv">4</span>, <span class="at">with_ties=</span><span class="cn">FALSE</span>) <span class="co"># with_ties = TRUE retourne les cas d&#39;égalité, donc plus de 4 lignes</span></span></code></pre></div>
</div>
<p>En DuckDB et/ou sur un serveur SQL, on déconseille les fonctions <code>head</code> (qui ne respecte pas toujours l’ordre indiqué par <code>arrange</code>) ou <code>top_n</code> (superseded). La fonction <code>slice</code> en fonctionne pas : elle ne peut pas respecter l’ordre.</p>
</div>
</div>
</div>
</section>
<section id="extraire-les-x-dernières-lignes-de-la-base-10-par-défaut" class="level2" data-number="4.3">
<h2 data-number="4.3"><span class="header-section-number">4.3</span> Extraire les x dernières lignes de la base (10 par défaut)</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-3" role="tab" aria-controls="tabset-13-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-4" role="tab" aria-controls="tabset-13-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-5" role="tab" aria-controls="tabset-13-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-13-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="sourceCode" id="cb52"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> <span class="kw">x</span> = <span class="dv">10</span>;</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql noprint;<span class="kw">select</span> count(*) <span class="kw">into</span> :total_lignes <span class="kw">from</span> donnees_sas;<span class="kw">quit</span>;</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> deb = <span class="kw">%eval</span>(<span class="kw">&amp;total_lignes.</span> - <span class="kw">&amp;x.</span> + <span class="dv">1</span>);</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Lignes_<span class="kw">&amp;x.</span>;<span class="kw">set</span> donnees_sas (firstobs = <span class="kw">&amp;deb.</span> obs = <span class="kw">&amp;total_lignes.</span>)<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-13-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(donnees_rbase, x)</span></code></pre></div>
</div>
<p>Alternativement</p>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>donnees_rbase[ ( <span class="fu">nrow</span>(donnees_rbase) <span class="sc">-</span> x ) <span class="sc">:</span> <span class="fu">nrow</span>(donnees_rbase), ]</span></code></pre></div>
</div>
<p>Les parenthèses sont importantes. Comparer les deux expressions ! Bon exemple du recycling</p>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>( <span class="fu">nrow</span>(donnees_rbase) <span class="sc">-</span> x ) <span class="sc">:</span> <span class="fu">nrow</span>(donnees_rbase)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(donnees_rbase) <span class="sc">-</span> x <span class="sc">:</span> <span class="fu">nrow</span>(donnees_rbase)</span></code></pre></div>
</div>
</div>
<div id="tabset-13-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-13-3-tab">
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>( (<span class="fu">n</span>() <span class="sc">-</span> x) <span class="sc">:</span> <span class="fu">n</span>())</span></code></pre></div>
</div>
</div>
<div id="tabset-13-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-13-4-tab">
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">last</span>(.SD, x)]</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">last</span>(donnees_datatable, x)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(donnees_datatable, x)</span></code></pre></div>
</div>
<p>Alternativement</p>
<div class="cell">

</div>
</div>
<div id="tabset-13-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-13-5-tab">
<p>Mêmes remarques que pour les premières lignes : il n’y a pas d’ordre a priori en SQL. On conseille <code>slice_min</code> ou <code>slice_max</code> qui indiquent explicitement l’ordre utilisé, et l’on déconseille <code>slice</code> et <code>tail</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">slice_min</span>(duree, <span class="at">n=</span><span class="dv">5</span>, <span class="at">with_ties=</span><span class="cn">FALSE</span>) <span class="co"># with_ties = TRUE retourne les cas d&#39;égalité, donc plus de 5 lignes</span></span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="nombre-de-lignes-et-de-colonnes-dans-la-base" class="level2" data-number="4.4">
<h2 data-number="4.4"><span class="header-section-number">4.4</span> Nombre de lignes et de colonnes dans la base</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-3" role="tab" aria-controls="tabset-14-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-4" role="tab" aria-controls="tabset-14-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-5" role="tab" aria-controls="tabset-14-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-14-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="sourceCode" id="cb59"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Nombre de lignes */</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> count(*) <span class="kw">as</span> Nb_Lignes <span class="kw">from</span> donnees_sas;<span class="kw">quit</span>;</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> count(*) <span class="kw">as</span> Nb_Lignes, count(<span class="kw">distinct</span> identifiant) <span class="kw">as</span> Nb_Identifiants</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> donnees_sas;</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co">/* Liste des variables de la base dans la base Var */</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> contents<span class="kw"> data</span> = donnees_sas out = <span class="fu">Var</span> noprint<span class="kw">;run</span>;</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co">/* Nombre de colonnes */</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> count(*) <span class="kw">as</span> Nb_Colonnes <span class="kw">from</span> <span class="fu">Var</span><span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-14-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les syntaxes dim(donnees_rbase)[1] et dim(donnees_rbase)[2] sont plus rapides que nrow() et ncol()</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;Nombre de lignes : %d | Nombre de colonnes : %d&quot;</span>, <span class="fu">dim</span>(donnees_rbase)[<span class="dv">1</span>], <span class="fu">dim</span>(donnees_rbase)[<span class="dv">2</span>])</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;Nombre de lignes : %d | Nombre de colonnes : %d&quot;</span>, <span class="fu">nrow</span>(donnees_rbase), <span class="fu">ncol</span>(donnees_rbase))</span></code></pre></div>
</div>
</div>
<div id="tabset-14-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-14-3-tab">
<div class="cell">
<div class="sourceCode" id="cb61"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;Nombre de lignes : %d | Nombre de colonnes : %d&quot;</span>,</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>        donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">nrow</span>(),</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>        donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">ncol</span>())</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Nombre de lignes</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Nombre de colonnes</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">ncol</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-14-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-14-4-tab">
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les syntaxes dim(donnees_rbase)[1] et dim(donnees_rbase)[2] sont plus rapides que nrow() et ncol()</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(donnees_datatable) ; <span class="fu">dim</span>(donnees_datatable)[<span class="dv">1</span>] ; <span class="fu">dim</span>(donnees_datatable)[<span class="dv">2</span>]</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(donnees_datatable) ; <span class="fu">nrow</span>(donnees_datatable) ; <span class="fu">ncol</span>(donnees_datatable)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;Nombre de lignes : %d | Nombre de colonnes : %d&quot;</span>, <span class="fu">dim</span>(donnees_datatable)[<span class="dv">1</span>], <span class="fu">dim</span>(donnees_datatable)[<span class="dv">2</span>])</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, .N]</span></code></pre></div>
</div>
</div>
<div id="tabset-14-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-14-5-tab">
<p>Duckdb/SQL ne connaît pas le nombre de lignes sans un calcul. Il faut faire <code>count()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb63"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Nombre de lignes</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">nrow</span>() <span class="co"># retourne NA</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">count</span>() <span class="co"># correct</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Nombre de colonnes</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span>  <span class="fu">ncol</span>()</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="liste-des-variables-de-la-base" class="level2" data-number="4.5">
<h2 data-number="4.5"><span class="header-section-number">4.5</span> Liste des variables de la base</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-3" role="tab" aria-controls="tabset-15-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-4" role="tab" aria-controls="tabset-15-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-5" role="tab" aria-controls="tabset-15-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-15-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="sourceCode" id="cb64"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Par ordre d&#39;apparition dans la base */</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> contents<span class="kw"> data</span> = donnees_sas out = <span class="fu">Var</span> noprint<span class="kw">;run</span>;</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> name <span class="kw">into</span> :nom_col separated <span class="kw">by</span> <span class="st">&quot; &quot;</span> <span class="kw">from</span> <span class="fu">Var</span> <span class="kw">order</span> <span class="kw">by</span> <span class="fu">varnum</span><span class="kw">;run</span>;</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co">/* On affiche les noms des variables */</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> Liste des variables : <span class="kw">&amp;nom_col.</span>;</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co">/* Par ordre alphabétique */</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> contents<span class="kw"> data</span> = donnees_sas out = <span class="fu">Var</span> noprint<span class="kw">;run</span>;</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> name <span class="kw">into</span> :nom_col separated <span class="kw">by</span> <span class="st">&quot; &quot;</span> <span class="kw">from</span> <span class="fu">Var</span><span class="kw">;run</span>;</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="co">/* On affiche les noms des variables */</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> Liste des variables : <span class="kw">&amp;nom_col.</span>;</span></code></pre></div>
</div>
<div id="tabset-15-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="cell">
<div class="sourceCode" id="cb65"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Liste des variables par ordre d&#39;apparition dans la base</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(donnees_rbase)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(donnees_rbase)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Liste des variables par ordre alphabétique</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(donnees_rbase)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">colnames</span>(donnees_rbase))</span></code></pre></div>
</div>
</div>
<div id="tabset-15-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-15-3-tab">
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Liste des variables par ordre d&#39;apparition dans la base</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">names</span>()</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Liste des variables par ordre alphabétique</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">colnames</span>() <span class="sc">%&gt;%</span> <span class="fu">sort</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-15-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-15-4-tab">
<div class="cell">
<div class="sourceCode" id="cb67"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Liste des variables par ordre d&#39;apparition dans la base</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(donnees_datatable)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(donnees_datatable)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Liste des variables par ordre alphabétique</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">colnames</span>(donnees_datatable))</span></code></pre></div>
</div>
</div>
<div id="tabset-15-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-15-5-tab">
<div class="cell">
<div class="sourceCode" id="cb68"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="mettre-les-noms-des-variables-en-minuscule" class="level2" data-number="4.6">
<h2 data-number="4.6"><span class="header-section-number">4.6</span> Mettre les noms des variables en minuscule</h2>
<p><code>R</code> est sensible à la casse, il est pertinent d’harmoniser les noms des variables en minuscule.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-3" role="tab" aria-controls="tabset-16-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-4" role="tab" aria-controls="tabset-16-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-5" role="tab" aria-controls="tabset-16-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-16-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<p>Sans objet, <code>SAS</code> n’est pas sensible à la casse.</p>
</div>
<div id="tabset-16-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(donnees_rbase) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">colnames</span>(donnees_rbase))</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre possibilité</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setNames</span>(donnees_rbase, <span class="fu">tolower</span>(<span class="fu">names</span>(donnees_rbase)))</span></code></pre></div>
</div>
</div>
<div id="tabset-16-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-16-3-tab">
<div class="cell">
<div class="sourceCode" id="cb70"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">rename_with</span>(tolower)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  magrittr<span class="sc">::</span><span class="fu">set_colnames</span>(<span class="at">value =</span> <span class="fu">casefold</span>(<span class="fu">colnames</span>(.), <span class="at">upper =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-16-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-16-4-tab">
<div class="cell">
<div class="sourceCode" id="cb71"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(donnees_datatable) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">colnames</span>(donnees_datatable))</span></code></pre></div>
</div>
</div>
<div id="tabset-16-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-16-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="nombre-didentifiants-uniques-et-de-lignes-dans-la-base" class="level2" data-number="4.7">
<h2 data-number="4.7"><span class="header-section-number">4.7</span> Nombre d’identifiants uniques et de lignes dans la base</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-3" role="tab" aria-controls="tabset-17-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-4" role="tab" aria-controls="tabset-17-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-5" role="tab" aria-controls="tabset-17-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-17-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<div class="sourceCode" id="cb72"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> count(*) <span class="kw">as</span> Nb_Lignes, count(<span class="kw">distinct</span> identifiant) <span class="kw">as</span> Nb_Identifiants_Uniques</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> donnees_sas;</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-17-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<div class="cell">
<div class="sourceCode" id="cb73"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;La base de données contient %d lignes et %d identifiants uniques !&quot;</span>,</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">nrow</span>(donnees_rbase),</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">length</span>(<span class="fu">unique</span>(donnees_rbase<span class="sc">$</span>identifiant)))</span></code></pre></div>
</div>
</div>
<div id="tabset-17-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-17-3-tab">
<div class="cell">
<div class="sourceCode" id="cb74"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;La base de données contient %d lignes et %d identifiants uniques !&quot;</span>,</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>        donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">nrow</span>(),</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>        donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(identifiant) <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">n_distinct</span>()</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution pour le nombre d&#39;identifiants uniques</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(identifiant) <span class="sc">%&gt;%</span> <span class="fu">n_distinct</span>()</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(identifiant) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-17-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-17-4-tab">
<div class="cell">
<div class="sourceCode" id="cb75"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;La base de données contient %d lignes et %d identifiants uniques !&quot;</span>,</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">nrow</span>(donnees_datatable),</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>        donnees_datatable[, <span class="fu">uniqueN</span>(identifiant)])</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants uniques</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">uniqueN</span>(identifiant)]</span></code></pre></div>
</div>
</div>
<div id="tabset-17-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-17-5-tab">
<div class="cell">
<div class="sourceCode" id="cb76"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(identifiant) <span class="sc">%&gt;%</span> <span class="fu">count</span>()</span></code></pre></div>
</div>
<p>Note : on a vu que <code>nrow</code> ne fonctionne pas en DuckDB.</p>
</div>
</div>
</div>
</section>
<section id="quelle-est-la-position-de-la-variable-date_entree" class="level2" data-number="4.8">
<h2 data-number="4.8"><span class="header-section-number">4.8</span> Quelle est la position de la variable date_entree ?</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" role="tab" aria-controls="tabset-18-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" role="tab" aria-controls="tabset-18-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-3" role="tab" aria-controls="tabset-18-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-4" role="tab" aria-controls="tabset-18-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-5" role="tab" aria-controls="tabset-18-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-18-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-18-1-tab">
<div class="sourceCode" id="cb77"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> <span class="fu">var</span> = date_entree;</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> contents<span class="kw"> data</span> = donnees_sas out = <span class="fu">Var</span> noprint<span class="kw">;run</span>;</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> <span class="fu">varnum</span> <span class="kw">as</span> Position <span class="kw">from</span> <span class="fu">Var</span> <span class="kw">where</span> <span class="fu">lowcase</span>(NAME) = <span class="st">&quot;&amp;var.&quot;</span>;</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-18-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-18-2-tab">
<div class="cell">
<div class="sourceCode" id="cb78"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;date_entree&quot;</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> <span class="fu">match</span>(variable, <span class="fu">names</span>(donnees_rbase))</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;La variable %s se trouve en colonne n°%s !&quot;</span>, variable, pos)</span></code></pre></div>
</div>
</div>
<div id="tabset-18-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-18-3-tab">
<div class="cell">
<div class="sourceCode" id="cb79"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;date_entree&quot;</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> <span class="fu">match</span>(variable, donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">colnames</span>())</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;La variable %s se trouve en colonne n°%s !&quot;</span>, variable, pos)</span></code></pre></div>
</div>
</div>
<div id="tabset-18-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-18-4-tab">
<div class="cell">
<div class="sourceCode" id="cb80"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;date_entree&quot;</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> <span class="fu">match</span>(variable, <span class="fu">names</span>(donnees_datatable))</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;La variable %s se trouve en colonne n°%s !&quot;</span>, variable, pos)</span></code></pre></div>
</div>
</div>
<div id="tabset-18-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-18-5-tab">
<div class="cell">
<div class="sourceCode" id="cb81"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;date_entree&quot;</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> <span class="fu">match</span>(variable, requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">colnames</span>())</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;La variable %s se trouve en colonne n°%s !&quot;</span>, variable, pos)</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="variables-qui-débutent-par-note" class="level2" data-number="4.9">
<h2 data-number="4.9"><span class="header-section-number">4.9</span> Variables qui débutent par “note”</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-19-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-1" role="tab" aria-controls="tabset-19-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-2" role="tab" aria-controls="tabset-19-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-3" role="tab" aria-controls="tabset-19-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-4" role="tab" aria-controls="tabset-19-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-5" role="tab" aria-controls="tabset-19-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-19-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-19-1-tab">
<div class="sourceCode" id="cb82"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> contents<span class="kw"> data</span> = donnees_sas out = Variables<span class="kw">;run</span>;</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> Name <span class="kw">from</span> Variables <span class="kw">where</span> <span class="fu">upcase</span>(<span class="fu">substr</span>(Name,<span class="dv">1</span>,<span class="dv">4</span>)) = <span class="st">&quot;NOTE&quot;</span><span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-19-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-19-2-tab">
<div class="cell">
<div class="sourceCode" id="cb83"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;^note&quot;</span>, <span class="fu">names</span>(donnees_rbase), <span class="at">ignore.case =</span> <span class="cn">TRUE</span>, <span class="at">value =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-19-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-19-3-tab">
<div class="cell">
<div class="sourceCode" id="cb84"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(donnees_tidyverse) <span class="sc">|&gt;</span> <span class="fu">str_subset</span>(<span class="st">&quot;^note&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-19-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-19-4-tab">
<div class="cell">
<div class="sourceCode" id="cb85"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">&quot;^note&quot;</span>, <span class="fu">names</span>(donnees_datatable), <span class="at">ignore.case =</span> <span class="cn">TRUE</span>, <span class="at">value =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-19-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-19-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="type-des-variables-int-char-bool-etc." class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Type des variables (int, char, bool, etc.)</h1>
<section id="afficher-le-type-des-variables" class="level2" data-number="5.1">
<h2 data-number="5.1"><span class="header-section-number">5.1</span> Afficher le type des variables</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-20-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-1" role="tab" aria-controls="tabset-20-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-2" role="tab" aria-controls="tabset-20-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-3" role="tab" aria-controls="tabset-20-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-4" role="tab" aria-controls="tabset-20-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-5" role="tab" aria-controls="tabset-20-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-20-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-20-1-tab">
<div class="sourceCode" id="cb86"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> contents<span class="kw"> data</span> = donnees_sas<span class="kw">;run</span>;</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="co">/* On supprime la base Var temporaire */</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> datasets lib = Work nolist;<span class="kw">delete</span> <span class="fu">Var</span><span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-20-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-20-2-tab">
<div class="cell">
<div class="sourceCode" id="cb87"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(donnees_rbase, class)</span></code></pre></div>
</div>
</div>
<div id="tabset-20-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-20-3-tab">
<div class="cell">
<div class="sourceCode" id="cb88"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map</span>(donnees_tidyverse, class)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(donnees_tidyverse)</span></code></pre></div>
</div>
</div>
<div id="tabset-20-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-20-4-tab">
<div class="cell">
<div class="sourceCode" id="cb89"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">lapply</span>(.SD, class)]</span></code></pre></div>
</div>
</div>
<div id="tabset-20-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-20-5-tab">
<p>On ne peut pas appliquer directement la fonction <code>class</code> sur un objet de type <code>connection</code>. Cependant, DuckDB affiche le type des variables dans un print. On peut également appliquer la fonction <code>class</code> sur un extrait des données (après <code>collect</code>).</p>
<div class="cell">
<div class="sourceCode" id="cb90"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map</span>(requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="sc">%&gt;%</span> <span class="fu">collect</span>(), class)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(requete_duckdb)</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="convertir-le-type-dune-seule-variable" class="level2" data-number="5.2">
<h2 data-number="5.2"><span class="header-section-number">5.2</span> Convertir le type d’une seule variable</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-21-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-1" role="tab" aria-controls="tabset-21-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-2" role="tab" aria-controls="tabset-21-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-3" role="tab" aria-controls="tabset-21-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-4" role="tab" aria-controls="tabset-21-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-5" role="tab" aria-controls="tabset-21-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-21-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-21-1-tab">
<div class="sourceCode" id="cb91"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Transformer la variable Sexe en caractère */</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  Sexe_car = <span class="kw">put</span>(Sexe, $<span class="dv">1</span>.);</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Transformer la variable Sexe_car en numérique */</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  Sexe_num = <span class="kw">input</span>(Sexe_car, <span class="dv">1</span>.);</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Transformer une date d&#39;un format caractère à un format Date */</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> <span class="fu">date</span> $<span class="dv">10</span>.;</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">date</span> = <span class="st">&quot;01/01/2000&quot;</span>;</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> date_sas yymmdd10.;</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>  date_sas = <span class="kw">input</span>(<span class="fu">date</span>, ddmmyy10.);</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-21-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-21-2-tab">
<div class="cell">
<div class="sourceCode" id="cb92"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer la variable sexe en numérique</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>sexe_numerique <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(donnees_rbase<span class="sc">$</span>sexe)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer la variable sexe_numerique en caractère</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>sexe_caractere <span class="ot">&lt;-</span> <span class="fu">as.character</span>(donnees_rbase<span class="sc">$</span>sexe_numerique)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer une date d&#39;un format caractère à un format Date</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>date_r <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">dmy</span>(<span class="st">&quot;01/01/2000&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-21-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-21-3-tab">
<div class="cell">
<div class="sourceCode" id="cb93"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer la variable sexe en numérique</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span>  </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sexe_numerique =</span> <span class="fu">as.numeric</span>(sexe))</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer la variable sexe_numerique en caractère</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sexe_caractere =</span> <span class="fu">as.character</span>(sexe_numerique))</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer une date d&#39;un format caractère à un format Date</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span>  </span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_r =</span> lubridate<span class="sc">::</span><span class="fu">dmy</span>(<span class="st">&quot;01/01/2000&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-21-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-21-4-tab">
<div class="cell">
<div class="sourceCode" id="cb94"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer la variable sexe en numérique</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, sexe_numerique <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(sexe)]</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer la variable sexe_numerique en caractère</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, sexe_caractere <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(sexe_numerique)]</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer une date d&#39;un format caractère à un format Date</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, date_r <span class="sc">:</span><span class="er">=</span> lubridate<span class="sc">::</span><span class="fu">dmy</span>(<span class="st">&quot;01/01/2000&quot;</span>)]</span></code></pre></div>
</div>
</div>
<div id="tabset-21-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-21-5-tab">
<div class="cell">
<div class="sourceCode" id="cb95"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span>  </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sexe_numerique =</span> <span class="fu">as.numeric</span>(sexe)) <span class="sc">%&gt;%</span> <span class="co"># Transformer la variable sexe en numérique</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sexe_caractere =</span> <span class="fu">as.character</span>(sexe_numerique)) <span class="sc">%&gt;%</span> <span class="co"># Transformer la variable sexe_numerique en caractère</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;sexe&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n=</span><span class="dv">5</span>)</span></code></pre></div>
</div>
<p>En DuckDB, plusieurs syntaxes sont possibles pour transformer une chaîne de caractères en date. Sauf lorsque la chaîne de caractères n’est pas au format <code>YYYY-MM-DD</code>. On conseille de passer par la fonction <code>strptime</code> de DuckDB pour indiquer le format de la date.</p>
<div class="cell">
<div class="sourceCode" id="cb96"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer une date d&#39;un format caractère à un format Date</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span>  </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_0 =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2000-01-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_1 =</span> <span class="fu">as.Date</span>(<span class="fu">strptime</span>(<span class="st">&quot;01/01/2000&quot;</span>,<span class="st">&quot;%d/%m/%Y&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(date_r = lubridate::dmy(&quot;01/01/2000&quot;)) %&gt;% # no known SQL translation</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;date&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n=</span><span class="dv">5</span>)</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="convertir-le-type-de-plusieurs-variables" class="level2" data-number="5.3">
<h2 data-number="5.3"><span class="header-section-number">5.3</span> Convertir le type de plusieurs variables</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-22-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-1" role="tab" aria-controls="tabset-22-1" aria-selected="true"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-22-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-22-1-tab">
<div class="cell">
<div class="sourceCode" id="cb97"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>enNumerique <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;duree&quot;</span>, <span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>enDate <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;date_naissance&#39;</span>, <span class="st">&#39;date_entree&#39;</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span>  </span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(enNumerique, as.integer) <span class="sc">%&gt;%</span> </span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(enDate, as.character) <span class="sc">%&gt;%</span> </span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(enDate, <span class="sc">~</span> <span class="fu">as.Date</span>(<span class="fu">strptime</span>(.,<span class="st">&#39;%Y-%m-%d&#39;</span>))) <span class="sc">%&gt;%</span> <span class="co"># strptime est une fonction duckdb</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(enNumerique, enDate) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n=</span><span class="dv">5</span>)</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="sélectionner-des-lignes-et-des-colonnes" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Sélectionner des lignes et des colonnes</h1>
<section id="sélectionner-de-colonnes-par-position" class="level2" data-number="6.1">
<h2 data-number="6.1"><span class="header-section-number">6.1</span> Sélectionner de colonnes par position</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-23-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-1" role="tab" aria-controls="tabset-23-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-2" role="tab" aria-controls="tabset-23-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-3" role="tab" aria-controls="tabset-23-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-4" role="tab" aria-controls="tabset-23-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-5" role="tab" aria-controls="tabset-23-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-23-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-23-1-tab">
<div class="sourceCode" id="cb98"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> pos = <span class="dv">1</span>;</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> contents<span class="kw"> data</span> = donnees_sas out = <span class="fu">Var</span> noprint<span class="kw">;run</span>;</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql noprint;</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> name <span class="kw">into</span> :nom_col separated <span class="kw">by</span> <span class="st">&quot; &quot;</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> <span class="fu">Var</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span> <span class="fu">varnum</span> = <span class="kw">&amp;pos.</span>;</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Colonnes;<span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = <span class="kw">&amp;nom_col.</span>)<span class="kw">;run</span>;</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> datasets lib = Work nolist;<span class="kw">delete</span> <span class="fu">Var</span><span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-23-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-23-2-tab">
<div class="cell">
<div class="sourceCode" id="cb99"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Résultat sous forme de vecteur caractère</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_rbase[[pos]] ; <span class="fu">class</span>(id)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_rbase[, pos] ; <span class="fu">class</span>(id)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Résultat sous forme de data.frame</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_rbase[pos] ; <span class="fu">class</span>(id)</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_rbase[, pos, drop <span class="ot">=</span> <span class="cn">FALSE</span>] ; <span class="fu">class</span>(id)</span></code></pre></div>
</div>
</div>
<div id="tabset-23-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-23-3-tab">
<div class="cell">
<div class="sourceCode" id="cb100"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sous forme de vecteur</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="dv">1</span>)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(id)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="fu">all_of</span>(pos))</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(id)</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Sous forme de tibble</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span>)</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(id)</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(pos))</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(id)</span></code></pre></div>
</div>
</div>
<div id="tabset-23-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-23-4-tab">
<div class="cell">
<div class="sourceCode" id="cb101"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Résultat sous forme de vecteur caractère</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_datatable[[pos]] ; <span class="fu">class</span>(id)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Résultat sous forme de data.table</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_datatable[pos] ; <span class="fu">class</span>(id)</span></code></pre></div>
</div>
</div>
<div id="tabset-23-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-23-5-tab">
<p>En DuckDB, il y a une vraie différence entre <code>select</code> et <code>pull</code>. Dans le premier cas, les calculs restent du côté DuckDB, et c’est donc le moteur SQL qui continue à exécuter les calculs. Avec <code>pull</code>, le résultat est un <code>tibble</code> et les données sont transférées à la session R.</p>
<div class="cell">
<div class="sourceCode" id="cb102"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">3</span>)</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="sélectionner-des-colonnes-par-nom" class="level2" data-number="6.2">
<h2 data-number="6.2"><span class="header-section-number">6.2</span> Sélectionner des colonnes par nom</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-24-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-1" role="tab" aria-controls="tabset-24-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-24-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-2" role="tab" aria-controls="tabset-24-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-24-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-3" role="tab" aria-controls="tabset-24-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-24-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-4" role="tab" aria-controls="tabset-24-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-24-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-5" role="tab" aria-controls="tabset-24-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-24-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-24-1-tab">
<div class="sourceCode" id="cb103"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Colonnes;<span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = identifiant)<span class="kw">;run</span>;</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Colonnes;<span class="kw">set</span> donnees_sas;<span class="kw">keep</span> identifiant<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-24-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-24-2-tab">
<div class="cell">
<div class="sourceCode" id="cb104"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Résultat sous forme de vecteur caractère</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_rbase<span class="sc">$</span>identifiant ; <span class="fu">class</span>(id)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_rbase[[<span class="st">&quot;identifiant&quot;</span>]] ; <span class="fu">class</span>(id)</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_rbase[, <span class="st">&quot;identifiant&quot;</span>] ; <span class="fu">class</span>(id)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Résultat sous forme de data.frame</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(donnees_rbase[, <span class="st">&quot;identifiant&quot;</span>])</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Attention, utilisation du drop = FALSE étrange</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a><span class="co"># En fait, l&#39;affectation par [] a pour option par défaut drop = TRUE. Ce qui implique que si l&#39;affectation renvoie un data.frame d&#39;1 seule colonne, l&#39;objet sera transformé en objet plus simple (vecteur en l&#39;occurrence)</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(donnees_rbase[, <span class="st">&quot;identifiant&quot;</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_rbase[<span class="st">&quot;identifiant&quot;</span>] ; <span class="fu">class</span>(id)</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_rbase[, <span class="st">&quot;identifiant&quot;</span>, drop <span class="ot">=</span> <span class="cn">FALSE</span>] ; <span class="fu">class</span>(id)</span></code></pre></div>
</div>
</div>
<div id="tabset-24-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-24-3-tab">
<div class="cell">
<div class="sourceCode" id="cb105"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sous forme de vecteur</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">pull</span>(identifiant)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">&quot;identifiant&quot;</span>)</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Sous forme de tibble</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(identifiant)</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">&quot;identifiant&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-24-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-24-4-tab">
<div class="cell">
<div class="sourceCode" id="cb106"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Résultat sous forme de vecteur caractère</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_datatable<span class="sc">$</span>identifiant ; <span class="fu">class</span>(id)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_datatable[[<span class="st">&quot;identifiant&quot;</span>]] ; <span class="fu">class</span>(id)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_datatable[, identifiant] ; <span class="fu">class</span>(id)</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Résultat sous forme de data.table</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_datatable[, <span class="st">&quot;identifiant&quot;</span>] ; <span class="fu">class</span>(id)</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_datatable[, .(<span class="st">&quot;identifiant&quot;</span>)] ; <span class="fu">class</span>(id)</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">list</span>(<span class="st">&quot;identifiant&quot;</span>)] ; <span class="fu">class</span>(id)</span></code></pre></div>
</div>
</div>
<div id="tabset-24-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-24-5-tab">
<div class="cell">
<div class="sourceCode" id="cb107"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select</span>(identifiant)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">&quot;identifiant&quot;</span>)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">any_of</span>(<span class="st">&quot;identifiant&quot;</span>))</span></code></pre></div>
</div>
<p>Note : on déconseille l’utilisation de <code>select</code> sur des chaînes de caractère : certaines fonction du tidyvers nécessient de passer par les opérateurs <code>any_of</code> ou <code>all_of</code> pour ce genre d’opérations (<code>distinct</code> par exemple).</p>
</div>
</div>
</div>
</section>
<section id="sélectionner-des-colonnes-par-un-vecteur-de-noms" class="level2" data-number="6.3">
<h2 data-number="6.3"><span class="header-section-number">6.3</span> Sélectionner des colonnes par un vecteur de noms</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-25-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-1" role="tab" aria-controls="tabset-25-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-25-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-2" role="tab" aria-controls="tabset-25-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-25-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-3" role="tab" aria-controls="tabset-25-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-25-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-4" role="tab" aria-controls="tabset-25-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-25-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-5" role="tab" aria-controls="tabset-25-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-25-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-25-1-tab">
<div class="sourceCode" id="cb108"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> <span class="fu">var</span> = identifiant Sexe note_contenu;</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Colonnes;</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Sélection de colonnes */</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = <span class="kw">&amp;var.</span>);</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Selection de colonnes */</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">keep</span> <span class="kw">&amp;var.</span>;</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-25-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-25-2-tab">
<div class="cell">
<div class="sourceCode" id="cb109"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;identifiant&quot;</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Résultat sous forme de vecteur caractère</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_rbase[, variable] ; <span class="fu">class</span>(id)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_rbase[[variable]] ; <span class="fu">class</span>(id)</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Résultat sous forme de data.frame</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_rbase[variable] ; <span class="fu">class</span>(id)</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_rbase[, variable, drop <span class="ot">=</span> <span class="cn">FALSE</span>] ; <span class="fu">class</span>(id)</span></code></pre></div>
</div>
</div>
<div id="tabset-25-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-25-3-tab">
<div class="cell">
<div class="sourceCode" id="cb110"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;identifiant&quot;</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sous forme de vecteur</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="fu">all_of</span>(variable))</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sous forme de tibble</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(variable))</span></code></pre></div>
</div>
</div>
<div id="tabset-25-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-25-4-tab">
<div class="cell">
<div class="sourceCode" id="cb111"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Résultat sous forme de vecteur caractère</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;identifiant&quot;</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_datatable[[variable]] ; <span class="fu">class</span>(id)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Résultat sous forme de data.table</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_datatable[, .(variable)] ; <span class="fu">class</span>(id)</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">list</span>(variable)] ; <span class="fu">class</span>(id)</span></code></pre></div>
</div>
</div>
<div id="tabset-25-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-25-5-tab">
<div class="cell">
<div class="sourceCode" id="cb112"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>,<span class="st">&quot;duree&quot;</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">any_of</span>(variable))</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="sauf-certaines-variables" class="level2" data-number="6.4">
<h2 data-number="6.4"><span class="header-section-number">6.4</span> Sauf certaines variables</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-26-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-1" role="tab" aria-controls="tabset-26-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-26-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-2" role="tab" aria-controls="tabset-26-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-26-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-3" role="tab" aria-controls="tabset-26-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-26-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-4" role="tab" aria-controls="tabset-26-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-26-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-5" role="tab" aria-controls="tabset-26-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-26-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-26-1-tab">
<div class="sourceCode" id="cb113"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> <span class="fu">var</span> = identifiant Sexe note_contenu;</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Colonnes;<span class="kw">set</span> donnees_sas (<span class="kw">drop</span> = <span class="kw">&amp;var.</span>)<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-26-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-26-2-tab">
<div class="cell">
<div class="sourceCode" id="cb114"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;sexe&quot;</span>, <span class="st">&quot;note_contenu&quot;</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Ne fonctionne pas !</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="co">#exclusion_var &lt;- donnees_rbase[, -c(variable)]</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>exclusion_var <span class="ot">&lt;-</span> donnees_rbase[, <span class="fu">setdiff</span>(<span class="fu">names</span>(donnees_rbase), variable)]</span></code></pre></div>
</div>
</div>
<div id="tabset-26-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-26-3-tab">
<div class="cell">
<div class="sourceCode" id="cb115"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;sexe&quot;</span>, <span class="st">&quot;note_contenu&quot;</span>)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>exclusion_var <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">all_of</span>(variable))</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>exclusion_var <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">all_of</span>(variable))</span></code></pre></div>
</div>
</div>
<div id="tabset-26-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-26-4-tab">
<div class="cell">
<div class="sourceCode" id="cb116"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;sexe&quot;</span>, <span class="st">&quot;note_contenu&quot;</span>)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>exclusion_var <span class="ot">&lt;-</span> donnees_datatable[, <span class="sc">!</span>..variable]</span></code></pre></div>
</div>
</div>
<div id="tabset-26-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-26-5-tab">
<p>Les opérateurs <code>-</code> et <code>!</code> fonctionnent.</p>
<div class="cell">
<div class="sourceCode" id="cb117"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span>identifiant)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">all_of</span>(variable))</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="sélectionner-la-3e-colonne" class="level2" data-number="6.5">
<h2 data-number="6.5"><span class="header-section-number">6.5</span> Sélectionner la 3e colonne</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-27-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-1" role="tab" aria-controls="tabset-27-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-27-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-2" role="tab" aria-controls="tabset-27-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-27-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-3" role="tab" aria-controls="tabset-27-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-27-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-4" role="tab" aria-controls="tabset-27-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-27-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-5" role="tab" aria-controls="tabset-27-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-27-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-27-1-tab">
<div class="sourceCode" id="cb118"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> contents<span class="kw"> data</span> = donnees_sas out = <span class="fu">Var</span> noprint<span class="kw">;run</span>;</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql noprint;</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> name <span class="kw">into</span> :nom_col separated <span class="kw">by</span> <span class="st">&quot; &quot;</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> <span class="fu">Var</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span> <span class="fu">varnum</span> = <span class="dv">3</span>;</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Col3;<span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = <span class="kw">&amp;nom_col.</span>)<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-27-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-27-2-tab">
<div class="cell">
<div class="sourceCode" id="cb119"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>col3 <span class="ot">&lt;-</span> donnees_rbase[, <span class="dv">3</span>]</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>col3 <span class="ot">&lt;-</span> donnees_rbase[<span class="dv">3</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-27-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-27-3-tab">
<div class="cell">
<div class="sourceCode" id="cb120"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>col3 <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="dv">3</span>)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>col3 <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">3</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-27-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-27-4-tab">
<div class="cell">
<div class="sourceCode" id="cb121"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>col3 <span class="ot">&lt;-</span> donnees_datatable[, <span class="dv">3</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-27-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-27-5-tab">
<div class="cell">
<div class="sourceCode" id="cb122"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">3</span>)</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="sélectionner-plusieurs-colonnes" class="level2" data-number="6.6">
<h2 data-number="6.6"><span class="header-section-number">6.6</span> Sélectionner plusieurs colonnes</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-28-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-1" role="tab" aria-controls="tabset-28-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-28-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-2" role="tab" aria-controls="tabset-28-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-28-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-3" role="tab" aria-controls="tabset-28-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-28-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-4" role="tab" aria-controls="tabset-28-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-28-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-5" role="tab" aria-controls="tabset-28-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-28-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-28-1-tab">
<div class="sourceCode" id="cb123"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> <span class="fu">var</span> = identifiant note_contenu sexe;</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Colonnes;<span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = <span class="kw">&amp;var.</span>)<span class="kw">;run</span>;</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> Colonnes <span class="kw">as</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> <span class="kw">%sysfunc</span>(<span class="fu">tranwrd</span>(<span class="kw">&amp;var.</span>, <span class="kw">%str</span>( ), <span class="kw">%str</span>(, )))</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> donnees_sas;</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-28-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-28-2-tab">
<div class="cell">
<div class="sourceCode" id="cb124"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;sexe&quot;</span>)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>colonnes <span class="ot">&lt;-</span> donnees_rbase[, cols]</span></code></pre></div>
</div>
</div>
<div id="tabset-28-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-28-3-tab">
<div class="cell">
<div class="sourceCode" id="cb125"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;sexe&quot;</span>)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Plusieurs possibilités</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>colonnes <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(cols))</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>colonnes <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">any_of</span>(cols))</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>colonnes <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>({{ cols }})</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>colonnes <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span>cols)</span></code></pre></div>
</div>
</div>
<div id="tabset-28-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-28-4-tab">
<div class="cell">
<div class="sourceCode" id="cb126"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;sexe&quot;</span>)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Plusieurs écritures possibles</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Peut-être l&#39;écriture la plus simple, à privilégier</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>colonnes <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">mget</span>(cols)]</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ecriture cohérente avec la logique data.table</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>colonnes <span class="ot">&lt;-</span> donnees_datatable[, .SD, .SDcols <span class="ot">=</span> cols]</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ecriture un peu contre-intuitve. Attention ! L&#39;écriture est bien ..cols, et non ..(cols) !!</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Les syntaxes donnees_datatable[, ..(cols)] et donnees_datatable[, .(cols)] ne fonctionnent pas</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>colonnes <span class="ot">&lt;-</span> donnees_datatable[, ..cols]</span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ecriture avec with = FALSE : désactive la possibilité de se référer à des colonnes sans les guillemets</span></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>colonnes <span class="ot">&lt;-</span> donnees_datatable[, cols, with <span class="ot">=</span> <span class="cn">FALSE</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-28-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-28-5-tab">
<div class="cell">
<div class="sourceCode" id="cb127"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;sexe&quot;</span>)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Plusieurs possibilités</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(cols))</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">any_of</span>(cols))</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select</span>({{ cols }})</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span>cols)</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="sélectionner-les-colonnes-qui-débutent-par-le-mot-note" class="level2" data-number="6.7">
<h2 data-number="6.7"><span class="header-section-number">6.7</span> Sélectionner les colonnes qui débutent par le mot Note</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-29-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-1" role="tab" aria-controls="tabset-29-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-29-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-2" role="tab" aria-controls="tabset-29-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-29-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-3" role="tab" aria-controls="tabset-29-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-29-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-4" role="tab" aria-controls="tabset-29-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-29-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-5" role="tab" aria-controls="tabset-29-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-29-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-29-1-tab">
<div class="sourceCode" id="cb128"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* 1ère solution */</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Selection_Variables;<span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = <span class="fu">Note</span>:)<span class="kw">;run</span>;</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="co">/* 2e solution */</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> contents<span class="kw"> data</span> = donnees_sas out = <span class="fu">Var</span> noprint<span class="kw">;run</span>;</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> name <span class="kw">into</span> :var_notes separated <span class="kw">by</span> <span class="st">&quot; &quot;</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> <span class="fu">Var</span> <span class="kw">where</span> <span class="fu">substr</span>(<span class="fu">upcase</span>(name), <span class="dv">1</span>, <span class="dv">4</span>) = <span class="st">&quot;NOTE&quot;</span> <span class="kw">order</span> <span class="kw">by</span> <span class="fu">varnum</span>;</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> datasets lib = Work nolist;<span class="kw">delete</span> <span class="fu">Var</span><span class="kw">;run</span>;</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas_Notes;<span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = <span class="kw">&amp;var_notes.</span>)<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-29-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-29-2-tab">
<div class="cell">
<div class="sourceCode" id="cb129"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">grepl</span>(<span class="st">&quot;^note&quot;</span>, <span class="fu">names</span>(donnees_rbase))]</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">substr</span>(<span class="fu">tolower</span>(<span class="fu">names</span>(donnees_rbase)), <span class="dv">1</span>, <span class="dv">4</span>) <span class="sc">==</span> <span class="st">&quot;note&quot;</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-29-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-29-3-tab">
<div class="cell">
<div class="sourceCode" id="cb130"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;note&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-29-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-29-4-tab">
<div class="cell">
<div class="sourceCode" id="cb131"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1ère méthode</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">names</span>(donnees_datatable)[<span class="fu">substr</span>(<span class="fu">names</span>(donnees_datatable), <span class="dv">1</span>, <span class="dv">4</span>) <span class="sc">==</span> <span class="st">&quot;note&quot;</span>]</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">&lt;-</span> donnees_datatable[, .SD, .SDcols <span class="ot">=</span> cols]</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2e méthode</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">&lt;-</span> donnees_datatable[, .SD, .SDcols <span class="ot">=</span> <span class="fu">patterns</span>(<span class="st">&quot;^note&quot;</span>)]</span></code></pre></div>
</div>
</div>
<div id="tabset-29-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-29-5-tab">
<div class="cell">
<div class="sourceCode" id="cb132"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;note&quot;</span>))</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="sélectionner-les-colonnes-qui-ne-débutent-pas-par-le-mot-note" class="level2" data-number="6.8">
<h2 data-number="6.8"><span class="header-section-number">6.8</span> Sélectionner les colonnes qui ne débutent pas par le mot Note</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-30-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-1" role="tab" aria-controls="tabset-30-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-30-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-2" role="tab" aria-controls="tabset-30-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-30-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-3" role="tab" aria-controls="tabset-30-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-30-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-4" role="tab" aria-controls="tabset-30-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-30-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-5" role="tab" aria-controls="tabset-30-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-30-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-30-1-tab">
<div class="sourceCode" id="cb133"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Selection_Variables;<span class="kw">set</span> donnees_sas (<span class="kw">drop</span> = <span class="fu">Note</span>:)<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-30-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-30-2-tab">
<div class="cell">
<div class="sourceCode" id="cb134"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> donnees_rbase[<span class="sc">!</span> <span class="fu">grepl</span>(<span class="st">&quot;^note&quot;</span>, <span class="fu">names</span>(donnees_rbase))]</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">substr</span>(<span class="fu">tolower</span>(<span class="fu">names</span>(donnees_rbase)), <span class="dv">1</span>, <span class="dv">4</span>) <span class="sc">!=</span> <span class="st">&quot;note&quot;</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-30-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-30-3-tab">
<div class="cell">
<div class="sourceCode" id="cb135"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">&quot;note&quot;</span>))</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">&quot;note&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-30-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-30-4-tab">
<div class="cell">
<div class="sourceCode" id="cb136"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;^note&quot;</span>, <span class="fu">names</span>(donnees_datatable), <span class="at">value =</span> <span class="cn">TRUE</span>, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">&lt;-</span> donnees_datatable[, .SD, .SDcols <span class="ot">=</span> <span class="sc">-</span>cols]</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">&lt;-</span> donnees_datatable[, .SD, .SDcols <span class="ot">=</span> <span class="sc">-</span><span class="fu">patterns</span>(<span class="st">&quot;^note&quot;</span>)]</span></code></pre></div>
</div>
</div>
<div id="tabset-30-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-30-5-tab">
<div class="cell">
<div class="sourceCode" id="cb137"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">&quot;note&quot;</span>))</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">&quot;note&quot;</span>))</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="sélectionner-lensemble-des-variables-numériques-de-la-base" class="level2" data-number="6.9">
<h2 data-number="6.9"><span class="header-section-number">6.9</span> Sélectionner l’ensemble des variables numériques de la base</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-31-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-31-1" role="tab" aria-controls="tabset-31-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-31-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-31-2" role="tab" aria-controls="tabset-31-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-31-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-31-3" role="tab" aria-controls="tabset-31-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-31-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-31-4" role="tab" aria-controls="tabset-31-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-31-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-31-5" role="tab" aria-controls="tabset-31-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-31-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-31-1-tab">
<div class="sourceCode" id="cb138"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Colonnes;<span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = _numeric_)<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-31-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-31-2-tab">
<div class="cell">
<div class="sourceCode" id="cb139"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>varNumeriques <span class="ot">&lt;-</span> donnees_rbase[, <span class="fu">sapply</span>(donnees_rbase, is.numeric), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-31-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-31-3-tab">
<div class="cell">
<div class="sourceCode" id="cb140"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>varNumeriques <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>varNumeriques <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.numeric)</span></code></pre></div>
</div>
</div>
<div id="tabset-31-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-31-4-tab">
<div class="cell">
<div class="sourceCode" id="cb141"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">&lt;-</span> donnees_datatable[, .SD, .SDcols <span class="ot">=</span> is.numeric]</span></code></pre></div>
</div>
</div>
<div id="tabset-31-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-31-5-tab">
<div class="cell">
<div class="sourceCode" id="cb142"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.numeric)</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="co"># requete_duckdb %&gt;% select(where(is.numeric))</span></span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="sélectionner-lensemble-des-variables-de-format-date" class="level2" data-number="6.10">
<h2 data-number="6.10"><span class="header-section-number">6.10</span> Sélectionner l’ensemble des variables de format “Date”</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-32-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-32-1" role="tab" aria-controls="tabset-32-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-32-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-32-2" role="tab" aria-controls="tabset-32-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-32-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-32-3" role="tab" aria-controls="tabset-32-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-32-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-32-4" role="tab" aria-controls="tabset-32-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-32-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-32-5" role="tab" aria-controls="tabset-32-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-32-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-32-1-tab">
<div class="sourceCode" id="cb143"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> contents<span class="kw"> data</span> = donnees_sas out = <span class="fu">Var</span> noprint<span class="kw">;run</span>;</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql noprint;</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> name <span class="kw">into</span> :nom_col separated <span class="kw">by</span> <span class="st">&quot; &quot;</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> <span class="fu">Var</span> <span class="kw">where</span> <span class="kw">format</span> <span class="kw">not</span> <span class="kw">in</span> (<span class="st">&quot;$&quot;</span>, <span class="st">&quot;&quot;</span>);</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Colonnes;<span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = <span class="kw">&amp;nom_col.</span>)<span class="kw">;run</span>;</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> datasets lib = Work nolist;<span class="kw">delete</span> <span class="fu">Var</span><span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-32-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-32-2-tab">
<div class="cell">
<div class="sourceCode" id="cb144"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>varDates <span class="ot">&lt;-</span> donnees_rbase[, <span class="fu">sapply</span>(donnees_rbase, is.Date), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>varDates <span class="ot">&lt;-</span> <span class="fu">Filter</span>(is.Date, donnees_rbase)</span></code></pre></div>
</div>
</div>
<div id="tabset-32-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-32-3-tab">
<div class="cell">
<div class="sourceCode" id="cb145"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>varDates <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">where</span>(is.Date))</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>varDates <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.Date)</span></code></pre></div>
</div>
</div>
<div id="tabset-32-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-32-4-tab">
<div class="cell">
<div class="sourceCode" id="cb146"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>var_dates <span class="ot">&lt;-</span> donnees_datatable[, .SD, .SDcols <span class="ot">=</span> is.Date]</span></code></pre></div>
</div>
</div>
<div id="tabset-32-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-32-5-tab">
<div class="cell">
<div class="sourceCode" id="cb147"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.Date)</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="co"># requete_duckdb %&gt;% select(where(is.Date))</span></span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="sélectionner-des-lignes" class="level2" data-number="6.11">
<h2 data-number="6.11"><span class="header-section-number">6.11</span> Sélectionner des lignes</h2>
<section id="e-ligne" class="level3" data-number="6.11.1">
<h3 data-number="6.11.1"><span class="header-section-number">6.11.1</span> 3e ligne</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-33-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-33-1" role="tab" aria-controls="tabset-33-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-33-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-33-2" role="tab" aria-controls="tabset-33-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-33-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-33-3" role="tab" aria-controls="tabset-33-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-33-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-33-4" role="tab" aria-controls="tabset-33-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-33-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-33-5" role="tab" aria-controls="tabset-33-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-33-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-33-1-tab">
<div class="sourceCode" id="cb148"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Ligne3;<span class="kw">set</span> donnees_sas (firstobs = <span class="dv">3</span> obs = <span class="dv">3</span>)<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-33-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-33-2-tab">
<div class="cell">
<div class="sourceCode" id="cb149"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>ligne3 <span class="ot">&lt;-</span> donnees_rbase[<span class="dv">3</span>, ]</span></code></pre></div>
</div>
</div>
<div id="tabset-33-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-33-3-tab">
<div class="cell">
<div class="sourceCode" id="cb150"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>ligne3 <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">3</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-33-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-33-4-tab">
<div class="cell">
<div class="sourceCode" id="cb151"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>ligne3 <span class="ot">&lt;-</span> donnees_datatable[<span class="dv">3</span>, ]</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>ligne3 <span class="ot">&lt;-</span> donnees_datatable[<span class="dv">3</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-33-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-33-5-tab">
<p>DuckDB, moteur SQL, ne respecte pas l’ordre des lignes. Il faut passer par un filtre ou choisir explicitement un ordre.</p>
<div class="cell">
<div class="sourceCode" id="cb152"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">filter</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">==</span> <span class="dv">2023</span>)</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="sélectionner-les-3-premières-lignes-et-les-3-premières-colonnes-de-la-base" class="level3" data-number="6.11.2">
<h3 data-number="6.11.2"><span class="header-section-number">6.11.2</span> Sélectionner les 3 premières lignes et les 3 premières colonnes de la base</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-34-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-34-1" role="tab" aria-controls="tabset-34-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-34-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-34-2" role="tab" aria-controls="tabset-34-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-34-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-34-3" role="tab" aria-controls="tabset-34-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-34-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-34-4" role="tab" aria-controls="tabset-34-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-34-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-34-5" role="tab" aria-controls="tabset-34-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-34-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-34-1-tab">
<div class="sourceCode" id="cb153"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> contents<span class="kw"> data</span> = donnees_sas out = <span class="fu">Var</span> noprint<span class="kw">;run</span>;</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql noprint;</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> name <span class="kw">into</span> :nom_col separated <span class="kw">by</span> <span class="st">&quot; &quot;</span> <span class="kw">from</span> <span class="fu">Var</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span> <span class="dv">1</span> &lt;= <span class="fu">varnum</span> &lt;= <span class="dv">3</span>;</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Top3;</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (firstobs = <span class="dv">1</span> obs = <span class="dv">3</span> <span class="kw">keep</span> = <span class="kw">&amp;nom_col.</span>);</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> datasets lib = Work nolist;<span class="kw">delete</span> <span class="fu">Var</span><span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-34-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-34-2-tab">
<div class="cell">
<div class="sourceCode" id="cb154"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>top3 <span class="ot">&lt;-</span> donnees_rbase[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-34-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-34-3-tab">
<div class="cell">
<div class="sourceCode" id="cb155"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>top3 <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-34-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-34-4-tab">
<div class="cell">
<div class="sourceCode" id="cb156"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>top3 <span class="ot">&lt;-</span> donnees_datatable[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-34-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-34-5-tab">
<p>DuckDB, moteur SQL, ne respecte pas l’ordre des lignes. Il faut passer par un filtre ou choisir explicitement un ordre.</p>
<div class="cell">
<div class="sourceCode" id="cb157"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">filter</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">==</span> <span class="dv">2023</span>)</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="entrées-en-2023" class="level3" data-number="6.11.3">
<h3 data-number="6.11.3"><span class="header-section-number">6.11.3</span> Entrées en 2023</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-35-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-35-1" role="tab" aria-controls="tabset-35-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-35-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-35-2" role="tab" aria-controls="tabset-35-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-35-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-35-3" role="tab" aria-controls="tabset-35-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-35-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-35-4" role="tab" aria-controls="tabset-35-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-35-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-35-5" role="tab" aria-controls="tabset-35-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-35-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-35-1-tab">
<div class="sourceCode" id="cb158"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> En2023;</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">where</span> = (<span class="fu">year</span>(date_entree) = <span class="dv">2023</span>));</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-35-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-35-2-tab">
<div class="cell">
<div class="sourceCode" id="cb159"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">ATTENTION</span><span class="co">, solution qui ne fonctionne pas toujours bien ! En effet, les valeurs manquantes sont sélectionnées !</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>en2023 <span class="ot">&lt;-</span> donnees_rbase[lubridate<span class="sc">::</span><span class="fu">year</span>(donnees_rbase<span class="sc">$</span>date_entree) <span class="sc">==</span> <span class="dv">2023</span>, ]</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Bonnes écritures, qui excluent les valeurs manquantes</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>en2023 <span class="ot">&lt;-</span> donnees_rbase[lubridate<span class="sc">::</span><span class="fu">year</span>(donnees_rbase<span class="sc">$</span>date_entree) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2023</span>), ]</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>en2023 <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">which</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(donnees_rbase<span class="sc">$</span>date_entree) <span class="sc">==</span> <span class="dv">2023</span>), ]</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>en2023 <span class="ot">&lt;-</span> <span class="fu">subset</span>(donnees_rbase, lubridate<span class="sc">::</span><span class="fu">year</span>(donnees_rbase<span class="sc">$</span>date_entree) <span class="sc">==</span> <span class="dv">2023</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-35-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-35-3-tab">
<div class="cell">
<div class="sourceCode" id="cb160"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>en2023 <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">filter</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">==</span> <span class="dv">2023</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-35-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-35-4-tab">
<div class="cell">
<div class="sourceCode" id="cb161"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pas de problème avec les valeurs manquantes comme pour la syntaxe en R-Base</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>en2023 <span class="ot">&lt;-</span> donnees_datatable[lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">==</span> <span class="dv">2023</span>, ]</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>en2023 <span class="ot">&lt;-</span> donnees_datatable[lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">==</span> <span class="dv">2023</span>]</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>en2023 <span class="ot">&lt;-</span> <span class="fu">subset</span>(donnees_datatable, lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">==</span> <span class="dv">2023</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-35-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-35-5-tab">
<p>DuckDB, moteur SQL, ne respecte pas l’ordre des lignes. Il faut passer par un filtre ou choisir explicitement un ordre.</p>
<div class="cell">
<div class="sourceCode" id="cb162"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">filter</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">==</span> <span class="dv">2023</span>)</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="sélectionner-suivant-de-multiples-conditions" class="level2" data-number="6.12">
<h2 data-number="6.12"><span class="header-section-number">6.12</span> Sélectionner suivant de multiples conditions</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-36-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-36-1" role="tab" aria-controls="tabset-36-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-36-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-36-2" role="tab" aria-controls="tabset-36-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-36-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-36-3" role="tab" aria-controls="tabset-36-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-36-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-36-4" role="tab" aria-controls="tabset-36-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-36-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-36-5" role="tab" aria-controls="tabset-36-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-36-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-36-1-tab">
<div class="sourceCode" id="cb163"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Femmes entrées avant 2023 */</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* Ecriture correcte */</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Avant2023_Femme;</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">where</span> = (<span class="fu">year</span>(date_entree) &lt; <span class="dv">2023</span> <span class="kw">and</span> <span class="kw">not</span> missing(date_entree) <span class="kw">and</span> sexe = <span class="dv">2</span>));</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a><span class="co">/* Ecriture incorrecte. Les valeurs manquantes sont considérées comme des nombres négatifs faibles, et inférieurs à 2023. */</span></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a><span class="co">/* Elles sont sélectionnées dans le code suivant : */</span></span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Avant2023_Femme;</span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">where</span> = (<span class="fu">year</span>(date_entree) &lt; <span class="dv">2023</span> <span class="kw">and</span> sexe = <span class="dv">2</span>));</span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-36-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-36-2-tab">
<div class="cell">
<div class="sourceCode" id="cb164"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Femmes entrées avant 2023</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>avant2023_femme <span class="ot">&lt;-</span> <span class="fu">subset</span>(donnees_rbase, lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">&lt;</span> <span class="dv">2023</span> <span class="sc">&amp;</span> sexe <span class="sc">==</span> <span class="st">&quot;2&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-36-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-36-3-tab">
<div class="cell">
<div class="sourceCode" id="cb165"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Femmes entrées avant 2023</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>avant2023_femme <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">&lt;</span> <span class="dv">2023</span> <span class="sc">&amp;</span> sexe <span class="sc">==</span> <span class="st">&quot;2&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-36-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-36-4-tab">
<div class="cell">
<div class="sourceCode" id="cb166"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Femmes entrées avant 2023</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>avant2023_femme <span class="ot">&lt;-</span> donnees_datatable[lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">&lt;</span> <span class="dv">2023</span> <span class="sc">&amp;</span> sexe <span class="sc">==</span> <span class="st">&quot;2&quot;</span>]</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>avant2023_femme <span class="ot">&lt;-</span> <span class="fu">subset</span>(donnees_datatable, lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">&lt;</span> <span class="dv">2023</span> <span class="sc">&amp;</span> sexe <span class="sc">==</span> <span class="st">&quot;2&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-36-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-36-5-tab">
<div class="cell">
<div class="sourceCode" id="cb167"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Femmes entrées avant 2023</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> </span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">&lt;</span> <span class="dv">2023</span> <span class="sc">&amp;</span> sexe <span class="sc">==</span> <span class="st">&quot;2&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="sélectionner-des-lignes-par-référence-lignes-de-lidentifiant-087" class="level2" data-number="6.13">
<h2 data-number="6.13"><span class="header-section-number">6.13</span> Sélectionner des lignes par référence : lignes de l’identifiant 087</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-37-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-37-1" role="tab" aria-controls="tabset-37-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-37-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-37-2" role="tab" aria-controls="tabset-37-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-37-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-37-3" role="tab" aria-controls="tabset-37-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-37-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-37-4" role="tab" aria-controls="tabset-37-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-37-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-37-5" role="tab" aria-controls="tabset-37-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-37-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-37-1-tab">
<div class="sourceCode" id="cb168"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> <span class="fu">var</span> = identifiant;</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> sel = <span class="dv">087</span>;</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Selection;</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> <span class="kw">&amp;var.</span> <span class="kw">in</span> (<span class="st">&quot;&amp;sel.&quot;</span>);</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Selection;</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">where</span> = (<span class="kw">&amp;var.</span> <span class="kw">in</span> (<span class="st">&quot;&amp;sel.&quot;</span>)));</span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-37-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-37-2-tab">
<div class="cell">
<div class="sourceCode" id="cb169"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;identifiant&quot;</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">&lt;-</span> <span class="st">&quot;087&quot;</span></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>donnees_rbase[donnees_rbase[, variable] <span class="sc">%in%</span> sel, ]</span></code></pre></div>
</div>
</div>
<div id="tabset-37-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-37-3-tab">
<div class="cell">
<div class="sourceCode" id="cb170"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">filter</span>(identifiant <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;087&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(identifiant)</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">filter</span>(identifiant <span class="sc">==</span> <span class="st">&quot;087&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(identifiant)</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Essayons désormais par variable</span></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;identifiant&quot;</span></span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">&lt;-</span> <span class="st">&quot;087&quot;</span></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">if_any</span>(variable, <span class="sc">~</span> .x <span class="sc">%in%</span> sel)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(variable))</span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">get</span>(variable) <span class="sc">%in%</span> sel) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(variable))</span></code></pre></div>
</div>
</div>
<div id="tabset-37-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-37-4-tab">
<div class="cell">
<div class="sourceCode" id="cb171"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;identifiant&quot;</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">&lt;-</span> <span class="st">&quot;087&quot;</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable[donnees_datatable[[variable]] <span class="sc">%chin%</span> sel, ]</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>donnees_datatable[donnees_datatable[[variable]] <span class="sc">%chin%</span> sel, ]</span></code></pre></div>
</div>
</div>
<div id="tabset-37-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-37-5-tab">
<div class="cell">
<div class="sourceCode" id="cb172"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">filter</span>(identifiant <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;087&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(identifiant)</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">filter</span>(identifiant <span class="sc">==</span> <span class="st">&quot;087&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(identifiant)</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Essayons désormais par variables</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;identifiant&quot;</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">&lt;-</span> <span class="st">&quot;087&quot;</span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : peut-on faire plus simplement ?</span></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.data[[variable]] <span class="sc">%in%</span> sel) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(variable))</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="sélectionner-des-lignes-et-des-colonnes-1" class="level2" data-number="6.14">
<h2 data-number="6.14"><span class="header-section-number">6.14</span> Sélectionner des lignes et des colonnes</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-38-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-38-1" role="tab" aria-controls="tabset-38-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-38-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-38-2" role="tab" aria-controls="tabset-38-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-38-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-38-3" role="tab" aria-controls="tabset-38-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-38-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-38-4" role="tab" aria-controls="tabset-38-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-38-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-38-5" role="tab" aria-controls="tabset-38-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-38-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-38-1-tab">
<div class="sourceCode" id="cb173"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> cols = identifiant note_contenu sexe;</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Femmes;</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">where</span> = (Sexe = <span class="dv">2</span>) <span class="kw">keep</span> = <span class="kw">&amp;cols.</span>);</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Femmes;</span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> Sexe = <span class="dv">2</span>;</span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">keep</span> <span class="kw">&amp;cols.</span>;</span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a><span class="co">/* Par nom ou par variable */</span></span>
<span id="cb173-12"><a href="#cb173-12" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> <span class="fu">var</span> = identifiant Sexe note_contenu;</span>
<span id="cb173-13"><a href="#cb173-13" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Femmes;</span>
<span id="cb173-14"><a href="#cb173-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Sélection de colonnes */</span></span>
<span id="cb173-15"><a href="#cb173-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = <span class="kw">&amp;var.</span>);</span>
<span id="cb173-16"><a href="#cb173-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Sélection de lignes respectant une certaine condition */</span></span>
<span id="cb173-17"><a href="#cb173-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> Sexe = <span class="st">&quot;2&quot;</span>;</span>
<span id="cb173-18"><a href="#cb173-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Création de colonne */</span></span>
<span id="cb173-19"><a href="#cb173-19" aria-hidden="true" tabindex="-1"></a>  note2 = note_contenu / <span class="dv">20</span> * <span class="dv">5</span>;</span>
<span id="cb173-20"><a href="#cb173-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Suppression de colonnes */</span></span>
<span id="cb173-21"><a href="#cb173-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">drop</span> Sexe;</span>
<span id="cb173-22"><a href="#cb173-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Selection de colonnes */</span></span>
<span id="cb173-23"><a href="#cb173-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">keep</span> identifiant Sexe note_contenu;</span>
<span id="cb173-24"><a href="#cb173-24" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-38-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-38-2-tab">
<div class="cell">
<div class="sourceCode" id="cb174"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;sexe&quot;</span>, <span class="st">&quot;date_naissance&quot;</span>)</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>femmes <span class="ot">&lt;-</span> donnees_rbase[donnees_rbase<span class="sc">$</span>sexe <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;2&quot;</span>), cols]</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>femmes <span class="ot">&lt;-</span> <span class="fu">subset</span>(donnees_rbase, sexe <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;2&quot;</span>), cols)</span></code></pre></div>
</div>
</div>
<div id="tabset-38-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-38-3-tab">
<div class="cell">
<div class="sourceCode" id="cb175"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;sexe&quot;</span>, <span class="st">&quot;date_naissance&quot;</span>)</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>femmes <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sexe <span class="sc">==</span> <span class="st">&quot;2&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(cols))</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>femmes <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sexe <span class="sc">==</span> <span class="st">&quot;2&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>({{ cols }})</span></code></pre></div>
</div>
</div>
<div id="tabset-38-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-38-4-tab">
<div class="cell">
<div class="sourceCode" id="cb176"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;sexe&quot;</span>, <span class="st">&quot;date_naissance&quot;</span>)</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>femmes <span class="ot">&lt;-</span> donnees_datatable[sexe <span class="sc">==</span> <span class="st">&quot;2&quot;</span>, ..cols]</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>femmes <span class="ot">&lt;-</span> <span class="fu">subset</span>(donnees_datatable, sexe <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;2&quot;</span>), cols)</span></code></pre></div>
</div>
</div>
<div id="tabset-38-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-38-5-tab">
<div class="cell">
<div class="sourceCode" id="cb177"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;sexe&quot;</span>, <span class="st">&quot;date_naissance&quot;</span>)</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sexe <span class="sc">==</span> <span class="st">&quot;2&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(cols))</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sexe <span class="sc">==</span> <span class="st">&quot;2&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>({{ cols }})</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="manipuler-des-lignes-et-des-colonnes" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Manipuler des lignes et des colonnes</h1>
<section id="renommer-des-variables" class="level2" data-number="7.1">
<h2 data-number="7.1"><span class="header-section-number">7.1</span> Renommer des variables</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-39-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-39-1" role="tab" aria-controls="tabset-39-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-39-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-39-2" role="tab" aria-controls="tabset-39-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-39-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-39-3" role="tab" aria-controls="tabset-39-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-39-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-39-4" role="tab" aria-controls="tabset-39-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-39-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-39-5" role="tab" aria-controls="tabset-39-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-39-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-39-1-tab">
<div class="sourceCode" id="cb178"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">rename</span> = (sexe = sexe2));</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">rename</span> sexe2 = sexe;</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-39-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-39-2-tab">
<div class="cell">
<div class="sourceCode" id="cb179"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On renomme la variable sexe en sexe_red</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(donnees_rbase)[<span class="fu">names</span>(donnees_rbase) <span class="sc">==</span> <span class="st">&quot;sexe&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;sexe_red&quot;</span></span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a><span class="co"># On la renomme en sexe</span></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(donnees_rbase)[<span class="fu">names</span>(donnees_rbase) <span class="sc">==</span> <span class="st">&quot;sexe_red&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;sexe&quot;</span></span></code></pre></div>
</div>
</div>
<div id="tabset-39-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-39-3-tab">
<div class="cell">
<div class="sourceCode" id="cb180"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On renomme la variable sexe en sexe_red</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">sexe_red =</span> sexe)</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a><span class="co"># On la renomme en sexe</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">sexe =</span> sexe_red)</span></code></pre></div>
</div>
</div>
<div id="tabset-39-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-39-4-tab">
<div class="cell">
<div class="sourceCode" id="cb181"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On renomme la variable sexe en sexe_red</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(donnees_datatable)[<span class="fu">names</span>(donnees_datatable) <span class="sc">==</span> <span class="st">&quot;sexe&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;sexe_red&quot;</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a><span class="co"># On la renomme en sexe</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(donnees_datatable)[<span class="fu">names</span>(donnees_datatable) <span class="sc">==</span> <span class="st">&quot;sexe_red&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;sexe&quot;</span></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a><span class="co"># En data.table, les instructions débutant par set modifient les éléments par référence, c&#39;est-à-dire sans copie.</span></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ceci est plus efficace pour manipuler des données volumineuses.</span></span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(donnees_datatable, <span class="st">&quot;sexe&quot;</span>, <span class="st">&quot;sexe_red&quot;</span>)</span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(donnees_datatable, <span class="st">&quot;sexe_red&quot;</span>, <span class="st">&quot;sexe&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-39-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-39-5-tab">
<div class="cell">
<div class="sourceCode" id="cb182"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On renomme la variable sexe en sexe_red</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sexe_red =</span> sexe)</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a><span class="co"># On la renomme en sexe</span></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sexe =</span> sexe_red)</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="créer-des-variables-avec-des-conditions" class="level2" data-number="7.2">
<h2 data-number="7.2"><span class="header-section-number">7.2</span> Créer des variables avec des conditions</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-40-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-40-1" role="tab" aria-controls="tabset-40-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-40-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-40-2" role="tab" aria-controls="tabset-40-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-40-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-40-3" role="tab" aria-controls="tabset-40-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-40-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-40-4" role="tab" aria-controls="tabset-40-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-40-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-40-5" role="tab" aria-controls="tabset-40-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-40-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-40-1-tab">
<div class="sourceCode" id="cb183"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Civilite;</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 1ère solution (if) */</span></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Civilite $<span class="dv">20</span>.;</span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span>      Sexe = <span class="dv">2</span> <span class="kw">then</span> Civilite = <span class="st">&quot;Mme&quot;</span>;</span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">else</span> <span class="kw">if</span> Sexe = <span class="dv">1</span> <span class="kw">then</span> Civilite = <span class="st">&quot;Mr&quot;</span>;</span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">else</span>                  Civilite = <span class="st">&quot;Inconnu&quot;</span>;</span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 2e solution (do - end) */</span></span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span>      Sexe = <span class="dv">2</span> <span class="kw">then do</span>;</span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a>    Civilite2 = <span class="st">&quot;Femme&quot;</span>;</span>
<span id="cb183-13"><a href="#cb183-13" aria-hidden="true" tabindex="-1"></a><span class="kw">  end</span>;</span>
<span id="cb183-14"><a href="#cb183-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">else</span> <span class="kw">if</span> Sexe = <span class="dv">1</span> <span class="kw">then do</span>;</span>
<span id="cb183-15"><a href="#cb183-15" aria-hidden="true" tabindex="-1"></a>    Civilite2 = <span class="st">&quot;Homme&quot;</span>;</span>
<span id="cb183-16"><a href="#cb183-16" aria-hidden="true" tabindex="-1"></a><span class="kw">  end</span>;</span>
<span id="cb183-17"><a href="#cb183-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">else do</span>;</span>
<span id="cb183-18"><a href="#cb183-18" aria-hidden="true" tabindex="-1"></a>    Civilite2 = <span class="st">&quot;Inconnu&quot;</span>;</span>
<span id="cb183-19"><a href="#cb183-19" aria-hidden="true" tabindex="-1"></a><span class="kw">  end</span>;</span>
<span id="cb183-20"><a href="#cb183-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb183-21"><a href="#cb183-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 3e solution (select) */</span></span>
<span id="cb183-22"><a href="#cb183-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Civilite3 $<span class="dv">20</span>.;</span>
<span id="cb183-23"><a href="#cb183-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span>;</span>
<span id="cb183-24"><a href="#cb183-24" aria-hidden="true" tabindex="-1"></a>    when      (Sexe = <span class="dv">2</span>) Civilite3 = <span class="st">&quot;Femme&quot;</span>;</span>
<span id="cb183-25"><a href="#cb183-25" aria-hidden="true" tabindex="-1"></a>    when      (Sexe = <span class="dv">1</span>) Civilite3 = <span class="st">&quot;Homme&quot;</span>;</span>
<span id="cb183-26"><a href="#cb183-26" aria-hidden="true" tabindex="-1"></a>    otherwise            Civilite3 = <span class="st">&quot;Inconnu&quot;</span>;</span>
<span id="cb183-27"><a href="#cb183-27" aria-hidden="true" tabindex="-1"></a><span class="kw">  end</span>;</span>
<span id="cb183-28"><a href="#cb183-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb183-29"><a href="#cb183-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">keep</span> Sexe Civilite Civilite2 Civilite3<span class="kw">;run</span>;</span>
<span id="cb183-30"><a href="#cb183-30" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-40-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-40-2-tab">
<div class="cell">
<div class="sourceCode" id="cb184"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>civilite <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(donnees_rbase<span class="sc">$</span>sexe <span class="sc">==</span> <span class="st">&quot;2&quot;</span>, <span class="st">&quot;Mme&quot;</span>, </span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">ifelse</span>(donnees_rbase<span class="sc">$</span>sexe <span class="sc">==</span> <span class="st">&quot;1&quot;</span>, <span class="st">&quot;M&quot;</span>, </span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;Inconnu&quot;</span>))</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution (rapide)</span></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>civilite <span class="ot">&lt;-</span> <span class="st">&quot;Inconnu&quot;</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>civilite[donnees_rbase<span class="sc">$</span>sexe <span class="sc">==</span> <span class="st">&quot;1&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;M&quot;</span></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>civilite[donnees_rbase<span class="sc">$</span>sexe <span class="sc">==</span> <span class="st">&quot;2&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Mme&quot;</span></span></code></pre></div>
</div>
</div>
<div id="tabset-40-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-40-3-tab">
<div class="cell">
<div class="sourceCode" id="cb185"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">civilite =</span> <span class="fu">case_when</span>(sexe <span class="sc">==</span> <span class="st">&quot;2&quot;</span> <span class="sc">~</span> <span class="st">&quot;Mme&quot;</span>,</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>                              sexe <span class="sc">==</span> <span class="st">&quot;1&quot;</span> <span class="sc">~</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>                              <span class="cn">TRUE</span>        <span class="sc">~</span> <span class="st">&quot;Inconnu&quot;</span>)</span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
</div>
<div id="tabset-40-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-40-4-tab">
<div class="cell">
<div class="sourceCode" id="cb186"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, civilite <span class="sc">:</span><span class="er">=</span> <span class="fu">fcase</span>(sexe <span class="sc">==</span> <span class="st">&quot;2&quot;</span>, <span class="st">&quot;Mme&quot;</span>,</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>                                      sexe <span class="sc">==</span> <span class="st">&quot;1&quot;</span>, <span class="st">&quot;M.&quot;</span>,</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">is.na</span>(sexe), <span class="st">&quot;Inconnu&quot;</span>)]</span></code></pre></div>
</div>
</div>
<div id="tabset-40-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-40-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="formater-les-modalités-des-valeurs" class="level2" data-number="7.3">
<h2 data-number="7.3"><span class="header-section-number">7.3</span> Formater les modalités des valeurs</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-41-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-41-1" role="tab" aria-controls="tabset-41-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-41-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-41-2" role="tab" aria-controls="tabset-41-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-41-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-41-3" role="tab" aria-controls="tabset-41-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-41-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-41-4" role="tab" aria-controls="tabset-41-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-41-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-41-5" role="tab" aria-controls="tabset-41-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-41-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-41-1-tab">
<div class="sourceCode" id="cb187"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Utilisation des formats */</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> <span class="kw">format</span>;</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Variable discrète */</span></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>  value sexef</span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> = <span class="st">&quot;Homme&quot;</span></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span> = <span class="st">&quot;Femme&quot;</span>;</span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Variable continue */</span></span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a>  value agef</span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a>  low-&lt;<span class="dv">26</span> = <span class="st">&quot;1. De 15 à 25 ans&quot;</span></span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">26</span>&lt;-&lt;<span class="dv">50</span> = <span class="st">&quot;2. De 26 à 49 ans&quot;</span></span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">50</span>-high = <span class="st">&quot;3. 50 ans ou plus&quot;</span>;</span>
<span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-14"><a href="#cb187-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Variable caractère */</span></span>
<span id="cb187-15"><a href="#cb187-15" aria-hidden="true" tabindex="-1"></a>  value $ cspf</span>
<span id="cb187-16"><a href="#cb187-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;1&#39;</span> = <span class="st">&quot;Cadre&quot;</span></span>
<span id="cb187-17"><a href="#cb187-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;2&#39;</span> = <span class="st">&quot;Profession intermédiaire&quot;</span></span>
<span id="cb187-18"><a href="#cb187-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;3&#39;</span> = <span class="st">&quot;Employé&quot;</span></span>
<span id="cb187-19"><a href="#cb187-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;4&#39;</span> = <span class="st">&quot;Ouvrier&quot;</span></span>
<span id="cb187-20"><a href="#cb187-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;5&#39;</span> = <span class="st">&quot;Retraité&quot;</span>;</span>
<span id="cb187-21"><a href="#cb187-21" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-41-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-41-2-tab">
<div class="cell">
<div class="sourceCode" id="cb188"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>sexef <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;2&quot;</span> <span class="ot">=</span> <span class="st">&quot;Femme&quot;</span>)</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>cspf <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;2&quot;</span> <span class="ot">=</span> <span class="st">&quot;Profession intermédiaire&quot;</span>, <span class="st">&quot;3&quot;</span> <span class="ot">=</span> <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;4&quot;</span> <span class="ot">=</span> <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;5&quot;</span> <span class="ot">=</span> <span class="st">&quot;Retraité&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-41-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-41-3-tab">
<div class="cell">
<div class="sourceCode" id="cb189"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>sexef_format <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;2&quot;</span> <span class="ot">=</span> <span class="st">&quot;Femme&quot;</span>)</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>cspf_format <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;2&quot;</span> <span class="ot">=</span> <span class="st">&quot;Profession intermédiaire&quot;</span>, <span class="st">&quot;3&quot;</span> <span class="ot">=</span> <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;4&quot;</span> <span class="ot">=</span> <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;5&quot;</span> <span class="ot">=</span> <span class="st">&quot;Retraité&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-41-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-41-4-tab">
<div class="cell">
<div class="sourceCode" id="cb190"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>sexeform <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;2&quot;</span> <span class="ot">=</span> <span class="st">&quot;Femme&quot;</span>)</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>cspform <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;Cadre&quot;</span>, <span class="st">&quot;2&quot;</span> <span class="ot">=</span> <span class="st">&quot;Profession intermédiaire&quot;</span>, <span class="st">&quot;3&quot;</span> <span class="ot">=</span> <span class="st">&quot;Employé&quot;</span>, <span class="st">&quot;4&quot;</span> <span class="ot">=</span> <span class="st">&quot;Ouvrier&quot;</span>, <span class="st">&quot;5&quot;</span> <span class="ot">=</span> <span class="st">&quot;Retraité&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-41-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-41-5-tab">
<p>Préférer <code>case_match</code> quand il s’agit de valeurs déterminées.</p>
<div class="cell">
<div class="sourceCode" id="cb191"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> </span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sexef =</span> <span class="fu">case_when</span>(</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>    sexef<span class="sc">==</span><span class="st">&quot;1&quot;</span> <span class="sc">~</span> <span class="st">&quot;Homme&quot;</span>,</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>    sexef<span class="sc">==</span><span class="st">&quot;2&quot;</span> <span class="sc">~</span> <span class="st">&quot;Femme&quot;</span>,</span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> sexef),</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">cspf =</span> <span class="fu">case_match</span>(csp,</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;1&quot;</span> <span class="sc">~</span> <span class="st">&quot;Cadre&quot;</span>,</span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;2&quot;</span> <span class="sc">~</span> <span class="st">&quot;Profession intermédiaire&quot;</span>,</span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;3&quot;</span> <span class="sc">~</span> <span class="st">&quot;Employé&quot;</span>,</span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;4&quot;</span> <span class="sc">~</span> <span class="st">&quot;Ouvrier&quot;</span>,</span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;5&quot;</span> <span class="sc">~</span> <span class="st">&quot;Retraité&quot;</span>,</span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> csp)) <span class="sc">%&gt;%</span> </span>
<span id="cb191-13"><a href="#cb191-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sexe, sexef, csp, cspf)</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="utiliser-les-formats" class="level2" data-number="7.4">
<h2 data-number="7.4"><span class="header-section-number">7.4</span> Utiliser les formats</h2>
<p>Nécessite le lancement des formats à l’étape précédente.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-42-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-42-1" role="tab" aria-controls="tabset-42-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-42-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-42-2" role="tab" aria-controls="tabset-42-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-42-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-42-3" role="tab" aria-controls="tabset-42-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-42-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-42-4" role="tab" aria-controls="tabset-42-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-42-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-42-5" role="tab" aria-controls="tabset-42-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-42-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-42-1-tab">
<div class="sourceCode" id="cb192"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Exprimer dans le format sexef (Hommes / Femmes) */</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexef $<span class="dv">25</span>.;</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>  Sexef = <span class="kw">put</span>(Sexe, sexef.);</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* On exprime la CSP en texte dans une variable CSPF avec le format */</span></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> CSPF $<span class="dv">25</span>.;</span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a>  CSPF = <span class="kw">put</span>(CSP, $cspf.);</span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-42-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-42-2-tab">
<div class="cell">
<div class="sourceCode" id="cb193"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On exprime CSP et sexe en formaté</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>cspf <span class="ot">&lt;-</span> cspf[donnees_rbase<span class="sc">$</span>csp]</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>sexef <span class="ot">&lt;-</span> sexef[donnees_rbase<span class="sc">$</span>sexe]</span></code></pre></div>
</div>
</div>
<div id="tabset-42-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-42-3-tab">
<div class="cell">
<div class="sourceCode" id="cb194"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On exprime CSP et sexe en formaté</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sexef =</span> sexef_format[sexe],</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">cspf =</span> cspf_format[csp])</span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Les éventuelles valeurs manquantes sont conservées en NA</span></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">sexef =</span> <span class="fu">case_when</span>(</span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a>      sexe <span class="sc">==</span> <span class="st">&quot;1&quot;</span> <span class="sc">~</span> <span class="st">&quot;Homme&quot;</span>,</span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a>      sexe <span class="sc">==</span> <span class="st">&quot;2&quot;</span> <span class="sc">~</span> <span class="st">&quot;Femme&quot;</span>,</span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>        <span class="sc">~</span> sexe),</span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">cspf =</span> <span class="fu">case_when</span>(</span>
<span id="cb194-15"><a href="#cb194-15" aria-hidden="true" tabindex="-1"></a>      csp <span class="sc">==</span> <span class="st">&quot;1&quot;</span> <span class="sc">~</span> <span class="st">&quot;Cadre&quot;</span>,</span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a>      csp <span class="sc">==</span> <span class="st">&quot;2&quot;</span> <span class="sc">~</span> <span class="st">&quot;Profession intermédiaire&quot;</span>,</span>
<span id="cb194-17"><a href="#cb194-17" aria-hidden="true" tabindex="-1"></a>      csp <span class="sc">==</span> <span class="st">&quot;3&quot;</span> <span class="sc">~</span> <span class="st">&quot;Employé&quot;</span>,</span>
<span id="cb194-18"><a href="#cb194-18" aria-hidden="true" tabindex="-1"></a>      csp <span class="sc">==</span> <span class="st">&quot;4&quot;</span> <span class="sc">~</span> <span class="st">&quot;Ouvrier&quot;</span>,</span>
<span id="cb194-19"><a href="#cb194-19" aria-hidden="true" tabindex="-1"></a>      csp <span class="sc">==</span> <span class="st">&quot;5&quot;</span> <span class="sc">~</span> <span class="st">&quot;Retraité&quot;</span>,</span>
<span id="cb194-20"><a href="#cb194-20" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>       <span class="sc">~</span> csp)</span>
<span id="cb194-21"><a href="#cb194-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb194-22"><a href="#cb194-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Syntaxe pour attribuer une valeur aux NA</span></span>
<span id="cb194-23"><a href="#cb194-23" aria-hidden="true" tabindex="-1"></a>valeurAuxNA <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb194-24"><a href="#cb194-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sexef =</span> <span class="fu">case_when</span>(</span>
<span id="cb194-25"><a href="#cb194-25" aria-hidden="true" tabindex="-1"></a>    sexe <span class="sc">==</span> <span class="st">&quot;1&quot;</span> <span class="sc">~</span> <span class="st">&quot;Homme&quot;</span>,</span>
<span id="cb194-26"><a href="#cb194-26" aria-hidden="true" tabindex="-1"></a>    sexe <span class="sc">==</span> <span class="st">&quot;2&quot;</span> <span class="sc">~</span> <span class="st">&quot;Femme&quot;</span>,</span>
<span id="cb194-27"><a href="#cb194-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(x)    <span class="sc">~</span> <span class="st">&quot;Inconnu&quot;</span>,</span>
<span id="cb194-28"><a href="#cb194-28" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span>        <span class="sc">~</span> sexe))</span></code></pre></div>
</div>
</div>
<div id="tabset-42-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-42-4-tab">
<div class="cell">
<div class="sourceCode" id="cb195"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On exprime CSP et sexe en formaté</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span> (<span class="at">cspf =</span> cspform[csp], <span class="at">sexef =</span> sexeform[sexe])]</span></code></pre></div>
</div>
</div>
<div id="tabset-42-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-42-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="transformer-le-format-dune-variable" class="level2" data-number="7.5">
<h2 data-number="7.5"><span class="header-section-number">7.5</span> Transformer le format d’une variable</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-43-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-43-1" role="tab" aria-controls="tabset-43-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-43-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-43-2" role="tab" aria-controls="tabset-43-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-43-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-43-3" role="tab" aria-controls="tabset-43-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-43-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-43-4" role="tab" aria-controls="tabset-43-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-43-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-43-5" role="tab" aria-controls="tabset-43-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-43-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-43-1-tab">
<div class="sourceCode" id="cb196"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Transformer la variable Sexe en caractère */</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>  Sexe_car = <span class="kw">put</span>(Sexe, $<span class="dv">1</span>.);</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Transformer la variable Sexe_car en numérique */</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>  Sexe_num = <span class="kw">input</span>(Sexe_car, <span class="dv">1</span>.);</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Transformer une date d&#39;un format caractère à un format Date */</span></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> <span class="fu">date</span> $<span class="dv">10</span>.;</span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">date</span> = <span class="st">&quot;01/01/2000&quot;</span>;</span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> date_sas yymmdd10.;</span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a>  date_sas = <span class="kw">input</span>(<span class="fu">date</span>, ddmmyy10.);</span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-43-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-43-2-tab">
<div class="cell">
<div class="sourceCode" id="cb197"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer la variable sexe en numérique</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>sexe_numerique <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(donnees_rbase<span class="sc">$</span>sexe)</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer la variable sexe_numerique en caractère</span></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>sexe_caractere <span class="ot">&lt;-</span> <span class="fu">as.character</span>(donnees_rbase<span class="sc">$</span>sexe_numerique)</span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer une date d&#39;un format caractère à un format Date</span></span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>date_r <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">dmy</span>(<span class="st">&quot;01/01/2000&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-43-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-43-3-tab">
<div class="cell">
<div class="sourceCode" id="cb198"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer la variable sexe en numérique</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span>  </span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sexe_numerique =</span> <span class="fu">as.numeric</span>(sexe))</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer la variable sexe_numerique en caractère</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sexe_caractere =</span> <span class="fu">as.character</span>(sexe_numerique))</span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer une date d&#39;un format caractère à un format Date</span></span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span>  </span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_r =</span> lubridate<span class="sc">::</span><span class="fu">dmy</span>(<span class="st">&quot;01/01/2000&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-43-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-43-4-tab">
<div class="cell">
<div class="sourceCode" id="cb199"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer la variable sexe en numérique</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, sexe_numerique <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(sexe)]</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer la variable sexe_numerique en caractère</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, sexe_caractere <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(sexe_numerique)]</span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer une date d&#39;un format caractère à un format Date</span></span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, date_r <span class="sc">:</span><span class="er">=</span> lubridate<span class="sc">::</span><span class="fu">dmy</span>(<span class="st">&quot;01/01/2000&quot;</span>)]</span></code></pre></div>
</div>
</div>
<div id="tabset-43-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-43-5-tab">
<div class="cell">
<div class="sourceCode" id="cb200"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="co">#enNumerique &lt;- c(&quot;Duree&quot;, &quot;Note_Contenu&quot;, &quot;Note_Formateur&quot;, &quot;Note_Moyens&quot;, &quot;Note_Accompagnement&quot;, &quot;Note_Materiel&quot;)</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a><span class="co">#enDate &lt;- c(&#39;Date_naissance&#39;, &#39;Date_entree&#39;)</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a><span class="co">#requete_duckdb %&gt;%  </span></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  mutate_at(enNumerique, as.integer) %&gt;% </span></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  mutate(poids_sondage=as.numeric(poids_sondage)) %&gt;%</span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  mutate_at(enDate, ~ as.Date(strptime(.,&#39;%d/%m/%Y&#39;))) %&gt;% # strptime est une fonction duckdb</span></span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  select(enDate, Duree, Note_Contenu)</span></span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span></code></pre></div>
</div>
<p>Note : <code>duckdb</code> fait des conversions de type implicitement, mais seulement les conversions incontestables. Il faudra souvent préciser le type des variables.</p>
</div>
</div>
</div>
</section>
<section id="créer-et-supprimer-plusieurs-variables" class="level2" data-number="7.6">
<h2 data-number="7.6"><span class="header-section-number">7.6</span> Créer, et supprimer plusieurs variables</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-44-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-44-1" role="tab" aria-controls="tabset-44-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-44-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-44-2" role="tab" aria-controls="tabset-44-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-44-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-44-3" role="tab" aria-controls="tabset-44-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-44-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-44-4" role="tab" aria-controls="tabset-44-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-44-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-44-5" role="tab" aria-controls="tabset-44-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-44-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-44-1-tab">
<div class="sourceCode" id="cb201"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Manipulation de colonnes par référence */</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Creation;</span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>  note_contenu2 = note_contenu / <span class="dv">20</span> * <span class="dv">5</span>;</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>  note_formateur2 = note_formateur / <span class="dv">20</span> * <span class="dv">5</span>;</span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Suppression des variables créées */</span></span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">drop</span> note_contenu2 note_formateur2;</span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a><span class="co">/* Par nom ou par variable */</span></span>
<span id="cb201-11"><a href="#cb201-11" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> <span class="fu">var</span> = identifiant Sexe note_contenu;</span>
<span id="cb201-12"><a href="#cb201-12" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Femmes;</span>
<span id="cb201-13"><a href="#cb201-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Sélection de colonnes */</span></span>
<span id="cb201-14"><a href="#cb201-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = <span class="kw">&amp;var.</span>);</span>
<span id="cb201-15"><a href="#cb201-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Sélection de lignes respectant une certaine condition */</span></span>
<span id="cb201-16"><a href="#cb201-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> Sexe = <span class="st">&quot;2&quot;</span>;</span>
<span id="cb201-17"><a href="#cb201-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Création de colonne */</span></span>
<span id="cb201-18"><a href="#cb201-18" aria-hidden="true" tabindex="-1"></a>  note2 = note_contenu / <span class="dv">20</span> * <span class="dv">5</span>;</span>
<span id="cb201-19"><a href="#cb201-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Suppression de colonnes */</span></span>
<span id="cb201-20"><a href="#cb201-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">drop</span> note2;</span>
<span id="cb201-21"><a href="#cb201-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Selection de colonnes */</span></span>
<span id="cb201-22"><a href="#cb201-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">keep</span> identifiant Sexe note_contenu;</span>
<span id="cb201-23"><a href="#cb201-23" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-44-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-44-2-tab">
<div class="cell">
<div class="sourceCode" id="cb202"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>note2 <span class="ot">&lt;-</span> donnees_rbase<span class="sc">$</span>note_contenu <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">5</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Le with permet de s&#39;affranchir des expressions &quot;donnees_rbase$&quot;</span></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_rbase, note2 <span class="ot">&lt;-</span> note_contenu <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">5</span>)</span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> <span class="fu">transform</span>(donnees_rbase, <span class="at">note2 =</span> note_contenu <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">5</span>)</span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a><span class="co"># On ne peut pas utiliser transform pour des variables récemment créées</span></span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a><span class="co">#donnees_rbase &lt;- transform(donnees_rbase, note3 = note_contenu ** 2, note3 = log(note3))</span></span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppression de variables</span></span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>note2 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Création et suppressions de plusieurs variables</span></span>
<span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> <span class="fu">transform</span>(donnees_rbase, <span class="at">note_contenu2 =</span> note_contenu <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">5</span>, <span class="at">note_formateur2 =</span> note_formateur <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">5</span>)</span>
<span id="cb202-13"><a href="#cb202-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppression des variables créées</span></span>
<span id="cb202-14"><a href="#cb202-14" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu2&quot;</span>, <span class="st">&quot;note_formateur2&quot;</span>)</span>
<span id="cb202-15"><a href="#cb202-15" aria-hidden="true" tabindex="-1"></a>donnees_rbase[, variable] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
</div>
</div>
<div id="tabset-44-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-44-3-tab">
<div class="cell">
<div class="sourceCode" id="cb203"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">note2 =</span> note_contenu <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">5</span>)</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppression de variables</span></span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>note2)</span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-8"><a href="#cb203-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Création et suppressions de plusieurs variables</span></span>
<span id="cb203-9"><a href="#cb203-9" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb203-10"><a href="#cb203-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">note_contenu2 =</span> note_contenu <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">5</span>,</span>
<span id="cb203-11"><a href="#cb203-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">note_formateur2 =</span> note_formateur <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">5</span>)</span>
<span id="cb203-12"><a href="#cb203-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-13"><a href="#cb203-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppression des variables créées</span></span>
<span id="cb203-14"><a href="#cb203-14" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu2&quot;</span>, <span class="st">&quot;note_formateur2&quot;</span>)</span>
<span id="cb203-15"><a href="#cb203-15" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb203-16"><a href="#cb203-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">all_of</span>(variable))</span></code></pre></div>
</div>
</div>
<div id="tabset-44-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-44-4-tab">
<div class="cell">
<div class="sourceCode" id="cb204"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Création de variables</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, note2 <span class="sc">:</span><span class="er">=</span> note_contenu <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">5</span>]</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppression de variables</span></span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, note2 <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Création et suppressions de plusieurs variables</span></span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">c</span>(<span class="st">&quot;note_contenu2&quot;</span>, <span class="st">&quot;note_formateur2&quot;</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">list</span>(note_contenu <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">5</span>, note_formateur <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">5</span>)]</span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span> (<span class="at">note_contenu2 =</span> note_contenu <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">5</span>, <span class="at">note_formateur2 =</span> note_formateur <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">5</span>)]</span>
<span id="cb204-10"><a href="#cb204-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppression des variables créées</span></span>
<span id="cb204-11"><a href="#cb204-11" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">c</span>(<span class="st">&quot;note_contenu2&quot;</span>, <span class="st">&quot;note_formateur2&quot;</span>) <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb204-12"><a href="#cb204-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou par référence extérieure</span></span>
<span id="cb204-13"><a href="#cb204-13" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu2&quot;</span>, <span class="st">&quot;note_formateur2&quot;</span>)</span>
<span id="cb204-14"><a href="#cb204-14" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span> (<span class="at">note_contenu2 =</span> note_contenu <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">5</span>, <span class="at">note_formateur2 =</span> note_formateur <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">5</span>)]</span>
<span id="cb204-15"><a href="#cb204-15" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, (variable) <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-44-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-44-5-tab">
<div class="cell">
<div class="sourceCode" id="cb205"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : à compléter !</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Création de la colonne note2</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> </span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">note2 =</span> <span class="fu">as.integer</span>(Note_Contenu) <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(note2)</span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppression de colonnes</span></span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a><span class="co">#requete_duckdb %&gt;% select(- CSP, -contains(&quot;Date&quot;), -starts_with(&quot;Note&quot;))</span></span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="on-souhaite-réexprimer-toutes-les-notes-sur-100-et-non-sur-20" class="level2" data-number="7.7">
<h2 data-number="7.7"><span class="header-section-number">7.7</span> On souhaite réexprimer toutes les notes sur 100 et non sur 20</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-45-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-45-1" role="tab" aria-controls="tabset-45-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-45-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-45-2" role="tab" aria-controls="tabset-45-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-45-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-45-3" role="tab" aria-controls="tabset-45-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-45-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-45-4" role="tab" aria-controls="tabset-45-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-45-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-45-5" role="tab" aria-controls="tabset-45-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-45-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-45-1-tab">
<div class="sourceCode" id="cb206"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> notes = Note_Contenu   Note_Formateur Note_Moyens     Note_Accompagnement     Note_Materiel;</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* On supprime d&#39;abord les doubles blancs entre les variables */</span></span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> notes = <span class="kw">%sysfunc</span>(<span class="fu">compbl</span>(<span class="kw">&amp;notes.</span>));</span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a><span class="co">/* on affiche les notes dans la log de SAS */</span></span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> <span class="kw">&amp;notes;</span></span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a><span class="co">/* 1ère solution : avec les array */</span></span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a><span class="co">/* Les variables sont modifiées dans cet exemple */</span></span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Sur100_1;</span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb206-11"><a href="#cb206-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">array</span> variables (*) <span class="kw">&amp;notes.</span>;</span>
<span id="cb206-12"><a href="#cb206-12" aria-hidden="true" tabindex="-1"></a><span class="kw">  do</span> increment = <span class="dv">1</span> <span class="kw">to</span> <span class="fu">dim</span>(variables);</span>
<span id="cb206-13"><a href="#cb206-13" aria-hidden="true" tabindex="-1"></a>    variables[increment] = variables[increment] / <span class="dv">20</span> * <span class="dv">100</span>;</span>
<span id="cb206-14"><a href="#cb206-14" aria-hidden="true" tabindex="-1"></a><span class="kw">  end</span>; </span>
<span id="cb206-15"><a href="#cb206-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">drop</span> increment;</span>
<span id="cb206-16"><a href="#cb206-16" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb206-17"><a href="#cb206-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-18"><a href="#cb206-18" aria-hidden="true" tabindex="-1"></a><span class="co">/* 2e solution : avec une macro */</span></span>
<span id="cb206-19"><a href="#cb206-19" aria-hidden="true" tabindex="-1"></a><span class="co">/* De nouvelles variables sont ajoutées dans cet exemple */</span></span>
<span id="cb206-20"><a href="#cb206-20" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb206-21"><a href="#cb206-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb206-22"><a href="#cb206-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%macro</span> Sur100;</span>
<span id="cb206-23"><a href="#cb206-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%do</span> i = <span class="dv">1</span> <span class="kw">%to</span> <span class="kw">%sysfunc</span>(countw(<span class="kw">&amp;notes.</span>));</span>
<span id="cb206-24"><a href="#cb206-24" aria-hidden="true" tabindex="-1"></a>      <span class="kw">%let</span> <span class="fu">note</span> = <span class="kw">%scan</span>(<span class="kw">&amp;notes.</span>, <span class="kw">&amp;i.</span>);</span>
<span id="cb206-25"><a href="#cb206-25" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&amp;note.</span>_100 = <span class="kw">&amp;note.</span> / <span class="dv">20</span> * <span class="dv">100</span>;</span>
<span id="cb206-26"><a href="#cb206-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%end</span>;</span>
<span id="cb206-27"><a href="#cb206-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%mend</span> Sur100;</span>
<span id="cb206-28"><a href="#cb206-28" aria-hidden="true" tabindex="-1"></a>  %Sur100;</span>
<span id="cb206-29"><a href="#cb206-29" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-45-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-45-2-tab">
<div class="cell">
<div class="sourceCode" id="cb207"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">names</span>(donnees_rbase)[<span class="fu">grepl</span>(<span class="st">&quot;^note&quot;</span>, <span class="fu">names</span>(donnees_rbase))]</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Les variables sont modifiées dans cet exemple</span></span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>sur100 <span class="ot">&lt;-</span> donnees_rbase[, notes] <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a><span class="co"># On  souhaite conserver les notes sur 100 dans d&#39;autres variables, suffixées par _100</span></span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a>donnees_rbase[, <span class="fu">paste0</span>(notes, <span class="st">&quot;_100&quot;</span>)] <span class="ot">&lt;-</span> donnees_rbase[, notes] <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div>
</div>
</div>
<div id="tabset-45-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-45-3-tab">
<div class="cell">
<div class="sourceCode" id="cb208"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les variables sont modifiées dans cet exemple</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>sur100 <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;note&quot;</span>), <span class="sc">~</span> .x <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">100</span>))</span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a><span class="co"># On  souhaite conserver les notes sur 100 dans d&#39;autres variables, suffixées par _100</span></span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;note&quot;</span>), <span class="sc">~</span> .x <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">100</span>, <span class="at">.names =</span> <span class="st">&quot;{.col}_100&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-45-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-45-4-tab">
<div class="cell">
<div class="sourceCode" id="cb209"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">names</span>(donnees_datatable)[<span class="fu">grepl</span>(<span class="st">&quot;^note&quot;</span>, <span class="fu">names</span>(donnees_datatable))]</span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Les variables sont modifiées dans cet exemple</span></span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a>sur100 <span class="ot">&lt;-</span> <span class="fu">copy</span>(donnees_datatable)</span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a>sur100 <span class="ot">&lt;-</span> sur100[, (notes) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) x <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">100</span>), .SDcols <span class="ot">=</span> notes]</span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a>sur100 <span class="ot">&lt;-</span> sur100[, (notes) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) x <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">100</span>), .SD <span class="ot">=</span> notes]</span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou encore, plus simple</span></span>
<span id="cb209-8"><a href="#cb209-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Dans cet exemple, les notes dans la base donnees_datatable ne sont pas changées</span></span>
<span id="cb209-9"><a href="#cb209-9" aria-hidden="true" tabindex="-1"></a>sur100 <span class="ot">&lt;-</span> sur100[, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) x <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">100</span>), .SDcols <span class="ot">=</span> <span class="fu">patterns</span>(<span class="st">&quot;^note&quot;</span>)]</span>
<span id="cb209-10"><a href="#cb209-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-11"><a href="#cb209-11" aria-hidden="true" tabindex="-1"></a><span class="co"># On  souhaite conserver les notes sur 20 dans d&#39;autres variables, suffixées par _20</span></span>
<span id="cb209-12"><a href="#cb209-12" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, (<span class="fu">paste0</span>(notes, <span class="st">&quot;_100&quot;</span>)) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) x <span class="sc">/</span> <span class="dv">20</span> <span class="sc">*</span> <span class="dv">100</span>), .SDcols <span class="ot">=</span> notes]</span></code></pre></div>
</div>
</div>
<div id="tabset-45-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-45-5-tab">
<div class="cell">
<div class="sourceCode" id="cb210"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> </span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;note&quot;</span>), <span class="sc">~</span> <span class="fu">as.numeric</span>(.x)<span class="sc">/</span><span class="dv">20</span><span class="sc">*</span><span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;note&quot;</span>))</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="mettre-un-0-devant-un-nombre" class="level2" data-number="7.8">
<h2 data-number="7.8"><span class="header-section-number">7.8</span> Mettre un 0 devant un nombre</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-46-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-46-1" role="tab" aria-controls="tabset-46-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-46-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-46-2" role="tab" aria-controls="tabset-46-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-46-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-46-3" role="tab" aria-controls="tabset-46-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-46-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-46-4" role="tab" aria-controls="tabset-46-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-46-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-46-5" role="tab" aria-controls="tabset-46-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-46-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-46-1-tab">
<div class="sourceCode" id="cb211"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Zero_devant;</span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = date_entree);</span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Obtenir le mois et la date */</span></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>  Mois = <span class="fu">month</span>(date_entree);</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>  Annee = <span class="fu">year</span>(date_entree);</span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Mettre le mois sur 2 positions (avec un 0 devant si le mois &lt;= 9) : format prédéfini z2. */</span></span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a>  Mois_a = <span class="kw">put</span>(Mois, z2.);</span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">drop</span> Mois;</span>
<span id="cb211-9"><a href="#cb211-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">rename</span> Mois_a = Mois;</span>
<span id="cb211-10"><a href="#cb211-10" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-46-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-46-2-tab">
<div class="cell">
<div class="sourceCode" id="cb212"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtenir le mois et la date</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>mois <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">month</span>(donnees_rbase<span class="sc">$</span>date_entree)</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>annee <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">year</span>(donnees_rbase<span class="sc">$</span>date_entree)</span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Mettre le numéro du mois sur 2 positions (avec un 0 devant si le mois &lt;= 9)</span></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>mois <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%02d&quot;</span>, donnees_rbase<span class="sc">$</span>mois)</span></code></pre></div>
</div>
</div>
<div id="tabset-46-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-46-3-tab">
<div class="cell">
<div class="sourceCode" id="cb213"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mois =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%02d&quot;</span>, lubridate<span class="sc">::</span><span class="fu">month</span>(date_entree)))</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mois =</span> lubridate<span class="sc">::</span><span class="fu">month</span>(date_entree),</span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">mois =</span> <span class="fu">ifelse</span>(<span class="fu">str_length</span>(mois) <span class="sc">&lt;</span> <span class="dv">2</span>, <span class="fu">paste0</span>(<span class="st">&quot;0&quot;</span>, mois), mois))</span></code></pre></div>
</div>
</div>
<div id="tabset-46-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-46-4-tab">
<div class="cell">
<div class="sourceCode" id="cb214"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtenir le mois et la date</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">mois =</span> lubridate<span class="sc">::</span><span class="fu">month</span>(date_entree), <span class="at">annee =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(donnees_datatable<span class="sc">$</span>date_entree))]</span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Mettre le numéro du mois sur 2 positions (avec un 0 devant si le mois &lt;= 9)</span></span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, mois <span class="sc">:</span><span class="er">=</span> <span class="fu">sprintf</span>(<span class="st">&quot;%02d&quot;</span>, mois)]</span></code></pre></div>
</div>
</div>
<div id="tabset-46-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-46-5-tab">
<div class="cell">
<div class="sourceCode" id="cb215"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : pas exactement au bon endroit</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="co">#requete_duckdb %&gt;% </span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  mutate_at(enDate, ~ as.Date(strptime(.,&#39;%d/%m/%Y&#39;))) %&gt;% # strptime est une fonction duckdb</span></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  mutate(mois=lubridate::month(Date_entree),</span></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a><span class="co">#         mois=ifelse(str_length(mois)&lt;2, paste0(&quot;0&quot;, mois), mois)) %&gt;% </span></span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  select(mois, Date_entree)</span></span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="arrondir-une-valeur-numérique" class="level2" data-number="7.9">
<h2 data-number="7.9"><span class="header-section-number">7.9</span> Arrondir une valeur numérique</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-47-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-47-1" role="tab" aria-controls="tabset-47-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-47-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-47-2" role="tab" aria-controls="tabset-47-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-47-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-47-3" role="tab" aria-controls="tabset-47-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-47-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-47-4" role="tab" aria-controls="tabset-47-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-47-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-47-5" role="tab" aria-controls="tabset-47-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-47-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-47-1-tab">
<div class="sourceCode" id="cb216"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Arrondis;</span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = poids_sondage);</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Arrondi à l&#39;entier le plus proche */</span></span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>  poids_arrondi_0 = <span class="fu">round</span>(poids_sondage);</span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Arrondi à 1 chiffre après la virgule */</span></span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a>  poids_arrondi_1 = <span class="fu">round</span>(poids_sondage, <span class="dv">0.1</span>);</span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Arrondi à 2 chiffre après la virgule */</span></span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a>  poids_arrondi_2 = <span class="fu">round</span>(poids_sondage, <span class="dv">0.2</span>);</span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Arrondi à l&#39;entier inférieur */</span></span>
<span id="cb216-10"><a href="#cb216-10" aria-hidden="true" tabindex="-1"></a>  poids_inf = <span class="fu">floor</span>(poids_sondage);</span>
<span id="cb216-11"><a href="#cb216-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Arrondi à l&#39;entier supérieur */</span></span>
<span id="cb216-12"><a href="#cb216-12" aria-hidden="true" tabindex="-1"></a>  poids_sup = <span class="fu">ceil</span>(poids_sondage);  </span>
<span id="cb216-13"><a href="#cb216-13" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-47-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-47-2-tab">
<div class="cell">
<div class="sourceCode" id="cb217"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrondi à l&#39;entier le plus proche</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>poids_arrondi_0 <span class="ot">&lt;-</span> <span class="fu">round</span>(donnees_rbase<span class="sc">$</span>poids_sondage, <span class="dv">0</span>)</span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrondi à 1 chiffre après la virgule</span></span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>poids_arrondi_1 <span class="ot">&lt;-</span> <span class="fu">round</span>(donnees_rbase<span class="sc">$</span>poids_sondage, <span class="dv">1</span>)</span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrondi à 2 chiffre après la virgule</span></span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>poids_arrondi_2 <span class="ot">&lt;-</span> <span class="fu">round</span>(donnees_rbase<span class="sc">$</span>poids_sondage, <span class="dv">2</span>)</span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrondi à l&#39;entier inférieur</span></span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a>poids_inf <span class="ot">&lt;-</span> <span class="fu">floor</span>(donnees_rbase<span class="sc">$</span>poids_sondage)</span>
<span id="cb217-9"><a href="#cb217-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrondi à l&#39;entier supérieur</span></span>
<span id="cb217-10"><a href="#cb217-10" aria-hidden="true" tabindex="-1"></a>poids_sup <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(donnees_rbase<span class="sc">$</span>poids_sondage)</span></code></pre></div>
</div>
</div>
<div id="tabset-47-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-47-3-tab">
<div class="cell">
<div class="sourceCode" id="cb218"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Arrondi à l&#39;entier le plus proche</span></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">poids_arrondi_0 =</span> <span class="fu">round</span>(poids_sondage, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Arrondi à 1 chiffre après la virgule</span></span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">poids_arrondi_1 =</span> <span class="fu">round</span>(poids_sondage, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Arrondi à 2 chiffre après la virgule</span></span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">poids_arrondi_2 =</span> <span class="fu">round</span>(poids_sondage, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb218-8"><a href="#cb218-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Arrondi à l&#39;entier inférieur</span></span>
<span id="cb218-9"><a href="#cb218-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">poids_inf =</span> <span class="fu">floor</span>(poids_sondage)) <span class="sc">%&gt;%</span> </span>
<span id="cb218-10"><a href="#cb218-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Arrondi à l&#39;entier supérieur</span></span>
<span id="cb218-11"><a href="#cb218-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">poids_sup =</span> <span class="fu">ceiling</span>(poids_sondage))</span>
<span id="cb218-12"><a href="#cb218-12" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;poids&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-47-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-47-4-tab">
<div class="cell">
<div class="sourceCode" id="cb219"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrondi à l&#39;entier le plus proche</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, poids_arrondi_0 <span class="sc">:</span><span class="er">=</span> <span class="fu">round</span>(poids_sondage, <span class="dv">0</span>)]</span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrondi à 1 chiffre après la virgule</span></span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, poids_arrondi_1 <span class="sc">:</span><span class="er">=</span> <span class="fu">round</span>(poids_sondage, <span class="dv">1</span>)]</span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrondi à 2 chiffre après la virgule</span></span>
<span id="cb219-6"><a href="#cb219-6" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, poids_arrondi_2 <span class="sc">:</span><span class="er">=</span> <span class="fu">round</span>(poids_sondage, <span class="dv">2</span>)]</span>
<span id="cb219-7"><a href="#cb219-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrondi à l&#39;entier inférieur</span></span>
<span id="cb219-8"><a href="#cb219-8" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, poids_inf <span class="sc">:</span><span class="er">=</span> <span class="fu">floor</span>(poids_sondage)]</span>
<span id="cb219-9"><a href="#cb219-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrondi à l&#39;entier supérieur</span></span>
<span id="cb219-10"><a href="#cb219-10" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, poids_sup <span class="sc">:</span><span class="er">=</span> <span class="fu">ceiling</span>(poids_sondage)]</span></code></pre></div>
</div>
</div>
<div id="tabset-47-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-47-5-tab">
<div class="cell">
<div class="sourceCode" id="cb220"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> </span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="co"># la fonction round de duckdb ne prend pas l&#39;argument digits, mais la traduction fonctionne</span></span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">poids_arrondi_0 =</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(poids_sondage),<span class="dv">0</span>),</span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">poids_arrondi_1 =</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(poids_sondage),<span class="dv">1</span>),</span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">poids_arrondi_2 =</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(poids_sondage),<span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">poids_floor =</span> <span class="fu">floor</span>(<span class="fu">as.numeric</span>(poids_sondage)),</span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">poids_ceiling =</span> <span class="fu">ceiling</span>(<span class="fu">as.numeric</span>(poids_sondage)),</span>
<span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;poids&quot;</span>))</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="manipuler-des-dates" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Manipuler des dates</h1>
<p>Pour en savoir plus sur le fonctionnement des dates en <code>R</code> : <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_donnees_temporelles.html" class="uri">https://book.utilitr.org/03_Fiches_thematiques/Fiche_donnees_temporelles.html</a>.</p>
<section id="créer-des-dates" class="level2" data-number="8.1">
<h2 data-number="8.1"><span class="header-section-number">8.1</span> Créer des dates</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-48-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-48-1" role="tab" aria-controls="tabset-48-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-48-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-48-2" role="tab" aria-controls="tabset-48-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-48-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-48-3" role="tab" aria-controls="tabset-48-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-48-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-48-4" role="tab" aria-controls="tabset-48-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-48-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-48-5" role="tab" aria-controls="tabset-48-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-48-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-48-1-tab">
<div class="sourceCode" id="cb221"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Deux manières de créer une date */</span></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Decembre_31_<span class="kw">&amp;an.</span>_a Decembre_31_<span class="kw">&amp;an.</span>_b ddmmyy10.;</span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>  Decembre_31_<span class="kw">&amp;an.</span>_a = <span class="st">&quot;31dec&amp;an.&quot;</span>d;</span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* mdy pour month, day, year (pas d&#39;autre alternative, ymd par exemple n&#39;existe pas) */</span></span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a>  Decembre_31_<span class="kw">&amp;an.</span>_b = <span class="fu">mdy</span>(<span class="dv">12</span>, <span class="dv">31</span>, <span class="kw">&amp;an.</span>);</span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-48-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-48-2-tab">
<div class="cell">
<div class="sourceCode" id="cb222"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour créer une date</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="fu">paste0</span>(annee,<span class="st">&quot;-12-31&quot;</span>), <span class="at">origin =</span> <span class="st">&quot;1970-01-01&quot;</span>)</span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">paste0</span>(annee,<span class="st">&quot;-12-31&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-48-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-48-3-tab">
<div class="cell">
<div class="sourceCode" id="cb223"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour créer une date</span></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="fu">paste0</span>(annee,<span class="st">&quot;-12-31&quot;</span>))</span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">paste0</span>(annee,<span class="st">&quot;-12-31&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-48-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-48-4-tab">
<div class="cell">
<div class="sourceCode" id="cb224"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour créer une date</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="fu">paste0</span>(annee,<span class="st">&quot;-12-31&quot;</span>))</span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">paste0</span>(annee,<span class="st">&quot;-12-31&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-48-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-48-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="manipuler-des-dates-1" class="level2" data-number="8.2">
<h2 data-number="8.2"><span class="header-section-number">8.2</span> Manipuler des dates</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-49-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-49-1" role="tab" aria-controls="tabset-49-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-49-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-49-2" role="tab" aria-controls="tabset-49-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-49-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-49-3" role="tab" aria-controls="tabset-49-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-49-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-49-4" role="tab" aria-controls="tabset-49-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-49-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-49-5" role="tab" aria-controls="tabset-49-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-49-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-49-1-tab">
<div class="sourceCode" id="cb225"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* On utilise ici %sysevalf et non %eval pour des calculs avec des macro-variables non entières */</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> sixmois = <span class="kw">%sysevalf</span>(<span class="dv">365.25</span>/<span class="dv">2</span>);</span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> sixmois : <span class="kw">&amp;sixmois.</span>;</span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Âge à l&#39;entrée dans le dispositif */</span></span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a>  Age = <span class="fu">intck</span>(<span class="st">&#39;year&#39;</span>, date_naissance, date_entree);</span>
<span id="cb225-8"><a href="#cb225-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Âge formaté */</span></span>
<span id="cb225-9"><a href="#cb225-9" aria-hidden="true" tabindex="-1"></a>  Agef = <span class="kw">put</span>(Age, agef.);</span>
<span id="cb225-10"><a href="#cb225-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Date de sortie du dispositif : ajout de la durée à la date d&#39;entrée */</span></span>
<span id="cb225-11"><a href="#cb225-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> date_sortie ddmmyy10.;</span>
<span id="cb225-12"><a href="#cb225-12" aria-hidden="true" tabindex="-1"></a>  date_sortie = <span class="fu">intnx</span>(<span class="st">&#39;day&#39;</span>, date_entree, duree);  </span>
<span id="cb225-13"><a href="#cb225-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* La durée du contrat est-elle inférieure à 6 mois ? */</span></span>
<span id="cb225-14"><a href="#cb225-14" aria-hidden="true" tabindex="-1"></a>  Duree_Inf_6_mois = (Duree &lt; <span class="kw">&amp;sixmois.</span> <span class="kw">&amp; </span>Duree ne .);</span>
<span id="cb225-15"><a href="#cb225-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb225-16"><a href="#cb225-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Date 6 mois après la sortie */</span></span>
<span id="cb225-17"><a href="#cb225-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Date_6mois ddmmyy10.;</span>
<span id="cb225-18"><a href="#cb225-18" aria-hidden="true" tabindex="-1"></a>  Date_6mois = <span class="fu">intnx</span>(<span class="st">&#39;month&#39;</span>, date_sortie, <span class="dv">6</span>);</span>
<span id="cb225-19"><a href="#cb225-19" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb225-20"><a href="#cb225-20" aria-hidden="true" tabindex="-1"></a><span class="co">/* Ventilation pondérée (cf. infra) */</span></span>
<span id="cb225-21"><a href="#cb225-21" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;tables apres_31_decembre;weight poids_sondage<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-49-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-49-2-tab">
<div class="cell">
<div class="sourceCode" id="cb226"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Âge à l&#39;entrée dans le dispositif</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">floor</span>(lubridate<span class="sc">::</span><span class="fu">time_length</span>(<span class="fu">difftime</span>(donnees_rbase<span class="sc">$</span>date_entree, donnees_rbase<span class="sc">$</span>date_naissance), <span class="st">&quot;years&quot;</span>))</span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Âge formaté</span></span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>agef[donnees_rbase<span class="sc">$</span>age <span class="sc">&lt;</span> <span class="dv">26</span>]                           <span class="ot">&lt;-</span> <span class="st">&quot;1. De 15 à 25 ans&quot;</span></span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 26 &lt;= donnees_rbase$age &lt; 50 ne fonctionne pas, il faut passer en 2 étapes</span></span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>agef[<span class="dv">26</span> <span class="sc">&lt;=</span> donnees_rbase<span class="sc">$</span>age <span class="sc">&amp;</span> donnees_rbase<span class="sc">$</span>age <span class="sc">&lt;</span> <span class="dv">50</span>] <span class="ot">&lt;-</span> <span class="st">&quot;2. De 26 à 49 ans&quot;</span></span>
<span id="cb226-7"><a href="#cb226-7" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>agef[donnees_rbase<span class="sc">$</span>age <span class="sc">&gt;=</span> <span class="dv">50</span>]                          <span class="ot">&lt;-</span> <span class="st">&quot;3. 50 ans ou plus&quot;</span></span>
<span id="cb226-8"><a href="#cb226-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb226-9"><a href="#cb226-9" aria-hidden="true" tabindex="-1"></a><span class="co"># L&#39;option right = TRUE implique que les bornes sont ]0; 25] / ]25; 49] / ]49; Infini[</span></span>
<span id="cb226-10"><a href="#cb226-10" aria-hidden="true" tabindex="-1"></a>agef <span class="ot">&lt;-</span> <span class="fu">cut</span>(donnees_rbase<span class="sc">$</span>age, </span>
<span id="cb226-11"><a href="#cb226-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">25</span>, <span class="dv">49</span>, <span class="cn">Inf</span>),</span>
<span id="cb226-12"><a href="#cb226-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">right =</span> <span class="cn">TRUE</span>,</span>
<span id="cb226-13"><a href="#cb226-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;1. De 15 à 25 ans&quot;</span>, <span class="st">&quot;2. De 26 à 49 ans&quot;</span>, <span class="st">&quot;3. 50 ans ou plus&quot;</span>), </span>
<span id="cb226-14"><a href="#cb226-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">ordered_result =</span> <span class="cn">TRUE</span>)</span>
<span id="cb226-15"><a href="#cb226-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-16"><a href="#cb226-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Manipuler les dates</span></span>
<span id="cb226-17"><a href="#cb226-17" aria-hidden="true" tabindex="-1"></a>sixmois <span class="ot">&lt;-</span> <span class="fl">365.25</span><span class="sc">/</span><span class="dv">2</span></span>
<span id="cb226-18"><a href="#cb226-18" aria-hidden="true" tabindex="-1"></a><span class="co"># La durée du contrat est-elle inférieure à 6 mois ?</span></span>
<span id="cb226-19"><a href="#cb226-19" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>duree_inf_6_mois <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(donnees_rbase<span class="sc">$</span>duree <span class="sc">&lt;</span> sixmois, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb226-20"><a href="#cb226-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Date de sortie du dispositif</span></span>
<span id="cb226-21"><a href="#cb226-21" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>date_sortie <span class="ot">&lt;-</span> donnees_rbase<span class="sc">$</span>date_entree <span class="sc">+</span> lubridate<span class="sc">::</span><span class="fu">days</span>(donnees_rbase<span class="sc">$</span>duree)</span>
<span id="cb226-22"><a href="#cb226-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-23"><a href="#cb226-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Date 6 mois après la sortie</span></span>
<span id="cb226-24"><a href="#cb226-24" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>date_6mois <span class="ot">&lt;-</span> donnees_rbase<span class="sc">$</span>date_sortie <span class="sc">+</span> lubridate<span class="sc">::</span><span class="fu">month</span>(<span class="dv">6</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-49-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-49-3-tab">
<div class="cell">
<div class="sourceCode" id="cb227"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Âge à l&#39;entrée dans le dispositif</span></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">as.period</span>(<span class="fu">interval</span>(<span class="at">start =</span> date_naissance, <span class="at">end =</span> date_entree))<span class="sc">$</span>year)</span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Âge formaté</span></span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agef =</span> <span class="fu">case_when</span>(</span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&lt;</span> <span class="dv">26</span>             <span class="sc">~</span> <span class="st">&quot;1. De 15 à 25 ans&quot;</span>,</span>
<span id="cb227-8"><a href="#cb227-8" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&gt;=</span> <span class="dv">26</span> <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">50</span> <span class="sc">~</span> <span class="st">&quot;2. De 26 à 49 ans&quot;</span>,</span>
<span id="cb227-9"><a href="#cb227-9" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&gt;=</span> <span class="dv">50</span>            <span class="sc">~</span> <span class="st">&quot;3. 50 ans ou plus&quot;</span>)</span>
<span id="cb227-10"><a href="#cb227-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb227-11"><a href="#cb227-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-12"><a href="#cb227-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Manipuler les dates</span></span>
<span id="cb227-13"><a href="#cb227-13" aria-hidden="true" tabindex="-1"></a>sixmois <span class="ot">&lt;-</span> <span class="fl">365.25</span><span class="sc">/</span><span class="dv">2</span></span>
<span id="cb227-14"><a href="#cb227-14" aria-hidden="true" tabindex="-1"></a><span class="co"># La durée du contrat est-elle inférieure à 6 mois ?</span></span>
<span id="cb227-15"><a href="#cb227-15" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb227-16"><a href="#cb227-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">duree_inf_6_mois =</span> <span class="fu">case_when</span>(duree <span class="sc">&lt;</span>  sixmois <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb227-17"><a href="#cb227-17" aria-hidden="true" tabindex="-1"></a>                                      duree <span class="sc">&gt;=</span> sixmois <span class="sc">~</span> <span class="dv">0</span>))</span>
<span id="cb227-18"><a href="#cb227-18" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">pull</span>(duree_inf_6_mois) <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span>
<span id="cb227-19"><a href="#cb227-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-20"><a href="#cb227-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Date de sortie du dispositif</span></span>
<span id="cb227-21"><a href="#cb227-21" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb227-22"><a href="#cb227-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_sortie =</span> date_entree <span class="sc">+</span> lubridate<span class="sc">::</span><span class="fu">days</span>(duree))</span>
<span id="cb227-23"><a href="#cb227-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-24"><a href="#cb227-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Date 6 mois après la sortie</span></span>
<span id="cb227-25"><a href="#cb227-25" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb227-26"><a href="#cb227-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_6mois =</span> date_sortie <span class="sc">+</span> lubridate<span class="sc">::</span><span class="fu">month</span>(<span class="dv">6</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-49-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-49-4-tab">
<div class="cell">
<div class="sourceCode" id="cb228"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Âge à l&#39;entrée dans le dispositif</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, age <span class="sc">:</span><span class="er">=</span> <span class="fu">floor</span>(lubridate<span class="sc">::</span><span class="fu">time_length</span>(<span class="fu">difftime</span>(donnees_datatable<span class="sc">$</span>date_entree, donnees_datatable<span class="sc">$</span>date_naissance), <span class="st">&quot;years&quot;</span>))]</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Âge formaté</span></span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, agef <span class="sc">:</span><span class="er">=</span> <span class="fu">fcase</span>(age <span class="sc">&lt;</span> <span class="dv">26</span>,             <span class="st">&quot;1. De 15 à 25 ans&quot;</span>,</span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="dv">26</span> <span class="sc">&lt;=</span> age <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">50</span>, <span class="st">&quot;2. De 26 à 49 ans&quot;</span>,</span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a>                                  age <span class="sc">&gt;=</span> <span class="dv">50</span>,            <span class="st">&quot;3. 50 ans ou plus&quot;</span>)]</span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Manipuler les dates</span></span>
<span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a>sixmois <span class="ot">&lt;-</span> <span class="fl">365.25</span><span class="sc">/</span><span class="dv">2</span></span>
<span id="cb228-11"><a href="#cb228-11" aria-hidden="true" tabindex="-1"></a><span class="co"># La durée du contrat est-elle inférieure à 6 mois ?</span></span>
<span id="cb228-12"><a href="#cb228-12" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, duree_inf_6_mois <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(duree <span class="sc">&gt;=</span> sixmois, <span class="dv">1</span>, <span class="dv">0</span>)]</span>
<span id="cb228-13"><a href="#cb228-13" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, duree_inf_6_mois <span class="sc">:</span><span class="er">=</span> <span class="fu">fifelse</span>(duree <span class="sc">&gt;=</span> sixmois, <span class="dv">1</span>, <span class="dv">0</span>)]</span>
<span id="cb228-14"><a href="#cb228-14" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, duree_inf_6_mois <span class="sc">:</span><span class="er">=</span> <span class="fu">fcase</span>(duree <span class="sc">&gt;=</span> sixmois, <span class="dv">1</span>,</span>
<span id="cb228-15"><a href="#cb228-15" aria-hidden="true" tabindex="-1"></a>                                              duree <span class="sc">&lt;</span>  sixmois, <span class="dv">0</span>)]</span>
<span id="cb228-16"><a href="#cb228-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Date de sortie du dispositif</span></span>
<span id="cb228-17"><a href="#cb228-17" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, date_sortie <span class="sc">:</span><span class="er">=</span> date_entree <span class="sc">+</span> lubridate<span class="sc">::</span><span class="fu">days</span>(duree)]</span>
<span id="cb228-18"><a href="#cb228-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-19"><a href="#cb228-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Date 6 mois après la sortie</span></span>
<span id="cb228-20"><a href="#cb228-20" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, date_6mois <span class="sc">:</span><span class="er">=</span> date_sortie <span class="sc">+</span> lubridate<span class="sc">::</span><span class="fu">month</span>(<span class="dv">6</span>)]</span></code></pre></div>
</div>
</div>
<div id="tabset-49-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-49-5-tab">
<div class="cell">
<div class="sourceCode" id="cb229"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Création de la colonne age </span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> </span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(enDate, <span class="sc">~</span> <span class="fu">as.Date</span>(<span class="fu">strptime</span>(.,<span class="st">&#39;%d/%m/%Y&#39;</span>))) <span class="sc">%&gt;%</span> <span class="co"># strptime est une fonction duckdb</span></span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">year</span>(<span class="fu">age</span>(Date_entree,Date_naissance))) <span class="sc">%&gt;%</span> </span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(age)</span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Âge formaté</span></span>
<span id="cb229-8"><a href="#cb229-8" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span></span>
<span id="cb229-9"><a href="#cb229-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(enDate, <span class="sc">~</span> <span class="fu">as.Date</span>(<span class="fu">strptime</span>(.,<span class="st">&#39;%d/%m/%Y&#39;</span>))) <span class="sc">%&gt;%</span> <span class="co"># strptime est une fonction duckdb</span></span>
<span id="cb229-10"><a href="#cb229-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">year</span>(<span class="fu">age</span>(Date_entree,Date_naissance))) <span class="sc">%&gt;%</span> </span>
<span id="cb229-11"><a href="#cb229-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agef =</span> <span class="fu">case_when</span>(</span>
<span id="cb229-12"><a href="#cb229-12" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&lt;</span> <span class="dv">26</span> <span class="sc">~</span> <span class="st">&quot;1. De 15 à 25 ans&quot;</span>,</span>
<span id="cb229-13"><a href="#cb229-13" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&gt;=</span> <span class="dv">26</span> <span class="sc">|</span> age <span class="sc">&lt;</span> <span class="dv">50</span> <span class="sc">~</span>  <span class="st">&quot;2. De 26 à 49 ans&quot;</span>,</span>
<span id="cb229-14"><a href="#cb229-14" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">~</span> <span class="st">&quot;3. 50 ans ou plus&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb229-15"><a href="#cb229-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(age, agef)</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="manipuler-des-chaînes-de-caractères" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Manipuler des chaînes de caractères</h1>
<p>Pour en savoir plus sur le fonctionnement des chaînes de caractères en <code>R</code> : <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_donnees_textuelles.html" class="uri">https://book.utilitr.org/03_Fiches_thematiques/Fiche_donnees_textuelles.html</a>.</p>
<section id="majuscule-minuscule" class="level2" data-number="9.1">
<h2 data-number="9.1"><span class="header-section-number">9.1</span> Majuscule, minuscule</h2>
<section id="majuscule" class="level3" data-number="9.1.1">
<h3 data-number="9.1.1"><span class="header-section-number">9.1.1</span> Majuscule</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-50-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-50-1" role="tab" aria-controls="tabset-50-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-50-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-50-2" role="tab" aria-controls="tabset-50-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-50-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-50-3" role="tab" aria-controls="tabset-50-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-50-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-50-4" role="tab" aria-controls="tabset-50-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-50-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-50-5" role="tab" aria-controls="tabset-50-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-50-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-50-1-tab">
<div class="sourceCode" id="cb230"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>  CSP_majuscule = <span class="fu">upcase</span>(CSPF);</span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-50-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-50-2-tab">
<div class="cell">
<div class="sourceCode" id="cb231"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>csp_maj <span class="ot">&lt;-</span> <span class="fu">toupper</span>(donnees_rbase<span class="sc">$</span>cspf)</span></code></pre></div>
</div>
</div>
<div id="tabset-50-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-50-3-tab">
<div class="cell">
<div class="sourceCode" id="cb232"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">csp_maj =</span> <span class="fu">toupper</span>(cspf))</span></code></pre></div>
</div>
</div>
<div id="tabset-50-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-50-4-tab">
<div class="cell">
<div class="sourceCode" id="cb233"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, csp_maj <span class="sc">:</span><span class="er">=</span> <span class="fu">toupper</span>(cspf)]</span></code></pre></div>
</div>
</div>
<div id="tabset-50-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-50-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="minuscule" class="level3" data-number="9.1.2">
<h3 data-number="9.1.2"><span class="header-section-number">9.1.2</span> Minuscule</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-51-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-51-1" role="tab" aria-controls="tabset-51-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-51-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-51-2" role="tab" aria-controls="tabset-51-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-51-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-51-3" role="tab" aria-controls="tabset-51-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-51-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-51-4" role="tab" aria-controls="tabset-51-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-51-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-51-5" role="tab" aria-controls="tabset-51-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-51-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-51-1-tab">
<div class="sourceCode" id="cb234"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>  CSP_minuscule = <span class="fu">lowcase</span>(CSPF);</span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-51-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-51-2-tab">
<div class="cell">
<div class="sourceCode" id="cb235"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>csp_min <span class="ot">&lt;-</span> <span class="fu">tolower</span>(donnees_rbase<span class="sc">$</span>cspf)</span></code></pre></div>
</div>
</div>
<div id="tabset-51-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-51-3-tab">
<div class="cell">
<div class="sourceCode" id="cb236"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">csp_maj =</span> <span class="fu">tolower</span>(cspf))</span></code></pre></div>
</div>
</div>
<div id="tabset-51-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-51-4-tab">
<div class="cell">
<div class="sourceCode" id="cb237"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co"># En minuscule</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, csp_min <span class="sc">:</span><span class="er">=</span> <span class="fu">tolower</span>(cspf)]</span></code></pre></div>
</div>
</div>
<div id="tabset-51-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-51-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="première-lettre-en-majuscule" class="level3" data-number="9.1.3">
<h3 data-number="9.1.3"><span class="header-section-number">9.1.3</span> Première lettre en majuscule</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-52-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-52-1" role="tab" aria-controls="tabset-52-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-52-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-52-2" role="tab" aria-controls="tabset-52-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-52-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-52-3" role="tab" aria-controls="tabset-52-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-52-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-52-4" role="tab" aria-controls="tabset-52-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-52-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-52-5" role="tab" aria-controls="tabset-52-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-52-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-52-1-tab">
<div class="sourceCode" id="cb238"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>  Niveau = propcase(Niveau);</span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-52-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-52-2-tab">
<div class="cell">
<div class="sourceCode" id="cb239"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1ère lettre en majuscule, autres lettres en minuscule</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>niveau <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">toupper</span>(<span class="fu">substr</span>(donnees_rbase<span class="sc">$</span>niveau, <span class="dv">1</span>, <span class="dv">1</span>)), <span class="fu">tolower</span>(<span class="fu">substr</span>(donnees_rbase<span class="sc">$</span>niveau, <span class="dv">2</span>, <span class="fu">length</span>(donnees_rbase<span class="sc">$</span>niveau))))</span></code></pre></div>
</div>
</div>
<div id="tabset-52-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-52-3-tab">
<div class="cell">
<div class="sourceCode" id="cb240"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1ère lettre en majuscule, autres lettres en minuscule</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span>  </span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">niveau =</span> <span class="fu">str_to_title</span>(niveau))</span></code></pre></div>
</div>
</div>
<div id="tabset-52-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-52-4-tab">
<div class="cell">
<div class="sourceCode" id="cb241"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1ère lettre en majuscule, autres lettres en minuscule</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, niveau <span class="sc">:</span><span class="er">=</span> <span class="fu">paste0</span>(<span class="fu">toupper</span>(<span class="fu">substr</span>(niveau, <span class="dv">1</span>, <span class="dv">1</span>)), <span class="fu">tolower</span>(<span class="fu">substr</span>(niveau, <span class="dv">2</span>, <span class="fu">length</span>(niveau))))]</span></code></pre></div>
</div>
</div>
<div id="tabset-52-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-52-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="nombre-de-caractères-dans-une-chaîne-de-caractères" class="level2" data-number="9.2">
<h2 data-number="9.2"><span class="header-section-number">9.2</span> Nombre de caractères dans une chaîne de caractères</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-53-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-53-1" role="tab" aria-controls="tabset-53-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-53-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-53-2" role="tab" aria-controls="tabset-53-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-53-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-53-3" role="tab" aria-controls="tabset-53-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-53-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-53-4" role="tab" aria-controls="tabset-53-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-53-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-53-5" role="tab" aria-controls="tabset-53-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-53-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-53-1-tab">
<div class="sourceCode" id="cb242"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>  taille_id = <span class="kw">length</span>(identifiant);</span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-53-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-53-2-tab">
<div class="cell">
<div class="sourceCode" id="cb243"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>taille_id <span class="ot">&lt;-</span> <span class="fu">nchar</span>(donnees_rbase<span class="sc">$</span>identifiant)</span></code></pre></div>
</div>
</div>
<div id="tabset-53-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-53-3-tab">
<div class="cell">
<div class="sourceCode" id="cb244"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">taille_id =</span> <span class="fu">nchar</span>(identifiant))</span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">taille_id =</span> <span class="fu">str_split</span>(identifiant, <span class="st">&#39;&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>           lengths)</span></code></pre></div>
</div>
</div>
<div id="tabset-53-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-53-4-tab">
<div class="cell">
<div class="sourceCode" id="cb245"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, taille_id <span class="sc">:</span><span class="er">=</span> <span class="fu">nchar</span>(identifiant)]</span></code></pre></div>
</div>
</div>
<div id="tabset-53-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-53-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="remplacer-une-chaîne-de-caractères-par-une-autre" class="level2" data-number="9.3">
<h2 data-number="9.3"><span class="header-section-number">9.3</span> Remplacer une chaîne de caractères par une autre</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-54-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-54-1" role="tab" aria-controls="tabset-54-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-54-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-54-2" role="tab" aria-controls="tabset-54-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-54-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-54-3" role="tab" aria-controls="tabset-54-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-54-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-54-4" role="tab" aria-controls="tabset-54-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-54-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-54-5" role="tab" aria-controls="tabset-54-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-54-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-54-1-tab">
<div class="sourceCode" id="cb246"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> A_Corriger;</span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">infile</span> <span class="kw">cards</span> dsd dlm=<span class="st">&#39;|&#39;</span>;</span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> A_corriger $<span class="dv">8</span>.;</span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">input</span> A_corriger $;</span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">cards</span>;</span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>  Qualifie</span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>  qualifie</span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a>  Qualifie</span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a>  QUALIFIE</span>
<span id="cb246-10"><a href="#cb246-10" aria-hidden="true" tabindex="-1"></a>;</span>
<span id="cb246-11"><a href="#cb246-11" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb246-12"><a href="#cb246-12" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> A_Corriger;</span>
<span id="cb246-13"><a href="#cb246-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> A_Corriger;</span>
<span id="cb246-14"><a href="#cb246-14" aria-hidden="true" tabindex="-1"></a>  Corrige = <span class="fu">lowcase</span>(A_corriger);</span>
<span id="cb246-15"><a href="#cb246-15" aria-hidden="true" tabindex="-1"></a>  Corrige = <span class="fu">tranwrd</span>(Corrige, <span class="st">&quot;qualifie&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>);</span>
<span id="cb246-16"><a href="#cb246-16" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-54-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-54-2-tab">
<div class="cell">
<div class="sourceCode" id="cb247"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Le mot Qualifié n&#39;a pas d&#39;accent : on le corrige</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>aCorriger <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Qualifie&quot;</span>, <span class="st">&quot;qualifie&quot;</span>, <span class="st">&quot;Qualifie&quot;</span>, <span class="st">&quot;QUALIFIE&quot;</span>)</span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a><span class="co"># [Q-q] permet de représenter Q ou q, et donc de prendre en compte Qualifie et qualifie</span></span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&quot;[Q-q]ualifie&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="fu">tolower</span>(aCorriger))</span></code></pre></div>
</div>
</div>
<div id="tabset-54-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-54-3-tab">
<div class="cell">
<div class="sourceCode" id="cb248"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Le mot Qualifié n&#39;a pas d&#39;accent : on le corrige</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>aCorriger <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Qualifie&quot;</span>, <span class="st">&quot;qualifie&quot;</span>, <span class="st">&quot;Qualifie&quot;</span>, <span class="st">&quot;QUALIFIE&quot;</span>)</span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a><span class="co"># [Q-q] permet de représenter Q ou q, et donc de prendre en compte Qualifie et qualifie</span></span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>aCorriger <span class="sc">%&gt;%</span> <span class="fu">tolower</span>() <span class="sc">%&gt;%</span> <span class="fu">str_replace_all</span>(<span class="st">&quot;[Q-q]ualifie&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-54-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-54-4-tab">
<div class="cell">
<div class="sourceCode" id="cb249"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Le mot Qualifié n&#39;a pas d&#39;accent : on le corrige</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>aCorriger <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Qualifie&quot;</span>, <span class="st">&quot;qualifie&quot;</span>, <span class="st">&quot;Qualifie&quot;</span>, <span class="st">&quot;QUALIFIE&quot;</span>)</span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a><span class="co"># [Q-q] permet de représenter Q ou q, et donc de prendre en compte Qualifie et qualifie</span></span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&quot;[Q-q]ualifie&quot;</span>, <span class="st">&quot;Qualifié&quot;</span>, <span class="fu">tolower</span>(aCorriger))</span></code></pre></div>
</div>
</div>
<div id="tabset-54-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-54-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="manipuler-des-chaînes-de-caractères-1" class="level2" data-number="9.4">
<h2 data-number="9.4"><span class="header-section-number">9.4</span> Manipuler des chaînes de caractères</h2>
<section id="textes-sur-lesquels-les-fonctions-seront-appliquées" class="level3" data-number="9.4.1">
<h3 data-number="9.4.1"><span class="header-section-number">9.4.1</span> Textes sur lesquels les fonctions seront appliquées</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-55-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-55-1" role="tab" aria-controls="tabset-55-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-55-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-55-2" role="tab" aria-controls="tabset-55-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-55-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-55-3" role="tab" aria-controls="tabset-55-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-55-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-55-4" role="tab" aria-controls="tabset-55-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-55-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-55-5" role="tab" aria-controls="tabset-55-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-55-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-55-1-tab">
<div class="sourceCode" id="cb250"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Exemple_chaines;</span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>  Texte = <span class="st">&quot;              Ce   Texte   mériterait   d être   corrigé                  &quot;</span>;</span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a>  Texte1 = <span class="st">&quot;Je m&#39;appelle&quot;</span>;</span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a>  Texte2 = <span class="st">&quot;SAS&quot;</span>;</span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a>  Texte3 = <span class="st">&quot;Phrase à découper&quot;</span>;</span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a>  Texte4 = <span class="st">&quot;&quot;</span>;</span>
<span id="cb250-7"><a href="#cb250-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-55-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-55-2-tab">
<div class="cell">
<div class="sourceCode" id="cb251"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a>texte  <span class="ot">&lt;-</span> <span class="st">&quot;              Ce   Texte   mériterait   d être   corrigé                  &quot;</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>texte1 <span class="ot">&lt;-</span> <span class="st">&quot;Ce texte&quot;</span></span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>texte2 <span class="ot">&lt;-</span> <span class="st">&quot;va être&quot;</span></span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a>texte3 <span class="ot">&lt;-</span> <span class="st">&quot;concaténé&quot;</span></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>texte4 <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span></code></pre></div>
</div>
</div>
<div id="tabset-55-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-55-3-tab">
<div class="cell">
<div class="sourceCode" id="cb252"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>texte  <span class="ot">&lt;-</span> <span class="st">&quot;              Ce   Texte   mériterait   d être   corrigé                  &quot;</span></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>texte1 <span class="ot">&lt;-</span> <span class="st">&quot;Ce texte&quot;</span></span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>texte2 <span class="ot">&lt;-</span> <span class="st">&quot;va être&quot;</span></span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>texte3 <span class="ot">&lt;-</span> <span class="st">&quot;concaténé&quot;</span></span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a>texte4 <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span></code></pre></div>
</div>
</div>
<div id="tabset-55-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-55-4-tab">
<div class="cell">
<div class="sourceCode" id="cb253"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>texte  <span class="ot">&lt;-</span> <span class="st">&quot;              Ce   Texte   mériterait   d être   corrigé                  &quot;</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>texte1 <span class="ot">&lt;-</span> <span class="st">&quot;Je m&#39;appelle&quot;</span></span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>texte2 <span class="ot">&lt;-</span> <span class="st">&quot;R&quot;</span></span></code></pre></div>
</div>
</div>
<div id="tabset-55-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-55-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="extraire-des-éléments-dune-chaîne-de-caractères" class="level3" data-number="9.4.2">
<h3 data-number="9.4.2"><span class="header-section-number">9.4.2</span> Extraire des éléments d’une chaîne de caractères</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-56-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-56-1" role="tab" aria-controls="tabset-56-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-56-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-56-2" role="tab" aria-controls="tabset-56-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-56-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-56-3" role="tab" aria-controls="tabset-56-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-56-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-56-4" role="tab" aria-controls="tabset-56-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-56-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-56-5" role="tab" aria-controls="tabset-56-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-56-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-56-1-tab">
<div class="sourceCode" id="cb254"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Exemple_chaines;</span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> Exemple_chaines;</span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Extraire les 2e, 3e et 4e caractère de Concatener */</span></span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Fonction tranwrd (TRANslate WoRD) */</span></span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 2 correspond à la position du 1er caractère à récupérer, 3 le nombre total de caractères à partir du point de départ */</span></span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a>  extrait = <span class="fu">substr</span>(Concatener, <span class="dv">2</span>, <span class="dv">3</span>);</span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb254-9"><a href="#cb254-9" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span> = Exemple_chaines<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-56-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-56-2-tab">
<div class="cell">
<div class="sourceCode" id="cb255"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraire les 2e, 3e et 4e caractères de Concatener</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 correspond à la position du 1er caractère à récupérer, 5 la position du dernier caractère</span></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>extrait <span class="ot">&lt;-</span> <span class="fu">substr</span>(concatene, <span class="dv">2</span>, <span class="dv">5</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-56-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-56-3-tab">
<div class="cell">
<div class="sourceCode" id="cb256"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraire les 2e, 3e et 4e caractères de Concatener</span></span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 correspond à la position du 1er caractère à récupérer, 5 la position du dernier caractère</span></span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a>extrait <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(concatene, <span class="dv">2</span>, <span class="dv">5</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-56-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-56-4-tab">
<div class="cell">
<div class="sourceCode" id="cb257"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraire les 2e, 3e et 4e caractères de texte</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 correspond à la position du 1er caractère à récupérer, 5 la position du dernier caractère</span></span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>extrait <span class="ot">&lt;-</span> <span class="fu">substr</span>(texte, <span class="dv">2</span>, <span class="dv">5</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-56-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-56-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="enlever-les-blancs-superflus-dune-chaîne-de-caractères" class="level3" data-number="9.4.3">
<h3 data-number="9.4.3"><span class="header-section-number">9.4.3</span> Enlever les blancs superflus d’une chaîne de caractères</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-57-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-57-1" role="tab" aria-controls="tabset-57-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-57-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-57-2" role="tab" aria-controls="tabset-57-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-57-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-57-3" role="tab" aria-controls="tabset-57-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-57-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-57-4" role="tab" aria-controls="tabset-57-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-57-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-57-5" role="tab" aria-controls="tabset-57-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-57-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-57-1-tab">
<div class="sourceCode" id="cb258"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Exemple_chaines;</span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> Exemple_chaines;</span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Enlever les blancs au début et à la fin de la chaîne de caractère */</span></span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>  Enlever_Blancs_Initiaux = strip(Texte);</span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Enlever les doubles blancs dans la chaîne de caractères */</span></span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a>  Enlever_Blancs_Entre = <span class="fu">compbl</span>(Enlever_Blancs_Initiaux);</span>
<span id="cb258-8"><a href="#cb258-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb258-9"><a href="#cb258-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Enlever doubles blancs */</span></span>
<span id="cb258-10"><a href="#cb258-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* REVOIR !!!!! */</span></span>
<span id="cb258-11"><a href="#cb258-11" aria-hidden="true" tabindex="-1"></a>  Enlever_Doubles_Blancs = <span class="fu">compress</span>(Texte, <span class="st">&quot;  &quot;</span>, <span class="st">&quot;t&quot;</span>);</span>
<span id="cb258-12"><a href="#cb258-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb258-13"><a href="#cb258-13" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span> = Exemple_chaines<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-57-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-57-2-tab">
<div class="cell">
<div class="sourceCode" id="cb259"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enlever les blancs au début et à la fin de la chaîne de caractère</span></span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;\\s+&quot; est une expression régulière indiquant 1 ou plusieurs espaces successifs</span></span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Le gsub remplace 1 ou plusieurs espaces successifs par un seul espace</span></span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a><span class="co"># trimws enlève les espaces au début et à la fin d&#39;une chaîne de caractère </span></span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a>texte <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">s+&quot;</span>, <span class="st">&quot; &quot;</span>, <span class="fu">trimws</span>(texte))</span></code></pre></div>
</div>
</div>
<div id="tabset-57-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-57-3-tab">
<div class="cell">
<div class="sourceCode" id="cb260"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enlever les blancs au début et à la fin de la chaîne de caractère</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="co"># str_squish() supprime les espaces blancs au début et à la fin, et remplace tous les espaces blancs internes par un seul espace</span></span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>texte <span class="ot">&lt;-</span> <span class="fu">str_squish</span>(texte)</span></code></pre></div>
</div>
</div>
<div id="tabset-57-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-57-4-tab">
<div class="cell">
<div class="sourceCode" id="cb261"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enlever les blancs au début et à la fin de la chaîne de caractère</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;\\s+&quot; est une expression régulière indiquant 1 ou plusieurs espaces successifs</span></span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Le gsub remplace 1 ou plusieurs espaces successifs par un seul espace</span></span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a><span class="co"># trimws enlève les espaces au début et à la fin d&#39;une chaîne de caractère </span></span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a>texte <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">s+&quot;</span>, <span class="st">&quot; &quot;</span>, <span class="fu">trimws</span>(texte))</span></code></pre></div>
</div>
</div>
<div id="tabset-57-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-57-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="concaténer-des-chaînes-de-caractères" class="level3" data-number="9.4.4">
<h3 data-number="9.4.4"><span class="header-section-number">9.4.4</span> Concaténer des chaînes de caractères</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-58-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-58-1" role="tab" aria-controls="tabset-58-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-58-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-58-2" role="tab" aria-controls="tabset-58-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-58-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-58-3" role="tab" aria-controls="tabset-58-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-58-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-58-4" role="tab" aria-controls="tabset-58-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-58-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-58-5" role="tab" aria-controls="tabset-58-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-58-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-58-1-tab">
<div class="sourceCode" id="cb262"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Exemple_chaines;</span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> Exemple_chaines;</span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Trois méthodes pour concaténer des chaînes de caractères */</span></span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a>  Concatener  = Texte1||<span class="st">&quot; &quot;</span>||Texte2;</span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a>  Concatener2 = Texte1!!<span class="st">&quot; &quot;</span>!!Texte2;</span>
<span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a>  Concatener3 = catx(<span class="st">&quot; &quot;</span>, Texte1, Texte2);</span>
<span id="cb262-8"><a href="#cb262-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb262-9"><a href="#cb262-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Effet des valeurs manquantes */</span></span>
<span id="cb262-10"><a href="#cb262-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Le séparateur est enlevé lors d&#39;une concaténation avec une chaîne de caractère vide */</span></span>
<span id="cb262-11"><a href="#cb262-11" aria-hidden="true" tabindex="-1"></a>  Concatener4 = catx(<span class="st">&quot;-&quot;</span>, Texte4, Texte3);</span>
<span id="cb262-12"><a href="#cb262-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb262-13"><a href="#cb262-13" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span> = Exemple_chaines<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-58-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-58-2-tab">
<div class="cell">
<div class="sourceCode" id="cb263"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Concaténer des chaînes de caractères</span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>concatene <span class="ot">&lt;-</span> <span class="fu">paste</span>(texte1, texte2, texte3, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(texte1, texte2, texte3)</span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Effet des valeurs manquantes : le délimiteur (ici -) apparaît avec la concaténation avec le caractère manquant</span></span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(texte4, texte3, <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-58-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-58-3-tab">
<div class="cell">
<div class="sourceCode" id="cb264"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Concaténer des chaînes de caractères</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>concatene <span class="ot">&lt;-</span> <span class="fu">str_flatten</span>(<span class="fu">c</span>(texte1, texte2, texte3), <span class="at">collapse =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Effet des valeurs manquantes : le délimiteur (ici -) apparaît avec la concaténation avec le caractère manquant</span></span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str_flatten</span>(<span class="fu">c</span>(texte4, texte3), <span class="at">collapse =</span> <span class="st">&quot;-&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-58-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-58-4-tab">
<div class="cell">
<div class="sourceCode" id="cb265"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Concaténer des chaînes de caractères</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(texte1, texte2, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(texte1, texte2)</span></code></pre></div>
</div>
</div>
<div id="tabset-58-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-58-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="transformer-plusieurs-caractères-différents" class="level3" data-number="9.4.5">
<h3 data-number="9.4.5"><span class="header-section-number">9.4.5</span> Transformer plusieurs caractères différents</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-59-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-59-1" role="tab" aria-controls="tabset-59-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-59-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-59-2" role="tab" aria-controls="tabset-59-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-59-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-59-3" role="tab" aria-controls="tabset-59-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-59-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-59-4" role="tab" aria-controls="tabset-59-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-59-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-59-5" role="tab" aria-controls="tabset-59-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-59-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-59-1-tab">
<div class="sourceCode" id="cb266"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Exemple_chaines;</span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> Exemple_chaines;</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Transformer plusieurs caractères différents */</span></span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* On transforme le é en e, le â en a, le î en i, ... */</span></span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a>  chaine = <span class="st">&quot;éèêëàâçîô&quot;</span>;</span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a>  chaine_sans_accent = <span class="fu">translate</span>(chaine, <span class="st">&quot;eeeeaacio&quot;</span>, <span class="st">&quot;éèêëàâçîô&quot;</span>);</span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb266-8"><a href="#cb266-8" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span> = Exemple_chaines<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-59-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-59-2-tab">
<div class="cell">
<div class="sourceCode" id="cb267"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer plusieurs caractères différents</span></span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>chaine <span class="ot">&lt;-</span> <span class="st">&quot;éèêëàâçîô&quot;</span></span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a><span class="fu">chartr</span>(<span class="st">&quot;éèêëàâçîô&quot;</span>, <span class="st">&quot;eeeeaacio&quot;</span>, chaine)</span></code></pre></div>
</div>
</div>
<div id="tabset-59-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-59-3-tab">
<div class="cell">
<div class="sourceCode" id="cb268"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer plusieurs caractères différents</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>chaine <span class="ot">&lt;-</span> <span class="st">&quot;éèêëàâçîô&quot;</span></span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a><span class="fu">chartr</span>(<span class="st">&quot;éèêëàâçîô&quot;</span>, <span class="st">&quot;eeeeaacio&quot;</span>, chaine)</span></code></pre></div>
</div>
</div>
<div id="tabset-59-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-59-4-tab">
<div class="cell">
<div class="sourceCode" id="cb269"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer plusieurs caractères différents</span></span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>chaine <span class="ot">&lt;-</span> <span class="st">&quot;éèêëàâçîô&quot;</span></span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a><span class="fu">chartr</span>(<span class="st">&quot;éèêëàâçîô&quot;</span>, <span class="st">&quot;eeeeaacio&quot;</span>, chaine)</span></code></pre></div>
</div>
</div>
<div id="tabset-59-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-59-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="découper-une-chaîne-de-caractères-selon-un-caractère-donné" class="level2" data-number="9.5">
<h2 data-number="9.5"><span class="header-section-number">9.5</span> Découper une chaîne de caractères selon un caractère donné</h2>
<p>Découper une phrase selon les espaces pour isoler les mots.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-60-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-60-1" role="tab" aria-controls="tabset-60-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-60-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-60-2" role="tab" aria-controls="tabset-60-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-60-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-60-3" role="tab" aria-controls="tabset-60-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-60-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-60-4" role="tab" aria-controls="tabset-60-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-60-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-60-5" role="tab" aria-controls="tabset-60-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-60-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-60-1-tab">
<div class="sourceCode" id="cb270"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Mots;</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a>  delim = <span class="st">&quot; &quot;</span>;</span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a>  Texte = <span class="st">&quot;Mon texte va être coupé !&quot;</span>;</span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Chaque mot dans une variable */</span></span>
<span id="cb270-6"><a href="#cb270-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%macro</span> Decouper;</span>
<span id="cb270-7"><a href="#cb270-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%do</span> i = <span class="dv">1</span> <span class="kw">%to</span> <span class="kw">%sysfunc</span>(countw(Texte, delim));</span>
<span id="cb270-8"><a href="#cb270-8" aria-hidden="true" tabindex="-1"></a>      Mot<span class="kw">&amp;i.</span> = <span class="fu">scan</span>(Texte, <span class="kw">&amp;i.</span>, delim);</span>
<span id="cb270-9"><a href="#cb270-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%end</span>;</span>
<span id="cb270-10"><a href="#cb270-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%mend</span> Decouper;</span>
<span id="cb270-11"><a href="#cb270-11" aria-hidden="true" tabindex="-1"></a>  %Decouper;</span>
<span id="cb270-12"><a href="#cb270-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb270-13"><a href="#cb270-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Les mots empilés */</span></span>
<span id="cb270-14"><a href="#cb270-14" aria-hidden="true" tabindex="-1"></a>  nb_mots = countw(Texte, delim);</span>
<span id="cb270-15"><a href="#cb270-15" aria-hidden="true" tabindex="-1"></a><span class="kw">  do</span> nb = <span class="dv">1</span> <span class="kw">to</span> nb_mots;</span>
<span id="cb270-16"><a href="#cb270-16" aria-hidden="true" tabindex="-1"></a>    mots = <span class="fu">scan</span>(Texte, nb, delim);</span>
<span id="cb270-17"><a href="#cb270-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">output</span>;</span>
<span id="cb270-18"><a href="#cb270-18" aria-hidden="true" tabindex="-1"></a><span class="kw">  end</span>;</span>
<span id="cb270-19"><a href="#cb270-19" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb270-20"><a href="#cb270-20" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span> = Mots<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-60-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-60-2-tab">
<div class="cell">
<div class="sourceCode" id="cb271"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>chaine  <span class="ot">&lt;-</span> <span class="st">&quot;Mon texte va être coupé !&quot;</span></span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(<span class="fu">strsplit</span>(chaine, <span class="at">split =</span> <span class="st">&quot; &quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-60-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-60-3-tab">
<div class="cell">
<div class="sourceCode" id="cb272"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>chaine  <span class="ot">&lt;-</span> <span class="st">&quot;Mon texte va être coupé !&quot;</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(chaine, <span class="at">pattern =</span> <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-60-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-60-4-tab">
<div class="cell">
<div class="sourceCode" id="cb273"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>chaine  <span class="ot">&lt;-</span> <span class="st">&quot;Mon texte va être coupé !&quot;</span></span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(<span class="fu">strsplit</span>(chaine, <span class="at">split =</span> <span class="st">&quot; &quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-60-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-60-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="inverser-une-chaîne-de-caractères" class="level2" data-number="9.6">
<h2 data-number="9.6"><span class="header-section-number">9.6</span> Inverser une chaîne de caractères</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-61-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-61-1" role="tab" aria-controls="tabset-61-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-61-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-61-2" role="tab" aria-controls="tabset-61-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-61-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-61-3" role="tab" aria-controls="tabset-61-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-61-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-61-4" role="tab" aria-controls="tabset-61-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-61-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-61-5" role="tab" aria-controls="tabset-61-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-61-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-61-1-tab">
<div class="sourceCode" id="cb274"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Mots;</span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>  Texte = <span class="st">&quot;Mon texte va être coupé !&quot;</span>;</span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">x</span> = <span class="fu">left</span>(<span class="fu">reverse</span>(Texte));</span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span> = Mots<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-61-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-61-2-tab">
<div class="cell">
<div class="sourceCode" id="cb275"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>inverserTexte <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(</span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(<span class="fu">strsplit</span>(x, <span class="cn">NULL</span>), rev),</span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a>    paste, <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a><span class="fu">inverserTexte</span>(chaine)</span></code></pre></div>
</div>
</div>
<div id="tabset-61-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-61-3-tab">
<div class="cell">
<div class="sourceCode" id="cb276"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringi)</span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>stringi<span class="sc">::</span><span class="fu">stri_reverse</span>(chaine)</span></code></pre></div>
</div>
</div>
<div id="tabset-61-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-61-4-tab">
<div class="cell">
<div class="sourceCode" id="cb277"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>inverserTexte <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(</span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(<span class="fu">strsplit</span>(x, <span class="cn">NULL</span>), rev),</span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a>    paste, <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a><span class="fu">inverserTexte</span>(chaine)</span></code></pre></div>
</div>
</div>
<div id="tabset-61-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-61-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="les-tris" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Les tris</h1>
<section id="trier-les-colonnes-de-la-base" class="level2" data-number="10.1">
<h2 data-number="10.1"><span class="header-section-number">10.1</span> Trier les colonnes de la base</h2>
<section id="mettre-identifiant-et-date_entree-au-début-de-la-base" class="level3" data-number="10.1.1">
<h3 data-number="10.1.1"><span class="header-section-number">10.1.1</span> Mettre identifiant et date_entree au début de la base</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-62-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-62-1" role="tab" aria-controls="tabset-62-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-62-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-62-2" role="tab" aria-controls="tabset-62-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-62-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-62-3" role="tab" aria-controls="tabset-62-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-62-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-62-4" role="tab" aria-controls="tabset-62-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-62-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-62-5" role="tab" aria-controls="tabset-62-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-62-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-62-1-tab">
<div class="sourceCode" id="cb278"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> colTri = identifiant date_entree;</span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">retain</span> <span class="kw">&amp;colTri.</span>;</span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a><span class="co">/* Autre solution */</span></span>
<span id="cb278-8"><a href="#cb278-8" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb278-9"><a href="#cb278-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> donnees_sas <span class="kw">as</span></span>
<span id="cb278-10"><a href="#cb278-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Dans la proc SQL, les variables doivent être séparées par des virgules */</span></span>
<span id="cb278-11"><a href="#cb278-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* On remplace les blancs entre les mots par des virgules pour la proc SQL */</span></span>
<span id="cb278-12"><a href="#cb278-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> <span class="kw">%sysfunc</span>(<span class="fu">tranwrd</span>(<span class="kw">&amp;colTri.</span>, <span class="kw">%str</span>( ), <span class="kw">%str</span>(, ))), * <span class="kw">from</span> donnees_sas;</span>
<span id="cb278-13"><a href="#cb278-13" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-62-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-62-2-tab">
<div class="cell">
<div class="sourceCode" id="cb279"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>colTri <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;date_entree&quot;</span>)</span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[, <span class="fu">union</span>(colTri, <span class="fu">colnames</span>(donnees_rbase))]</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre possibilité, plus longue !</span></span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[, <span class="fu">c</span>(colTri, <span class="fu">setdiff</span>(<span class="fu">colnames</span>(donnees_rbase), colTri))]</span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[, <span class="fu">c</span>(colTri, <span class="fu">colnames</span>(donnees_rbase)[<span class="sc">!</span> <span class="fu">colnames</span>(donnees_rbase) <span class="sc">%in%</span> colTri])]</span></code></pre></div>
</div>
</div>
<div id="tabset-62-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-62-3-tab">
<div class="cell">
<div class="sourceCode" id="cb280"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(identifiant, date_entree)</span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Autres solutions</span></span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a>colTri <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;date_entree&quot;</span>)</span>
<span id="cb280-6"><a href="#cb280-6" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb280-7"><a href="#cb280-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">all_of</span>(colTri))</span>
<span id="cb280-8"><a href="#cb280-8" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse_tri <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb280-9"><a href="#cb280-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(colTri), <span class="fu">everything</span>())</span></code></pre></div>
</div>
</div>
<div id="tabset-62-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-62-4-tab">
<div class="cell">
<div class="sourceCode" id="cb281"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>colTri <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;date_entree&quot;</span>)</span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>tri <span class="ot">&lt;-</span> <span class="fu">union</span>(colTri, <span class="fu">colnames</span>(donnees_datatable))</span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable <span class="ot">&lt;-</span> donnees_datatable[, ..tri]</span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a><span class="co"># En data.table, les instructions débutant par set modifient les éléments par référence, c&#39;est-à-dire sans copie.</span></span>
<span id="cb281-6"><a href="#cb281-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ceci est plus efficace pour manipuler des données volumineuses.</span></span>
<span id="cb281-7"><a href="#cb281-7" aria-hidden="true" tabindex="-1"></a><span class="fu">setcolorder</span>(donnees_datatable, colTri)</span></code></pre></div>
</div>
</div>
<div id="tabset-62-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-62-5-tab">
<div class="cell">
<div class="sourceCode" id="cb282"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> </span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(enDate, <span class="sc">~</span> <span class="fu">as.Date</span>(<span class="fu">strptime</span>(.,<span class="st">&#39;%d/%m/%Y&#39;</span>))) <span class="sc">%&gt;%</span> <span class="co"># strptime est une fonction duckdb</span></span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(identifiant, date_entree, <span class="fu">everything</span>())</span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> </span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(enDate, <span class="sc">~</span> <span class="fu">as.Date</span>(<span class="fu">strptime</span>(.,<span class="st">&#39;%d/%m/%Y&#39;</span>))) <span class="sc">%&gt;%</span> <span class="co"># strptime est une fonction duckdb</span></span>
<span id="cb282-7"><a href="#cb282-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(identifiant, date_entree)</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="mettre-la-variable-poids_sondage-au-début-de-la-base" class="level3" data-number="10.1.2">
<h3 data-number="10.1.2"><span class="header-section-number">10.1.2</span> Mettre la variable poids_sondage au début de la base</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-63-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-63-1" role="tab" aria-controls="tabset-63-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-63-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-63-2" role="tab" aria-controls="tabset-63-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-63-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-63-3" role="tab" aria-controls="tabset-63-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-63-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-63-4" role="tab" aria-controls="tabset-63-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-63-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-63-5" role="tab" aria-controls="tabset-63-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-63-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-63-1-tab">
<div class="sourceCode" id="cb283"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Mettre la variable poids_sondage au début de la base */</span></span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">retain</span> poids_sondage;</span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-63-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-63-2-tab">
<div class="cell">
<div class="sourceCode" id="cb284"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mettre la variable poids_sondage au début de la base</span></span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[, <span class="fu">c</span>(<span class="st">&quot;poids_sondage&quot;</span>, <span class="fu">setdiff</span>(<span class="fu">colnames</span>(donnees_rbase), <span class="st">&quot;poids_sondage&quot;</span>))]</span></code></pre></div>
</div>
</div>
<div id="tabset-63-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-63-3-tab">
<div class="cell">
<div class="sourceCode" id="cb285"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mettre la variable poids_sondage au début de la base</span></span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(poids_sondage)</span></code></pre></div>
</div>
</div>
<div id="tabset-63-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-63-4-tab">
<div class="cell">
<div class="sourceCode" id="cb286"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mettre la variable poids_sondage au début de la base</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setcolorder</span>(donnees_datatable, <span class="fu">union</span>(<span class="st">&quot;poids_sondage&quot;</span>, <span class="fu">colnames</span>(donnees_datatable)))</span></code></pre></div>
</div>
</div>
<div id="tabset-63-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-63-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="mettre-la-variable-poids_sondage-à-la-fin-de-la-base" class="level3" data-number="10.1.3">
<h3 data-number="10.1.3"><span class="header-section-number">10.1.3</span> Mettre la variable poids_sondage à la fin de la base</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-64-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-64-1" role="tab" aria-controls="tabset-64-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-64-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-64-2" role="tab" aria-controls="tabset-64-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-64-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-64-3" role="tab" aria-controls="tabset-64-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-64-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-64-4" role="tab" aria-controls="tabset-64-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-64-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-64-5" role="tab" aria-controls="tabset-64-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-64-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-64-1-tab">
<div class="sourceCode" id="cb287"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Mettre la variable poids_sondage à la fin de la base */</span></span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> contents<span class="kw"> data</span> = donnees_sas out = <span class="fu">var</span><span class="kw">;run</span>;</span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql noprint;</span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> name <span class="kw">into</span> :<span class="fu">var</span> separated <span class="kw">by</span> <span class="st">&quot; &quot;</span> <span class="kw">from</span> <span class="fu">var</span></span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span> <span class="fu">lowcase</span>(name) ne <span class="st">&quot;poids_sondage&quot;</span> <span class="kw">order</span> <span class="kw">by</span> <span class="fu">varnum</span>;</span>
<span id="cb287-6"><a href="#cb287-6" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb287-7"><a href="#cb287-7" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb287-8"><a href="#cb287-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">retain</span> <span class="kw">&amp;var.</span> poids_sondage;</span>
<span id="cb287-9"><a href="#cb287-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb287-10"><a href="#cb287-10" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-64-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-64-2-tab">
<div class="cell">
<div class="sourceCode" id="cb288"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mettre la variable poids_sondage à la fin de la base</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[, <span class="fu">c</span>(<span class="fu">setdiff</span>(<span class="fu">colnames</span>(donnees_rbase), <span class="st">&quot;poids_sondage&quot;</span>), <span class="st">&quot;poids_sondage&quot;</span>)]</span></code></pre></div>
</div>
</div>
<div id="tabset-64-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-64-3-tab">
<div class="cell">
<div class="sourceCode" id="cb289"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mettre la variable poids_sondage à la fin de la base</span></span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(poids_sondage, <span class="at">.after =</span> <span class="fu">last_col</span>())</span></code></pre></div>
</div>
</div>
<div id="tabset-64-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-64-4-tab">
<div class="cell">
<div class="sourceCode" id="cb290"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mettre la variable poids_sondage à la fin de la base</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setcolorder</span>(donnees_datatable, <span class="fu">c</span>(<span class="fu">setdiff</span>(<span class="fu">colnames</span>(donnees_datatable), <span class="st">&quot;poids_sondage&quot;</span>), <span class="st">&quot;poids_sondage&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-64-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-64-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="trier-les-lignes" class="level2" data-number="10.2">
<h2 data-number="10.2"><span class="header-section-number">10.2</span> Trier les lignes</h2>
<section id="tri-par-ordre-croissant-didentifiant-et-date_entree" class="level3" data-number="10.2.1">
<h3 data-number="10.2.1"><span class="header-section-number">10.2.1</span> Tri par ordre croissant d’identifiant et date_entree</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-65-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-65-1" role="tab" aria-controls="tabset-65-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-65-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-65-2" role="tab" aria-controls="tabset-65-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-65-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-65-3" role="tab" aria-controls="tabset-65-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-65-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-65-4" role="tab" aria-controls="tabset-65-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-65-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-65-5" role="tab" aria-controls="tabset-65-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-65-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-65-1-tab">
<div class="sourceCode" id="cb291"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* 1ère possibilité */</span></span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> Identifiant Date_entree<span class="kw">;run</span>;</span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a><span class="co">/* 2e possibilité */</span></span>
<span id="cb291-5"><a href="#cb291-5" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb291-6"><a href="#cb291-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> Donnes <span class="kw">as</span> <span class="kw">select</span> * <span class="kw">from</span> donnees_sas</span>
<span id="cb291-7"><a href="#cb291-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span> <span class="kw">by</span> Identifiant, Date_entree;</span>
<span id="cb291-8"><a href="#cb291-8" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-65-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-65-2-tab">
<div class="cell">
<div class="sourceCode" id="cb292"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tri par ordre croissant</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a><span class="co"># L&#39;option na.last = FALSE (resp. TRUE) indique que les valeurs manquantes doivent figurer à la fin (resp. au début) du tri, que le tri soit croissant ou décroissant</span></span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(donnees_rbase<span class="sc">$</span>identifiant, donnees_rbase<span class="sc">$</span>date_entree, <span class="at">na.last =</span> <span class="cn">FALSE</span>), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-65-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-65-3-tab">
<div class="cell">
<div class="sourceCode" id="cb293"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tri par ordre croissant</span></span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, date_entree)</span></code></pre></div>
</div>
</div>
<div id="tabset-65-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-65-4-tab">
<div class="cell">
<div class="sourceCode" id="cb294"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tri par ordre croissant</span></span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="co"># L&#39;option na.last = FALSE (resp. TRUE) indique que les valeurs manquantes doivent figurer à la fin (resp. au début) du tri, que le tri soit croissant ou décroissant</span></span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable <span class="ot">&lt;-</span> donnees_datatable[<span class="fu">order</span>(identifiant, date_entree, <span class="at">na.last =</span> <span class="cn">FALSE</span>)]</span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-5"><a href="#cb294-5" aria-hidden="true" tabindex="-1"></a><span class="co"># En data.table, les instructions débutant par set modifient les éléments par référence, c&#39;est-à-dire sans copie.</span></span>
<span id="cb294-6"><a href="#cb294-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ceci est plus efficace pour manipuler des données volumineuses.</span></span>
<span id="cb294-7"><a href="#cb294-7" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(donnees_datatable, <span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;date_entree&quot;</span>, <span class="at">na.last =</span> <span class="cn">FALSE</span>)</span>
<span id="cb294-8"><a href="#cb294-8" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(donnees_datatable, identifiant, date_entree, <span class="at">na.last =</span> <span class="cn">FALSE</span>)</span>
<span id="cb294-9"><a href="#cb294-9" aria-hidden="true" tabindex="-1"></a><span class="fu">setorderv</span>(donnees_datatable, <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;date_entree&quot;</span>), <span class="at">order =</span> <span class="fu">c</span>(1L, 1L), <span class="at">na.last =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-65-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-65-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="tri-par-ordre-décroissant" class="level3" data-number="10.2.2">
<h3 data-number="10.2.2"><span class="header-section-number">10.2.2</span> Tri par ordre décroissant</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-66-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-66-1" role="tab" aria-controls="tabset-66-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-66-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-66-2" role="tab" aria-controls="tabset-66-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-66-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-66-3" role="tab" aria-controls="tabset-66-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-66-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-66-4" role="tab" aria-controls="tabset-66-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-66-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-66-5" role="tab" aria-controls="tabset-66-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-66-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-66-1-tab">
<div class="sourceCode" id="cb295"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Idem par ordre croissant d&#39;identifiant et ordre décroissant de date d&#39;entrée */</span></span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> Identifiant descending Date_entree<span class="kw">;run</span>;</span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> Donnes <span class="kw">as</span> <span class="kw">select</span> * <span class="kw">from</span> donnees_sas</span>
<span id="cb295-5"><a href="#cb295-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span> <span class="kw">by</span> Identifiant, Date_entree desc;</span>
<span id="cb295-6"><a href="#cb295-6" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-66-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-66-2-tab">
<div class="cell">
<div class="sourceCode" id="cb296"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tri par ordre croissant de identifiant et décroissant de date_entree (- avant le nom de la variable)</span></span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(donnees_rbase<span class="sc">$</span>identifiant, donnees_rbase<span class="sc">$</span>date_entree, <span class="at">na.last =</span> <span class="cn">FALSE</span>, <span class="at">decreasing =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>), <span class="at">method =</span> <span class="st">&quot;radix&quot;</span>), ]</span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre possibilité : - devant la variable (uniquement pour les variables numériques)</span></span>
<span id="cb296-5"><a href="#cb296-5" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(donnees_rbase<span class="sc">$</span>identifiant, <span class="sc">-</span>donnees_rbase<span class="sc">$</span>duree, <span class="at">na.last =</span> <span class="cn">FALSE</span>), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-66-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-66-3-tab">
<div class="cell">
<div class="sourceCode" id="cb297"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tri par ordre croissant de identifiant et décroissant de date_entree</span></span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="fu">desc</span>(date_entree))</span></code></pre></div>
</div>
</div>
<div id="tabset-66-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-66-4-tab">
<div class="cell">
<div class="sourceCode" id="cb298"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tri par ordre croissant de identifiant et décroissant de date_entree (- avant le nom de la variable)</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable <span class="ot">&lt;-</span> donnees_datatable[<span class="fu">order</span>(identifiant, <span class="sc">-</span>date_entree, <span class="at">na.last =</span> <span class="cn">FALSE</span>)]</span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(donnees_datatable, <span class="st">&quot;identifiant&quot;</span>, <span class="sc">-</span><span class="st">&quot;date_entree&quot;</span>, <span class="at">na.last =</span> <span class="cn">FALSE</span>)</span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(donnees_datatable, identifiant, <span class="sc">-</span>date_entree, <span class="at">na.last =</span> <span class="cn">FALSE</span>)</span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setorderv</span>(donnees_datatable, <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;date_entree&quot;</span>), <span class="at">order =</span> <span class="fu">c</span>(1L, <span class="sc">-</span>1L), <span class="at">na.last =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-66-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-66-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="incidence-des-valeurs-manquantes-dans-les-tris" class="level2" data-number="10.3">
<h2 data-number="10.3"><span class="header-section-number">10.3</span> Incidence des valeurs manquantes dans les tris</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-67-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-67-1" role="tab" aria-controls="tabset-67-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-67-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-67-2" role="tab" aria-controls="tabset-67-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-67-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-67-3" role="tab" aria-controls="tabset-67-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-67-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-67-4" role="tab" aria-controls="tabset-67-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-67-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-67-5" role="tab" aria-controls="tabset-67-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-67-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-67-1-tab">
<div class="sourceCode" id="cb299"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Dans SAS, les valeurs manquantes sont considérées comme des valeurs négatives */</span></span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* Elles sont donc situées en premier dans un tri par ordre croissant ... */</span></span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant date_entree<span class="kw">;run;proc</span> print<span class="kw">;run</span>;</span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a><span class="co">/* ... et en dernier dans un tri par ordre décroissant */</span></span>
<span id="cb299-5"><a href="#cb299-5" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant descending date_entree<span class="kw">;run</span>;</span>
<span id="cb299-6"><a href="#cb299-6" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-67-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-67-2-tab">
<div class="cell">
<div class="sourceCode" id="cb300"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les valeurs manquantes sont situées en dernier dans un tri par ordre croissant ou décroissant (car par défaut l&#39;option na.last = TRUE) ...</span></span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(donnees_rbase<span class="sc">$</span>identifiant, donnees_rbase<span class="sc">$</span>date_entree), ]</span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a><span class="co"># SAS considère les valeurs manquantes comme des nombres négatifs faibles.</span></span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour mimer le tri par ordre croissant en SAS :</span></span>
<span id="cb300-6"><a href="#cb300-6" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(donnees_rbase<span class="sc">$</span>identifiant, donnees_rbase<span class="sc">$</span>date_entree, <span class="at">na.last =</span> <span class="cn">FALSE</span>), ]</span>
<span id="cb300-7"><a href="#cb300-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour mimer le tri par ordre décroissant en SAS :</span></span>
<span id="cb300-8"><a href="#cb300-8" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(donnees_rbase<span class="sc">$</span>identifiant, donnees_rbase<span class="sc">$</span>date_entree,</span>
<span id="cb300-9"><a href="#cb300-9" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">na.last =</span> <span class="cn">FALSE</span>,</span>
<span id="cb300-10"><a href="#cb300-10" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">decreasing =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>),</span>
<span id="cb300-11"><a href="#cb300-11" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">method =</span> <span class="st">&quot;radix&quot;</span>), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-67-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-67-3-tab">
<div class="cell">
<div class="sourceCode" id="cb301"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Attention, avec arrange, les variables manquantes (NA) sont toujours classées en dernier, même avec desc()</span></span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, date_entree)</span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="fu">desc</span>(date_entree))</span>
<span id="cb301-6"><a href="#cb301-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-7"><a href="#cb301-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Or, SAS considère les valeurs manquantes comme des nombres négatifs faibles.</span></span>
<span id="cb301-8"><a href="#cb301-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Elles sont donc classées en premier dans un tri par ordre croissant, et en dernier dans un tri par ordre décroissant</span></span>
<span id="cb301-9"><a href="#cb301-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-10"><a href="#cb301-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour mimer le tri par ordre croissant en SAS : les valeurs manquantes de date_entree sont classées en premier</span></span>
<span id="cb301-11"><a href="#cb301-11" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb301-12"><a href="#cb301-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree)</span>
<span id="cb301-13"><a href="#cb301-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour mimer le tri par ordre décroissant en SAS</span></span>
<span id="cb301-14"><a href="#cb301-14" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb301-15"><a href="#cb301-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="fu">desc</span>(date_entree))</span></code></pre></div>
</div>
</div>
<div id="tabset-67-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-67-4-tab">
<div class="cell">
<div class="sourceCode" id="cb302"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les valeurs manquantes sont situées en dernier dans un tri par ordre croissant ou décroissant (car par défaut l&#39;option na.last = TRUE) ...</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable <span class="ot">&lt;-</span> donnees_datatable[<span class="fu">order</span>(identifiant, date_entree)]</span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a><span class="co"># SAS considère les valeurs manquantes comme des nombres négatifs faibles.</span></span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour mimer le tri par ordre croissant en SAS :</span></span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setorderv</span>(donnees_datatable, <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;date_entree&quot;</span>), <span class="at">order =</span> <span class="fu">c</span>(1L, 1L), <span class="at">na.last =</span> <span class="cn">FALSE</span>)</span>
<span id="cb302-6"><a href="#cb302-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour mimer le tri par ordre décroissant en SAS :</span></span>
<span id="cb302-7"><a href="#cb302-7" aria-hidden="true" tabindex="-1"></a><span class="fu">setorderv</span>(donnees_datatable, <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;date_entree&quot;</span>), <span class="at">order =</span> <span class="fu">c</span>(1L, <span class="sc">-</span>1L), <span class="at">na.last =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-67-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-67-5-tab">
<div class="cell">
<div class="sourceCode" id="cb303"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les valeurs manquantes sont situées en dernier dans un tri par ordre croissant ou décroissant (car par défaut l&#39;option na.last = TRUE) ...</span></span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Identifiant, Note_Contenu) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Identifiant, Note_Contenu)</span>
<span id="cb303-3"><a href="#cb303-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb303-4"><a href="#cb303-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour mimer le tri SAS, il faut écrire :</span></span>
<span id="cb303-5"><a href="#cb303-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Note : il faut faire select d&#39;abord, sinon il y a une erreur quand &quot;! is.na()&quot; est dans la liste des colonnes</span></span>
<span id="cb303-6"><a href="#cb303-6" aria-hidden="true" tabindex="-1"></a>requete_duckdb <span class="sc">%&gt;%</span> <span class="fu">select</span>(Identifiant, Note_Contenu) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Identifiant, <span class="sc">!</span> <span class="fu">is.na</span>(Note_Contenu), Note_Contenu)</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="trier-par-ordre-croissant-de-toutes-les-variables-de-la-base" class="level2" data-number="10.4">
<h2 data-number="10.4"><span class="header-section-number">10.4</span> Trier par ordre croissant de toutes les variables de la base</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-68-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-68-1" role="tab" aria-controls="tabset-68-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-68-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-68-2" role="tab" aria-controls="tabset-68-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-68-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-68-3" role="tab" aria-controls="tabset-68-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-68-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-68-4" role="tab" aria-controls="tabset-68-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-68-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-68-5" role="tab" aria-controls="tabset-68-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-68-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-68-1-tab">
<div class="sourceCode" id="cb304"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> _all_<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-68-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-68-2-tab">
<div class="cell">
<div class="sourceCode" id="cb305"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a>tri_toutes_variables <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(<span class="fu">colnames</span>(donnees_rbase), <span class="at">na.last =</span> <span class="cn">FALSE</span>)]</span></code></pre></div>
</div>
</div>
<div id="tabset-68-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-68-3-tab">
<div class="cell">
<div class="sourceCode" id="cb306"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>tri_toutes_variables <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">pick</span>(<span class="fu">everything</span>()))</span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a>tri_toutes_variables <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">across</span>(<span class="fu">everything</span>()))</span></code></pre></div>
</div>
</div>
<div id="tabset-68-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-68-4-tab">
<div class="cell">
<div class="sourceCode" id="cb307"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>tri_toutes_variables <span class="ot">&lt;-</span> <span class="fu">setorderv</span>(donnees_datatable, <span class="at">na.last =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-68-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-68-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="gestion-par-groupe" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Gestion par groupe</h1>
<section id="numéroter-les-lignes" class="level2" data-number="11.1">
<h2 data-number="11.1"><span class="header-section-number">11.1</span> Numéroter les lignes</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-69-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-69-1" role="tab" aria-controls="tabset-69-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-69-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-69-2" role="tab" aria-controls="tabset-69-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-69-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-69-3" role="tab" aria-controls="tabset-69-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-69-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-69-4" role="tab" aria-controls="tabset-69-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-69-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-69-5" role="tab" aria-controls="tabset-69-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-69-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-69-1-tab">
<div class="sourceCode" id="cb308"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a>  Num_observation = _n_;</span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb308-5"><a href="#cb308-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-6"><a href="#cb308-6" aria-hidden="true" tabindex="-1"></a><span class="co">/* Autre solution */</span></span>
<span id="cb308-7"><a href="#cb308-7" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql noprint;<span class="kw">select</span> count(*) <span class="kw">into</span> :nbLignes <span class="kw">from</span> donnees_sas;<span class="kw">quit</span>;</span>
<span id="cb308-8"><a href="#cb308-8" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> numLigne<span class="kw">;do</span> Num_observation = <span class="dv">1</span> <span class="kw">to</span> <span class="kw">&amp;nbLignes.</span>;<span class="kw">output;end;run</span>;</span>
<span id="cb308-9"><a href="#cb308-9" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> _NULL_;</span>
<span id="cb308-10"><a href="#cb308-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas nobs = <span class="fu">n</span>;</span>
<span id="cb308-11"><a href="#cb308-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">call</span> symputx(<span class="st">&#39;nbLignes&#39;</span>, <span class="fu">n</span>);</span>
<span id="cb308-12"><a href="#cb308-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb308-13"><a href="#cb308-13" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> Nombre de lignes : <span class="kw">&amp;nbLignes.</span>;</span>
<span id="cb308-14"><a href="#cb308-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-15"><a href="#cb308-15" aria-hidden="true" tabindex="-1"></a><span class="co">/* Le merge &quot;simple&quot; (sans by) va seulement concaténer les deux bases l&#39;une à côté de l&#39;autre */</span></span>
<span id="cb308-16"><a href="#cb308-16" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb308-17"><a href="#cb308-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">merge</span> donnees_sas numLigne;</span>
<span id="cb308-18"><a href="#cb308-18" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-69-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-69-2-tab">
<div class="cell">
<div class="sourceCode" id="cb309"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Numéro de l&#39;observation : 2 manières différentes</span></span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>num_observation <span class="ot">&lt;-</span> <span class="fu">row.names</span>(donnees_rbase)</span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>num_observation <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span> <span class="sc">:</span> <span class="fu">nrow</span>(donnees_rbase))</span>
<span id="cb309-4"><a href="#cb309-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-5"><a href="#cb309-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Numéro du contrat de chaque individu, contrat trié par date d&#39;entrée</span></span>
<span id="cb309-6"><a href="#cb309-6" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(donnees_rbase<span class="sc">$</span>identifiant, donnees_rbase<span class="sc">$</span>date_entre, <span class="at">na.last =</span> <span class="cn">FALSE</span>), ]</span>
<span id="cb309-7"><a href="#cb309-7" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>un <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb309-8"><a href="#cb309-8" aria-hidden="true" tabindex="-1"></a><span class="co"># MISE EN GARDE : en utilisant la fonction ave, toujours précéder la fonction de FUN !</span></span>
<span id="cb309-9"><a href="#cb309-9" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>numero_contrat <span class="ot">&lt;-</span> <span class="fu">ave</span>(donnees_rbase<span class="sc">$</span>un, donnees_rbase<span class="sc">$</span>identifiant, <span class="at">FUN =</span> cumsum)</span>
<span id="cb309-10"><a href="#cb309-10" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>un <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb309-11"><a href="#cb309-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-12"><a href="#cb309-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb309-13"><a href="#cb309-13" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(donnees_rbase<span class="sc">$</span>identifiant, donnees_rbase<span class="sc">$</span>date_entre, <span class="at">na.last =</span> <span class="cn">FALSE</span>), ]</span>
<span id="cb309-14"><a href="#cb309-14" aria-hidden="true" tabindex="-1"></a><span class="co"># MISE EN GARDE : en utilisant la fonction ave, toujours précéder la fonction de FUN !</span></span>
<span id="cb309-15"><a href="#cb309-15" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>numero_contrat <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">ave</span>(donnees_rbase<span class="sc">$</span>identifiant, donnees_rbase<span class="sc">$</span>identifiant, <span class="at">FUN =</span> seq_along))</span>
<span id="cb309-16"><a href="#cb309-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-17"><a href="#cb309-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution : order pour éviter le as.numeric</span></span>
<span id="cb309-18"><a href="#cb309-18" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(donnees_rbase<span class="sc">$</span>identifiant, donnees_rbase<span class="sc">$</span>date_entre, <span class="at">na.last =</span> <span class="cn">FALSE</span>), ]</span>
<span id="cb309-19"><a href="#cb309-19" aria-hidden="true" tabindex="-1"></a><span class="co"># MISE EN GARDE : en utilisant la fonction ave, toujours précéder la fonction de FUN !</span></span>
<span id="cb309-20"><a href="#cb309-20" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>numero_contrat <span class="ot">&lt;-</span> <span class="fu">ave</span>(<span class="fu">order</span>(donnees_rbase<span class="sc">$</span>date_entree), donnees_rbase<span class="sc">$</span>identifiant, <span class="at">FUN =</span> seq_along)</span>
<span id="cb309-21"><a href="#cb309-21" aria-hidden="true" tabindex="-1"></a><span class="co">#https://stackoverflow.com/questions/11996135/create-a-sequential-number-counter-for-rows-within-each-group-of-a-dataframe</span></span>
<span id="cb309-22"><a href="#cb309-22" aria-hidden="true" tabindex="-1"></a><span class="co">#https://stackoverflow.com/questions/13732062/what-are-examples-of-when-seq-along-works-but-seq-produces-unintended-results</span></span></code></pre></div>
</div>
</div>
<div id="tabset-69-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-69-3-tab">
<div class="cell">
<div class="sourceCode" id="cb310"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Numéro de l&#39;observation</span></span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb310-4"><a href="#cb310-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span> </span>
<span id="cb310-5"><a href="#cb310-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_observation =</span> <span class="fu">row_number</span>())</span>
<span id="cb310-6"><a href="#cb310-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-7"><a href="#cb310-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Numéro du contrat de chaque individu, contrat trié par date d&#39;entrée</span></span>
<span id="cb310-8"><a href="#cb310-8" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange() va permettre de trier les observations par identifiant et date d&#39;entrée </span></span>
<span id="cb310-9"><a href="#cb310-9" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb310-10"><a href="#cb310-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb310-11"><a href="#cb310-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb310-12"><a href="#cb310-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span> </span>
<span id="cb310-13"><a href="#cb310-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">numero_contrat =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb310-14"><a href="#cb310-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb310-15"><a href="#cb310-15" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : Dans group_by, à quoi sert le drop ?</span></span></code></pre></div>
</div>
</div>
<div id="tabset-69-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-69-4-tab">
<div class="cell">
<div class="sourceCode" id="cb311"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Numéro de l&#39;observation : 2 manières différentes</span></span>
<span id="cb311-2"><a href="#cb311-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, num_observation <span class="sc">:</span><span class="er">=</span> .I]</span>
<span id="cb311-3"><a href="#cb311-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, num_observation <span class="sc">:</span><span class="er">=</span> <span class="fu">seq_len</span>(.N)]</span>
<span id="cb311-4"><a href="#cb311-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-5"><a href="#cb311-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Numéro du contrat de chaque individu, contrat trié par date d&#39;entrée</span></span>
<span id="cb311-6"><a href="#cb311-6" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(donnees_datatable, <span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;date_entree&quot;</span>, <span class="at">na.last =</span> <span class="cn">FALSE</span>)</span>
<span id="cb311-7"><a href="#cb311-7" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, numero_contrat <span class="sc">:</span><span class="er">=</span> <span class="fu">rowid</span>(identifiant)]</span>
<span id="cb311-8"><a href="#cb311-8" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, numero_contrat <span class="sc">:</span><span class="er">=</span> <span class="fu">seq_len</span>(.N), by <span class="ot">=</span> identifiant]</span></code></pre></div>
</div>
</div>
<div id="tabset-69-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-69-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="première-et-dernière-ligne-par-identifiant" class="level2" data-number="11.2">
<h2 data-number="11.2"><span class="header-section-number">11.2</span> Première et dernière ligne par identifiant</h2>
<section id="première-ligne-par-identifiant" class="level3" data-number="11.2.1">
<h3 data-number="11.2.1"><span class="header-section-number">11.2.1</span> Première ligne par identifiant</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-70-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-70-1" role="tab" aria-controls="tabset-70-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-70-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-70-2" role="tab" aria-controls="tabset-70-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-70-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-70-3" role="tab" aria-controls="tabset-70-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-70-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-70-4" role="tab" aria-controls="tabset-70-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-70-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-70-5" role="tab" aria-controls="tabset-70-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-70-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-70-1-tab">
<div class="sourceCode" id="cb312"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant date_entree<span class="kw">;run</span>;</span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* L&#39;instruction options permet de ne pas afficher d&#39;erreur si la variable numero_contrat n&#39;existe pas */</span></span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a><span class="kw">options</span> dkricond=nowarn dkrocond=nowarn;</span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">drop</span> = numero_contrat);</span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> identifiant date_entree;</span>
<span id="cb312-7"><a href="#cb312-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">retain</span> numero_contrat <span class="dv">0</span>;</span>
<span id="cb312-8"><a href="#cb312-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> first.identifiant <span class="kw">then</span> numero_contrat = <span class="dv">1</span>;</span>
<span id="cb312-9"><a href="#cb312-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">else</span>                      numero_contrat = numero_contrat + <span class="dv">1</span>;</span>
<span id="cb312-10"><a href="#cb312-10" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb312-11"><a href="#cb312-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-12"><a href="#cb312-12" aria-hidden="true" tabindex="-1"></a><span class="kw">options</span> dkricond=warn dkrocond=warn;</span>
<span id="cb312-13"><a href="#cb312-13" aria-hidden="true" tabindex="-1"></a><span class="co">/* Pour trier les colonnes */</span></span>
<span id="cb312-14"><a href="#cb312-14" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb312-15"><a href="#cb312-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">retain</span> identifiant date_entree numero_contrat numero_contrat;</span>
<span id="cb312-16"><a href="#cb312-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb312-17"><a href="#cb312-17" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-70-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-70-2-tab">
<div class="cell">
<div class="sourceCode" id="cb313"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a>donnees_rbase[<span class="sc">!</span><span class="fu">duplicated</span>(donnees_rbase<span class="sc">$</span>identifiant), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-70-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-70-3-tab">
<div class="cell">
<div class="sourceCode" id="cb314"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb314-3"><a href="#cb314-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb314-4"><a href="#cb314-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span></span>
<span id="cb314-5"><a href="#cb314-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb314-6"><a href="#cb314-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb314-7"><a href="#cb314-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-8"><a href="#cb314-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Autres solutions</span></span>
<span id="cb314-9"><a href="#cb314-9" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb314-10"><a href="#cb314-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb314-11"><a href="#cb314-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb314-12"><a href="#cb314-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span></span>
<span id="cb314-13"><a href="#cb314-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb314-14"><a href="#cb314-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb314-15"><a href="#cb314-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-16"><a href="#cb314-16" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span>  </span>
<span id="cb314-17"><a href="#cb314-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb314-18"><a href="#cb314-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb314-19"><a href="#cb314-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span></span>
<span id="cb314-20"><a href="#cb314-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb314-21"><a href="#cb314-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb314-22"><a href="#cb314-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-23"><a href="#cb314-23" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span>  </span>
<span id="cb314-24"><a href="#cb314-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb314-25"><a href="#cb314-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb314-26"><a href="#cb314-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span></span>
<span id="cb314-27"><a href="#cb314-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="fu">nth</span>(<span class="fu">row_number</span>(), <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb314-28"><a href="#cb314-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-70-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-70-4-tab">
<div class="cell">
<div class="sourceCode" id="cb315"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, .SD[<span class="dv">1</span>], by <span class="ot">=</span> identifiant]</span></code></pre></div>
</div>
</div>
<div id="tabset-70-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-70-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="dernière-ligne-par-identifiant" class="level3" data-number="11.2.2">
<h3 data-number="11.2.2"><span class="header-section-number">11.2.2</span> Dernière ligne par identifiant</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-71-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-71-1" role="tab" aria-controls="tabset-71-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-71-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-71-2" role="tab" aria-controls="tabset-71-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-71-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-71-3" role="tab" aria-controls="tabset-71-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-71-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-71-4" role="tab" aria-controls="tabset-71-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-71-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-71-5" role="tab" aria-controls="tabset-71-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-71-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-71-1-tab">
<div class="sourceCode" id="cb316"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant date_entree<span class="kw">;run</span>;</span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* L&#39;instruction options permet de ne pas afficher d&#39;erreur si la variable numero_contrat n&#39;existe pas */</span></span>
<span id="cb316-3"><a href="#cb316-3" aria-hidden="true" tabindex="-1"></a><span class="kw">options</span> dkricond=nowarn dkrocond=nowarn;</span>
<span id="cb316-4"><a href="#cb316-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb316-5"><a href="#cb316-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">drop</span> = numero_contrat);</span>
<span id="cb316-6"><a href="#cb316-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> identifiant date_entree;</span>
<span id="cb316-7"><a href="#cb316-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">retain</span> numero_contrat <span class="dv">0</span>;</span>
<span id="cb316-8"><a href="#cb316-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> first.identifiant <span class="kw">then</span> numero_contrat = <span class="dv">1</span>;</span>
<span id="cb316-9"><a href="#cb316-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">else</span>                      numero_contrat = numero_contrat + <span class="dv">1</span>;</span>
<span id="cb316-10"><a href="#cb316-10" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb316-11"><a href="#cb316-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-12"><a href="#cb316-12" aria-hidden="true" tabindex="-1"></a><span class="kw">options</span> dkricond=warn dkrocond=warn;</span>
<span id="cb316-13"><a href="#cb316-13" aria-hidden="true" tabindex="-1"></a><span class="co">/* Pour trier les colonnes */</span></span>
<span id="cb316-14"><a href="#cb316-14" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb316-15"><a href="#cb316-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">retain</span> identifiant date_entree numero_contrat numero_contrat;</span>
<span id="cb316-16"><a href="#cb316-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb316-17"><a href="#cb316-17" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-71-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-71-2-tab">
<div class="cell">
<div class="sourceCode" id="cb317"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a>donnees_rbase[<span class="sc">!</span><span class="fu">duplicated</span>(donnees_rbase<span class="sc">$</span>identifiant, <span class="at">fromLast =</span> <span class="cn">TRUE</span>), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-71-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-71-3-tab">
<div class="cell">
<div class="sourceCode" id="cb318"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb318-4"><a href="#cb318-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span></span>
<span id="cb318-5"><a href="#cb318-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb318-6"><a href="#cb318-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb318-7"><a href="#cb318-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-8"><a href="#cb318-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Autres solutions</span></span>
<span id="cb318-9"><a href="#cb318-9" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span>  </span>
<span id="cb318-10"><a href="#cb318-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb318-11"><a href="#cb318-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb318-12"><a href="#cb318-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span></span>
<span id="cb318-13"><a href="#cb318-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb318-14"><a href="#cb318-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb318-15"><a href="#cb318-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-16"><a href="#cb318-16" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span>  </span>
<span id="cb318-17"><a href="#cb318-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb318-18"><a href="#cb318-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb318-19"><a href="#cb318-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span></span>
<span id="cb318-20"><a href="#cb318-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="fu">nth</span>(<span class="fu">row_number</span>(), <span class="sc">-</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb318-21"><a href="#cb318-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-71-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-71-4-tab">
<div class="cell">
<div class="sourceCode" id="cb319"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, .SD[.N], by <span class="ot">=</span> identifiant]</span></code></pre></div>
</div>
</div>
<div id="tabset-71-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-71-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="le-premier-contrat-le-dernier-contrat-ni-le-premier-ni-le-dernier-contrat-de-chaque-individu" class="level2" data-number="11.3">
<h2 data-number="11.3"><span class="header-section-number">11.3</span> Le premier contrat, le dernier contrat, ni le premier ni le dernier contrat de chaque individu</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-72-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-72-1" role="tab" aria-controls="tabset-72-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-72-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-72-2" role="tab" aria-controls="tabset-72-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-72-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-72-3" role="tab" aria-controls="tabset-72-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-72-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-72-4" role="tab" aria-controls="tabset-72-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-72-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-72-5" role="tab" aria-controls="tabset-72-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-72-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-72-1-tab">
<div class="sourceCode" id="cb320"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant date_entree<span class="kw">;run</span>;</span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb320-4"><a href="#cb320-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> identifiant date_entree;</span>
<span id="cb320-5"><a href="#cb320-5" aria-hidden="true" tabindex="-1"></a>  Premier_Contrat = (first.identifiant = <span class="dv">1</span>);</span>
<span id="cb320-6"><a href="#cb320-6" aria-hidden="true" tabindex="-1"></a>  Dernier_Contrat = (last.identifiant = <span class="dv">1</span>);</span>
<span id="cb320-7"><a href="#cb320-7" aria-hidden="true" tabindex="-1"></a>  Ni_Prem_Ni_Der  = (first.identifiant = <span class="dv">0</span> <span class="kw">and</span> last.identifiant = <span class="dv">0</span>);</span>
<span id="cb320-8"><a href="#cb320-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-72-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-72-2-tab">
<div class="cell">
<div class="sourceCode" id="cb321"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(donnees_rbase<span class="sc">$</span>identifiant, donnees_rbase<span class="sc">$</span>date_entre, <span class="at">na.last =</span> <span class="cn">FALSE</span>), ]</span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>premier_contrat <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">duplicated</span>(donnees_rbase<span class="sc">$</span>identifiant, <span class="at">fromLast =</span> <span class="cn">FALSE</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>dernier_contrat <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">duplicated</span>(donnees_rbase<span class="sc">$</span>identifiant, <span class="at">fromLast =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb321-4"><a href="#cb321-4" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>ni_prem_ni_der  <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="sc">!</span> <span class="fu">c</span>(<span class="sc">!</span><span class="fu">duplicated</span>(donnees_rbase<span class="sc">$</span>identifiant, <span class="at">fromLast =</span> <span class="cn">FALSE</span>) <span class="sc">|</span> <span class="sc">!</span><span class="fu">duplicated</span>(donnees_rbase<span class="sc">$</span>identifiant, <span class="at">fromLast =</span> <span class="cn">TRUE</span>)), <span class="dv">1</span>, <span class="dv">0</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-72-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-72-3-tab">
<div class="cell">
<div class="sourceCode" id="cb322"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Premier contrat</span></span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb322-4"><a href="#cb322-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span> </span>
<span id="cb322-5"><a href="#cb322-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb322-6"><a href="#cb322-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">premier_contrat =</span> <span class="fu">ifelse</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb322-7"><a href="#cb322-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb322-8"><a href="#cb322-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-9"><a href="#cb322-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Dernier contrat</span></span>
<span id="cb322-10"><a href="#cb322-10" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb322-11"><a href="#cb322-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb322-12"><a href="#cb322-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span> </span>
<span id="cb322-13"><a href="#cb322-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb322-14"><a href="#cb322-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dernier_contrat =</span> <span class="fu">ifelse</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="fu">n</span>(), <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb322-15"><a href="#cb322-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb322-16"><a href="#cb322-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-17"><a href="#cb322-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Ni le premier, ni le dernier contrat</span></span>
<span id="cb322-18"><a href="#cb322-18" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb322-19"><a href="#cb322-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb322-20"><a href="#cb322-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span> </span>
<span id="cb322-21"><a href="#cb322-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb322-22"><a href="#cb322-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ni_prem_ni_der =</span> <span class="fu">ifelse</span>( <span class="sc">!</span> (<span class="fu">row_number</span>() <span class="sc">==</span> <span class="fu">n</span>() <span class="sc">|</span> <span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span>), <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb322-23"><a href="#cb322-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-72-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-72-4-tab">
<div class="cell">
<div class="sourceCode" id="cb323"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable <span class="ot">&lt;-</span> donnees_datatable[<span class="fu">order</span>(identifiant, date_entree, <span class="at">na.last =</span> <span class="cn">FALSE</span>)]</span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, premier_contrat <span class="sc">:</span><span class="er">=</span> <span class="fu">fifelse</span>(<span class="sc">!</span><span class="fu">duplicated</span>(identifiant, <span class="at">fromLast =</span> <span class="cn">FALSE</span>), <span class="dv">1</span>, <span class="dv">0</span>)]</span>
<span id="cb323-3"><a href="#cb323-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, dernier_contrat <span class="sc">:</span><span class="er">=</span> <span class="fu">fifelse</span>(<span class="sc">!</span><span class="fu">duplicated</span>(identifiant, <span class="at">fromLast =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>, <span class="dv">0</span>)]</span>
<span id="cb323-4"><a href="#cb323-4" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, ni_prem_ni_der <span class="sc">:</span><span class="er">=</span> <span class="fu">fifelse</span>(<span class="sc">!</span> <span class="fu">c</span>(<span class="sc">!</span><span class="fu">duplicated</span>(identifiant, <span class="at">fromLast =</span> <span class="cn">FALSE</span>) <span class="sc">|</span> <span class="sc">!</span><span class="fu">duplicated</span>(identifiant, <span class="at">fromLast =</span> <span class="cn">TRUE</span>)), <span class="dv">1</span>, <span class="dv">0</span>)]</span></code></pre></div>
</div>
</div>
<div id="tabset-72-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-72-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="créer-une-base-avec-les-seuls-premiers-contrats-et-une-base-avec-les-seuls-derniers-contrats" class="level2" data-number="11.4">
<h2 data-number="11.4"><span class="header-section-number">11.4</span> Créer une base avec les seuls premiers contrats, et une base avec les seuls derniers contrats</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-73-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-73-1" role="tab" aria-controls="tabset-73-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-73-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-73-2" role="tab" aria-controls="tabset-73-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-73-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-73-3" role="tab" aria-controls="tabset-73-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-73-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-73-4" role="tab" aria-controls="tabset-73-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-73-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-73-5" role="tab" aria-controls="tabset-73-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-73-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-73-1-tab">
<div class="sourceCode" id="cb324"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant date_entree<span class="kw">;run</span>;</span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* Création de 2 bases en une seule étape */</span></span>
<span id="cb324-3"><a href="#cb324-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Premier_Contrat Dernier_Contrat;</span>
<span id="cb324-4"><a href="#cb324-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb324-5"><a href="#cb324-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> identifiant date_entree;</span>
<span id="cb324-6"><a href="#cb324-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> first.identifiant <span class="kw">then</span> <span class="kw">output</span> Premier_Contrat;</span>
<span id="cb324-7"><a href="#cb324-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> last.identifiant <span class="kw">then</span> <span class="kw">output</span> Dernier_Contrat;</span>
<span id="cb324-8"><a href="#cb324-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-73-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-73-2-tab">
<div class="cell">
<div class="sourceCode" id="cb325"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer une base avec les seuls premiers contrats, et une base avec les seuls derniers contrats</span></span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(donnees_rbase<span class="sc">$</span>identifiant, donnees_rbase<span class="sc">$</span>date_entre, <span class="at">na.last =</span> <span class="cn">FALSE</span>), ]</span>
<span id="cb325-3"><a href="#cb325-3" aria-hidden="true" tabindex="-1"></a>premier_contrat <span class="ot">&lt;-</span> donnees_rbase[<span class="sc">!</span><span class="fu">duplicated</span>(donnees_rbase<span class="sc">$</span>identifiant, <span class="at">fromLast =</span> <span class="cn">FALSE</span>), ]</span>
<span id="cb325-4"><a href="#cb325-4" aria-hidden="true" tabindex="-1"></a>dernier_contrat <span class="ot">&lt;-</span> donnees_rbase[<span class="sc">!</span><span class="fu">duplicated</span>(donnees_rbase<span class="sc">$</span>identifiant, <span class="at">fromLast =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb325-5"><a href="#cb325-5" aria-hidden="true" tabindex="-1"></a>ni_prem_ni_der  <span class="ot">&lt;-</span> donnees_rbase[<span class="sc">!</span> (<span class="sc">!</span><span class="fu">duplicated</span>(donnees_rbase<span class="sc">$</span>identifiant, <span class="at">fromLast =</span> <span class="cn">FALSE</span>) <span class="sc">|</span> <span class="sc">!</span><span class="fu">duplicated</span>(donnees_rbase<span class="sc">$</span>identifiant, <span class="at">fromLast =</span> <span class="cn">TRUE</span>)), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-73-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-73-3-tab">
<div class="cell">
<div class="sourceCode" id="cb326"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Premier contrat</span></span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a>premier_contrat <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb326-3"><a href="#cb326-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb326-4"><a href="#cb326-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span> </span>
<span id="cb326-5"><a href="#cb326-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb326-6"><a href="#cb326-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">premier_contrat =</span> <span class="fu">ifelse</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb326-7"><a href="#cb326-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb326-8"><a href="#cb326-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-9"><a href="#cb326-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Dernier contrat</span></span>
<span id="cb326-10"><a href="#cb326-10" aria-hidden="true" tabindex="-1"></a>dernier_contrat <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb326-11"><a href="#cb326-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb326-12"><a href="#cb326-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span> </span>
<span id="cb326-13"><a href="#cb326-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb326-14"><a href="#cb326-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dernier_contrat =</span> <span class="fu">ifelse</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="fu">n</span>(), <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb326-15"><a href="#cb326-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb326-16"><a href="#cb326-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-17"><a href="#cb326-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Ni le premier, ni le dernier contrat</span></span>
<span id="cb326-18"><a href="#cb326-18" aria-hidden="true" tabindex="-1"></a>ni_prem_ni_der <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb326-19"><a href="#cb326-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb326-20"><a href="#cb326-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span> </span>
<span id="cb326-21"><a href="#cb326-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb326-22"><a href="#cb326-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ni_prem_ni_der =</span> <span class="fu">ifelse</span>( <span class="sc">!</span> (<span class="fu">row_number</span>() <span class="sc">==</span> <span class="fu">n</span>() <span class="sc">|</span> <span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span>), <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb326-23"><a href="#cb326-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-73-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-73-4-tab">
<div class="cell">
<div class="sourceCode" id="cb327"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable <span class="ot">&lt;-</span> donnees_datatable[<span class="fu">order</span>(identifiant, date_entree, <span class="at">na.last =</span> <span class="cn">FALSE</span>)]</span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a>premier_contrat <span class="ot">&lt;-</span> donnees_datatable[<span class="sc">!</span><span class="fu">duplicated</span>(identifiant, <span class="at">fromLast =</span> <span class="cn">FALSE</span>), ]</span>
<span id="cb327-3"><a href="#cb327-3" aria-hidden="true" tabindex="-1"></a>dernier_contrat <span class="ot">&lt;-</span> donnees_datatable[<span class="sc">!</span><span class="fu">duplicated</span>(identifiant, <span class="at">fromLast =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb327-4"><a href="#cb327-4" aria-hidden="true" tabindex="-1"></a>ni_prem_ni_der  <span class="ot">&lt;-</span> donnees_datatable[<span class="sc">!</span> (<span class="sc">!</span><span class="fu">duplicated</span>(identifiant, <span class="at">fromLast =</span> <span class="cn">FALSE</span>) <span class="sc">|</span> <span class="sc">!</span><span class="fu">duplicated</span>(identifiant, <span class="at">fromLast =</span> <span class="cn">TRUE</span>)), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-73-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-73-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="sélection-de-lignes-par-identifiant" class="level2" data-number="11.5">
<h2 data-number="11.5"><span class="header-section-number">11.5</span> Sélection de lignes par identifiant</h2>
<section id="les-2-premières-lignes-de-chaque-identifiant" class="level3" data-number="11.5.1">
<h3 data-number="11.5.1"><span class="header-section-number">11.5.1</span> Les 2 premières lignes de chaque identifiant</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-74-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-74-1" role="tab" aria-controls="tabset-74-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-74-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-74-2" role="tab" aria-controls="tabset-74-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-74-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-74-3" role="tab" aria-controls="tabset-74-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-74-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-74-4" role="tab" aria-controls="tabset-74-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-74-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-74-5" role="tab" aria-controls="tabset-74-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-74-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-74-1-tab">
<div class="sourceCode" id="cb328"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Les 2 premières lignes de chaque identifiant */</span></span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant numero_contrat<span class="kw">;run</span>;</span>
<span id="cb328-3"><a href="#cb328-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb328-4"><a href="#cb328-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> * <span class="kw">from</span> donnees_sas <span class="kw">group</span> <span class="kw">by</span> identifiant</span>
<span id="cb328-5"><a href="#cb328-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">having</span> numero_contrat &lt;= <span class="dv">2</span>;</span>
<span id="cb328-6"><a href="#cb328-6" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-74-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-74-2-tab">
<div class="cell">
<div class="sourceCode" id="cb329"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 premières lignes par identifiant (le premier si une seule ligne)</span></span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Peut-on le faire en moins d&#39;étapes ??? Avec head ?</span></span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>a <span class="ot">&lt;-</span> 1L</span>
<span id="cb329-4"><a href="#cb329-4" aria-hidden="true" tabindex="-1"></a><span class="co"># MISE EN GARDE : en utilisant la fonction ave, toujours précéder la fonction de FUN !</span></span>
<span id="cb329-5"><a href="#cb329-5" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>numero_contrat <span class="ot">&lt;-</span> <span class="fu">ave</span>(donnees_rbase<span class="sc">$</span>a, donnees_rbase<span class="sc">$</span>identifiant, <span class="at">FUN =</span> cumsum)</span>
<span id="cb329-6"><a href="#cb329-6" aria-hidden="true" tabindex="-1"></a>deux_premieres_lignes <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">which</span>(donnees_rbase<span class="sc">$</span>numero_contrat <span class="sc">&lt;=</span> <span class="dv">2</span>), ]</span>
<span id="cb329-7"><a href="#cb329-7" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>a <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb329-8"><a href="#cb329-8" aria-hidden="true" tabindex="-1"></a><span class="co"># REVOIR</span></span>
<span id="cb329-9"><a href="#cb329-9" aria-hidden="true" tabindex="-1"></a><span class="co"># MISE EN GARDE : en utilisant la fonction ave, toujours précéder la fonction de FUN !</span></span>
<span id="cb329-10"><a href="#cb329-10" aria-hidden="true" tabindex="-1"></a><span class="co">#donnees_rbase[ave(rep(TRUE, nrow(donnees_rbase)), donnees_rbase$identifiant, FUN = function(z) seq_along(z) == 2L)]</span></span>
<span id="cb329-11"><a href="#cb329-11" aria-hidden="true" tabindex="-1"></a><span class="co">#ind &lt;- donnees_rbase[ave(rep(TRUE, nrow(donnees_rbase)), donnees_rbase$identifiant, FUN = function(z) length(z) == 1L | seq_along(z) == 2L)]</span></span></code></pre></div>
</div>
</div>
<div id="tabset-74-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-74-3-tab">
<div class="cell">
<div class="sourceCode" id="cb330"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les deux premières lignes</span></span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a>deux_premieres_lignes <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb330-4"><a href="#cb330-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span> </span>
<span id="cb330-5"><a href="#cb330-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb330-6"><a href="#cb330-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb330-7"><a href="#cb330-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-74-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-74-4-tab">
<div class="cell">
<div class="sourceCode" id="cb331"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a>deux_premieres_lignes <span class="ot">&lt;-</span> donnees_datatable[, .SD[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], by <span class="ot">=</span> identifiant]</span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Version en R Base</span></span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a><span class="co">#https://stackoverflow.com/questions/14800161/select-the-top-n-values-by-group</span></span></code></pre></div>
</div>
</div>
<div id="tabset-74-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-74-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="les-2-dernières-lignes-de-chaque-identifiant" class="level3" data-number="11.5.2">
<h3 data-number="11.5.2"><span class="header-section-number">11.5.2</span> Les 2 dernières lignes de chaque identifiant</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-75-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-75-1" role="tab" aria-controls="tabset-75-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-75-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-75-2" role="tab" aria-controls="tabset-75-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-75-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-75-3" role="tab" aria-controls="tabset-75-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-75-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-75-4" role="tab" aria-controls="tabset-75-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-75-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-75-5" role="tab" aria-controls="tabset-75-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-75-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-75-1-tab">
<div class="sourceCode" id="cb332"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Les 2 dernières lignes de chaque identifiant */</span></span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant numero_contrat<span class="kw">;run</span>;</span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb332-4"><a href="#cb332-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> * <span class="kw">from</span> donnees_sas <span class="kw">group</span> <span class="kw">by</span> identifiant</span>
<span id="cb332-5"><a href="#cb332-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">having</span> numero_contrat &gt;= count(*) - <span class="dv">1</span>;</span>
<span id="cb332-6"><a href="#cb332-6" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-75-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-75-2-tab">
<div class="cell">
<div class="sourceCode" id="cb333"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 premières lignes par identifiant (le premier si une seule ligne)</span></span>
<span id="cb333-2"><a href="#cb333-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Peut-on le faire en moins d&#39;étapes ??? Avec head ?</span></span>
<span id="cb333-3"><a href="#cb333-3" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>a <span class="ot">&lt;-</span> 1L</span>
<span id="cb333-4"><a href="#cb333-4" aria-hidden="true" tabindex="-1"></a><span class="co"># MISE EN GARDE : en utilisant la fonction ave, toujours précéder la fonction de FUN !</span></span>
<span id="cb333-5"><a href="#cb333-5" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>numero_contrat <span class="ot">&lt;-</span> <span class="fu">ave</span>(donnees_rbase<span class="sc">$</span>a, donnees_rbase<span class="sc">$</span>identifiant, <span class="at">FUN =</span> cumsum)</span>
<span id="cb333-6"><a href="#cb333-6" aria-hidden="true" tabindex="-1"></a>deux_premieres_lignes <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">which</span>(donnees_rbase<span class="sc">$</span>numero_contrat <span class="sc">&lt;=</span> <span class="dv">2</span>), ]</span>
<span id="cb333-7"><a href="#cb333-7" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>a <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb333-8"><a href="#cb333-8" aria-hidden="true" tabindex="-1"></a><span class="co"># REVOIR</span></span>
<span id="cb333-9"><a href="#cb333-9" aria-hidden="true" tabindex="-1"></a><span class="co"># MISE EN GARDE : en utilisant la fonction ave, toujours précéder la fonction de FUN !</span></span>
<span id="cb333-10"><a href="#cb333-10" aria-hidden="true" tabindex="-1"></a><span class="co">#donnees_rbase[ave(rep(TRUE, nrow(donnees_rbase)), donnees_rbase$identifiant, FUN = function(z) seq_along(z) == 2L)]</span></span>
<span id="cb333-11"><a href="#cb333-11" aria-hidden="true" tabindex="-1"></a><span class="co">#ind &lt;- donnees_rbase[ave(rep(TRUE, nrow(donnees_rbase)), donnees_rbase$identifiant, FUN = function(z) length(z) == 1L | seq_along(z) == 2L)]</span></span></code></pre></div>
</div>
</div>
<div id="tabset-75-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-75-3-tab">
<div class="cell">
<div class="sourceCode" id="cb334"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les deux dernières lignes</span></span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a>deux_dernieres_lignes <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb334-3"><a href="#cb334-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb334-4"><a href="#cb334-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span> </span>
<span id="cb334-5"><a href="#cb334-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb334-6"><a href="#cb334-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">n</span>() <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb334-7"><a href="#cb334-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-75-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-75-4-tab">
<div class="cell">
<div class="sourceCode" id="cb335"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a>deux_dernieres_lignes <span class="ot">&lt;-</span> donnees_datatable[, .SD[.N<span class="dv">-2</span><span class="sc">:</span>.N], by <span class="ot">=</span> identifiant]</span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Version en R Base</span></span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a><span class="co">#https://stackoverflow.com/questions/14800161/select-the-top-n-values-by-group</span></span></code></pre></div>
</div>
</div>
<div id="tabset-75-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-75-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="e-ligne-de-lindividu-et-rien-si-lindividu-a-1-seule-ligne" class="level3" data-number="11.5.3">
<h3 data-number="11.5.3"><span class="header-section-number">11.5.3</span> 2e ligne de l’individu (et rien si l’individu a 1 seule ligne)</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-76-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-76-1" role="tab" aria-controls="tabset-76-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-76-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-76-2" role="tab" aria-controls="tabset-76-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-76-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-76-3" role="tab" aria-controls="tabset-76-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-76-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-76-4" role="tab" aria-controls="tabset-76-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-76-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-76-5" role="tab" aria-controls="tabset-76-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-76-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-76-1-tab">
<div class="sourceCode" id="cb336"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant date_entree<span class="kw">;run</span>;</span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb336-4"><a href="#cb336-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> identifiant date_entree;</span>
<span id="cb336-5"><a href="#cb336-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">retain</span> numero_contrat <span class="dv">0</span>;</span>
<span id="cb336-6"><a href="#cb336-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> first.identifiant <span class="kw">then</span> numero_contrat = <span class="dv">1</span>;</span>
<span id="cb336-7"><a href="#cb336-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">else</span>                      numero_contrat = numero_contrat + <span class="dv">1</span>;</span>
<span id="cb336-8"><a href="#cb336-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb336-9"><a href="#cb336-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-10"><a href="#cb336-10" aria-hidden="true" tabindex="-1"></a><span class="co">/* 2 stratégies possibles */</span></span>
<span id="cb336-11"><a href="#cb336-11" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Deuxieme_Contrat;</span>
<span id="cb336-12"><a href="#cb336-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb336-13"><a href="#cb336-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> numero_contrat = <span class="dv">2</span>;</span>
<span id="cb336-14"><a href="#cb336-14" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb336-15"><a href="#cb336-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-16"><a href="#cb336-16" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Deuxieme_Contrat;</span>
<span id="cb336-17"><a href="#cb336-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">where</span> = (numero_contrat = <span class="dv">2</span>));</span>
<span id="cb336-18"><a href="#cb336-18" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-76-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-76-2-tab">
<div class="cell">
<div class="sourceCode" id="cb337"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec le numéro de contrat</span></span>
<span id="cb337-2"><a href="#cb337-2" aria-hidden="true" tabindex="-1"></a>deuxieme_ligne <span class="ot">&lt;-</span> donnees_rbase[donnees_rbase<span class="sc">$</span>numero_contrat <span class="sc">==</span> <span class="dv">2</span>, ]</span>
<span id="cb337-3"><a href="#cb337-3" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(donnees_rbase<span class="sc">$</span>identifiant, donnees_rbase<span class="sc">$</span>date_entre, <span class="at">na.last =</span> <span class="cn">FALSE</span>), ]</span>
<span id="cb337-4"><a href="#cb337-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb337-5"><a href="#cb337-5" aria-hidden="true" tabindex="-1"></a>donnees_rbase[<span class="fu">unlist</span>(<span class="fu">tapply</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(donnees_rbase)), donnees_rbase<span class="sc">$</span>identifiant, <span class="cf">function</span>(x) x[<span class="fu">length</span>(x)<span class="sc">-</span>(<span class="fu">length</span>(x)<span class="sc">-</span><span class="dv">1</span>)])), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-76-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-76-3-tab">
<div class="cell">
<div class="sourceCode" id="cb338"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span> </span>
<span id="cb338-5"><a href="#cb338-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb338-6"><a href="#cb338-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-76-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-76-4-tab">
<div class="cell">
<div class="sourceCode" id="cb339"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a>deuxieme_ligne <span class="ot">&lt;-</span> donnees_datatable[, .SD[<span class="dv">2</span>], by <span class="ot">=</span> identifiant]</span></code></pre></div>
</div>
</div>
<div id="tabset-76-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-76-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="lavant-dernière-ligne-de-lindividu-et-rien-si-lindividu-a-1-seul-contrat" class="level3" data-number="11.5.4">
<h3 data-number="11.5.4"><span class="header-section-number">11.5.4</span> L’avant-dernière ligne de l’individu (et rien si l’individu a 1 seul contrat)</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-77-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-77-1" role="tab" aria-controls="tabset-77-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-77-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-77-2" role="tab" aria-controls="tabset-77-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-77-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-77-3" role="tab" aria-controls="tabset-77-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-77-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-77-4" role="tab" aria-controls="tabset-77-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-77-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-77-5" role="tab" aria-controls="tabset-77-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-77-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-77-1-tab">
<div class="sourceCode" id="cb340"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Nécessite d&#39;avoir le numéro du contrat */</span></span>
<span id="cb340-2"><a href="#cb340-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb340-3"><a href="#cb340-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> * <span class="kw">from</span> donnees_sas <span class="kw">group</span> <span class="kw">by</span> identifiant</span>
<span id="cb340-4"><a href="#cb340-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">having</span> numero_contrat = count(*) - <span class="dv">1</span>;</span>
<span id="cb340-5"><a href="#cb340-5" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-77-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-77-2-tab">
<div class="cell">
<div class="sourceCode" id="cb341"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a>donnees_rbase[<span class="fu">unlist</span>(<span class="fu">tapply</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(donnees_rbase)), donnees_rbase<span class="sc">$</span>identifiant, <span class="cf">function</span>(x) x[<span class="fu">length</span>(x)<span class="sc">-</span><span class="dv">1</span>])), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-77-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-77-3-tab">
<div class="cell">
<div class="sourceCode" id="cb342"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb342-4"><a href="#cb342-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span> </span>
<span id="cb342-5"><a href="#cb342-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="fu">nth</span>(<span class="fu">row_number</span>(), <span class="sc">-</span><span class="dv">2</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-77-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-77-4-tab">
<div class="cell">
<div class="sourceCode" id="cb343"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, .SD[.N<span class="dv">-1</span>], by <span class="ot">=</span> identifiant]</span></code></pre></div>
</div>
</div>
<div id="tabset-77-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-77-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="sélection-par-groupement" class="level2" data-number="11.6">
<h2 data-number="11.6"><span class="header-section-number">11.6</span> Sélection par groupement</h2>
<section id="personnes-qui-ont-eu-au-moins-une-entrée-en-2022" class="level3" data-number="11.6.1">
<h3 data-number="11.6.1"><span class="header-section-number">11.6.1</span> Personnes qui ont eu au moins une entrée en 2022</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-78-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-78-1" role="tab" aria-controls="tabset-78-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-78-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-78-2" role="tab" aria-controls="tabset-78-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-78-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-78-3" role="tab" aria-controls="tabset-78-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-78-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-78-4" role="tab" aria-controls="tabset-78-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-78-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-78-5" role="tab" aria-controls="tabset-78-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-78-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-78-1-tab">
<div class="sourceCode" id="cb344"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Personnes qui ont eu au moins une entrée en 2022 */</span></span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> *</span>
<span id="cb344-4"><a href="#cb344-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> donnees_sas</span>
<span id="cb344-5"><a href="#cb344-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">group</span> <span class="kw">by</span> identifiant</span>
<span id="cb344-6"><a href="#cb344-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">having</span> <span class="fu">sum</span>(<span class="fu">year</span>(date_entree) = <span class="dv">2022</span>) &gt;= <span class="dv">1</span>;</span>
<span id="cb344-7"><a href="#cb344-7" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-78-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-78-2-tab">
<div class="cell">
<div class="sourceCode" id="cb345"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Personnes qui ont eu au moins une entrée en 2022</span></span>
<span id="cb345-2"><a href="#cb345-2" aria-hidden="true" tabindex="-1"></a>auMoins2022 <span class="ot">&lt;-</span> <span class="fu">subset</span>(donnees_rbase, identifiant <span class="sc">%in%</span> <span class="fu">unique</span>(identifiant[lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2022</span>)]))</span>
<span id="cb345-3"><a href="#cb345-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-4"><a href="#cb345-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution : ne semble possible que pour une seule variable</span></span>
<span id="cb345-5"><a href="#cb345-5" aria-hidden="true" tabindex="-1"></a><span class="co"># MISE EN GARDE : en utilisant la fonction ave, toujours précéder la fonction de FUN !</span></span>
<span id="cb345-6"><a href="#cb345-6" aria-hidden="true" tabindex="-1"></a>auMoins2022 <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">with</span>(donnees_rbase, <span class="fu">ave</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2022</span>), identifiant, <span class="at">FUN =</span> any)), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-78-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-78-3-tab">
<div class="cell">
<div class="sourceCode" id="cb346"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Personnes qui ont eu au moins une entrée en 2022</span></span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a>auMoins2022 <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span></span>
<span id="cb346-4"><a href="#cb346-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">any</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">==</span> <span class="dv">2022</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb346-5"><a href="#cb346-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb346-6"><a href="#cb346-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb346-7"><a href="#cb346-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou plus simplement</span></span>
<span id="cb346-8"><a href="#cb346-8" aria-hidden="true" tabindex="-1"></a>auMoins2022 <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb346-9"><a href="#cb346-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">any</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">==</span> <span class="dv">2022</span>), <span class="at">.by =</span> identifiant)</span></code></pre></div>
</div>
</div>
<div id="tabset-78-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-78-4-tab">
<div class="cell">
<div class="sourceCode" id="cb347"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Personnes qui ont eu au moins une entrée en 2022</span></span>
<span id="cb347-2"><a href="#cb347-2" aria-hidden="true" tabindex="-1"></a>auMoins2022 <span class="ot">&lt;-</span> donnees_datatable[, <span class="cf">if</span>(<span class="fu">any</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">%in%</span> <span class="dv">2022</span>)) .SD, by <span class="ot">=</span> identifiant]</span>
<span id="cb347-3"><a href="#cb347-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-4"><a href="#cb347-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb347-5"><a href="#cb347-5" aria-hidden="true" tabindex="-1"></a>auMoins2022 <span class="ot">&lt;-</span> donnees_datatable[, <span class="cf">if</span> (<span class="fu">sum</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">==</span> <span class="dv">2022</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">0</span>) .SD, by <span class="ot">=</span> identifiant]</span></code></pre></div>
</div>
</div>
<div id="tabset-78-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-78-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="personnes-qui-ont-suivi-à-la-fois-une-formation-qualifiée-et-une-formation-non-qualifiée" class="level3" data-number="11.6.2">
<h3 data-number="11.6.2"><span class="header-section-number">11.6.2</span> Personnes qui ont suivi à la fois une formation qualifiée et une formation non qualifiée</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-79-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-79-1" role="tab" aria-controls="tabset-79-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-79-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-79-2" role="tab" aria-controls="tabset-79-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-79-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-79-3" role="tab" aria-controls="tabset-79-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-79-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-79-4" role="tab" aria-controls="tabset-79-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-79-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-79-5" role="tab" aria-controls="tabset-79-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-79-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-79-1-tab">
<div class="sourceCode" id="cb348"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> Qualif_Non_Qualif <span class="kw">as</span></span>
<span id="cb348-3"><a href="#cb348-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> *</span>
<span id="cb348-4"><a href="#cb348-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> donnees_sas</span>
<span id="cb348-5"><a href="#cb348-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">group</span> <span class="kw">by</span> identifiant</span>
<span id="cb348-6"><a href="#cb348-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">having</span> <span class="fu">sum</span>(Niveau = <span class="st">&quot;Non qualifie&quot;</span>) &gt;= <span class="dv">1</span> <span class="kw">and</span> <span class="fu">sum</span>(Niveau = <span class="st">&quot;Non qualifie&quot;</span>) &gt;= <span class="dv">1</span>;</span>
<span id="cb348-7"><a href="#cb348-7" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-79-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-79-2-tab">
<div class="cell">
<div class="sourceCode" id="cb349"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Personnes qui ont suivi à la fois une formation qualifiée et une formation non qualifiée</span></span>
<span id="cb349-2"><a href="#cb349-2" aria-hidden="true" tabindex="-1"></a><span class="co"># MISE EN GARDE : en utilisant la fonction ave, toujours précéder la fonction de FUN !</span></span>
<span id="cb349-3"><a href="#cb349-3" aria-hidden="true" tabindex="-1"></a>qualif_non_qualif <span class="ot">&lt;-</span> <span class="fu">subset</span>(</span>
<span id="cb349-4"><a href="#cb349-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(donnees_rbase, </span>
<span id="cb349-5"><a href="#cb349-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">qualif     =</span> <span class="fu">ave</span>(niveau, identifiant, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">ifelse</span>(x <span class="sc">==</span> <span class="st">&quot;Qualifié&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), </span>
<span id="cb349-6"><a href="#cb349-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">non_qualif =</span> <span class="fu">ave</span>(niveau, identifiant, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">ifelse</span>(x <span class="sc">==</span> <span class="st">&quot;Non Qualifié&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))),</span>
<span id="cb349-7"><a href="#cb349-7" aria-hidden="true" tabindex="-1"></a>  qualif <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> non_qualif <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb349-8"><a href="#cb349-8" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/49669862/how-to-group-by-in-base-r</span></span></code></pre></div>
</div>
</div>
<div id="tabset-79-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-79-3-tab">
<div class="cell">
<div class="sourceCode" id="cb350"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Personnes qui ont suivi à la fois une formation qualifiée et une formation non qualifiée</span></span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a>qualif_non_qualif <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb350-3"><a href="#cb350-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span></span>
<span id="cb350-4"><a href="#cb350-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">any</span>(niveau <span class="sc">==</span> <span class="st">&quot;Qualifié&quot;</span>) <span class="sc">&amp;</span> <span class="fu">any</span>(niveau <span class="sc">==</span> <span class="st">&quot;Non qualifié&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb350-5"><a href="#cb350-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb350-6"><a href="#cb350-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-7"><a href="#cb350-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou plus simplement</span></span>
<span id="cb350-8"><a href="#cb350-8" aria-hidden="true" tabindex="-1"></a>qualif_non_qualif <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb350-9"><a href="#cb350-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">any</span>(niveau <span class="sc">==</span> <span class="st">&quot;Qualifié&quot;</span>) <span class="sc">&amp;</span> <span class="fu">any</span>(niveau <span class="sc">==</span> <span class="st">&quot;Non qualifié&quot;</span>), <span class="at">.by =</span> identifiant)</span></code></pre></div>
</div>
</div>
<div id="tabset-79-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-79-4-tab">
<div class="cell">
<div class="sourceCode" id="cb351"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Personnes qui ont suivi à la fois une formation qualifiée et une formation non qualifiée</span></span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-3"><a href="#cb351-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Méthode la plus simple</span></span>
<span id="cb351-4"><a href="#cb351-4" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="cf">if</span> (<span class="fu">sum</span>(niveau <span class="sc">==</span> <span class="st">&quot;Qualifié&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">sum</span>(niveau <span class="sc">==</span> <span class="st">&quot;Non qualifié&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">0</span>) .SD, by <span class="ot">=</span> identifiant]</span>
<span id="cb351-5"><a href="#cb351-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-6"><a href="#cb351-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre méthode</span></span>
<span id="cb351-7"><a href="#cb351-7" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span> (<span class="at">qualif =</span> <span class="fu">sum</span>(<span class="fu">fifelse</span>(niveau <span class="sc">==</span> <span class="st">&quot;Qualifié&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb351-8"><a href="#cb351-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">non_qualif =</span> <span class="fu">sum</span>(<span class="fu">fifelse</span>(niveau <span class="sc">==</span> <span class="st">&quot;Non qualifié&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb351-9"><a href="#cb351-9" aria-hidden="true" tabindex="-1"></a>                by <span class="ot">=</span> identifiant][qualif <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> non_qualif <span class="sc">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb351-10"><a href="#cb351-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-11"><a href="#cb351-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre méthode</span></span>
<span id="cb351-12"><a href="#cb351-12" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span> (<span class="at">qualif =</span> <span class="fu">sum</span>(niveau <span class="sc">==</span> <span class="st">&quot;Qualifié&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">non_qualif =</span> <span class="fu">sum</span>(niveau <span class="sc">==</span> <span class="st">&quot;Non qualifié&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), by <span class="ot">=</span> identifiant][qualif <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> non_qualif <span class="sc">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb351-13"><a href="#cb351-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-14"><a href="#cb351-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by et Having de SQL</span></span>
<span id="cb351-15"><a href="#cb351-15" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/Rdatatable/data.table/issues/788</span></span></code></pre></div>
</div>
</div>
<div id="tabset-79-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-79-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="personnes-qui-ont-suivi-deux-contrats-et-seulement-deux-dont-lun-au-moins-ayant-débuté-en-2022" class="level3" data-number="11.6.3">
<h3 data-number="11.6.3"><span class="header-section-number">11.6.3</span> Personnes qui ont suivi deux contrats, et seulement deux, dont l’un au moins ayant débuté en 2022</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-80-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-80-1" role="tab" aria-controls="tabset-80-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-80-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-80-2" role="tab" aria-controls="tabset-80-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-80-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-80-3" role="tab" aria-controls="tabset-80-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-80-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-80-4" role="tab" aria-controls="tabset-80-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-80-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-80-5" role="tab" aria-controls="tabset-80-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-80-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-80-1-tab">
<div class="sourceCode" id="cb352"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Personnes qui ont suivi deux contrats, et seulement deux, dont l&#39;un au moins ayant débuté en 2022 */</span></span>
<span id="cb352-2"><a href="#cb352-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb352-3"><a href="#cb352-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> Deux_Contrats <span class="kw">as</span></span>
<span id="cb352-4"><a href="#cb352-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> *</span>
<span id="cb352-5"><a href="#cb352-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> donnees_sas</span>
<span id="cb352-6"><a href="#cb352-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">group</span> <span class="kw">by</span> identifiant</span>
<span id="cb352-7"><a href="#cb352-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">having</span> count(*) = <span class="dv">2</span> <span class="kw">and</span> <span class="fu">sum</span>(<span class="fu">year</span>(date_entree) = <span class="dv">2022</span>) &gt;= <span class="dv">1</span>;</span>
<span id="cb352-8"><a href="#cb352-8" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-80-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-80-2-tab">
<div class="cell">
<div class="sourceCode" id="cb353"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Personnes qui ont suivi deux contrats, et seulement deux, dont l&#39;un au moins ayant débuté en 2022</span></span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a><span class="co"># MISE EN GARDE : en utilisant la fonction ave, toujours précéder la fonction de FUN !</span></span>
<span id="cb353-3"><a href="#cb353-3" aria-hidden="true" tabindex="-1"></a>deux_contrats <span class="ot">&lt;-</span> <span class="fu">subset</span>(</span>
<span id="cb353-4"><a href="#cb353-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(donnees_rbase, </span>
<span id="cb353-5"><a href="#cb353-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">nb =</span> <span class="fu">ave</span>(identifiant, identifiant, <span class="at">FUN =</span> length), </span>
<span id="cb353-6"><a href="#cb353-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">an =</span> <span class="fu">ave</span>(date_entree, identifiant, </span>
<span id="cb353-7"><a href="#cb353-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">FUN =</span> <span class="cf">function</span>(x) </span>
<span id="cb353-8"><a href="#cb353-8" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">sum</span>(<span class="fu">ifelse</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(x) <span class="sc">==</span> <span class="dv">2022</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))),</span>
<span id="cb353-9"><a href="#cb353-9" aria-hidden="true" tabindex="-1"></a>  nb <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> an <span class="sc">&gt;=</span> <span class="dv">1</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-80-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-80-3-tab">
<div class="cell">
<div class="sourceCode" id="cb354"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Personnes qui ont suivi deux contrats, et seulement deux, dont l&#39;un au moins ayant débuté en 2022</span></span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a>deux_contrats <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span></span>
<span id="cb354-4"><a href="#cb354-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb354-5"><a href="#cb354-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">any</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">==</span> <span class="dv">2022</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb354-6"><a href="#cb354-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb354-7"><a href="#cb354-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-8"><a href="#cb354-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou plus simplement</span></span>
<span id="cb354-9"><a href="#cb354-9" aria-hidden="true" tabindex="-1"></a>deux_contrats <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb354-10"><a href="#cb354-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">any</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">==</span> <span class="dv">2022</span> <span class="sc">&amp;</span> <span class="fu">n</span>() <span class="sc">==</span> <span class="dv">2</span>), <span class="at">.by =</span> identifiant)</span></code></pre></div>
</div>
</div>
<div id="tabset-80-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-80-4-tab">
<div class="cell">
<div class="sourceCode" id="cb355"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Personnes qui ont suivi deux contrats, et seulement deux, dont l&#39;un au moins ayant débuté en 2022</span></span>
<span id="cb355-2"><a href="#cb355-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="cf">if</span> (.N <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">sum</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">==</span> <span class="dv">2022</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;=</span> <span class="dv">1</span>) .SD, by <span class="ot">=</span> identifiant]</span></code></pre></div>
</div>
</div>
<div id="tabset-80-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-80-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="ajouter-une-colonne-désignant-la-note-moyenne-et-la-somme-de-note_contenu-par-individu" class="level2" data-number="11.7">
<h2 data-number="11.7"><span class="header-section-number">11.7</span> Ajouter une colonne désignant la note moyenne et la somme de Note_Contenu, par individu</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-81-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-81-1" role="tab" aria-controls="tabset-81-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-81-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-81-2" role="tab" aria-controls="tabset-81-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-81-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-81-3" role="tab" aria-controls="tabset-81-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-81-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-81-4" role="tab" aria-controls="tabset-81-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-81-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-81-5" role="tab" aria-controls="tabset-81-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-81-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-81-1-tab">
<div class="sourceCode" id="cb356"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* 1ère solution */</span></span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant<span class="kw">;run</span>;</span>
<span id="cb356-3"><a href="#cb356-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">mean</span> noprint;</span>
<span id="cb356-4"><a href="#cb356-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> Note_Contenu;</span>
<span id="cb356-5"><a href="#cb356-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> identifiant;</span>
<span id="cb356-6"><a href="#cb356-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">output</span> out = Temp;</span>
<span id="cb356-7"><a href="#cb356-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb356-8"><a href="#cb356-8" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Temp;</span>
<span id="cb356-9"><a href="#cb356-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> Temp (<span class="kw">where</span> = (_STAT_ = <span class="st">&quot;MEAN&quot;</span>));</span>
<span id="cb356-10"><a href="#cb356-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">keep</span> identifiant Note_Contenu;</span>
<span id="cb356-11"><a href="#cb356-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">rename</span> Note_Contenu = Note_Contenu_Moyenne;</span>
<span id="cb356-12"><a href="#cb356-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb356-13"><a href="#cb356-13" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb356-14"><a href="#cb356-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">merge</span> donnees_sas (<span class="kw">in</span> = a) Temp (<span class="kw">in</span> = b);</span>
<span id="cb356-15"><a href="#cb356-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> identifiant;</span>
<span id="cb356-16"><a href="#cb356-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> a;</span>
<span id="cb356-17"><a href="#cb356-17" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb356-18"><a href="#cb356-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-19"><a href="#cb356-19" aria-hidden="true" tabindex="-1"></a><span class="co">/* 2e solution : plus souple */</span></span>
<span id="cb356-20"><a href="#cb356-20" aria-hidden="true" tabindex="-1"></a><span class="co">/* Pour supprimer la variable ajoutée lors de la 1ère solution */</span></span>
<span id="cb356-21"><a href="#cb356-21" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb356-22"><a href="#cb356-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">drop</span> = Note_Contenu_Moyenne Note_Contenu_Somme);</span>
<span id="cb356-23"><a href="#cb356-23" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb356-24"><a href="#cb356-24" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb356-25"><a href="#cb356-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> donnees_sas <span class="kw">as</span></span>
<span id="cb356-26"><a href="#cb356-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> *</span>
<span id="cb356-27"><a href="#cb356-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> donnees_sas a <span class="fu">left</span> join</span>
<span id="cb356-28"><a href="#cb356-28" aria-hidden="true" tabindex="-1"></a>       (<span class="kw">select</span> identifiant,</span>
<span id="cb356-29"><a href="#cb356-29" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mean</span>(Note_Contenu) <span class="kw">as</span> Note_Contenu_Moyenne,</span>
<span id="cb356-30"><a href="#cb356-30" aria-hidden="true" tabindex="-1"></a>               <span class="fu">sum</span>(Note_Contenu) <span class="kw">as</span> Note_Contenu_Somme</span>
<span id="cb356-31"><a href="#cb356-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">from</span> donnees_sas <span class="kw">group</span> <span class="kw">by</span> identifiant) b</span>
<span id="cb356-32"><a href="#cb356-32" aria-hidden="true" tabindex="-1"></a>       <span class="kw">on</span> a.identifiant = b.identifiant</span>
<span id="cb356-33"><a href="#cb356-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span> <span class="kw">by</span> identifiant;</span>
<span id="cb356-34"><a href="#cb356-34" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-81-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-81-2-tab">
<div class="cell">
<div class="sourceCode" id="cb357"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MISE EN GARDE : en utilisant la fonction ave, toujours précéder la fonction de FUN !</span></span>
<span id="cb357-2"><a href="#cb357-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> <span class="fu">transform</span>(donnees_rbase, </span>
<span id="cb357-3"><a href="#cb357-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">note_contenu_moyenne =</span> <span class="fu">ave</span>(note_contenu, identifiant, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb357-4"><a href="#cb357-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">note_contenu_somme   =</span> <span class="fu">ave</span>(note_contenu, identifiant, <span class="at">FUN =</span> sum,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-81-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-81-3-tab">
<div class="cell">
<div class="sourceCode" id="cb358"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb358-2"><a href="#cb358-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span></span>
<span id="cb358-3"><a href="#cb358-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">note_contenu_moyenne =</span> <span class="fu">mean</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb358-4"><a href="#cb358-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">note_contenu_somme   =</span> <span class="fu">sum</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb358-5"><a href="#cb358-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-81-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-81-4-tab">
<div class="cell">
<div class="sourceCode" id="cb359"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span> (<span class="at">note_contenu_moyenne =</span> <span class="fu">mean</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb359-2"><a href="#cb359-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">note_contenu_somme =</span> <span class="fu">sum</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), by <span class="ot">=</span> identifiant]</span>
<span id="cb359-3"><a href="#cb359-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Moyenne de chaque note</span></span>
<span id="cb359-4"><a href="#cb359-4" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">c</span>(<span class="st">&quot;Note_Contenu&quot;</span>, <span class="st">&quot;Note_Formateur&quot;</span>, <span class="st">&quot;Note_Moyens&quot;</span>, <span class="st">&quot;Note_Accompagnement&quot;</span>, <span class="st">&quot;Note_Materiel&quot;</span>))</span>
<span id="cb359-5"><a href="#cb359-5" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">paste0</span>(notes, <span class="st">&quot;_m&quot;</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .SDcols <span class="ot">=</span> notes, keyby <span class="ot">=</span> identifiant]</span></code></pre></div>
</div>
</div>
<div id="tabset-81-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-81-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="ajout-dune-variable-dentrée-initiale-par-individu" class="level2" data-number="11.8">
<h2 data-number="11.8"><span class="header-section-number">11.8</span> Ajout d’une variable d’entrée initiale par individu</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-82-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-82-1" role="tab" aria-controls="tabset-82-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-82-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-82-2" role="tab" aria-controls="tabset-82-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-82-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-82-3" role="tab" aria-controls="tabset-82-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-82-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-82-4" role="tab" aria-controls="tabset-82-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-82-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-82-5" role="tab" aria-controls="tabset-82-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-82-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-82-1-tab">
<div class="sourceCode" id="cb360"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> Identifiant date_entree<span class="kw">;run</span>;</span>
<span id="cb360-2"><a href="#cb360-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb360-3"><a href="#cb360-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb360-4"><a href="#cb360-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> Identifiant date_entree;</span>
<span id="cb360-5"><a href="#cb360-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> premiere_entree ddmmyy10.;</span>
<span id="cb360-6"><a href="#cb360-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">retain</span> premiere_entree;</span>
<span id="cb360-7"><a href="#cb360-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> first.Identifiant <span class="kw">then</span> premiere_entree = date_entree;</span>
<span id="cb360-8"><a href="#cb360-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">else</span>                      premiere_entree = premiere_entree;</span>
<span id="cb360-9"><a href="#cb360-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-82-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-82-2-tab">
<div class="cell">
<div class="sourceCode" id="cb361"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(donnees_rbase<span class="sc">$</span>identifiant, donnees_rbase<span class="sc">$</span>date_entree, <span class="at">na.last =</span> <span class="cn">FALSE</span>), ]</span>
<span id="cb361-2"><a href="#cb361-2" aria-hidden="true" tabindex="-1"></a><span class="co"># MISE EN GARDE : en utilisant la fonction ave, toujours précéder la fonction de FUN !</span></span>
<span id="cb361-3"><a href="#cb361-3" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> <span class="fu">transform</span>(donnees_rbase,</span>
<span id="cb361-4"><a href="#cb361-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">premiere_entree =</span> <span class="fu">ave</span>(date_entree, identifiant, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">head</span>(x, <span class="dv">1</span>)))</span></code></pre></div>
</div>
</div>
<div id="tabset-82-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-82-3-tab">
<div class="cell">
<div class="sourceCode" id="cb362"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span></span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">premiere_entree =</span> <span class="fu">head</span>(date_entree, <span class="dv">1</span>), <span class="at">.by =</span> identifiant)</span>
<span id="cb362-5"><a href="#cb362-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-6"><a href="#cb362-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb362-7"><a href="#cb362-7" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb362-8"><a href="#cb362-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb362-9"><a href="#cb362-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span></span>
<span id="cb362-10"><a href="#cb362-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span></span>
<span id="cb362-11"><a href="#cb362-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">premiere_entree =</span> <span class="fu">case_when</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> date_entree,</span>
<span id="cb362-12"><a href="#cb362-12" aria-hidden="true" tabindex="-1"></a>                                     <span class="cn">TRUE</span>              <span class="sc">~</span> <span class="cn">NA</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb362-13"><a href="#cb362-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(premiere_entree, <span class="at">.direction =</span> <span class="fu">c</span>(<span class="st">&quot;down&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb362-14"><a href="#cb362-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-82-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-82-4-tab">
<div class="cell">
<div class="sourceCode" id="cb363"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setorderv</span>(donnees_datatable, <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;date_entree&quot;</span>), <span class="at">na.last =</span> <span class="cn">FALSE</span>)</span>
<span id="cb363-2"><a href="#cb363-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, premiere_entree <span class="sc">:</span><span class="er">=</span> <span class="fu">head</span>(date_entree, <span class="dv">1</span>), by <span class="ot">=</span> identifiant]</span></code></pre></div>
</div>
</div>
<div id="tabset-82-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-82-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="changement-détat-rleid-à-faire" class="level2" data-number="11.9">
<h2 data-number="11.9"><span class="header-section-number">11.9</span> Changement d’état (rleid) À FAIRE</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-83-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-83-1" role="tab" aria-controls="tabset-83-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-83-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-83-2" role="tab" aria-controls="tabset-83-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-83-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-83-3" role="tab" aria-controls="tabset-83-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-83-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-83-4" role="tab" aria-controls="tabset-83-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-83-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-83-5" role="tab" aria-controls="tabset-83-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-83-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-83-1-tab">
<div class="sourceCode" id="cb364"><pre class="sourceCode sas"><code class="sourceCode sas"></code></pre></div>
</div>
<div id="tabset-83-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-83-2-tab">
<div class="cell">

</div>
</div>
<div id="tabset-83-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-83-3-tab">
<div class="cell">

</div>
</div>
<div id="tabset-83-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-83-4-tab">
<div class="cell">

</div>
</div>
<div id="tabset-83-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-83-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="variable-retardée-lag" class="level2" data-number="11.10">
<h2 data-number="11.10"><span class="header-section-number">11.10</span> Variable retardée (lag)</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-84-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-84-1" role="tab" aria-controls="tabset-84-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-84-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-84-2" role="tab" aria-controls="tabset-84-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-84-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-84-3" role="tab" aria-controls="tabset-84-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-84-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-84-4" role="tab" aria-controls="tabset-84-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-84-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-84-5" role="tab" aria-controls="tabset-84-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-84-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-84-1-tab">
<div class="sourceCode" id="cb365"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* La date de fin du contrat précédent (lag) */</span></span>
<span id="cb365-2"><a href="#cb365-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant date_entree<span class="kw">;run</span>;</span>
<span id="cb365-3"><a href="#cb365-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sasBon;</span>
<span id="cb365-4"><a href="#cb365-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb365-5"><a href="#cb365-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> identifiant date_entree;  </span>
<span id="cb365-6"><a href="#cb365-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Date_fin_1 ddmmyy10.;</span>
<span id="cb365-7"><a href="#cb365-7" aria-hidden="true" tabindex="-1"></a>  Date_fin_1 = <span class="fu">lag</span>(Date_sortie);</span>
<span id="cb365-8"><a href="#cb365-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> first.identifiant <span class="kw">then</span> Date_fin_1 = .;</span>
<span id="cb365-9"><a href="#cb365-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb365-10"><a href="#cb365-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-11"><a href="#cb365-11" aria-hidden="true" tabindex="-1"></a><span class="co">/* ATTENTION au lag DANS UNE CONDITION IF (cf. document) */</span></span>
<span id="cb365-12"><a href="#cb365-12" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant date_entree<span class="kw">;run</span>;</span>
<span id="cb365-13"><a href="#cb365-13" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Lag_Bon;</span>
<span id="cb365-14"><a href="#cb365-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = identifiant date_entree date_sortie);</span>
<span id="cb365-15"><a href="#cb365-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> date_sortie_1 lag_faux lag_bon ddmmyy10.;</span>
<span id="cb365-16"><a href="#cb365-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Erreur */</span></span>
<span id="cb365-17"><a href="#cb365-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> date_entree = <span class="fu">lag</span>(date_sortie) + <span class="dv">1</span> <span class="kw">then</span> lag_faux = <span class="fu">lag</span>(date_sortie) + <span class="dv">1</span>;</span>
<span id="cb365-18"><a href="#cb365-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Bonne écriture */</span></span>
<span id="cb365-19"><a href="#cb365-19" aria-hidden="true" tabindex="-1"></a>  date_sortie_1 = <span class="fu">lag</span>(date_sortie);</span>
<span id="cb365-20"><a href="#cb365-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> date_entree = date_sortie_1 + <span class="dv">1</span> <span class="kw">then</span> lag_bon = date_sortie_1 + <span class="dv">1</span>;</span>
<span id="cb365-21"><a href="#cb365-21" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-84-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-84-2-tab">
<div class="cell">
<div class="sourceCode" id="cb366"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La date de fin du contrat précédent</span></span>
<span id="cb366-2"><a href="#cb366-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(donnees_rbase<span class="sc">$</span>identifiant, donnees_rbase<span class="sc">$</span>date_entre, <span class="at">na.last =</span> <span class="cn">FALSE</span>), ]</span>
<span id="cb366-3"><a href="#cb366-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Il n&#39;existe pas de fonction lag dans le R de base (à notre connaissance)</span></span>
<span id="cb366-4"><a href="#cb366-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Il faut soit utiliser un package, soit utiliser cette astuce</span></span>
<span id="cb366-5"><a href="#cb366-5" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>date_sortie_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="cn">NA</span>), donnees_rbase<span class="sc">$</span>date_sortie[ <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(donnees_rbase<span class="sc">$</span>date_sortie) <span class="sc">-</span> <span class="dv">1</span>)])</span>
<span id="cb366-6"><a href="#cb366-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Peut-on aussi utiliser tail(..., -1) ?</span></span>
<span id="cb366-7"><a href="#cb366-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb366-8"><a href="#cb366-8" aria-hidden="true" tabindex="-1"></a><span class="co"># La date du contrat futur (lead)</span></span>
<span id="cb366-9"><a href="#cb366-9" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>date_sortie__1 <span class="ot">&lt;-</span> <span class="fu">c</span>(donnees_rbase<span class="sc">$</span>date_sortie[ <span class="dv">2</span><span class="sc">:</span>(<span class="fu">length</span>(donnees_rbase<span class="sc">$</span>date_sortie))], <span class="fu">as.Date</span>(<span class="cn">NA</span>))</span>
<span id="cb366-10"><a href="#cb366-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb366-11"><a href="#cb366-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Autres solutions</span></span>
<span id="cb366-12"><a href="#cb366-12" aria-hidden="true" tabindex="-1"></a><span class="co">#https://stackoverflow.com/questions/3558988/basic-lag-in-r-vector-dataframe</span></span></code></pre></div>
</div>
</div>
<div id="tabset-84-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-84-3-tab">
<div class="cell">
<div class="sourceCode" id="cb367"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La date de fin du contrat précédent</span></span>
<span id="cb367-2"><a href="#cb367-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb367-3"><a href="#cb367-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb367-4"><a href="#cb367-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span> </span>
<span id="cb367-5"><a href="#cb367-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_sortie_1 =</span> <span class="fu">lag</span>(date_sortie))</span>
<span id="cb367-6"><a href="#cb367-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb367-7"><a href="#cb367-7" aria-hidden="true" tabindex="-1"></a><span class="co"># La date du contrat futur (lead)</span></span>
<span id="cb367-8"><a href="#cb367-8" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb367-9"><a href="#cb367-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb367-10"><a href="#cb367-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span> </span>
<span id="cb367-11"><a href="#cb367-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_sortie__1 =</span> <span class="fu">lead</span>(date_sortie))</span></code></pre></div>
</div>
</div>
<div id="tabset-84-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-84-4-tab">
<div class="cell">
<div class="sourceCode" id="cb368"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La date de fin du contrat précédent</span></span>
<span id="cb368-2"><a href="#cb368-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setorderv</span>(donnees_datatable, <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;date_entree&quot;</span>), <span class="at">order =</span> <span class="fu">c</span>(1L, 1L), <span class="at">na.last =</span> <span class="cn">FALSE</span>)</span>
<span id="cb368-3"><a href="#cb368-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, date_sortie_1 <span class="sc">:</span><span class="er">=</span> <span class="fu">shift</span>(.SD, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="st">&quot;lag&quot;</span>), .SDcols <span class="ot">=</span> <span class="st">&quot;date_sortie&quot;</span>]</span>
<span id="cb368-4"><a href="#cb368-4" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, .(date_sortie, date_sortie_1)]</span>
<span id="cb368-5"><a href="#cb368-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-6"><a href="#cb368-6" aria-hidden="true" tabindex="-1"></a><span class="co"># La date du contrat futur (lead)</span></span>
<span id="cb368-7"><a href="#cb368-7" aria-hidden="true" tabindex="-1"></a><span class="fu">setorderv</span>(donnees_datatable, <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;date_entree&quot;</span>), <span class="at">order =</span> <span class="fu">c</span>(1L, 1L), <span class="at">na.last =</span> <span class="cn">FALSE</span>)</span>
<span id="cb368-8"><a href="#cb368-8" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, date_sortie__1 <span class="sc">:</span><span class="er">=</span> <span class="fu">shift</span>(.SD, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="st">&quot;lead&quot;</span>), .SDcols <span class="ot">=</span> <span class="st">&quot;date_sortie&quot;</span>]</span>
<span id="cb368-9"><a href="#cb368-9" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, .(date_sortie, date_sortie__1)]</span>
<span id="cb368-10"><a href="#cb368-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-11"><a href="#cb368-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Autres solutions</span></span>
<span id="cb368-12"><a href="#cb368-12" aria-hidden="true" tabindex="-1"></a><span class="co">#https://stackoverflow.com/questions/3558988/basic-lag-in-r-vector-dataframe</span></span></code></pre></div>
</div>
</div>
<div id="tabset-84-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-84-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="gestion-par-rangées-de-lignes" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Gestion par rangées de lignes</h1>
<section id="sélectionner-les-lignes-avec-au-moins-une-note-inférieure-à-10" class="level2" data-number="12.1">
<h2 data-number="12.1"><span class="header-section-number">12.1</span> Sélectionner les lignes avec au moins une note inférieure à 10</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-85-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-85-1" role="tab" aria-controls="tabset-85-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-85-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-85-2" role="tab" aria-controls="tabset-85-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-85-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-85-3" role="tab" aria-controls="tabset-85-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-85-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-85-4" role="tab" aria-controls="tabset-85-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-85-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-85-5" role="tab" aria-controls="tabset-85-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-85-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-85-1-tab">
<div class="sourceCode" id="cb369"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> notes = Note_Contenu Note_Formateur Note_Moyens Note_Accompagnement Note_Materiel;</span>
<span id="cb369-2"><a href="#cb369-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Note_Inferieure_10;</span>
<span id="cb369-3"><a href="#cb369-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb369-4"><a href="#cb369-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb369-5"><a href="#cb369-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%macro</span> Inf10;</span>
<span id="cb369-6"><a href="#cb369-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%global</span> temp;</span>
<span id="cb369-7"><a href="#cb369-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%let</span> temp = ;</span>
<span id="cb369-8"><a href="#cb369-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%do</span> i = <span class="dv">1</span> <span class="kw">%to</span> <span class="kw">%sysfunc</span>(countw(<span class="kw">&amp;notes.</span>));</span>
<span id="cb369-9"><a href="#cb369-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">%let</span> j = <span class="kw">%scan</span>(<span class="kw">&amp;notes.</span>, <span class="kw">&amp;i.</span>);</span>
<span id="cb369-10"><a href="#cb369-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&amp;j.</span>_inf_10 = (<span class="kw">&amp;j.</span> &lt; <span class="dv">10</span> <span class="kw">and</span> <span class="kw">not</span> missing(<span class="kw">&amp;j.</span>));</span>
<span id="cb369-11"><a href="#cb369-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">%let</span> temp = <span class="kw">&amp;temp.</span> <span class="kw">&amp;j.</span>_inf_10;</span>
<span id="cb369-12"><a href="#cb369-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%end</span>;</span>
<span id="cb369-13"><a href="#cb369-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%mend</span> Inf10;</span>
<span id="cb369-14"><a href="#cb369-14" aria-hidden="true" tabindex="-1"></a>  %Inf10;</span>
<span id="cb369-15"><a href="#cb369-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb369-16"><a href="#cb369-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> <span class="fu">sum</span>(of <span class="kw">&amp;temp.</span>) &gt;= <span class="dv">1</span>;</span>
<span id="cb369-17"><a href="#cb369-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">drop</span> <span class="kw">&amp;temp.</span>;</span>
<span id="cb369-18"><a href="#cb369-18" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-85-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-85-2-tab">
<div class="cell">
<div class="sourceCode" id="cb370"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb370-2"><a href="#cb370-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase[<span class="fu">apply</span>(donnees_rbase[, varNotes], <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-85-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-85-3-tab">
<div class="cell">
<div class="sourceCode" id="cb371"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb371-2"><a href="#cb371-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb371-3"><a href="#cb371-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">if_any</span>(varNotes, <span class="sc">~</span> .x <span class="sc">&lt;</span> <span class="dv">10</span>))</span>
<span id="cb371-4"><a href="#cb371-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-5"><a href="#cb371-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb371-6"><a href="#cb371-6" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb371-7"><a href="#cb371-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_at</span>(varNotes, <span class="fu">any_vars</span>(. <span class="sc">&lt;</span> <span class="dv">10</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-85-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-85-4-tab">
<div class="cell">
<div class="sourceCode" id="cb372"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb372-2"><a href="#cb372-2" aria-hidden="true" tabindex="-1"></a>note_moins_10 <span class="ot">&lt;-</span> donnees_datatable[donnees_datatable[, .I[<span class="fu">rowSums</span>(.SD <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;=</span> <span class="dv">1</span>], .SDcols <span class="ot">=</span> varNotes]]</span>
<span id="cb372-3"><a href="#cb372-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-4"><a href="#cb372-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb372-5"><a href="#cb372-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Le Reduce(`|`, ...) permet d&#39;appliquer la condition | (ou) à tous les élements de la ligne, qui sont une vérification d&#39;un nb &lt; 10</span></span>
<span id="cb372-6"><a href="#cb372-6" aria-hidden="true" tabindex="-1"></a>note_moins_10 <span class="ot">&lt;-</span> donnees_datatable[donnees_datatable[, <span class="fu">Reduce</span>(<span class="st">`</span><span class="at">|</span><span class="st">`</span>, <span class="fu">lapply</span>(.SD, <span class="st">`</span><span class="at">&lt;</span><span class="st">`</span>, <span class="dv">10</span>)), .SDcols <span class="ot">=</span> varNotes]]</span>
<span id="cb372-7"><a href="#cb372-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-8"><a href="#cb372-8" aria-hidden="true" tabindex="-1"></a><span class="co"># https://arelbundock.com/posts/datatable_rowwise/</span></span></code></pre></div>
</div>
</div>
<div id="tabset-85-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-85-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="sélectionner-les-lignes-avec-toutes-les-notes-supérieurs-à-10" class="level2" data-number="12.2">
<h2 data-number="12.2"><span class="header-section-number">12.2</span> Sélectionner les lignes avec toutes les notes supérieurs à 10</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-86-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-86-1" role="tab" aria-controls="tabset-86-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-86-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-86-2" role="tab" aria-controls="tabset-86-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-86-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-86-3" role="tab" aria-controls="tabset-86-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-86-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-86-4" role="tab" aria-controls="tabset-86-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-86-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-86-5" role="tab" aria-controls="tabset-86-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-86-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-86-1-tab">
<div class="sourceCode" id="cb373"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> notes = Note_Contenu Note_Formateur Note_Moyens Note_Accompagnement Note_Materiel;</span>
<span id="cb373-2"><a href="#cb373-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Note_Sup_10;</span>
<span id="cb373-3"><a href="#cb373-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb373-4"><a href="#cb373-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb373-5"><a href="#cb373-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%macro</span> Inf10;</span>
<span id="cb373-6"><a href="#cb373-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%global</span> temp;</span>
<span id="cb373-7"><a href="#cb373-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%let</span> temp = ;</span>
<span id="cb373-8"><a href="#cb373-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%do</span> i = <span class="dv">1</span> <span class="kw">%to</span> <span class="kw">%sysfunc</span>(countw(<span class="kw">&amp;notes.</span>));</span>
<span id="cb373-9"><a href="#cb373-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">%let</span> j = <span class="kw">%scan</span>(<span class="kw">&amp;notes.</span>, <span class="kw">&amp;i.</span>);</span>
<span id="cb373-10"><a href="#cb373-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&amp;j.</span>_sup_10 = (<span class="kw">&amp;j.</span> &gt;= <span class="dv">10</span>);</span>
<span id="cb373-11"><a href="#cb373-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">%let</span> temp = <span class="kw">&amp;temp.</span> <span class="kw">&amp;j.</span>_sup_10;</span>
<span id="cb373-12"><a href="#cb373-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%end</span>;</span>
<span id="cb373-13"><a href="#cb373-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%mend</span> Inf10;</span>
<span id="cb373-14"><a href="#cb373-14" aria-hidden="true" tabindex="-1"></a>  %Inf10;</span>
<span id="cb373-15"><a href="#cb373-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb373-16"><a href="#cb373-16" aria-hidden="true" tabindex="-1"></a>  a = <span class="fu">sum</span>(of <span class="kw">&amp;temp.</span>);</span>
<span id="cb373-17"><a href="#cb373-17" aria-hidden="true" tabindex="-1"></a>  b = <span class="kw">%sysfunc</span>(countw(<span class="kw">&amp;notes.</span>));</span>
<span id="cb373-18"><a href="#cb373-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> <span class="fu">sum</span>(of <span class="kw">&amp;temp.</span>) = <span class="kw">%sysfunc</span>(countw(<span class="kw">&amp;notes.</span>));</span>
<span id="cb373-19"><a href="#cb373-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">drop</span> <span class="kw">&amp;temp.</span>;</span>
<span id="cb373-20"><a href="#cb373-20" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-86-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-86-2-tab">
<div class="cell">
<div class="sourceCode" id="cb374"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb374-2"><a href="#cb374-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-3"><a href="#cb374-3" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : REVOIR LE PB DES VALEURS MANQUANTES !!!!</span></span>
<span id="cb374-4"><a href="#cb374-4" aria-hidden="true" tabindex="-1"></a>donnees_rbase[<span class="fu">apply</span>(donnees_rbase[, varNotes], <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">all</span>(x <span class="sc">&gt;=</span> <span class="dv">10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-86-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-86-3-tab">
<div class="cell">
<div class="sourceCode" id="cb375"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb375-2"><a href="#cb375-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb375-3"><a href="#cb375-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">if_all</span>(varNotes, <span class="sc">~</span> . <span class="sc">&gt;=</span> <span class="dv">10</span>))</span>
<span id="cb375-4"><a href="#cb375-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-5"><a href="#cb375-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb375-6"><a href="#cb375-6" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb375-7"><a href="#cb375-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_at</span>(varNotes, <span class="fu">all_vars</span>(. <span class="sc">&gt;=</span> <span class="dv">10</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-86-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-86-4-tab">
<div class="cell">
<div class="sourceCode" id="cb376"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb376-2"><a href="#cb376-2" aria-hidden="true" tabindex="-1"></a>note_sup_10 <span class="ot">&lt;-</span> donnees_datatable[</span>
<span id="cb376-3"><a href="#cb376-3" aria-hidden="true" tabindex="-1"></a>  donnees_datatable[, .I[<span class="fu">rowSums</span>(.SD <span class="sc">&gt;=</span> <span class="dv">10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">==</span> <span class="fu">length</span>(varNotes)], .SDcols <span class="ot">=</span> varNotes]]</span>
<span id="cb376-4"><a href="#cb376-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-5"><a href="#cb376-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb376-6"><a href="#cb376-6" aria-hidden="true" tabindex="-1"></a>note_sup_10 <span class="ot">&lt;-</span> donnees_datatable[donnees_datatable[, <span class="fu">Reduce</span>(<span class="st">`</span><span class="at">&amp;</span><span class="st">`</span>, <span class="fu">lapply</span>(.SD, <span class="st">`</span><span class="at">&gt;=</span><span class="st">`</span>, <span class="dv">10</span>)), .SDcols <span class="ot">=</span> varNotes]]</span></code></pre></div>
</div>
</div>
<div id="tabset-86-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-86-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="moyenne-par-ligne" class="level2" data-number="12.3">
<h2 data-number="12.3"><span class="header-section-number">12.3</span> Moyenne par ligne</h2>
<section id="moyenne-par-ligne-1" class="level3" data-number="12.3.1">
<h3 data-number="12.3.1"><span class="header-section-number">12.3.1</span> Moyenne par ligne</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-87-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-87-1" role="tab" aria-controls="tabset-87-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-87-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-87-2" role="tab" aria-controls="tabset-87-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-87-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-87-3" role="tab" aria-controls="tabset-87-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-87-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-87-4" role="tab" aria-controls="tabset-87-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-87-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-87-5" role="tab" aria-controls="tabset-87-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-87-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-87-1-tab">
<div class="sourceCode" id="cb377"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Pour chaque observation, 5 notes sont renseignées. On calcule la moyenne de ces 5 notes pour chaque ligne */</span></span>
<span id="cb377-2"><a href="#cb377-2" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> notes = Note_Contenu Note_Formateur Note_Moyens Note_Accompagnement Note_Materiel;</span>
<span id="cb377-3"><a href="#cb377-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb377-4"><a href="#cb377-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb377-5"><a href="#cb377-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb377-6"><a href="#cb377-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 1ère solution */</span></span>
<span id="cb377-7"><a href="#cb377-7" aria-hidden="true" tabindex="-1"></a>  Note_moyenne    = <span class="fu">mean</span>(of <span class="kw">&amp;notes.</span>);</span>
<span id="cb377-8"><a href="#cb377-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb377-9"><a href="#cb377-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 2e solution : l&#39;équivalent des list-comprehension de Python en SAS */</span></span>
<span id="cb377-10"><a href="#cb377-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%macro</span> List_comprehension;</span>
<span id="cb377-11"><a href="#cb377-11" aria-hidden="true" tabindex="-1"></a>    Note_moyenne2 = <span class="fu">mean</span>(of <span class="kw">%do</span> i = <span class="dv">1</span> <span class="kw">%to</span> <span class="kw">%sysfunc</span>(countw(<span class="kw">&amp;notes.</span>));</span>
<span id="cb377-12"><a href="#cb377-12" aria-hidden="true" tabindex="-1"></a>                          <span class="kw">%let</span> j = <span class="kw">%scan</span>(<span class="kw">&amp;notes.</span>, <span class="kw">&amp;i.</span>);</span>
<span id="cb377-13"><a href="#cb377-13" aria-hidden="true" tabindex="-1"></a>                          <span class="kw">&amp;j.</span></span>
<span id="cb377-14"><a href="#cb377-14" aria-hidden="true" tabindex="-1"></a>                         <span class="kw">%end</span>;);;</span>
<span id="cb377-15"><a href="#cb377-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%mend</span> List_comprehension;</span>
<span id="cb377-16"><a href="#cb377-16" aria-hidden="true" tabindex="-1"></a>  %List_comprehension;</span>
<span id="cb377-17"><a href="#cb377-17" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-87-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-87-2-tab">
<div class="cell">
<div class="sourceCode" id="cb378"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb378-1"><a href="#cb378-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour chaque observation, 5 notes sont renseignées. On calcule la moyenne de ces 5 notes pour chaque ligne</span></span>
<span id="cb378-2"><a href="#cb378-2" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">c</span>(<span class="st">&quot;Note_Contenu&quot;</span>, <span class="st">&quot;Note_Formateur&quot;</span>, <span class="st">&quot;Note_Moyens&quot;</span>, <span class="st">&quot;Note_Accompagnement&quot;</span>, <span class="st">&quot;Note_Materiel&quot;</span>))</span>
<span id="cb378-3"><a href="#cb378-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-4"><a href="#cb378-4" aria-hidden="true" tabindex="-1"></a><span class="co"># apply permet d&#39;appliquer une fonctions aux lignes (1) ou colonnes (2) d&#39;un data.frame</span></span>
<span id="cb378-5"><a href="#cb378-5" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>note_moyenne <span class="ot">&lt;-</span> <span class="fu">apply</span>(donnees_rbase[, varNotes], <span class="dv">1</span>, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-87-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-87-3-tab">
<div class="cell">
<div class="sourceCode" id="cb379"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour chaque observation, 5 notes sont renseignées. On calcule la moyenne de ces 5 notes pour chaque ligne</span></span>
<span id="cb379-2"><a href="#cb379-2" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">c</span>(<span class="st">&quot;Note_Contenu&quot;</span>, <span class="st">&quot;Note_Formateur&quot;</span>, <span class="st">&quot;Note_Moyens&quot;</span>, <span class="st">&quot;Note_Accompagnement&quot;</span>, <span class="st">&quot;Note_Materiel&quot;</span>))</span>
<span id="cb379-3"><a href="#cb379-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Codes à privilégier</span></span>
<span id="cb379-4"><a href="#cb379-4" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb379-5"><a href="#cb379-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">note_moyenne =</span> <span class="fu">rowMeans</span>(<span class="fu">pick</span>(<span class="fu">all_of</span>(varNotes)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb379-6"><a href="#cb379-6" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb379-7"><a href="#cb379-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">note_moyenne =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(varNotes)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb379-8"><a href="#cb379-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb379-9"><a href="#cb379-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative lente</span></span>
<span id="cb379-10"><a href="#cb379-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Noter l&#39;utilisation de c_across dans ce cas de figure pour traiter automatiquement plusieurs variables</span></span>
<span id="cb379-11"><a href="#cb379-11" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb379-12"><a href="#cb379-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb379-13"><a href="#cb379-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">note_moyenne =</span> <span class="fu">mean</span>(<span class="fu">c_across</span>(<span class="fu">all_of</span>(varNotes)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb379-14"><a href="#cb379-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-87-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-87-4-tab">
<div class="cell">
<div class="sourceCode" id="cb380"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour chaque observation, 5 notes sont renseignées. On calcule la moyenne de ces 5 notes pour chaque ligne</span></span>
<span id="cb380-2"><a href="#cb380-2" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>,<span class="st">&quot;note_formateur&quot;</span>,<span class="st">&quot;note_moyens&quot;</span>,<span class="st">&quot;note_accompagnement&quot;</span>,<span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb380-3"><a href="#cb380-3" aria-hidden="true" tabindex="-1"></a><span class="co"># On souhaite moyenner les notes par formation</span></span>
<span id="cb380-4"><a href="#cb380-4" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, note_moyenne <span class="sc">:</span><span class="er">=</span> <span class="fu">rowMeans</span>(.SD, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .SDcols <span class="ot">=</span> varNotes]</span>
<span id="cb380-5"><a href="#cb380-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-6"><a href="#cb380-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Manière alternative, qui ne semble pas fonctionner</span></span>
<span id="cb380-7"><a href="#cb380-7" aria-hidden="true" tabindex="-1"></a><span class="co">#donnees_datatable[, note_moyenne := Reduce(function(...) sum(..., na.rm = TRUE), .SD),</span></span>
<span id="cb380-8"><a href="#cb380-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                  .SDcols = varNotes,</span></span>
<span id="cb380-9"><a href="#cb380-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                  by = 1:nrow(donnees_datatable)]</span></span>
<span id="cb380-10"><a href="#cb380-10" aria-hidden="true" tabindex="-1"></a><span class="co">#donnees_datatable[, do.call(function(x, y) sum(x, y, na.rm = TRUE), .SD), .SDcols = varNotes, by = 1:nrow(donnees_datatable)]</span></span></code></pre></div>
</div>
</div>
<div id="tabset-87-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-87-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="moyenne-des-moyennes-ligne" class="level3" data-number="12.3.2">
<h3 data-number="12.3.2"><span class="header-section-number">12.3.2</span> Moyenne des moyennes ligne</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-88-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-88-1" role="tab" aria-controls="tabset-88-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-88-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-88-2" role="tab" aria-controls="tabset-88-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-88-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-88-3" role="tab" aria-controls="tabset-88-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-88-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-88-4" role="tab" aria-controls="tabset-88-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-88-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-88-5" role="tab" aria-controls="tabset-88-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-88-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-88-1-tab">
<div class="sourceCode" id="cb381"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Note moyenne (moyenne des moyennes), non pondérée et pondérée */</span></span>
<span id="cb381-2"><a href="#cb381-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">mean</span>;<span class="fu">var</span> Note_moyenne<span class="kw">;run</span>;</span>
<span id="cb381-3"><a href="#cb381-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">mean</span>;<span class="fu">var</span> Note_moyenne;weight poids_sondage<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-88-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-88-2-tab">
<div class="cell">
<div class="sourceCode" id="cb382"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note moyenne (moyenne des moyennes), non pondérée et pondérée</span></span>
<span id="cb382-2"><a href="#cb382-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(donnees_rbase<span class="sc">$</span>note_moyenne, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb382-3"><a href="#cb382-3" aria-hidden="true" tabindex="-1"></a><span class="fu">weighted.mean</span>(donnees_rbase<span class="sc">$</span>note_moyenne, donnees_rbase<span class="sc">$</span>poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-88-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-88-3-tab">
<div class="cell">
<div class="sourceCode" id="cb383"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb383-1"><a href="#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note moyenne (moyenne des moyennes) non pondérée</span></span>
<span id="cb383-2"><a href="#cb383-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">pull</span>(note_moyenne) <span class="sc">%&gt;%</span> <span class="fu">mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb383-3"><a href="#cb383-3" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">Moyenne =</span> <span class="fu">mean</span>(note_moyenne, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb383-4"><a href="#cb383-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb383-5"><a href="#cb383-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Note moyenne (moyenne des moyennes) pondérée</span></span>
<span id="cb383-6"><a href="#cb383-6" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">Moyenne_ponderee =</span> <span class="fu">weighted.mean</span>(note_moyenne, poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-88-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-88-4-tab">
<div class="cell">
<div class="sourceCode" id="cb384"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note moyenne (moyenne des moyennes), non pondérée et pondérée</span></span>
<span id="cb384-2"><a href="#cb384-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">mean</span>(note_moyenne, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb384-3"><a href="#cb384-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">weighted.mean</span>(note_moyenne, poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)]</span></code></pre></div>
</div>
</div>
<div id="tabset-88-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-88-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="la-moyenne-par-ligne-est-est-elle-supérieure-à-la-moyenne" class="level3" data-number="12.3.3">
<h3 data-number="12.3.3"><span class="header-section-number">12.3.3</span> La moyenne par ligne est est-elle supérieure à la moyenne ?</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-89-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-89-1" role="tab" aria-controls="tabset-89-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-89-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-89-2" role="tab" aria-controls="tabset-89-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-89-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-89-3" role="tab" aria-controls="tabset-89-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-89-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-89-4" role="tab" aria-controls="tabset-89-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-89-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-89-5" role="tab" aria-controls="tabset-89-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-89-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-89-1-tab">
<div class="sourceCode" id="cb385"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* On crée une macro-variable SAS à partir de la valeur de la moyenne */</span></span>
<span id="cb385-2"><a href="#cb385-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql noprint;<span class="kw">select</span> <span class="fu">mean</span>(Note_moyenne) <span class="kw">into</span> :moyenne <span class="kw">from</span> donnees_sas;<span class="kw">quit</span>;</span>
<span id="cb385-3"><a href="#cb385-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb385-4"><a href="#cb385-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb385-5"><a href="#cb385-5" aria-hidden="true" tabindex="-1"></a>  Note_Superieure_Moyenne = (Note_moyenne &gt; <span class="kw">&amp;moyenne.</span>);</span>
<span id="cb385-6"><a href="#cb385-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb385-7"><a href="#cb385-7" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;tables Note_Superieure_Moyenne<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-89-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-89-2-tab">
<div class="cell">
<div class="sourceCode" id="cb386"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a>moyenne <span class="ot">&lt;-</span> <span class="fu">mean</span>(donnees_rbase<span class="sc">$</span>note_moyenne, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>note_superieure_moyenne <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(donnees_rbase<span class="sc">$</span>note_moyenne <span class="sc">&gt;</span> moyenne, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb386-3"><a href="#cb386-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(donnees_rbase<span class="sc">$</span>note_superieure_moyenne, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-89-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-89-3-tab">
<div class="cell">
<div class="sourceCode" id="cb387"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a>moyenne <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">pull</span>(note_moyenne) <span class="sc">%&gt;%</span> <span class="fu">mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb387-2"><a href="#cb387-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">note_superieure_moyenne =</span> <span class="fu">ifelse</span>(note_moyenne <span class="sc">&gt;</span> moyenne, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb387-3"><a href="#cb387-3" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">pull</span>(note_superieure_moyenne) <span class="sc">%&gt;%</span> <span class="fu">table</span>(<span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-89-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-89-4-tab">
<div class="cell">
<div class="sourceCode" id="cb388"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a>moyenne <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">mean</span>(note_moyenne, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, note_superieure_moyenne <span class="sc">:</span><span class="er">=</span> <span class="fu">fcase</span>(note_moyenne <span class="sc">&gt;=</span> moyenne, <span class="dv">1</span>,</span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a>                                                     note_moyenne <span class="sc">&lt;</span>  moyenne, <span class="dv">0</span>)]</span>
<span id="cb388-4"><a href="#cb388-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(donnees_datatable<span class="sc">$</span>note_superieure_moyenne, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-89-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-89-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="moyenne-pondérée-par-ligne" class="level2" data-number="12.4">
<h2 data-number="12.4"><span class="header-section-number">12.4</span> Moyenne pondérée par ligne</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-90-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-90-1" role="tab" aria-controls="tabset-90-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-90-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-90-2" role="tab" aria-controls="tabset-90-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-90-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-90-3" role="tab" aria-controls="tabset-90-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-90-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-90-4" role="tab" aria-controls="tabset-90-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-90-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-90-5" role="tab" aria-controls="tabset-90-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-90-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-90-1-tab">
<div class="sourceCode" id="cb389"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* On souhaite affecter les pondérations suivantes aux notes :</span></span>
<span id="cb389-2"><a href="#cb389-2" aria-hidden="true" tabindex="-1"></a><span class="co">Note_Contenu : 30%, Note_Formateur : 20%, Note_Moyens : 25%, Note_Accompagnement : 15%, Note_Materiel : 10% */</span></span>
<span id="cb389-3"><a href="#cb389-3" aria-hidden="true" tabindex="-1"></a><span class="co">/* Voici une solution possible. Une alternative intéressante serait de passer par IML (non traité ici) */</span></span>
<span id="cb389-4"><a href="#cb389-4" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> ponderation = <span class="dv">0.3</span> <span class="dv">0.2</span> <span class="dv">0.25</span> <span class="dv">0.15</span> <span class="dv">0.10</span>;</span>
<span id="cb389-5"><a href="#cb389-5" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> notes = Note_Contenu Note_Formateur Note_Moyens Note_Accompagnement Note_Materiel;</span>
<span id="cb389-6"><a href="#cb389-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-7"><a href="#cb389-7" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb389-8"><a href="#cb389-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb389-9"><a href="#cb389-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb389-10"><a href="#cb389-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%macro</span> Somme_pond;</span>
<span id="cb389-11"><a href="#cb389-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%global</span> temp;</span>
<span id="cb389-12"><a href="#cb389-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">%let</span> temp = ;</span>
<span id="cb389-13"><a href="#cb389-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%do</span> i = <span class="dv">1</span> <span class="kw">%to</span> <span class="kw">%sysfunc</span>(countw(<span class="kw">&amp;notes.</span>));</span>
<span id="cb389-14"><a href="#cb389-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">%let</span> k = <span class="kw">%scan</span>(<span class="kw">&amp;notes.</span>, <span class="kw">&amp;i.</span>);</span>
<span id="cb389-15"><a href="#cb389-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">%let</span> l = <span class="kw">%scan</span>(<span class="kw">&amp;ponderation.</span>, <span class="kw">&amp;i.</span>, <span class="kw">%str</span>( ));</span>
<span id="cb389-16"><a href="#cb389-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&amp;k.</span>_pond = <span class="kw">&amp;k.</span> * <span class="kw">&amp;l.</span>;</span>
<span id="cb389-17"><a href="#cb389-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">%let</span> temp = <span class="kw">&amp;temp.</span> <span class="kw">&amp;k.</span>_pond;</span>
<span id="cb389-18"><a href="#cb389-18" aria-hidden="true" tabindex="-1"></a>      <span class="kw">%end</span>;</span>
<span id="cb389-19"><a href="#cb389-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%mend</span> Somme_pond;</span>
<span id="cb389-20"><a href="#cb389-20" aria-hidden="true" tabindex="-1"></a>  %Somme_pond;</span>
<span id="cb389-21"><a href="#cb389-21" aria-hidden="true" tabindex="-1"></a>  Note_moyenne_pond = <span class="fu">sum</span>(of <span class="kw">&amp;temp.</span>);</span>
<span id="cb389-22"><a href="#cb389-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">drop</span> <span class="kw">&amp;temp.</span>;</span>
<span id="cb389-23"><a href="#cb389-23" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb389-24"><a href="#cb389-24" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">mean</span>;<span class="fu">var</span> Note_moyenne_pond<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-90-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-90-2-tab">
<div class="cell">
<div class="sourceCode" id="cb390"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On calcule de nouveau cette moyenne, mais en pondérant</span></span>
<span id="cb390-2"><a href="#cb390-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb390-3"><a href="#cb390-3" aria-hidden="true" tabindex="-1"></a><span class="co"># On souhaite affecter les pondérations suivantes aux notes :</span></span>
<span id="cb390-4"><a href="#cb390-4" aria-hidden="true" tabindex="-1"></a><span class="co"># note_contenu : 30%, note_formateur : 20%, note_moyens : 25%, note_accompagnement : 15%, note_materiel : 10%</span></span>
<span id="cb390-5"><a href="#cb390-5" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb390-6"><a href="#cb390-6" aria-hidden="true" tabindex="-1"></a>ponderation <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">note_contenu =</span> <span class="dv">30</span>, <span class="at">note_formateur =</span> <span class="dv">20</span>, <span class="at">note_moyens =</span> <span class="dv">25</span>, <span class="at">note_accompagnement =</span> <span class="dv">15</span>, <span class="at">note_materiel =</span> <span class="dv">10</span>) <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb390-7"><a href="#cb390-7" aria-hidden="true" tabindex="-1"></a><span class="co"># On vérifie que la somme des poids vaut 1</span></span>
<span id="cb390-8"><a href="#cb390-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ponderation)</span>
<span id="cb390-9"><a href="#cb390-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb390-10"><a href="#cb390-10" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>note_moyennepond <span class="ot">&lt;-</span> <span class="fu">apply</span>(donnees_rbase[, notes], <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">weighted.mean</span>(x, ponderation, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb390-11"><a href="#cb390-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb390-12"><a href="#cb390-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre manière, en exploitant le calcul matriciel</span></span>
<span id="cb390-13"><a href="#cb390-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Ne fonctionne pas, du fait des NA</span></span>
<span id="cb390-14"><a href="#cb390-14" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(donnees_rbase[, notes]) <span class="sc">%*%</span> <span class="fu">as.matrix</span>(ponderation)</span>
<span id="cb390-15"><a href="#cb390-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Produit élément par élément</span></span>
<span id="cb390-16"><a href="#cb390-16" aria-hidden="true" tabindex="-1"></a><span class="co"># On peut procéder par produit matriciel</span></span>
<span id="cb390-17"><a href="#cb390-17" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(donnees_rbase[, notes]) <span class="sc">*</span> <span class="fu">matrix</span>(<span class="fu">t</span>(<span class="fu">as.matrix</span>(ponderation)), <span class="fu">nrow</span>(donnees_rbase), <span class="dv">5</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-90-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-90-3-tab">
<div class="cell">
<div class="sourceCode" id="cb391"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb391-1"><a href="#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On calcule de nouveau cette moyenne, mais en pondérant</span></span>
<span id="cb391-2"><a href="#cb391-2" aria-hidden="true" tabindex="-1"></a><span class="co"># La fonction RowMeans ne fonctionne plus, cette fois !</span></span>
<span id="cb391-3"><a href="#cb391-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb391-4"><a href="#cb391-4" aria-hidden="true" tabindex="-1"></a><span class="co"># On souhaite affecter les pondérations suivantes aux notes :</span></span>
<span id="cb391-5"><a href="#cb391-5" aria-hidden="true" tabindex="-1"></a><span class="co"># note_contenu : 30%, note_formateur : 20%, note_moyens : 25%, note_accompagnement : 15%, note_materiel : 10%</span></span>
<span id="cb391-6"><a href="#cb391-6" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb391-7"><a href="#cb391-7" aria-hidden="true" tabindex="-1"></a>ponderation <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">note_contenu =</span> <span class="dv">30</span>, <span class="at">note_formateur =</span> <span class="dv">20</span>, <span class="at">note_moyens =</span> <span class="dv">25</span>, <span class="at">note_accompagnement =</span> <span class="dv">15</span>, <span class="at">note_materiel =</span> <span class="dv">10</span>) <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb391-8"><a href="#cb391-8" aria-hidden="true" tabindex="-1"></a><span class="co"># On vérifie que la somme des poids vaut 1</span></span>
<span id="cb391-9"><a href="#cb391-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ponderation)</span>
<span id="cb391-10"><a href="#cb391-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb391-11"><a href="#cb391-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Noter l&#39;utilisation de c_across dans ce cas de figure pour traiter automatiquement plusieurs variables</span></span>
<span id="cb391-12"><a href="#cb391-12" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb391-13"><a href="#cb391-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb391-14"><a href="#cb391-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">note_moyenne =</span> <span class="fu">weighted.mean</span>(<span class="fu">c_across</span>(varNotes), ponderation, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb391-15"><a href="#cb391-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-90-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-90-4-tab">
<div class="cell">
<div class="sourceCode" id="cb392"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="do">## On souhaite affecter les pondérations suivantes aux notes :</span></span>
<span id="cb392-2"><a href="#cb392-2" aria-hidden="true" tabindex="-1"></a><span class="do">## note_contenu : 30%, note_formateur : 20%, note_moyens : 25%, note_accompagnement : 15%, note_materiel : 10%</span></span>
<span id="cb392-3"><a href="#cb392-3" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb392-4"><a href="#cb392-4" aria-hidden="true" tabindex="-1"></a>ponderation <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">note_contenu =</span> <span class="dv">30</span>, <span class="at">note_formateur =</span> <span class="dv">20</span>, <span class="at">note_moyens =</span> <span class="dv">25</span>, <span class="at">note_accompagnement =</span> <span class="dv">15</span>, <span class="at">note_materiel =</span> <span class="dv">10</span>) <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb392-5"><a href="#cb392-5" aria-hidden="true" tabindex="-1"></a><span class="co"># On vérifie que la somme des poids vaut 1</span></span>
<span id="cb392-6"><a href="#cb392-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ponderation)</span>
<span id="cb392-7"><a href="#cb392-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-8"><a href="#cb392-8" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, note_moyenne_pond <span class="sc">:</span><span class="er">=</span> <span class="fu">rowSums</span>(<span class="fu">mapply</span>(<span class="at">FUN =</span> <span class="st">`</span><span class="at">*</span><span class="st">`</span>, .SD, ponderation), <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .SDcols <span class="ot">=</span> <span class="fu">names</span>(ponderation)]</span></code></pre></div>
</div>
</div>
<div id="tabset-90-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-90-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="transposer-une-base" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> Transposer une base</h1>
<section id="transposer-une-base-1" class="level2" data-number="13.1">
<h2 data-number="13.1"><span class="header-section-number">13.1</span> Transposer une base</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-91-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-91-1" role="tab" aria-controls="tabset-91-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-91-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-91-2" role="tab" aria-controls="tabset-91-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-91-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-91-3" role="tab" aria-controls="tabset-91-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-91-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-91-4" role="tab" aria-controls="tabset-91-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-91-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-91-5" role="tab" aria-controls="tabset-91-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-91-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-91-1-tab">
<div class="sourceCode" id="cb393"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* On commence déjà par calculer un tableau croisé comptant les occurrences */</span></span>
<span id="cb393-2"><a href="#cb393-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;<span class="kw">table</span> Sexef * cspf / out = Nb<span class="kw">;run</span>;</span>
<span id="cb393-3"><a href="#cb393-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = Nb;<span class="kw">by</span> cspf Sexef<span class="kw">;run</span>;</span>
<span id="cb393-4"><a href="#cb393-4" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span> = Nb<span class="kw">;run</span>;</span>
<span id="cb393-5"><a href="#cb393-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-6"><a href="#cb393-6" aria-hidden="true" tabindex="-1"></a><span class="co">/* On transpose le tableau */</span></span>
<span id="cb393-7"><a href="#cb393-7" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> transpose<span class="kw"> data</span> = Nb out = transpose;<span class="kw">by</span> cspf;<span class="fu">var</span> count;id Sexef<span class="kw">;run</span>;</span>
<span id="cb393-8"><a href="#cb393-8" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> transpose;<span class="kw">set</span> transpose (<span class="kw">drop</span> = _name_ _label_)<span class="kw">;run</span>;</span>
<span id="cb393-9"><a href="#cb393-9" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span> = transpose<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-91-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-91-2-tab">
<div class="cell">
<div class="sourceCode" id="cb394"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On commence déjà par calculer un tableau croisé comptant les occurrences</span></span>
<span id="cb394-2"><a href="#cb394-2" aria-hidden="true" tabindex="-1"></a><span class="co"># as.data.frame.matrix est nécessaire, car le résultat de xtabs est un array</span></span>
<span id="cb394-3"><a href="#cb394-3" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">as.data.frame.matrix</span>(<span class="fu">xtabs</span>( <span class="sc">~</span> cspf <span class="sc">+</span> sexef, <span class="at">data =</span> donnees_rbase))</span>
<span id="cb394-4"><a href="#cb394-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-5"><a href="#cb394-5" aria-hidden="true" tabindex="-1"></a><span class="co"># On transpose le tableau</span></span>
<span id="cb394-6"><a href="#cb394-6" aria-hidden="true" tabindex="-1"></a>nb_transpose <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(nb))</span></code></pre></div>
</div>
</div>
<div id="tabset-91-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-91-3-tab">
<div class="cell">
<div class="sourceCode" id="cb395"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On commence déjà par calculer un tableau croisé comptant les occurrences</span></span>
<span id="cb395-2"><a href="#cb395-2" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb395-3"><a href="#cb395-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cspf, sexef) <span class="sc">%&gt;%</span> </span>
<span id="cb395-4"><a href="#cb395-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(sexef, n)</span>
<span id="cb395-5"><a href="#cb395-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-6"><a href="#cb395-6" aria-hidden="true" tabindex="-1"></a><span class="co"># On transpose le tableau (on fait passer sexef en ligne et cspf en colonne)</span></span>
<span id="cb395-7"><a href="#cb395-7" aria-hidden="true" tabindex="-1"></a>nb_transpose <span class="ot">&lt;-</span> nb <span class="sc">%&gt;%</span> </span>
<span id="cb395-8"><a href="#cb395-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Créer les combinaisons de cspf et sexef en ligne</span></span>
<span id="cb395-9"><a href="#cb395-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>cspf, <span class="at">names_to =</span> <span class="st">&quot;sexef&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb395-10"><a href="#cb395-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mettre sexef en ligne et cspf en colonne</span></span>
<span id="cb395-11"><a href="#cb395-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> cspf, <span class="at">values_from =</span> value, <span class="at">values_fill =</span> <span class="dv">0</span>)</span>
<span id="cb395-12"><a href="#cb395-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-13"><a href="#cb395-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution avec les packages janitor et sjmisc</span></span>
<span id="cb395-14"><a href="#cb395-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb395-15"><a href="#cb395-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjmisc)</span>
<span id="cb395-16"><a href="#cb395-16" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb395-17"><a href="#cb395-17" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">tabyl</span>(cspf, sexef) <span class="sc">%&gt;%</span> </span>
<span id="cb395-18"><a href="#cb395-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># colonne cspf comme nom de ligne</span></span>
<span id="cb395-19"><a href="#cb395-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var=</span><span class="st">&quot;cspf&quot;</span>)</span>
<span id="cb395-20"><a href="#cb395-20" aria-hidden="true" tabindex="-1"></a>nb_transpose <span class="ot">&lt;-</span> nb <span class="sc">%&gt;%</span></span>
<span id="cb395-21"><a href="#cb395-21" aria-hidden="true" tabindex="-1"></a>  sjmisc<span class="sc">::</span><span class="fu">rotate_df</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-91-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-91-4-tab">
<div class="cell">
<div class="sourceCode" id="cb396"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etablissement d&#39;un tableau croisé comptant les occurrences</span></span>
<span id="cb396-2"><a href="#cb396-2" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> donnees_datatable[, .N, by <span class="ot">=</span> <span class="fu">list</span>(cspf, sexef)]</span>
<span id="cb396-3"><a href="#cb396-3" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">dcast</span>(nb, cspf <span class="sc">~</span> sexef, <span class="at">value.var =</span> <span class="st">&quot;N&quot;</span>)</span>
<span id="cb396-4"><a href="#cb396-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb396-5"><a href="#cb396-5" aria-hidden="true" tabindex="-1"></a><span class="co"># On transpose le tableau</span></span>
<span id="cb396-6"><a href="#cb396-6" aria-hidden="true" tabindex="-1"></a><span class="fu">transpose</span>(nb, <span class="at">keep.names =</span> <span class="st">&quot;sexef&quot;</span>, <span class="at">make.names =</span> <span class="st">&quot;cspf&quot;</span>)</span>
<span id="cb396-7"><a href="#cb396-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb396-8"><a href="#cb396-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dcast</span>(<span class="fu">melt</span>(nb, <span class="at">id.vars =</span> <span class="st">&quot;cspf&quot;</span>, <span class="at">variable.name =</span> <span class="st">&quot;sexef&quot;</span>), sexef <span class="sc">~</span> cspf)</span></code></pre></div>
</div>
</div>
<div id="tabset-91-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-91-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="passer-dune-base-en-largeur-wide-à-une-base-en-longueur-long" class="level2" data-number="13.2">
<h2 data-number="13.2"><span class="header-section-number">13.2</span> Passer d’une base en largeur (wide) à une base en longueur (long)</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-92-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-92-1" role="tab" aria-controls="tabset-92-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-92-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-92-2" role="tab" aria-controls="tabset-92-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-92-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-92-3" role="tab" aria-controls="tabset-92-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-92-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-92-4" role="tab" aria-controls="tabset-92-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-92-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-92-5" role="tab" aria-controls="tabset-92-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-92-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-92-1-tab">
<div class="sourceCode" id="cb397"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> notes = note_contenu note_formateur note_moyens note_accompagnement note_materiel;</span>
<span id="cb397-2"><a href="#cb397-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant<span class="kw">;run</span>;</span>
<span id="cb397-3"><a href="#cb397-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">mean</span> noprint;<span class="fu">var</span> <span class="kw">&amp;notes.</span>;<span class="kw">output</span> out = Temp;<span class="kw">by</span> identifiant<span class="kw">;run</span>;</span>
<span id="cb397-4"><a href="#cb397-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Wide;</span>
<span id="cb397-5"><a href="#cb397-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> Temp (<span class="kw">where</span> = (_STAT_ = <span class="st">&quot;MEAN&quot;</span>) <span class="kw">drop</span> = _TYPE_ _FREQ_);</span>
<span id="cb397-6"><a href="#cb397-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">keep</span> identifiant <span class="kw">&amp;notes.</span>;</span>
<span id="cb397-7"><a href="#cb397-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">drop</span> _STAT_;</span>
<span id="cb397-8"><a href="#cb397-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb397-9"><a href="#cb397-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb397-10"><a href="#cb397-10" aria-hidden="true" tabindex="-1"></a><span class="co">/* On passe de Wide à Long */</span></span>
<span id="cb397-11"><a href="#cb397-11" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> transpose<span class="kw"> data</span> = Wide out = Long;<span class="kw">by</span> Identifiant;<span class="fu">var</span> <span class="kw">&amp;notes.;run</span>;</span></code></pre></div>
</div>
<div id="tabset-92-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-92-2-tab">
<div class="cell">
<div class="sourceCode" id="cb398"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On souhaite mettre les notes en ligne et non en colonne</span></span>
<span id="cb398-2"><a href="#cb398-2" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb398-3"><a href="#cb398-3" aria-hidden="true" tabindex="-1"></a>wide_rbase <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(donnees_rbase[, varNotes], donnees_rbase[, <span class="st">&quot;identifiant&quot;</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>], mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb398-4"><a href="#cb398-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb398-5"><a href="#cb398-5" aria-hidden="true" tabindex="-1"></a>long_rbase <span class="ot">&lt;-</span> <span class="fu">reshape</span>(<span class="at">data =</span> wide_rbase,</span>
<span id="cb398-6"><a href="#cb398-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">varying =</span> varNotes,</span>
<span id="cb398-7"><a href="#cb398-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">v.names =</span> <span class="st">&quot;notes&quot;</span>,</span>
<span id="cb398-8"><a href="#cb398-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">timevar =</span> <span class="st">&quot;type_note&quot;</span>,</span>
<span id="cb398-9"><a href="#cb398-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">times =</span> varNotes,</span>
<span id="cb398-10"><a href="#cb398-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">new.row.names =</span> <span class="cn">NULL</span>,</span>
<span id="cb398-11"><a href="#cb398-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">direction =</span> <span class="st">&quot;long&quot;</span>)</span>
<span id="cb398-12"><a href="#cb398-12" aria-hidden="true" tabindex="-1"></a>long_rbase <span class="ot">&lt;-</span> long_rbase[<span class="fu">order</span>(long_rbase<span class="sc">$</span>identifiant), ]</span>
<span id="cb398-13"><a href="#cb398-13" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(long_rbase) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
</div>
</div>
<div id="tabset-92-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-92-3-tab">
<div class="cell">
<div class="sourceCode" id="cb399"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On souhaite mettre les notes en ligne et non en colonne</span></span>
<span id="cb399-2"><a href="#cb399-2" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb399-3"><a href="#cb399-3" aria-hidden="true" tabindex="-1"></a>wide_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb399-4"><a href="#cb399-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb399-5"><a href="#cb399-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(varNotes), <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb399-6"><a href="#cb399-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb399-7"><a href="#cb399-7" aria-hidden="true" tabindex="-1"></a><span class="co"># On l&#39;exprime en format long</span></span>
<span id="cb399-8"><a href="#cb399-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Mise en garde : ne pas écrire value_to !</span></span>
<span id="cb399-9"><a href="#cb399-9" aria-hidden="true" tabindex="-1"></a>long_tidyverse <span class="ot">&lt;-</span> wide_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb399-10"><a href="#cb399-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">!</span>identifiant,</span>
<span id="cb399-11"><a href="#cb399-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;type_note&quot;</span>,</span>
<span id="cb399-12"><a href="#cb399-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;note&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb399-13"><a href="#cb399-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(type_note, identifiant)</span></code></pre></div>
</div>
</div>
<div id="tabset-92-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-92-4-tab">
<div class="cell">
<div class="sourceCode" id="cb400"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On souhaite mettre les notes en ligne et non en colonne</span></span>
<span id="cb400-2"><a href="#cb400-2" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb400-3"><a href="#cb400-3" aria-hidden="true" tabindex="-1"></a>wide_datatable <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">lapply</span>(.SD, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), keyby <span class="ot">=</span> identifiant, .SDcols <span class="ot">=</span> varNotes]</span>
<span id="cb400-4"><a href="#cb400-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb400-5"><a href="#cb400-5" aria-hidden="true" tabindex="-1"></a>long_datatable <span class="ot">&lt;-</span> <span class="fu">melt</span>(wide_datatable,</span>
<span id="cb400-6"><a href="#cb400-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>),</span>
<span id="cb400-7"><a href="#cb400-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">measure.vars =</span> varNotes,</span>
<span id="cb400-8"><a href="#cb400-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">variable.name =</span> <span class="st">&quot;type_note&quot;</span>,</span>
<span id="cb400-9"><a href="#cb400-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value.name =</span> <span class="st">&quot;note&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-92-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-92-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="passer-dune-base-en-longueur-long-à-une-base-en-largeur-wide" class="level2" data-number="13.3">
<h2 data-number="13.3"><span class="header-section-number">13.3</span> Passer d’une base en longueur (long) à une base en largeur (wide)</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-93-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-93-1" role="tab" aria-controls="tabset-93-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-93-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-93-2" role="tab" aria-controls="tabset-93-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-93-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-93-3" role="tab" aria-controls="tabset-93-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-93-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-93-4" role="tab" aria-controls="tabset-93-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-93-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-93-5" role="tab" aria-controls="tabset-93-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-93-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-93-1-tab">
<div class="sourceCode" id="cb401"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* On souhaite mettre les notes en ligne et non en colonne */</span></span>
<span id="cb401-2"><a href="#cb401-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* On commence par calculer les notes moyennes par identifiant */</span></span>
<span id="cb401-3"><a href="#cb401-3" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> notes = note_contenu note_formateur note_moyens note_accompagnement note_materiel;</span>
<span id="cb401-4"><a href="#cb401-4" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant<span class="kw">;run</span>;</span>
<span id="cb401-5"><a href="#cb401-5" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">mean</span> noprint;<span class="fu">var</span> <span class="kw">&amp;notes.</span>;<span class="kw">output</span> out = Temp;<span class="kw">by</span> identifiant<span class="kw">;run</span>;</span>
<span id="cb401-6"><a href="#cb401-6" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Wide;</span>
<span id="cb401-7"><a href="#cb401-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> Temp (<span class="kw">where</span> = (_STAT_ = <span class="st">&quot;MEAN&quot;</span>) <span class="kw">drop</span> = _TYPE_ _FREQ_);</span>
<span id="cb401-8"><a href="#cb401-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">keep</span> identifiant <span class="kw">&amp;notes.</span>;</span>
<span id="cb401-9"><a href="#cb401-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">drop</span> _STAT_;</span>
<span id="cb401-10"><a href="#cb401-10" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb401-11"><a href="#cb401-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-12"><a href="#cb401-12" aria-hidden="true" tabindex="-1"></a><span class="co">/* On passe de Wide à Long */</span></span>
<span id="cb401-13"><a href="#cb401-13" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> transpose<span class="kw"> data</span> = Wide out = Long;<span class="kw">by</span> Identifiant;<span class="fu">var</span> <span class="kw">&amp;notes.;run</span>;</span>
<span id="cb401-14"><a href="#cb401-14" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Long;<span class="kw">set</span> Long (<span class="kw">rename</span> = (_NAME_ = Type_Note COL1 = <span class="fu">Note</span>))<span class="kw">;run</span>;</span>
<span id="cb401-15"><a href="#cb401-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-16"><a href="#cb401-16" aria-hidden="true" tabindex="-1"></a><span class="co">/* On passe de Long à Wide */</span></span>
<span id="cb401-17"><a href="#cb401-17" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> transpose<span class="kw"> data</span> = Long out = Wide;</span>
<span id="cb401-18"><a href="#cb401-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> Identifiant;</span>
<span id="cb401-19"><a href="#cb401-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> <span class="fu">Note</span>;</span>
<span id="cb401-20"><a href="#cb401-20" aria-hidden="true" tabindex="-1"></a>  id Type_Note;</span>
<span id="cb401-21"><a href="#cb401-21" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-93-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-93-2-tab">
<div class="cell">
<div class="sourceCode" id="cb402"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Passer de long à wide : on souhaite revenir à la situation initiale</span></span>
<span id="cb402-2"><a href="#cb402-2" aria-hidden="true" tabindex="-1"></a>wide_rbase <span class="ot">&lt;-</span> <span class="fu">reshape</span>(long_rbase,</span>
<span id="cb402-3"><a href="#cb402-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">timevar =</span> <span class="st">&quot;type_note&quot;</span>,</span>
<span id="cb402-4"><a href="#cb402-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">idvar =</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;id&quot;</span>),</span>
<span id="cb402-5"><a href="#cb402-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">direction =</span> <span class="st">&quot;wide&quot;</span>)</span>
<span id="cb402-6"><a href="#cb402-6" aria-hidden="true" tabindex="-1"></a><span class="co">#https://stats.oarc.ucla.edu/r/faq/how-can-i-reshape-my-data-in-r/</span></span></code></pre></div>
</div>
</div>
<div id="tabset-93-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-93-3-tab">
<div class="cell">
<div class="sourceCode" id="cb403"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb403-1"><a href="#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Passer de long à wide : on souhaite revenir à la situation initiale</span></span>
<span id="cb403-2"><a href="#cb403-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Mise en garde : ne pas écrire value_from !</span></span>
<span id="cb403-3"><a href="#cb403-3" aria-hidden="true" tabindex="-1"></a>wide_tidyverse <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(long_tidyverse, </span>
<span id="cb403-4"><a href="#cb403-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">names_from =</span> type_note,</span>
<span id="cb403-5"><a href="#cb403-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">values_from =</span> note)</span></code></pre></div>
</div>
</div>
<div id="tabset-93-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-93-4-tab">
<div class="cell">
<div class="sourceCode" id="cb404"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a>wide_datatable <span class="ot">&lt;-</span> <span class="fu">dcast</span>(long_datatable, identifiant <span class="sc">~</span> type_note, <span class="at">value.var =</span> <span class="st">&quot;note&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-93-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-93-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="variable-retardée-lag-et-avancée-lead" class="level1" data-number="14">
<h1 data-number="14"><span class="header-section-number">14</span> Variable retardée (lag) et avancée (lead)</h1>
<section id="variable-retardée-lag-1" class="level2" data-number="14.1">
<h2 data-number="14.1"><span class="header-section-number">14.1</span> Variable retardée (lag)</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-94-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-94-1" role="tab" aria-controls="tabset-94-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-94-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-94-2" role="tab" aria-controls="tabset-94-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-94-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-94-3" role="tab" aria-controls="tabset-94-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-94-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-94-4" role="tab" aria-controls="tabset-94-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-94-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-94-5" role="tab" aria-controls="tabset-94-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-94-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-94-1-tab">
<div class="sourceCode" id="cb405"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb405-1"><a href="#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* La date de fin du contrat précédent (lag) */</span></span>
<span id="cb405-2"><a href="#cb405-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant date_entree<span class="kw">;run</span>;</span>
<span id="cb405-3"><a href="#cb405-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sasBon;</span>
<span id="cb405-4"><a href="#cb405-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb405-5"><a href="#cb405-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> identifiant date_entree;  </span>
<span id="cb405-6"><a href="#cb405-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Date_fin_1 ddmmyy10.;</span>
<span id="cb405-7"><a href="#cb405-7" aria-hidden="true" tabindex="-1"></a>  Date_fin_1 = <span class="fu">lag</span>(Date_sortie);</span>
<span id="cb405-8"><a href="#cb405-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> first.identifiant <span class="kw">then</span> Date_fin_1 = .;</span>
<span id="cb405-9"><a href="#cb405-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb405-10"><a href="#cb405-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-11"><a href="#cb405-11" aria-hidden="true" tabindex="-1"></a><span class="co">/* ATTENTION au lag DANS UNE CONDITION IF (cf. document) */</span></span>
<span id="cb405-12"><a href="#cb405-12" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant date_entree<span class="kw">;run</span>;</span>
<span id="cb405-13"><a href="#cb405-13" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Lag_Bon;</span>
<span id="cb405-14"><a href="#cb405-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = identifiant date_entree date_sortie);</span>
<span id="cb405-15"><a href="#cb405-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> date_sortie_1 lag_faux lag_bon ddmmyy10.;</span>
<span id="cb405-16"><a href="#cb405-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Erreur */</span></span>
<span id="cb405-17"><a href="#cb405-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> date_entree = <span class="fu">lag</span>(date_sortie) + <span class="dv">1</span> <span class="kw">then</span> lag_faux = <span class="fu">lag</span>(date_sortie) + <span class="dv">1</span>;</span>
<span id="cb405-18"><a href="#cb405-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Bonne écriture */</span></span>
<span id="cb405-19"><a href="#cb405-19" aria-hidden="true" tabindex="-1"></a>  date_sortie_1 = <span class="fu">lag</span>(date_sortie);</span>
<span id="cb405-20"><a href="#cb405-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> date_entree = date_sortie_1 + <span class="dv">1</span> <span class="kw">then</span> lag_bon = date_sortie_1 + <span class="dv">1</span>;</span>
<span id="cb405-21"><a href="#cb405-21" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-94-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-94-2-tab">
<div class="cell">
<div class="sourceCode" id="cb406"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La date de fin du contrat précédent</span></span>
<span id="cb406-2"><a href="#cb406-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(donnees_rbase<span class="sc">$</span>identifiant, donnees_rbase<span class="sc">$</span>date_entre, <span class="at">na.last =</span> <span class="cn">FALSE</span>), ]</span>
<span id="cb406-3"><a href="#cb406-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Il n&#39;existe pas de fonction lag dans le R de base (à notre connaissance)</span></span>
<span id="cb406-4"><a href="#cb406-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Il faut soit utiliser un package, soit utiliser cette astuce</span></span>
<span id="cb406-5"><a href="#cb406-5" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>date_sortie_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="cn">NA</span>), donnees_rbase<span class="sc">$</span>date_sortie[ <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(donnees_rbase<span class="sc">$</span>date_sortie) <span class="sc">-</span> <span class="dv">1</span>)])</span>
<span id="cb406-6"><a href="#cb406-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Peut-on aussi utiliser tail(..., -1) ?</span></span>
<span id="cb406-7"><a href="#cb406-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-8"><a href="#cb406-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Autres solutions</span></span>
<span id="cb406-9"><a href="#cb406-9" aria-hidden="true" tabindex="-1"></a><span class="co">#https://stackoverflow.com/questions/3558988/basic-lag-in-r-vector-dataframe</span></span></code></pre></div>
</div>
</div>
<div id="tabset-94-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-94-3-tab">
<div class="cell">
<div class="sourceCode" id="cb407"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb407-1"><a href="#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La date de fin du contrat précédent</span></span>
<span id="cb407-2"><a href="#cb407-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb407-3"><a href="#cb407-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb407-4"><a href="#cb407-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span> </span>
<span id="cb407-5"><a href="#cb407-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_sortie_1 =</span> <span class="fu">lag</span>(date_sortie))</span></code></pre></div>
</div>
</div>
<div id="tabset-94-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-94-4-tab">
<div class="cell">
<div class="sourceCode" id="cb408"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La date de fin du contrat précédent</span></span>
<span id="cb408-2"><a href="#cb408-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setorderv</span>(donnees_datatable, <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;date_entree&quot;</span>), <span class="at">order =</span> <span class="fu">c</span>(1L, 1L), <span class="at">na.last =</span> <span class="cn">FALSE</span>)</span>
<span id="cb408-3"><a href="#cb408-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, date_sortie_1 <span class="sc">:</span><span class="er">=</span> <span class="fu">shift</span>(.SD, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="st">&quot;lag&quot;</span>), .SDcols <span class="ot">=</span> <span class="st">&quot;date_sortie&quot;</span>]</span>
<span id="cb408-4"><a href="#cb408-4" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, .(date_sortie, date_sortie_1)]</span></code></pre></div>
</div>
</div>
<div id="tabset-94-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-94-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="variable-avancée-lead" class="level2" data-number="14.2">
<h2 data-number="14.2"><span class="header-section-number">14.2</span> Variable avancée (lead)</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-95-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-95-1" role="tab" aria-controls="tabset-95-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-95-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-95-2" role="tab" aria-controls="tabset-95-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-95-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-95-3" role="tab" aria-controls="tabset-95-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-95-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-95-4" role="tab" aria-controls="tabset-95-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-95-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-95-5" role="tab" aria-controls="tabset-95-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-95-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-95-1-tab">
<div class="sourceCode" id="cb409"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* À FAIRE !!!!!!! */</span></span>
<span id="cb409-2"><a href="#cb409-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* La date de fin du contrat précédent (lag) */</span></span>
<span id="cb409-3"><a href="#cb409-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant date_entree<span class="kw">;run</span>;</span>
<span id="cb409-4"><a href="#cb409-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sasBon;</span>
<span id="cb409-5"><a href="#cb409-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb409-6"><a href="#cb409-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> identifiant date_entree;  </span>
<span id="cb409-7"><a href="#cb409-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Date_fin_1 ddmmyy10.;</span>
<span id="cb409-8"><a href="#cb409-8" aria-hidden="true" tabindex="-1"></a>  Date_fin_1 = <span class="fu">lag</span>(Date_sortie);</span>
<span id="cb409-9"><a href="#cb409-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> first.identifiant <span class="kw">then</span> Date_fin_1 = .;</span>
<span id="cb409-10"><a href="#cb409-10" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb409-11"><a href="#cb409-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-12"><a href="#cb409-12" aria-hidden="true" tabindex="-1"></a><span class="co">/* ATTENTION au lag DANS UNE CONDITION IF (cf. document) */</span></span>
<span id="cb409-13"><a href="#cb409-13" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> identifiant date_entree<span class="kw">;run</span>;</span>
<span id="cb409-14"><a href="#cb409-14" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Lag_Bon;</span>
<span id="cb409-15"><a href="#cb409-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = identifiant date_entree date_sortie);</span>
<span id="cb409-16"><a href="#cb409-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> date_sortie_1 lag_faux lag_bon ddmmyy10.;</span>
<span id="cb409-17"><a href="#cb409-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Erreur */</span></span>
<span id="cb409-18"><a href="#cb409-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> date_entree = <span class="fu">lag</span>(date_sortie) + <span class="dv">1</span> <span class="kw">then</span> lag_faux = <span class="fu">lag</span>(date_sortie) + <span class="dv">1</span>;</span>
<span id="cb409-19"><a href="#cb409-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Bonne écriture */</span></span>
<span id="cb409-20"><a href="#cb409-20" aria-hidden="true" tabindex="-1"></a>  date_sortie_1 = <span class="fu">lag</span>(date_sortie);</span>
<span id="cb409-21"><a href="#cb409-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> date_entree = date_sortie_1 + <span class="dv">1</span> <span class="kw">then</span> lag_bon = date_sortie_1 + <span class="dv">1</span>;</span>
<span id="cb409-22"><a href="#cb409-22" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-95-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-95-2-tab">
<div class="cell">
<div class="sourceCode" id="cb410"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La date du contrat futur (lead)</span></span>
<span id="cb410-2"><a href="#cb410-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>date_sortie__1 <span class="ot">&lt;-</span> <span class="fu">c</span>(donnees_rbase<span class="sc">$</span>date_sortie[ <span class="dv">2</span><span class="sc">:</span>(<span class="fu">length</span>(donnees_rbase<span class="sc">$</span>date_sortie))], <span class="fu">as.Date</span>(<span class="cn">NA</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-95-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-95-3-tab">
<div class="cell">
<div class="sourceCode" id="cb411"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La date du contrat futur (lead)</span></span>
<span id="cb411-2"><a href="#cb411-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb411-3"><a href="#cb411-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour trier les données de la même façon que SAS</span></span>
<span id="cb411-4"><a href="#cb411-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(identifiant, <span class="sc">!</span><span class="fu">is.na</span>(date_entree), date_entree) <span class="sc">%&gt;%</span> </span>
<span id="cb411-5"><a href="#cb411-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_sortie__1 =</span> <span class="fu">lead</span>(date_sortie))</span></code></pre></div>
</div>
</div>
<div id="tabset-95-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-95-4-tab">
<div class="cell">
<div class="sourceCode" id="cb412"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La date du contrat futur (lead)</span></span>
<span id="cb412-2"><a href="#cb412-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setorderv</span>(donnees_datatable, <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;date_entree&quot;</span>), <span class="at">order =</span> <span class="fu">c</span>(1L, 1L), <span class="at">na.last =</span> <span class="cn">FALSE</span>)</span>
<span id="cb412-3"><a href="#cb412-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, date_sortie__1 <span class="sc">:</span><span class="er">=</span> <span class="fu">shift</span>(.SD, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="st">&quot;lead&quot;</span>), .SDcols <span class="ot">=</span> <span class="st">&quot;date_sortie&quot;</span>]</span>
<span id="cb412-4"><a href="#cb412-4" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, .(date_sortie, date_sortie__1)]</span></code></pre></div>
</div>
</div>
<div id="tabset-95-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-95-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="les-valeurs-manquantes" class="level1" data-number="15">
<h1 data-number="15"><span class="header-section-number">15</span> Les valeurs manquantes</h1>
<section id="repérer-les-valeurs-manquantes-variables-âge-et-niveau" class="level2" data-number="15.1">
<h2 data-number="15.1"><span class="header-section-number">15.1</span> Repérer les valeurs manquantes (variables Âge et Niveau)</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-96-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-96-1" role="tab" aria-controls="tabset-96-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-96-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-96-2" role="tab" aria-controls="tabset-96-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-96-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-96-3" role="tab" aria-controls="tabset-96-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-96-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-96-4" role="tab" aria-controls="tabset-96-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-96-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-96-5" role="tab" aria-controls="tabset-96-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-96-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-96-1-tab">
<div class="sourceCode" id="cb413"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb413-1"><a href="#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Missing;</span>
<span id="cb413-2"><a href="#cb413-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb413-3"><a href="#cb413-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 1ère solution */</span></span>
<span id="cb413-4"><a href="#cb413-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> missing(age) <span class="kw">or</span> missing(Niveau) <span class="kw">then</span> missing1 = <span class="dv">1</span>;<span class="kw">else</span> missing1 = <span class="dv">0</span>;</span>
<span id="cb413-5"><a href="#cb413-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 2e solution */</span></span>
<span id="cb413-6"><a href="#cb413-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> age = . <span class="kw">or</span> Niveau = <span class="st">&#39;&#39;</span> <span class="kw">then</span> missing2 = <span class="dv">1</span>;<span class="kw">else</span> missing2 = <span class="dv">0</span>;</span>
<span id="cb413-7"><a href="#cb413-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">keep</span> Age Niveau Missing1 Missing2;</span>
<span id="cb413-8"><a href="#cb413-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-96-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-96-2-tab">
<div class="cell">
<div class="sourceCode" id="cb414"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mauvaise méthode pour repérer les valeurs manquantes</span></span>
<span id="cb414-2"><a href="#cb414-2" aria-hidden="true" tabindex="-1"></a>ageManquant <span class="ot">&lt;-</span> donnees_rbase[donnees_rbase<span class="sc">$</span>age <span class="sc">==</span> <span class="cn">NA</span> <span class="sc">|</span> donnees_rbase<span class="sc">$</span>niveau <span class="sc">==</span> <span class="cn">NA</span>,  ]</span>
<span id="cb414-3"><a href="#cb414-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb414-4"><a href="#cb414-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Bonne méthode pour repérer les valeurs manquantes</span></span>
<span id="cb414-5"><a href="#cb414-5" aria-hidden="true" tabindex="-1"></a>ageManquant <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">is.na</span>(donnees_rbase<span class="sc">$</span>age) <span class="sc">|</span> <span class="fu">is.na</span>(donnees_rbase<span class="sc">$</span>niveau), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-96-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-96-3-tab">
<div class="cell">
<div class="sourceCode" id="cb415"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mauvaise méthode pour repérer les valeurs manquantes</span></span>
<span id="cb415-2"><a href="#cb415-2" aria-hidden="true" tabindex="-1"></a>ageManquant <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb415-3"><a href="#cb415-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">==</span> <span class="cn">NA</span> <span class="sc">|</span> niveau <span class="sc">==</span> <span class="cn">NA</span>)</span>
<span id="cb415-4"><a href="#cb415-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb415-5"><a href="#cb415-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Bonne méthode pour repérer les valeurs manquantes</span></span>
<span id="cb415-6"><a href="#cb415-6" aria-hidden="true" tabindex="-1"></a>ageManquant <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb415-7"><a href="#cb415-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(age) <span class="sc">|</span> <span class="fu">is.na</span>(niveau))</span></code></pre></div>
</div>
</div>
<div id="tabset-96-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-96-4-tab">
<div class="cell">
<div class="sourceCode" id="cb416"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mauvaise méthode pour repérer les valeurs manquantes</span></span>
<span id="cb416-2"><a href="#cb416-2" aria-hidden="true" tabindex="-1"></a>ageManquant <span class="ot">&lt;-</span> donnees_datatable[age <span class="sc">==</span> <span class="cn">NA</span> <span class="sc">|</span> niveau <span class="sc">==</span> <span class="cn">NA</span>]</span>
<span id="cb416-3"><a href="#cb416-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb416-4"><a href="#cb416-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Bonne méthode pour repérer les valeurs manquantes</span></span>
<span id="cb416-5"><a href="#cb416-5" aria-hidden="true" tabindex="-1"></a>ageManquant <span class="ot">&lt;-</span> donnees_datatable[<span class="fu">is.na</span>(age)]</span>
<span id="cb416-6"><a href="#cb416-6" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, manquant <span class="sc">:</span><span class="er">=</span> <span class="fu">fifelse</span>(<span class="fu">is.na</span>(age) <span class="sc">|</span> <span class="fu">is.na</span>(niveau), <span class="dv">1</span>, <span class="dv">0</span>)]</span></code></pre></div>
</div>
</div>
<div id="tabset-96-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-96-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="nombre-et-proportion-de-valeurs-manquantes-par-variable" class="level2" data-number="15.2">
<h2 data-number="15.2"><span class="header-section-number">15.2</span> Nombre et proportion de valeurs manquantes par variable</h2>
<section id="pour-les-variables-numériques-ou-dates" class="level3" data-number="15.2.1">
<h3 data-number="15.2.1"><span class="header-section-number">15.2.1</span> Pour les variables numériques ou dates</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-97-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-97-1" role="tab" aria-controls="tabset-97-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-97-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-97-2" role="tab" aria-controls="tabset-97-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-97-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-97-3" role="tab" aria-controls="tabset-97-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-97-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-97-4" role="tab" aria-controls="tabset-97-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-97-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-97-5" role="tab" aria-controls="tabset-97-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-97-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-97-1-tab">
<div class="sourceCode" id="cb417"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Pour les variables numériques ou dates */</span></span>
<span id="cb417-2"><a href="#cb417-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* Partie &quot;Missing Values&quot; en bas du tableau consacré à la variable */</span></span>
<span id="cb417-3"><a href="#cb417-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> univariate<span class="kw"> data</span> = donnees_sas;<span class="fu">var</span> _numeric_<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-97-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-97-2-tab">
<div class="cell">
<div class="sourceCode" id="cb418"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb418-1"><a href="#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour les variables numériques ou date</span></span>
<span id="cb418-2"><a href="#cb418-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(<span class="fu">is.na</span>(</span>
<span id="cb418-3"><a href="#cb418-3" aria-hidden="true" tabindex="-1"></a>  donnees_rbase[<span class="fu">sapply</span>(donnees_rbase, <span class="cf">function</span>(x) <span class="fu">is.numeric</span>(x) <span class="sc">|</span> lubridate<span class="sc">::</span><span class="fu">is.Date</span>(x))]</span>
<span id="cb418-4"><a href="#cb418-4" aria-hidden="true" tabindex="-1"></a>  ), <span class="dv">2</span>, mean) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb418-5"><a href="#cb418-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb418-6"><a href="#cb418-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Autres solutions</span></span>
<span id="cb418-7"><a href="#cb418-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(</span>
<span id="cb418-8"><a href="#cb418-8" aria-hidden="true" tabindex="-1"></a>  donnees_rbase[<span class="fu">sapply</span>(donnees_rbase, <span class="cf">function</span>(x) <span class="fu">is.numeric</span>(x) <span class="sc">|</span> lubridate<span class="sc">::</span><span class="fu">is.Date</span>(x))],</span>
<span id="cb418-9"><a href="#cb418-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">mean</span>(<span class="fu">is.na</span>(x)) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb418-10"><a href="#cb418-10" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(</span>
<span id="cb418-11"><a href="#cb418-11" aria-hidden="true" tabindex="-1"></a>  donnees_rbase[<span class="fu">sapply</span>(donnees_rbase, <span class="cf">function</span>(x) <span class="fu">is.numeric</span>(x) <span class="sc">|</span> lubridate<span class="sc">::</span><span class="fu">is.Date</span>(x))],</span>
<span id="cb418-12"><a href="#cb418-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)) <span class="sc">/</span> <span class="fu">length</span>(x) <span class="sc">*</span> <span class="dv">100</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-97-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-97-3-tab">
<div class="cell">
<div class="sourceCode" id="cb419"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour les variables numériques ou date</span></span>
<span id="cb419-2"><a href="#cb419-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb419-3"><a href="#cb419-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">is.numeric</span>(.x) <span class="sc">|</span> lubridate<span class="sc">::</span><span class="fu">is.Date</span>(.x)),</span>
<span id="cb419-4"><a href="#cb419-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">list</span>(<span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.x)), <span class="sc">~</span><span class="fu">mean</span>(<span class="fu">is.na</span>(.x)))))</span>
<span id="cb419-5"><a href="#cb419-5" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb419-6"><a href="#cb419-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">is.numeric</span>(.x) <span class="sc">|</span> lubridate<span class="sc">::</span><span class="fu">is.Date</span>(.x)),</span>
<span id="cb419-7"><a href="#cb419-7" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">list</span>(<span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.x)), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.x)) <span class="sc">/</span> <span class="fu">length</span>(.x))))</span></code></pre></div>
</div>
</div>
<div id="tabset-97-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-97-4-tab">
<div class="cell">
<div class="sourceCode" id="cb420"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb420-1"><a href="#cb420-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour les variables numériques ou date</span></span>
<span id="cb420-2"><a href="#cb420-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">mean</span>(<span class="fu">is.na</span>(x)) <span class="sc">*</span> <span class="dv">100</span>), .SDcols <span class="ot">=</span> <span class="cf">function</span>(x) <span class="fu">c</span>(lubridate<span class="sc">::</span><span class="fu">is.Date</span>(x) <span class="sc">|</span> <span class="fu">is.numeric</span>(x))]</span></code></pre></div>
</div>
</div>
<div id="tabset-97-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-97-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="pour-lensemble-des-variables" class="level3" data-number="15.2.2">
<h3 data-number="15.2.2"><span class="header-section-number">15.2.2</span> Pour l’ensemble des variables</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-98-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-98-1" role="tab" aria-controls="tabset-98-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-98-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-98-2" role="tab" aria-controls="tabset-98-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-98-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-98-3" role="tab" aria-controls="tabset-98-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-98-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-98-4" role="tab" aria-controls="tabset-98-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-98-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-98-5" role="tab" aria-controls="tabset-98-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-98-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-98-1-tab">
<div class="sourceCode" id="cb421"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Une solution possible */</span></span>
<span id="cb421-2"><a href="#cb421-2" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> Iteration(base = donnees_sas);</span>
<span id="cb421-3"><a href="#cb421-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%local</span> nbVar;</span>
<span id="cb421-4"><a href="#cb421-4" aria-hidden="true" tabindex="-1"></a><span class="kw">  proc</span> contents<span class="kw"> data</span> = donnees_sas out = ListeVar noprint<span class="kw">;run</span>;</span>
<span id="cb421-5"><a href="#cb421-5" aria-hidden="true" tabindex="-1"></a><span class="kw">  proc</span> sql noprint;<span class="kw">select</span> count(*) <span class="kw">into</span> :nbVar <span class="kw">from</span> ListeVar;<span class="kw">quit</span>;</span>
<span id="cb421-6"><a href="#cb421-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%do</span> i = <span class="dv">1</span> <span class="kw">%to</span> <span class="kw">&amp;nbVar.</span>;</span>
<span id="cb421-7"><a href="#cb421-7" aria-hidden="true" tabindex="-1"></a><span class="kw">    data</span> _null_;</span>
<span id="cb421-8"><a href="#cb421-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">set</span> ListeVar (firstobs = <span class="kw">&amp;i.</span> obs = <span class="kw">&amp;i.</span>);</span>
<span id="cb421-9"><a href="#cb421-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">call</span> symput(<span class="st">&#39;var&#39;</span>, name);</span>
<span id="cb421-10"><a href="#cb421-10" aria-hidden="true" tabindex="-1"></a><span class="kw">    run</span>;</span>
<span id="cb421-11"><a href="#cb421-11" aria-hidden="true" tabindex="-1"></a><span class="kw">    proc</span> sql;</span>
<span id="cb421-12"><a href="#cb421-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">select</span> <span class="fu">max</span>(<span class="st">&quot;&amp;var.&quot;</span>) <span class="kw">as</span> Variable, <span class="fu">sum</span>(missing(<span class="kw">&amp;var.</span>)) <span class="kw">as</span> Manquants, <span class="fu">sum</span>(missing(<span class="kw">&amp;var.</span>)) / count(*) * <span class="dv">100</span> <span class="kw">as</span> Prop_Manquants</span>
<span id="cb421-13"><a href="#cb421-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">from</span> <span class="kw">&amp;base.</span>;</span>
<span id="cb421-14"><a href="#cb421-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">quit</span>;</span>
<span id="cb421-15"><a href="#cb421-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%end</span>;</span>
<span id="cb421-16"><a href="#cb421-16" aria-hidden="true" tabindex="-1"></a><span class="kw">  proc</span> datasets lib = work nolist;<span class="kw">delete</span> ListeVar<span class="kw">;run</span>;</span>
<span id="cb421-17"><a href="#cb421-17" aria-hidden="true" tabindex="-1"></a><span class="kw">%mend</span> Iteration;</span>
<span id="cb421-18"><a href="#cb421-18" aria-hidden="true" tabindex="-1"></a>%Iteration;</span></code></pre></div>
</div>
<div id="tabset-98-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-98-2-tab">
<div class="cell">
<div class="sourceCode" id="cb422"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb422-1"><a href="#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(<span class="fu">is.na</span>(donnees_rbase)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb422-2"><a href="#cb422-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(<span class="fu">is.na</span>(donnees_rbase), <span class="dv">2</span>, mean) <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div>
</div>
</div>
<div id="tabset-98-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-98-3-tab">
<div class="cell">
<div class="sourceCode" id="cb423"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb423-2"><a href="#cb423-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">mean</span>(<span class="fu">is.na</span>(.x))))</span>
<span id="cb423-3"><a href="#cb423-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-4"><a href="#cb423-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Autres solutions</span></span>
<span id="cb423-5"><a href="#cb423-5" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">mean</span>(<span class="fu">is.na</span>(.)) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb423-6"><a href="#cb423-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Obsolète</span></span>
<span id="cb423-7"><a href="#cb423-7" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">summarise_each</span>(<span class="fu">funs</span>(<span class="fu">mean</span>(<span class="fu">is.na</span>(.)) <span class="sc">*</span> <span class="dv">100</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-98-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-98-4-tab">
<div class="cell">
<div class="sourceCode" id="cb424"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb424-1"><a href="#cb424-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">mean</span>(<span class="fu">is.na</span>(x)) <span class="sc">*</span> <span class="dv">100</span>)]</span></code></pre></div>
</div>
</div>
<div id="tabset-98-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-98-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="incidence-des-valeurs-manquantes" class="level2" data-number="15.3">
<h2 data-number="15.3"><span class="header-section-number">15.3</span> Incidence des valeurs manquantes</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-99-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-99-1" role="tab" aria-controls="tabset-99-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-99-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-99-2" role="tab" aria-controls="tabset-99-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-99-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-99-3" role="tab" aria-controls="tabset-99-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-99-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-99-4" role="tab" aria-controls="tabset-99-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-99-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-99-5" role="tab" aria-controls="tabset-99-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-99-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-99-1-tab">
<div class="sourceCode" id="cb425"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* En SAS, les valeurs manquantes sont des nombres négatifs faibles */</span></span>
<span id="cb425-2"><a href="#cb425-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Valeur_Manquante;</span>
<span id="cb425-3"><a href="#cb425-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb425-4"><a href="#cb425-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Lorsque Age est manquant (missing), Jeune_Correct vaut 0 mais Jeune_Incorrect vaut 1 */</span></span>
<span id="cb425-5"><a href="#cb425-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* En effet, pour SAS, un Age manquant est une valeur inférieure à 0, donc bien inférieure à 25.</span></span>
<span id="cb425-6"><a href="#cb425-6" aria-hidden="true" tabindex="-1"></a><span class="co">     Donc la variable Jeune_Incorrect vaut bien 1 pour les âges inconnus */</span></span>
<span id="cb425-7"><a href="#cb425-7" aria-hidden="true" tabindex="-1"></a>  Jeune_Incorrect = (Age &lt;= <span class="dv">25</span>);</span>
<span id="cb425-8"><a href="#cb425-8" aria-hidden="true" tabindex="-1"></a>  Jeune_Correct   = (<span class="dv">0</span> &lt;= Age &lt;= <span class="dv">25</span>);</span>
<span id="cb425-9"><a href="#cb425-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb425-10"><a href="#cb425-10" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span> = Valeur_Manquante (<span class="kw">keep</span>  = Age Jeune_Correct Jeune_Incorrect</span>
<span id="cb425-11"><a href="#cb425-11" aria-hidden="true" tabindex="-1"></a>                                    <span class="kw">where</span> = (missing(Age)));</span>
<span id="cb425-12"><a href="#cb425-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb425-13"><a href="#cb425-13" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = Valeur_Manquante;tables Jeune_Incorrect Jeune_Correct<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-99-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-99-2-tab">
<div class="cell">
<div class="sourceCode" id="cb426"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb426-1"><a href="#cb426-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(donnees_rbase<span class="sc">$</span>note_formateur)</span>
<span id="cb426-2"><a href="#cb426-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(donnees_rbase<span class="sc">$</span>note_formateur, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-99-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-99-3-tab">
<div class="cell">
<div class="sourceCode" id="cb427"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">pull</span>(note_formateur) <span class="sc">%&gt;%</span> <span class="fu">mean</span>()</span>
<span id="cb427-2"><a href="#cb427-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">pull</span>(note_formateur) <span class="sc">%&gt;%</span> <span class="fu">mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb427-3"><a href="#cb427-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-4"><a href="#cb427-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Attention, en tidyverse, les syntaxes suivantes ne fonctionnent pas !</span></span>
<span id="cb427-5"><a href="#cb427-5" aria-hidden="true" tabindex="-1"></a><span class="co"># donnees_tidyverse %&gt;% mean(note_formateur)</span></span>
<span id="cb427-6"><a href="#cb427-6" aria-hidden="true" tabindex="-1"></a><span class="co"># donnees_tidyverse %&gt;% mean(note_formateur, na.rm = TRUE)</span></span></code></pre></div>
</div>
</div>
<div id="tabset-99-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-99-4-tab">
<div class="cell">
<div class="sourceCode" id="cb428"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb428-1"><a href="#cb428-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">mean</span>(note_formateur)]</span>
<span id="cb428-2"><a href="#cb428-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">mean</span>(note_formateur, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)]</span></code></pre></div>
</div>
</div>
<div id="tabset-99-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-99-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="remplacer-les-valeurs-manquantes-dune-seule-variable-par-0" class="level2" data-number="15.4">
<h2 data-number="15.4"><span class="header-section-number">15.4</span> Remplacer les valeurs manquantes d’une seule variable par 0</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-100-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-100-1" role="tab" aria-controls="tabset-100-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-100-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-100-2" role="tab" aria-controls="tabset-100-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-100-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-100-3" role="tab" aria-controls="tabset-100-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-100-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-100-4" role="tab" aria-controls="tabset-100-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-100-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-100-5" role="tab" aria-controls="tabset-100-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-100-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-100-1-tab">
<div class="sourceCode" id="cb429"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> <span class="fu">var</span> = note_contenu;</span>
<span id="cb429-2"><a href="#cb429-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas_sans_missing;</span>
<span id="cb429-3"><a href="#cb429-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb429-4"><a href="#cb429-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> missing(<span class="kw">&amp;var.</span>) <span class="kw">then</span> <span class="kw">&amp;var.</span> = <span class="dv">0</span>;</span>
<span id="cb429-5"><a href="#cb429-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Ou alors */</span></span>
<span id="cb429-6"><a href="#cb429-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> <span class="kw">&amp;var.</span> = . <span class="kw">then</span> <span class="kw">&amp;var.</span> = <span class="dv">0</span>;</span>
<span id="cb429-7"><a href="#cb429-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Ou encore */</span></span>
<span id="cb429-8"><a href="#cb429-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> note_contenu = . <span class="kw">then</span> note_contenu = <span class="dv">0</span>;</span>
<span id="cb429-9"><a href="#cb429-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-100-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-100-2-tab">
<div class="cell">
<div class="sourceCode" id="cb430"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb430-1"><a href="#cb430-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;note_contenu&quot;</span></span>
<span id="cb430-2"><a href="#cb430-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase_sans_na <span class="ot">&lt;-</span> donnees_rbase</span>
<span id="cb430-3"><a href="#cb430-3" aria-hidden="true" tabindex="-1"></a>donnees_rbase_sans_na[, variable][<span class="fu">is.na</span>(donnees_rbase_sans_na[, variable])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb430-4"><a href="#cb430-4" aria-hidden="true" tabindex="-1"></a>donnees_rbase_sans_na[, variable] <span class="ot">&lt;-</span> <span class="fu">replace</span>(donnees_rbase_sans_na[, variable],</span>
<span id="cb430-5"><a href="#cb430-5" aria-hidden="true" tabindex="-1"></a>                                             <span class="fu">is.na</span>(donnees_rbase_sans_na[, variable]), <span class="dv">0</span>)</span>
<span id="cb430-6"><a href="#cb430-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-7"><a href="#cb430-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou alors</span></span>
<span id="cb430-8"><a href="#cb430-8" aria-hidden="true" tabindex="-1"></a>donnees_rbase_sans_na <span class="ot">&lt;-</span> donnees_rbase</span>
<span id="cb430-9"><a href="#cb430-9" aria-hidden="true" tabindex="-1"></a>donnees_rbase_sans_na<span class="sc">$</span>note_contenu[<span class="fu">is.na</span>(donnees_rbase_sans_na<span class="sc">$</span>note_contenu)] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code></pre></div>
</div>
</div>
<div id="tabset-100-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-100-3-tab">
<div class="cell">
<div class="sourceCode" id="cb431"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;note_contenu&quot;</span></span>
<span id="cb431-2"><a href="#cb431-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse_sans_na <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb431-3"><a href="#cb431-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(variable,  <span class="sc">~</span>tidyr<span class="sc">::</span><span class="fu">replace_na</span>(.x, <span class="dv">0</span>)))</span>
<span id="cb431-4"><a href="#cb431-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-5"><a href="#cb431-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou alors</span></span>
<span id="cb431-6"><a href="#cb431-6" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse_sans_na <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb431-7"><a href="#cb431-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">note_contenu =</span> tidyr<span class="sc">::</span><span class="fu">replace_na</span>(note_contenu, <span class="dv">0</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-100-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-100-4-tab">
<div class="cell">
<div class="sourceCode" id="cb432"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb432-1"><a href="#cb432-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;note_contenu&quot;</span></span>
<span id="cb432-2"><a href="#cb432-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">replace</span>(.SD, <span class="fu">is.na</span>(.SD), <span class="dv">0</span>), .SDcols <span class="ot">=</span> variable]</span>
<span id="cb432-3"><a href="#cb432-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">fifelse</span>(<span class="fu">is.na</span>(x), <span class="dv">0</span>, x)), .SDcols <span class="ot">=</span> variable]</span>
<span id="cb432-4"><a href="#cb432-4" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">lapply</span>(.SD, \(x) <span class="fu">fifelse</span>(<span class="fu">is.na</span>(x), <span class="dv">0</span>, x)), .SDcols <span class="ot">=</span> variable]</span>
<span id="cb432-5"><a href="#cb432-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-6"><a href="#cb432-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou alors</span></span>
<span id="cb432-7"><a href="#cb432-7" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">replace</span>(.SD, <span class="fu">is.na</span>(.SD), <span class="dv">0</span>), .SDcols <span class="ot">=</span> <span class="st">&quot;note_contenu&quot;</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-100-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-100-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="remplacer-toutes-les-valeurs-numériques-manquantes-par-0" class="level2" data-number="15.5">
<h2 data-number="15.5"><span class="header-section-number">15.5</span> Remplacer toutes les valeurs numériques manquantes par 0</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-101-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-101-1" role="tab" aria-controls="tabset-101-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-101-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-101-2" role="tab" aria-controls="tabset-101-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-101-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-101-3" role="tab" aria-controls="tabset-101-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-101-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-101-4" role="tab" aria-controls="tabset-101-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-101-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-101-5" role="tab" aria-controls="tabset-101-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-101-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-101-1-tab">
<div class="sourceCode" id="cb433"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* On sélectionne toutes les variables numériques */</span></span>
<span id="cb433-2"><a href="#cb433-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> contents<span class="kw"> data</span> = donnees_sas out = <span class="fu">Var</span> noprint<span class="kw">;run</span>;</span>
<span id="cb433-3"><a href="#cb433-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql noprint;</span>
<span id="cb433-4"><a href="#cb433-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> name <span class="kw">into</span> :nom_col separated <span class="kw">by</span> <span class="st">&quot; &quot;</span> <span class="kw">from</span> <span class="fu">Var</span> <span class="kw">where</span> <span class="kw">format</span> = <span class="st">&quot;&quot;</span>;</span>
<span id="cb433-5"><a href="#cb433-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb433-6"><a href="#cb433-6" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas_sans_missing;</span>
<span id="cb433-7"><a href="#cb433-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb433-8"><a href="#cb433-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb433-9"><a href="#cb433-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%macro</span> Missing;</span>
<span id="cb433-10"><a href="#cb433-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%local</span> i <span class="fu">var</span>;</span>
<span id="cb433-11"><a href="#cb433-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%do</span> i = <span class="dv">1</span> <span class="kw">%to</span> <span class="kw">%sysfunc</span>(countw(<span class="kw">&amp;nom_col.</span>));</span>
<span id="cb433-12"><a href="#cb433-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">%let</span> <span class="fu">var</span> = <span class="kw">%scan</span>(<span class="kw">&amp;nom_col.</span>, <span class="kw">&amp;i)</span>;</span>
<span id="cb433-13"><a href="#cb433-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">if</span> missing(<span class="kw">&amp;var.</span>) <span class="kw">then</span> <span class="kw">&amp;var.</span> = <span class="dv">0</span>;</span>
<span id="cb433-14"><a href="#cb433-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%end</span>;</span>
<span id="cb433-15"><a href="#cb433-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%mend</span> Missing;</span>
<span id="cb433-16"><a href="#cb433-16" aria-hidden="true" tabindex="-1"></a>  %Missing;</span>
<span id="cb433-17"><a href="#cb433-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb433-18"><a href="#cb433-18" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb433-19"><a href="#cb433-19" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> datasets lib = Work nolist;<span class="kw">delete</span> <span class="fu">Var</span><span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-101-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-101-2-tab">
<div class="cell">
<div class="sourceCode" id="cb434"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dans le cas des dates, la valeur manquante a été remplacée par 1970-01-01</span></span>
<span id="cb434-2"><a href="#cb434-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase_sans_na <span class="ot">&lt;-</span> donnees_rbase</span>
<span id="cb434-3"><a href="#cb434-3" aria-hidden="true" tabindex="-1"></a>donnees_rbase_sans_na[<span class="fu">is.na</span>(donnees_rbase_sans_na)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb434-4"><a href="#cb434-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb434-5"><a href="#cb434-5" aria-hidden="true" tabindex="-1"></a><span class="co"># On remplace seulement les valeurs numériques par 0</span></span>
<span id="cb434-6"><a href="#cb434-6" aria-hidden="true" tabindex="-1"></a>donnees_rbase_sans_na <span class="ot">&lt;-</span> donnees_rbase</span>
<span id="cb434-7"><a href="#cb434-7" aria-hidden="true" tabindex="-1"></a>varNumeriques <span class="ot">&lt;-</span> <span class="fu">names</span>(donnees_rbase)[<span class="fu">unlist</span>(<span class="fu">lapply</span>(donnees_rbase, is.numeric))]</span>
<span id="cb434-8"><a href="#cb434-8" aria-hidden="true" tabindex="-1"></a>donnees_rbase_sans_na[, varNumeriques][<span class="fu">is.na</span>(donnees_rbase_sans_na[, varNumeriques])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb434-9"><a href="#cb434-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb434-10"><a href="#cb434-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution, avec replace</span></span>
<span id="cb434-11"><a href="#cb434-11" aria-hidden="true" tabindex="-1"></a>donnees_rbase_sans_na[, varNumeriques] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(donnees_rbase_sans_na[, varNumeriques],</span>
<span id="cb434-12"><a href="#cb434-12" aria-hidden="true" tabindex="-1"></a>                                                 <span class="cf">function</span>(x) {<span class="fu">replace</span>(x, <span class="fu">is.na</span>(x), <span class="dv">0</span>)})</span></code></pre></div>
</div>
</div>
<div id="tabset-101-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-101-3-tab">
<div class="cell">
<div class="sourceCode" id="cb435"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb435-1"><a href="#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On remplace seulement les valeurs numériques par 0</span></span>
<span id="cb435-2"><a href="#cb435-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse_sans_na <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb435-3"><a href="#cb435-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span>tidyr<span class="sc">::</span><span class="fu">replace_na</span>(.x, <span class="dv">0</span>)))</span>
<span id="cb435-4"><a href="#cb435-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-5"><a href="#cb435-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Autres façons d&#39;écrire les fonctions anonymes</span></span>
<span id="cb435-6"><a href="#cb435-6" aria-hidden="true" tabindex="-1"></a><span class="co"># La méthode complète</span></span>
<span id="cb435-7"><a href="#cb435-7" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse_sans_na <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb435-8"><a href="#cb435-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="cf">function</span>(x) tidyr<span class="sc">::</span><span class="fu">replace_na</span>(x, <span class="dv">0</span>)))</span>
<span id="cb435-9"><a href="#cb435-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Une autre façon de raccourcir (depuis R 4.1)</span></span>
<span id="cb435-10"><a href="#cb435-10" aria-hidden="true" tabindex="-1"></a><span class="co"># \(x) est un raccourci pour function(x)</span></span>
<span id="cb435-11"><a href="#cb435-11" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse_sans_na <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb435-12"><a href="#cb435-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), \(x) tidyr<span class="sc">::</span><span class="fu">replace_na</span>(x, <span class="dv">0</span>)))</span>
<span id="cb435-13"><a href="#cb435-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb435-14"><a href="#cb435-14" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse_sans_na <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb435-15"><a href="#cb435-15" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">modify_if</span>(is.numeric, <span class="sc">~</span>tidyr<span class="sc">::</span><span class="fu">replace_na</span>(.x, <span class="dv">0</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-101-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-101-4-tab">
<div class="cell">
<div class="sourceCode" id="cb436"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb436-1"><a href="#cb436-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable_sans_na <span class="ot">&lt;-</span> <span class="fu">copy</span>(donnees_datatable)</span>
<span id="cb436-2"><a href="#cb436-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setnafill</span>(donnees_datatable[, .SD, <span class="at">.SDcols =</span> is.numeric], <span class="at">fill =</span> <span class="dv">0</span>)</span>
<span id="cb436-3"><a href="#cb436-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-4"><a href="#cb436-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb436-5"><a href="#cb436-5" aria-hidden="true" tabindex="-1"></a>donnees_datatable_sans_na <span class="ot">&lt;-</span> <span class="fu">copy</span>(donnees_datatable)</span>
<span id="cb436-6"><a href="#cb436-6" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">colnames</span>(donnees_datatable_sans_na[, .SD, <span class="at">.SDcols =</span> is.numeric])</span>
<span id="cb436-7"><a href="#cb436-7" aria-hidden="true" tabindex="-1"></a>donnees_datatable_sans_na[, (cols) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">fifelse</span>(<span class="fu">is.na</span>(x), <span class="dv">0</span>, x)), .SDcols <span class="ot">=</span> cols]</span>
<span id="cb436-8"><a href="#cb436-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-9"><a href="#cb436-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensemble des colonnes</span></span>
<span id="cb436-10"><a href="#cb436-10" aria-hidden="true" tabindex="-1"></a>donnees_datatable_sans_na <span class="ot">&lt;-</span> <span class="fu">copy</span>(donnees_datatable)</span>
<span id="cb436-11"><a href="#cb436-11" aria-hidden="true" tabindex="-1"></a>donnees_datatable_sans_na[<span class="fu">is.na</span>(donnees_datatable_sans_na)] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code></pre></div>
</div>
</div>
<div id="tabset-101-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-101-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="les-doublons" class="level1" data-number="16">
<h1 data-number="16"><span class="header-section-number">16</span> Les doublons</h1>
<section id="doublons-pour-toutes-les-colonnes" class="level2" data-number="16.1">
<h2 data-number="16.1"><span class="header-section-number">16.1</span> Doublons pour toutes les colonnes</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-102-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-102-1" role="tab" aria-controls="tabset-102-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-102-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-102-2" role="tab" aria-controls="tabset-102-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-102-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-102-3" role="tab" aria-controls="tabset-102-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-102-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-102-4" role="tab" aria-controls="tabset-102-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-102-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-102-5" role="tab" aria-controls="tabset-102-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-102-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-102-1-tab">
<div class="sourceCode" id="cb437"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb437-1"><a href="#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* On extrait tous les doublons, pas la première occurrence */</span></span>
<span id="cb437-2"><a href="#cb437-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-3"><a href="#cb437-3" aria-hidden="true" tabindex="-1"></a><span class="co">/* On récupère déjà la dernière variable de la base (on en aura besoin plus loin) */</span></span>
<span id="cb437-4"><a href="#cb437-4" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> contents<span class="kw"> data</span> = donnees_sas out = <span class="fu">Var</span> noprint<span class="kw">;run</span>;</span>
<span id="cb437-5"><a href="#cb437-5" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql noprint;</span>
<span id="cb437-6"><a href="#cb437-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> name <span class="kw">into</span> :derniere_var</span>
<span id="cb437-7"><a href="#cb437-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> <span class="fu">Var</span></span>
<span id="cb437-8"><a href="#cb437-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span> <span class="fu">varnum</span> = (<span class="kw">select</span> <span class="fu">max</span>(<span class="fu">varnum</span>) <span class="kw">from</span> <span class="fu">Var</span>);</span>
<span id="cb437-9"><a href="#cb437-9" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb437-10"><a href="#cb437-10" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> <span class="kw">&amp;nom_col.;run</span>;</span>
<span id="cb437-11"><a href="#cb437-11" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Doublons;</span>
<span id="cb437-12"><a href="#cb437-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb437-13"><a href="#cb437-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> <span class="kw">&amp;nom_col.</span>;</span>
<span id="cb437-14"><a href="#cb437-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> <span class="kw">not</span> (first.<span class="kw">&amp;derniere_var.</span> <span class="kw">and</span> last.<span class="kw">&amp;derniere_var.</span>);</span>
<span id="cb437-15"><a href="#cb437-15" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-102-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-102-2-tab">
<div class="cell">
<div class="sourceCode" id="cb438"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb438-1"><a href="#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On extraie tous les doublons, pas la première occurrence</span></span>
<span id="cb438-2"><a href="#cb438-2" aria-hidden="true" tabindex="-1"></a>doublons <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">duplicated</span>(donnees_rbase), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-102-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-102-3-tab">
<div class="cell">
<div class="sourceCode" id="cb439"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb439-1"><a href="#cb439-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On extraie tous les doublons, pas la première occurrence</span></span>
<span id="cb439-2"><a href="#cb439-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb439-3"><a href="#cb439-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">everything</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb439-4"><a href="#cb439-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb439-5"><a href="#cb439-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb439-6"><a href="#cb439-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb439-7"><a href="#cb439-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb439-8"><a href="#cb439-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb439-9"><a href="#cb439-9" aria-hidden="true" tabindex="-1"></a>doublons <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span>  </span>
<span id="cb439-10"><a href="#cb439-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by_all</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb439-11"><a href="#cb439-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb439-12"><a href="#cb439-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb439-13"><a href="#cb439-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-102-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-102-4-tab">
<div class="cell">
<div class="sourceCode" id="cb440"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb440-1"><a href="#cb440-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On extraie tous les doublons, pas la première occurrence</span></span>
<span id="cb440-2"><a href="#cb440-2" aria-hidden="true" tabindex="-1"></a>doublons <span class="ot">&lt;-</span> donnees_datatable[<span class="fu">duplicated</span>(donnees_datatable), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-102-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-102-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="doublons-pour-une-ou-plusieurs-colonnes" class="level2" data-number="16.2">
<h2 data-number="16.2"><span class="header-section-number">16.2</span> Doublons pour une ou plusieurs colonnes</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-103-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-103-1" role="tab" aria-controls="tabset-103-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-103-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-103-2" role="tab" aria-controls="tabset-103-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-103-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-103-3" role="tab" aria-controls="tabset-103-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-103-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-103-4" role="tab" aria-controls="tabset-103-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-103-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-103-5" role="tab" aria-controls="tabset-103-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-103-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-103-1-tab">
<div class="sourceCode" id="cb441"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb441-1"><a href="#cb441-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* On extraie tous les doublons, pas la première occurrence */</span></span>
<span id="cb441-2"><a href="#cb441-2" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> <span class="fu">var</span> = identifiant;</span>
<span id="cb441-3"><a href="#cb441-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> <span class="kw">&amp;var.;run</span>;</span>
<span id="cb441-4"><a href="#cb441-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> doublons;</span>
<span id="cb441-5"><a href="#cb441-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb441-6"><a href="#cb441-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> <span class="kw">&amp;var.</span>;</span>
<span id="cb441-7"><a href="#cb441-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> <span class="kw">not</span> first.<span class="kw">&amp;var.</span>;</span>
<span id="cb441-8"><a href="#cb441-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-103-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-103-2-tab">
<div class="cell">
<div class="sourceCode" id="cb442"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb442-1"><a href="#cb442-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On extraie tous les doublons, pas la première occurrence</span></span>
<span id="cb442-2"><a href="#cb442-2" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;identifiant&quot;</span></span>
<span id="cb442-3"><a href="#cb442-3" aria-hidden="true" tabindex="-1"></a>doublons <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">duplicated</span>(donnees_rbase[, variable]), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-103-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-103-3-tab">
<div class="cell">
<div class="sourceCode" id="cb443"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb443-1"><a href="#cb443-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On extraie tous les doublons, pas la première occurrence</span></span>
<span id="cb443-2"><a href="#cb443-2" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;identifiant&quot;</span></span>
<span id="cb443-3"><a href="#cb443-3" aria-hidden="true" tabindex="-1"></a>doublons <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span>  </span>
<span id="cb443-4"><a href="#cb443-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(variable)) <span class="sc">%&gt;%</span> </span>
<span id="cb443-5"><a href="#cb443-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb443-6"><a href="#cb443-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb443-7"><a href="#cb443-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-103-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-103-4-tab">
<div class="cell">
<div class="sourceCode" id="cb444"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb444-1"><a href="#cb444-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On extraie tous les doublons, pas la première occurrence</span></span>
<span id="cb444-2"><a href="#cb444-2" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;identifiant&quot;</span></span>
<span id="cb444-3"><a href="#cb444-3" aria-hidden="true" tabindex="-1"></a>doublons <span class="ot">&lt;-</span> donnees_datatable[<span class="fu">duplicated</span>(donnees_datatable[, ..variable]), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-103-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-103-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="récupérer-toutes-les-lignes-pour-les-identifiants-en-doublon" class="level2" data-number="16.3">
<h2 data-number="16.3"><span class="header-section-number">16.3</span> Récupérer toutes les lignes pour les identifiants en doublon</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-104-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-104-1" role="tab" aria-controls="tabset-104-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-104-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-104-2" role="tab" aria-controls="tabset-104-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-104-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-104-3" role="tab" aria-controls="tabset-104-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-104-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-104-4" role="tab" aria-controls="tabset-104-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-104-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-104-5" role="tab" aria-controls="tabset-104-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-104-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-104-1-tab">
<div class="sourceCode" id="cb445"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb445-1"><a href="#cb445-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> <span class="fu">var</span> = identifiant;</span>
<span id="cb445-2"><a href="#cb445-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* On groupe par la colonne identifiant, et si on aboutit à strictement plus d&#39;une ligne, c&#39;est un doublon */</span></span>
<span id="cb445-3"><a href="#cb445-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb445-4"><a href="#cb445-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> enDouble <span class="kw">as</span></span>
<span id="cb445-5"><a href="#cb445-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> * <span class="kw">from</span> donnees_sas</span>
<span id="cb445-6"><a href="#cb445-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">group</span> <span class="kw">by</span> <span class="kw">&amp;var.</span></span>
<span id="cb445-7"><a href="#cb445-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">having</span> count(*) &gt; <span class="dv">1</span>;</span>
<span id="cb445-8"><a href="#cb445-8" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-104-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-104-2-tab">
<div class="cell">
<div class="sourceCode" id="cb446"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb446-1"><a href="#cb446-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;identifiant&quot;</span></span>
<span id="cb446-2"><a href="#cb446-2" aria-hidden="true" tabindex="-1"></a>enDouble <span class="ot">&lt;-</span> donnees_rbase[donnees_rbase[, variable] <span class="sc">%in%</span></span>
<span id="cb446-3"><a href="#cb446-3" aria-hidden="true" tabindex="-1"></a>                            donnees_rbase[<span class="fu">duplicated</span>(donnees_rbase[, variable]), variable]]</span></code></pre></div>
</div>
</div>
<div id="tabset-104-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-104-3-tab">
<div class="cell">
<div class="sourceCode" id="cb447"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb447-1"><a href="#cb447-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;identifiant&quot;</span></span>
<span id="cb447-2"><a href="#cb447-2" aria-hidden="true" tabindex="-1"></a>enDouble <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span>  </span>
<span id="cb447-3"><a href="#cb447-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(variable)) <span class="sc">%&gt;%</span> </span>
<span id="cb447-4"><a href="#cb447-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb447-5"><a href="#cb447-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-104-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-104-4-tab">
<div class="cell">
<div class="sourceCode" id="cb448"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb448-1"><a href="#cb448-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;identifiant&quot;</span></span>
<span id="cb448-2"><a href="#cb448-2" aria-hidden="true" tabindex="-1"></a>enDouble <span class="ot">&lt;-</span> donnees_datatable[donnees_datatable[[variable]] <span class="sc">%chin%</span></span>
<span id="cb448-3"><a href="#cb448-3" aria-hidden="true" tabindex="-1"></a>                                donnees_datatable[[variable]][<span class="fu">duplicated</span>(donnees_datatable[[variable]])], ]</span></code></pre></div>
</div>
</div>
<div id="tabset-104-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-104-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="récupérer-toutes-les-lignes-pour-les-identifiants-sans-doublon" class="level2" data-number="16.4">
<h2 data-number="16.4"><span class="header-section-number">16.4</span> Récupérer toutes les lignes pour les identifiants sans doublon</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-105-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-105-1" role="tab" aria-controls="tabset-105-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-105-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-105-2" role="tab" aria-controls="tabset-105-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-105-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-105-3" role="tab" aria-controls="tabset-105-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-105-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-105-4" role="tab" aria-controls="tabset-105-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-105-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-105-5" role="tab" aria-controls="tabset-105-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-105-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-105-1-tab">
<div class="sourceCode" id="cb449"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb449-1"><a href="#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> <span class="fu">var</span> = identifiant;</span>
<span id="cb449-2"><a href="#cb449-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb449-3"><a href="#cb449-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> sansDouble <span class="kw">as</span></span>
<span id="cb449-4"><a href="#cb449-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> * <span class="kw">from</span> donnees_sas</span>
<span id="cb449-5"><a href="#cb449-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">group</span> <span class="kw">by</span> <span class="kw">&amp;var.</span></span>
<span id="cb449-6"><a href="#cb449-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">having</span> count(*) = <span class="dv">1</span>;</span>
<span id="cb449-7"><a href="#cb449-7" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-105-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-105-2-tab">
<div class="cell">
<div class="sourceCode" id="cb450"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb450-1"><a href="#cb450-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;identifiant&quot;</span></span>
<span id="cb450-2"><a href="#cb450-2" aria-hidden="true" tabindex="-1"></a>sansDouble <span class="ot">&lt;-</span> donnees_rbase[<span class="sc">!</span> donnees_rbase[, variable] <span class="sc">%in%</span></span>
<span id="cb450-3"><a href="#cb450-3" aria-hidden="true" tabindex="-1"></a>                              donnees_rbase[<span class="fu">duplicated</span>(donnees_rbase[, variable]), variable]]</span></code></pre></div>
</div>
</div>
<div id="tabset-105-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-105-3-tab">
<div class="cell">
<div class="sourceCode" id="cb451"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb451-1"><a href="#cb451-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;identifiant&quot;</span></span>
<span id="cb451-2"><a href="#cb451-2" aria-hidden="true" tabindex="-1"></a>sansDouble <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span>  </span>
<span id="cb451-3"><a href="#cb451-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(variable)) <span class="sc">%&gt;%</span> </span>
<span id="cb451-4"><a href="#cb451-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb451-5"><a href="#cb451-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-105-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-105-4-tab">
<div class="cell">
<div class="sourceCode" id="cb452"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb452-1"><a href="#cb452-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;identifiant&quot;</span></span>
<span id="cb452-2"><a href="#cb452-2" aria-hidden="true" tabindex="-1"></a>sansDouble <span class="ot">&lt;-</span> donnees_datatable[<span class="sc">!</span> donnees_datatable[[variable]] <span class="sc">%chin%</span></span>
<span id="cb452-3"><a href="#cb452-3" aria-hidden="true" tabindex="-1"></a>                                  donnees_datatable[[variable]][<span class="fu">duplicated</span>(donnees_datatable[[variable]])], ]</span></code></pre></div>
</div>
</div>
<div id="tabset-105-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-105-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="suppression-des-doublons-pour-lensemble-des-variables" class="level2" data-number="16.5">
<h2 data-number="16.5"><span class="header-section-number">16.5</span> Suppression des doublons pour l’ensemble des variables</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-106-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-106-1" role="tab" aria-controls="tabset-106-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-106-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-106-2" role="tab" aria-controls="tabset-106-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-106-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-106-3" role="tab" aria-controls="tabset-106-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-106-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-106-4" role="tab" aria-controls="tabset-106-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-106-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-106-5" role="tab" aria-controls="tabset-106-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-106-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-106-1-tab">
<div class="sourceCode" id="cb453"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb453-1"><a href="#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* 1ère méthode */</span></span>
<span id="cb453-2"><a href="#cb453-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas nodupkey;</span>
<span id="cb453-3"><a href="#cb453-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> _all_;</span>
<span id="cb453-4"><a href="#cb453-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb453-5"><a href="#cb453-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-6"><a href="#cb453-6" aria-hidden="true" tabindex="-1"></a><span class="co">/* 2e méthode, avec first. et last. (cf. infra) */</span></span>
<span id="cb453-7"><a href="#cb453-7" aria-hidden="true" tabindex="-1"></a><span class="co">/* On récupère déjà la dernière variable de la base (on en aura besoin plus loin) */</span></span>
<span id="cb453-8"><a href="#cb453-8" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> contents<span class="kw"> data</span> = donnees_sas out = <span class="fu">Var</span> noprint<span class="kw">;run</span>;</span>
<span id="cb453-9"><a href="#cb453-9" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql noprint;</span>
<span id="cb453-10"><a href="#cb453-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> name <span class="kw">into</span> :derniere_var <span class="kw">from</span> <span class="fu">Var</span></span>
<span id="cb453-11"><a href="#cb453-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span> <span class="fu">varnum</span> = (<span class="kw">select</span> <span class="fu">max</span>(<span class="fu">varnum</span>) <span class="kw">from</span> <span class="fu">Var</span>);</span>
<span id="cb453-12"><a href="#cb453-12" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb453-13"><a href="#cb453-13" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql noprint;</span>
<span id="cb453-14"><a href="#cb453-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> name <span class="kw">into</span> :nom_col separated <span class="kw">by</span> <span class="st">&quot; &quot;</span> <span class="kw">from</span> <span class="fu">Var</span> <span class="kw">order</span> <span class="kw">by</span> <span class="fu">varnum</span>;</span>
<span id="cb453-15"><a href="#cb453-15" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb453-16"><a href="#cb453-16" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> Dernière variable de la base : <span class="kw">&amp;derniere_var.</span>;</span>
<span id="cb453-17"><a href="#cb453-17" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> <span class="kw">&amp;nom_col.;run</span>;</span>
<span id="cb453-18"><a href="#cb453-18" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> sansDouble;</span>
<span id="cb453-19"><a href="#cb453-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb453-20"><a href="#cb453-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> <span class="kw">&amp;nom_col.</span>;</span>
<span id="cb453-21"><a href="#cb453-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> first.<span class="kw">&amp;derniere_var.</span>;</span>
<span id="cb453-22"><a href="#cb453-22" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-106-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-106-2-tab">
<div class="cell">
<div class="sourceCode" id="cb454"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb454-1"><a href="#cb454-1" aria-hidden="true" tabindex="-1"></a>donnees_rbase_sansdoublon <span class="ot">&lt;-</span> donnees_rbase[<span class="sc">!</span> <span class="fu">duplicated</span>(donnees_rbase), ]</span>
<span id="cb454-2"><a href="#cb454-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-3"><a href="#cb454-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution (équivalente à la solution first. de SAS)</span></span>
<span id="cb454-4"><a href="#cb454-4" aria-hidden="true" tabindex="-1"></a>donnees_rbase_sansdoublon <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(<span class="fu">colnames</span>(donnees_rbase), <span class="at">na.last =</span> <span class="cn">FALSE</span>), ]</span>
<span id="cb454-5"><a href="#cb454-5" aria-hidden="true" tabindex="-1"></a>donnees_rbase_sansdoublon <span class="ot">&lt;-</span> donnees_rbase[<span class="sc">!</span><span class="fu">duplicated</span>(donnees_rbase[, <span class="fu">colnames</span>(donnees_rbase)], <span class="at">fromLast =</span> <span class="cn">TRUE</span>), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-106-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-106-3-tab">
<div class="cell">
<div class="sourceCode" id="cb455"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb455-1"><a href="#cb455-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse_sansdoublon <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb455-2"><a href="#cb455-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">pick</span>(<span class="fu">everything</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb455-3"><a href="#cb455-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb455-4"><a href="#cb455-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-5"><a href="#cb455-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb455-6"><a href="#cb455-6" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse_sansdoublon <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb455-7"><a href="#cb455-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">across</span>(<span class="fu">everything</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb455-8"><a href="#cb455-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-106-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-106-4-tab">
<div class="cell">
<div class="sourceCode" id="cb456"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb456-1"><a href="#cb456-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable_sansdoublon <span class="ot">&lt;-</span> <span class="fu">unique</span>(donnees_datatable)</span>
<span id="cb456-2"><a href="#cb456-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable_sansdoublon <span class="ot">&lt;-</span> donnees_datatable[<span class="sc">!</span> <span class="fu">duplicated</span>(donnees_datatable), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-106-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-106-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="suppression-des-doublons-pour-une-seule-variable" class="level2" data-number="16.6">
<h2 data-number="16.6"><span class="header-section-number">16.6</span> Suppression des doublons pour une seule variable</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-107-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-107-1" role="tab" aria-controls="tabset-107-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-107-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-107-2" role="tab" aria-controls="tabset-107-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-107-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-107-3" role="tab" aria-controls="tabset-107-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-107-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-107-4" role="tab" aria-controls="tabset-107-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-107-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-107-5" role="tab" aria-controls="tabset-107-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-107-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-107-1-tab">
<div class="sourceCode" id="cb457"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb457-1"><a href="#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> _all_<span class="kw">;run</span>;</span>
<span id="cb457-2"><a href="#cb457-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> sansDouble;</span>
<span id="cb457-3"><a href="#cb457-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb457-4"><a href="#cb457-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> _all_;</span>
<span id="cb457-5"><a href="#cb457-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> first.identifiant;</span>
<span id="cb457-6"><a href="#cb457-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-107-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-107-2-tab">
<div class="cell">
<div class="sourceCode" id="cb458"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb458-1"><a href="#cb458-1" aria-hidden="true" tabindex="-1"></a>donnees_rbase_sansdoublon <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(<span class="fu">colnames</span>(donnees_rbase), <span class="at">na.last =</span> <span class="cn">FALSE</span>), ]</span>
<span id="cb458-2"><a href="#cb458-2" aria-hidden="true" tabindex="-1"></a>donnees_rbase_sansdoublon <span class="ot">&lt;-</span> donnees_rbase_sansdoublon[<span class="sc">!</span><span class="fu">duplicated</span>(donnees_rbase_sansdoublon<span class="sc">$</span>identifiant), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-107-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-107-3-tab">
<div class="cell">
<div class="sourceCode" id="cb459"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb459-1"><a href="#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="co"># L&#39;option .keep_all = TRUE est nécessaire </span></span>
<span id="cb459-2"><a href="#cb459-2" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : REVOIR LE TRI PAR RAPPORT A SAS !!!</span></span>
<span id="cb459-3"><a href="#cb459-3" aria-hidden="true" tabindex="-1"></a>sansDouble <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb459-4"><a href="#cb459-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">pick</span>(<span class="fu">everything</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb459-5"><a href="#cb459-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(identifiant, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb459-6"><a href="#cb459-6" aria-hidden="true" tabindex="-1"></a>sansDouble <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb459-7"><a href="#cb459-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">across</span>(<span class="fu">everything</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb459-8"><a href="#cb459-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(identifiant, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-107-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-107-4-tab">
<div class="cell">
<div class="sourceCode" id="cb460"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb460-1"><a href="#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setorderv</span>(donnees_datatable, <span class="at">cols =</span> <span class="fu">colnames</span>(donnees_datatable), <span class="at">na.last =</span> <span class="cn">FALSE</span>)</span>
<span id="cb460-2"><a href="#cb460-2" aria-hidden="true" tabindex="-1"></a>sansDouble <span class="ot">&lt;-</span> donnees_datatable[<span class="sc">!</span> <span class="fu">duplicated</span>(donnees_datatable[, <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>)]), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-107-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-107-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="identifiants-uniques" class="level2" data-number="16.7">
<h2 data-number="16.7"><span class="header-section-number">16.7</span> Identifiants uniques</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-108-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-108-1" role="tab" aria-controls="tabset-108-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-108-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-108-2" role="tab" aria-controls="tabset-108-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-108-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-108-3" role="tab" aria-controls="tabset-108-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-108-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-108-4" role="tab" aria-controls="tabset-108-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-108-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-108-5" role="tab" aria-controls="tabset-108-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-108-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-108-1-tab">
<div class="sourceCode" id="cb461"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb461-1"><a href="#cb461-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb461-2"><a href="#cb461-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> id <span class="kw">as</span> <span class="kw">select</span> <span class="kw">distinct</span> identifiant <span class="kw">from</span> donnees_sas <span class="kw">order</span> <span class="kw">by</span> identifiant;</span>
<span id="cb461-3"><a href="#cb461-3" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-108-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-108-2-tab">
<div class="cell">
<div class="sourceCode" id="cb462"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb462-1"><a href="#cb462-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(donnees_rbase[<span class="st">&quot;identifiant&quot;</span>])</span></code></pre></div>
</div>
</div>
<div id="tabset-108-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-108-3-tab">
<div class="cell">
<div class="sourceCode" id="cb463"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb463-1"><a href="#cb463-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb463-2"><a href="#cb463-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(identifiant)</span></code></pre></div>
</div>
</div>
<div id="tabset-108-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-108-4-tab">
<div class="cell">
<div class="sourceCode" id="cb464"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb464-1"><a href="#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(donnees_datatable[, <span class="st">&quot;identifiant&quot;</span>])</span></code></pre></div>
</div>
</div>
<div id="tabset-108-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-108-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="nombre-de-lignes-uniques-sans-doublon" class="level2" data-number="16.8">
<h2 data-number="16.8"><span class="header-section-number">16.8</span> Nombre de lignes uniques, sans doublon</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-109-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-109-1" role="tab" aria-controls="tabset-109-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-109-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-109-2" role="tab" aria-controls="tabset-109-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-109-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-109-3" role="tab" aria-controls="tabset-109-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-109-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-109-4" role="tab" aria-controls="tabset-109-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-109-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-109-5" role="tab" aria-controls="tabset-109-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-109-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-109-1-tab">
<div class="sourceCode" id="cb465"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb465-1"><a href="#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> contents<span class="kw"> data</span> = donnees_sas out = <span class="fu">Var</span> noprint<span class="kw">;run</span>;</span>
<span id="cb465-2"><a href="#cb465-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql noprint;<span class="kw">select</span> name <span class="kw">into</span> :nom_col separated <span class="kw">by</span> <span class="st">&quot;, &quot;</span> <span class="kw">from</span> <span class="fu">Var</span> <span class="kw">order</span> <span class="kw">by</span> <span class="fu">varnum</span>;<span class="kw">quit</span>;</span>
<span id="cb465-3"><a href="#cb465-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb465-4"><a href="#cb465-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> count(*) <span class="kw">as</span> Nb_Lignes_Uniques</span>
<span id="cb465-5"><a href="#cb465-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> (<span class="kw">select</span> <span class="kw">&amp;nom_col.</span>, count(*) <span class="kw">from</span> donnees_sas <span class="kw">group</span> <span class="kw">by</span> <span class="kw">&amp;nom_col.</span>);</span>
<span id="cb465-6"><a href="#cb465-6" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-109-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-109-2-tab">
<div class="cell">
<div class="sourceCode" id="cb466"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb466-1"><a href="#cb466-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(<span class="fu">unique</span>(donnees_rbase))</span></code></pre></div>
</div>
</div>
<div id="tabset-109-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-109-3-tab">
<div class="cell">
<div class="sourceCode" id="cb467"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb467-1"><a href="#cb467-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb467-2"><a href="#cb467-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb467-3"><a href="#cb467-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-109-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-109-4-tab">
<div class="cell">
<div class="sourceCode" id="cb468"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb468-1"><a href="#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : pas sûr de moi</span></span>
<span id="cb468-2"><a href="#cb468-2" aria-hidden="true" tabindex="-1"></a><span class="fu">uniqueN</span>(donnees_datatable)</span></code></pre></div>
</div>
</div>
<div id="tabset-109-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-109-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="les-jointures-de-bases" class="level1" data-number="17">
<h1 data-number="17"><span class="header-section-number">17</span> Les jointures de bases</h1>
<p>Pour fonctionner, les codes de cette partie nécessitent l’import des bases d’exemple de la section “Importation de bases pour la jointure”.</p>
<section id="importation-de-bases-pour-les-jointures" class="level2" data-number="17.1">
<h2 data-number="17.1"><span class="header-section-number">17.1</span> Importation de bases pour les jointures</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-110-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-110-1" role="tab" aria-controls="tabset-110-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-110-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-110-2" role="tab" aria-controls="tabset-110-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-110-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-110-3" role="tab" aria-controls="tabset-110-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-110-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-110-4" role="tab" aria-controls="tabset-110-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-110-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-110-5" role="tab" aria-controls="tabset-110-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-110-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-110-1-tab">
<div class="sourceCode" id="cb469"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb469-1"><a href="#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* On suppose que l&#39;on dispose d&#39;une base supplémentaire avec les diplômes des personnes */</span></span>
<span id="cb469-2"><a href="#cb469-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Diplome;</span>
<span id="cb469-3"><a href="#cb469-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">infile</span> <span class="kw">cards</span> dsd dlm=<span class="st">&#39;|&#39;</span>;</span>
<span id="cb469-4"><a href="#cb469-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Identifiant $<span class="dv">3</span>. Diplome $<span class="dv">20</span>.;</span>
<span id="cb469-5"><a href="#cb469-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">input</span> Identifiant $ Diplome $;</span>
<span id="cb469-6"><a href="#cb469-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">cards</span>;</span>
<span id="cb469-7"><a href="#cb469-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">173</span>|Bac</span>
<span id="cb469-8"><a href="#cb469-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">168</span>|Bep-Cap</span>
<span id="cb469-9"><a href="#cb469-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">112</span>|Bep-Cap</span>
<span id="cb469-10"><a href="#cb469-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">087</span>|Bac+<span class="dv">2</span></span>
<span id="cb469-11"><a href="#cb469-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">689</span>|Bac+<span class="dv">2</span></span>
<span id="cb469-12"><a href="#cb469-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">765</span>|Pas de diplôme</span>
<span id="cb469-13"><a href="#cb469-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">113</span>|Bac</span>
<span id="cb469-14"><a href="#cb469-14" aria-hidden="true" tabindex="-1"></a>  <span class="dv">999</span>|Bac</span>
<span id="cb469-15"><a href="#cb469-15" aria-hidden="true" tabindex="-1"></a>  <span class="dv">554</span>|Bep-Cap</span>
<span id="cb469-16"><a href="#cb469-16" aria-hidden="true" tabindex="-1"></a>  ;</span>
<span id="cb469-17"><a href="#cb469-17" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb469-18"><a href="#cb469-18" aria-hidden="true" tabindex="-1"></a><span class="co">/* On suppose que l&#39;on dispose aussi d&#39;une base supplémentaire indiquant la date d&#39;une entrevue avec un conseiller */</span></span>
<span id="cb469-19"><a href="#cb469-19" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Entrevue;</span>
<span id="cb469-20"><a href="#cb469-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">infile</span> <span class="kw">cards</span> dsd dlm=<span class="st">&#39;|&#39;</span>;</span>
<span id="cb469-21"><a href="#cb469-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Identifiant $<span class="dv">3</span>. Date_entrevue ddmmyy10.;</span>
<span id="cb469-22"><a href="#cb469-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">input</span> Identifiant $ Date_entrevue ddmmyy10.;</span>
<span id="cb469-23"><a href="#cb469-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">cards</span>;</span>
<span id="cb469-24"><a href="#cb469-24" aria-hidden="true" tabindex="-1"></a>  <span class="dv">173</span>|<span class="dv">06</span>/<span class="dv">08</span>/<span class="dv">2021</span></span>
<span id="cb469-25"><a href="#cb469-25" aria-hidden="true" tabindex="-1"></a>  <span class="dv">168</span>|<span class="dv">17</span>/<span class="dv">10</span>/<span class="dv">2019</span></span>
<span id="cb469-26"><a href="#cb469-26" aria-hidden="true" tabindex="-1"></a>  <span class="dv">087</span>|<span class="dv">12</span>/<span class="dv">06</span>/<span class="dv">2021</span></span>
<span id="cb469-27"><a href="#cb469-27" aria-hidden="true" tabindex="-1"></a>  <span class="dv">689</span>|<span class="dv">28</span>/<span class="dv">03</span>/<span class="dv">2018</span></span>
<span id="cb469-28"><a href="#cb469-28" aria-hidden="true" tabindex="-1"></a>  <span class="dv">099</span>|<span class="dv">01</span>/<span class="dv">09</span>/<span class="dv">2022</span></span>
<span id="cb469-29"><a href="#cb469-29" aria-hidden="true" tabindex="-1"></a>  <span class="dv">765</span>|<span class="dv">01</span>/<span class="dv">10</span>/<span class="dv">2020</span></span>
<span id="cb469-30"><a href="#cb469-30" aria-hidden="true" tabindex="-1"></a>  ;</span>
<span id="cb469-31"><a href="#cb469-31" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb469-32"><a href="#cb469-32" aria-hidden="true" tabindex="-1"></a><span class="co">/* On récupère un extrait de la base initiale */</span></span>
<span id="cb469-33"><a href="#cb469-33" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Jointure;</span>
<span id="cb469-34"><a href="#cb469-34" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = Identifiant Sexe date_entree date_sortie);</span>
<span id="cb469-35"><a href="#cb469-35" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-110-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-110-2-tab">
<div class="cell">
<div class="sourceCode" id="cb470"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb470-1"><a href="#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On suppose que l&#39;on dispose d&#39;une base supplémentaire avec les diplômes des personnes</span></span>
<span id="cb470-2"><a href="#cb470-2" aria-hidden="true" tabindex="-1"></a>diplome_rbase <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">identifiant =</span> <span class="fu">c</span>(<span class="st">&quot;173&quot;</span>, <span class="st">&quot;168&quot;</span>, <span class="st">&quot;112&quot;</span>, <span class="st">&quot;087&quot;</span>, <span class="st">&quot;689&quot;</span>, <span class="st">&quot;765&quot;</span>, <span class="st">&quot;113&quot;</span>, <span class="st">&quot;999&quot;</span>, <span class="st">&quot;554&quot;</span>),</span>
<span id="cb470-3"><a href="#cb470-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">diplome =</span> <span class="fu">c</span>(<span class="st">&quot;Bac&quot;</span>, <span class="st">&quot;Bep-Cap&quot;</span>, <span class="st">&quot;Bep-Cap&quot;</span>, <span class="st">&quot;Bac+2&quot;</span>, <span class="st">&quot;Bac+2&quot;</span>, <span class="st">&quot;Pas de diplôme&quot;</span>, <span class="st">&quot;Bac&quot;</span>, <span class="st">&quot;Bac&quot;</span>, <span class="st">&quot;Bep-Cap&quot;</span>))</span>
<span id="cb470-4"><a href="#cb470-4" aria-hidden="true" tabindex="-1"></a><span class="co"># On suppose que l&#39;on dispose d&#39;une base supplémentaire indiquant la date d&#39;une entrevue avec un conseiller</span></span>
<span id="cb470-5"><a href="#cb470-5" aria-hidden="true" tabindex="-1"></a>entrevue_rbase <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">identifiant =</span> <span class="fu">c</span>(<span class="st">&quot;173&quot;</span>, <span class="st">&quot;168&quot;</span>, <span class="st">&quot;087&quot;</span>, <span class="st">&quot;689&quot;</span>, <span class="st">&quot;099&quot;</span>, <span class="st">&quot;765&quot;</span>),</span>
<span id="cb470-6"><a href="#cb470-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">date_entrevue =</span> <span class="fu">c</span>(<span class="st">&quot;06/08/2021&quot;</span>, <span class="st">&quot;17/10/2019&quot;</span>, <span class="st">&quot;12/06/2021&quot;</span>, <span class="st">&quot;28/03/2018&quot;</span>, <span class="st">&quot;01/09/2022&quot;</span>, <span class="st">&quot;01/10/2020&quot;</span>))</span>
<span id="cb470-7"><a href="#cb470-7" aria-hidden="true" tabindex="-1"></a>entrevue_rbase<span class="sc">$</span>date_entrevue <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">dmy</span>(entrevue_rbase<span class="sc">$</span>date_entrevue)</span>
<span id="cb470-8"><a href="#cb470-8" aria-hidden="true" tabindex="-1"></a><span class="co"># On récupère un extrait de la base initiale</span></span>
<span id="cb470-9"><a href="#cb470-9" aria-hidden="true" tabindex="-1"></a>jointure_rbase <span class="ot">&lt;-</span> donnees_rbase[, <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;sexe&quot;</span>, <span class="st">&quot;date_entree&quot;</span>, <span class="st">&quot;date_sortie&quot;</span>)]</span></code></pre></div>
</div>
</div>
<div id="tabset-110-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-110-3-tab">
<div class="cell">
<div class="sourceCode" id="cb471"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb471-1"><a href="#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On suppose que l&#39;on dispose d&#39;une base supplémentaire avec les diplômes des personnes</span></span>
<span id="cb471-2"><a href="#cb471-2" aria-hidden="true" tabindex="-1"></a>diplome_tidyverse <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">identifiant =</span> <span class="fu">c</span>(<span class="st">&quot;173&quot;</span>, <span class="st">&quot;168&quot;</span>, <span class="st">&quot;112&quot;</span>, <span class="st">&quot;087&quot;</span>, <span class="st">&quot;689&quot;</span>, <span class="st">&quot;765&quot;</span>, <span class="st">&quot;113&quot;</span>, <span class="st">&quot;999&quot;</span>, <span class="st">&quot;554&quot;</span>),</span>
<span id="cb471-3"><a href="#cb471-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">diplome =</span> <span class="fu">c</span>(<span class="st">&quot;Bac&quot;</span>, <span class="st">&quot;Bep-Cap&quot;</span>, <span class="st">&quot;Bep-Cap&quot;</span>, <span class="st">&quot;Bac+2&quot;</span>, <span class="st">&quot;Bac+2&quot;</span>, <span class="st">&quot;Pas de diplôme&quot;</span>, <span class="st">&quot;Bac&quot;</span>, <span class="st">&quot;Bac&quot;</span>, <span class="st">&quot;Bep-Cap&quot;</span>))</span>
<span id="cb471-4"><a href="#cb471-4" aria-hidden="true" tabindex="-1"></a><span class="co"># On suppose que l&#39;on dispose d&#39;une base supplémentaire indiquant la date d&#39;une entrevue avec un conseiller</span></span>
<span id="cb471-5"><a href="#cb471-5" aria-hidden="true" tabindex="-1"></a>entrevue_tidyverse <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">identifiant =</span> <span class="fu">c</span>(<span class="st">&quot;173&quot;</span>, <span class="st">&quot;168&quot;</span>, <span class="st">&quot;087&quot;</span>, <span class="st">&quot;689&quot;</span>, <span class="st">&quot;099&quot;</span>, <span class="st">&quot;765&quot;</span>),</span>
<span id="cb471-6"><a href="#cb471-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">date_entrevue =</span> <span class="fu">c</span>(<span class="st">&quot;06/08/2021&quot;</span>, <span class="st">&quot;17/10/2019&quot;</span>, <span class="st">&quot;12/06/2021&quot;</span>, <span class="st">&quot;28/03/2018&quot;</span>, <span class="st">&quot;01/09/2022&quot;</span>, <span class="st">&quot;01/10/2020&quot;</span>))</span>
<span id="cb471-7"><a href="#cb471-7" aria-hidden="true" tabindex="-1"></a>entrevue_tidyverse <span class="ot">&lt;-</span> entrevue_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb471-8"><a href="#cb471-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_entrevue =</span> lubridate<span class="sc">::</span><span class="fu">dmy</span>(date_entrevue))</span>
<span id="cb471-9"><a href="#cb471-9" aria-hidden="true" tabindex="-1"></a><span class="co"># On récupère un extrait de la base initiale</span></span>
<span id="cb471-10"><a href="#cb471-10" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;sexe&quot;</span>, <span class="st">&quot;date_entree&quot;</span>, <span class="st">&quot;date_sortie&quot;</span>)</span>
<span id="cb471-11"><a href="#cb471-11" aria-hidden="true" tabindex="-1"></a>jointure_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb471-12"><a href="#cb471-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(variable)</span></code></pre></div>
</div>
</div>
<div id="tabset-110-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-110-4-tab">
<div class="cell">
<div class="sourceCode" id="cb472"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb472-1"><a href="#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On suppose que l&#39;on dispose d&#39;une base supplémentaire avec les diplômes des personnes</span></span>
<span id="cb472-2"><a href="#cb472-2" aria-hidden="true" tabindex="-1"></a>diplome_datatable <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">identifiant =</span> <span class="fu">c</span>(<span class="st">&quot;173&quot;</span>, <span class="st">&quot;168&quot;</span>, <span class="st">&quot;112&quot;</span>, <span class="st">&quot;087&quot;</span>, <span class="st">&quot;689&quot;</span>, <span class="st">&quot;765&quot;</span>, <span class="st">&quot;113&quot;</span>, <span class="st">&quot;999&quot;</span>, <span class="st">&quot;554&quot;</span>),</span>
<span id="cb472-3"><a href="#cb472-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">diplome =</span> <span class="fu">c</span>(<span class="st">&quot;Bac&quot;</span>, <span class="st">&quot;Bep-Cap&quot;</span>, <span class="st">&quot;Bep-Cap&quot;</span>, <span class="st">&quot;Bac+2&quot;</span>, <span class="st">&quot;Bac+2&quot;</span>, <span class="st">&quot;Pas de diplôme&quot;</span>, <span class="st">&quot;Bac&quot;</span>, <span class="st">&quot;Bac&quot;</span>, <span class="st">&quot;Bep-Cap&quot;</span>))</span>
<span id="cb472-4"><a href="#cb472-4" aria-hidden="true" tabindex="-1"></a><span class="co"># On suppose que l&#39;on dispose d&#39;une base supplémentaire indiquant la date d&#39;une entrevue avec un conseiller</span></span>
<span id="cb472-5"><a href="#cb472-5" aria-hidden="true" tabindex="-1"></a>entrevue_datatable <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">identifiant =</span> <span class="fu">c</span>(<span class="st">&quot;173&quot;</span>, <span class="st">&quot;168&quot;</span>, <span class="st">&quot;087&quot;</span>, <span class="st">&quot;689&quot;</span>, <span class="st">&quot;099&quot;</span>, <span class="st">&quot;765&quot;</span>),</span>
<span id="cb472-6"><a href="#cb472-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">date_entrevue =</span> <span class="fu">c</span>(<span class="st">&quot;06/08/2021&quot;</span>, <span class="st">&quot;17/10/2019&quot;</span>, <span class="st">&quot;12/06/2021&quot;</span>, <span class="st">&quot;28/03/2018&quot;</span>, <span class="st">&quot;01/09/2022&quot;</span>, <span class="st">&quot;01/10/2020&quot;</span>))</span>
<span id="cb472-7"><a href="#cb472-7" aria-hidden="true" tabindex="-1"></a>entrevue_datatable[, date_entrevue <span class="sc">:</span><span class="er">=</span> lubridate<span class="sc">::</span><span class="fu">dmy</span>(date_entrevue)]</span>
<span id="cb472-8"><a href="#cb472-8" aria-hidden="true" tabindex="-1"></a><span class="co"># On récupère un extrait de la base initiale</span></span>
<span id="cb472-9"><a href="#cb472-9" aria-hidden="true" tabindex="-1"></a>jointure_datatable <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;sexe&quot;</span>, <span class="st">&quot;date_entree&quot;</span>, <span class="st">&quot;date_sortie&quot;</span>)]</span></code></pre></div>
</div>
</div>
<div id="tabset-110-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-110-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="inner-join-les-seuls-identifiants-communs-aux-deux-bases" class="level2" data-number="17.2">
<h2 data-number="17.2"><span class="header-section-number">17.2</span> Inner join : les seuls identifiants communs aux deux bases</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-111-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-111-1" role="tab" aria-controls="tabset-111-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-111-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-111-2" role="tab" aria-controls="tabset-111-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-111-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-111-3" role="tab" aria-controls="tabset-111-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-111-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-111-4" role="tab" aria-controls="tabset-111-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-111-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-111-5" role="tab" aria-controls="tabset-111-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-111-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-111-1-tab">
<div class="sourceCode" id="cb473"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb473-1"><a href="#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Le tri préalable des bases de données à joindre par la variable de jointure est nécessaire avec la stratégie merge */</span></span>
<span id="cb473-2"><a href="#cb473-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = Diplome;<span class="kw">by</span> identifiant<span class="kw">;run</span>;</span>
<span id="cb473-3"><a href="#cb473-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = Jointure;<span class="kw">by</span> identifiant<span class="kw">;run</span>;</span>
<span id="cb473-4"><a href="#cb473-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Inner_Join1;</span>
<span id="cb473-5"><a href="#cb473-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">merge</span> Jointure (<span class="kw">in</span> = a) Diplome (<span class="kw">in</span> = b);</span>
<span id="cb473-6"><a href="#cb473-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> identifiant;</span>
<span id="cb473-7"><a href="#cb473-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> a <span class="kw">and</span> b;</span>
<span id="cb473-8"><a href="#cb473-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb473-9"><a href="#cb473-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-10"><a href="#cb473-10" aria-hidden="true" tabindex="-1"></a><span class="co">/* Autre solution */</span></span>
<span id="cb473-11"><a href="#cb473-11" aria-hidden="true" tabindex="-1"></a><span class="co">/* Le tri préalable des bases de données à joindre n&#39;est pas nécessaire avec la jointure SQL */</span></span>
<span id="cb473-12"><a href="#cb473-12" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb473-13"><a href="#cb473-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> Inner_Join2 <span class="kw">as</span></span>
<span id="cb473-14"><a href="#cb473-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> * <span class="kw">from</span> Jointure a inner join Diplome b <span class="kw">on</span> a.identifiant = b.identifiant</span>
<span id="cb473-15"><a href="#cb473-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span> <span class="kw">by</span> a.identifiant;</span>
<span id="cb473-16"><a href="#cb473-16" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb473-17"><a href="#cb473-17" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span> = Inner_Join1 (obs = <span class="dv">10</span>)<span class="kw">;run</span>;</span>
<span id="cb473-18"><a href="#cb473-18" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> count(*) <span class="kw">from</span> Inner_Join1;<span class="kw">quit</span>;</span>
<span id="cb473-19"><a href="#cb473-19" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> count(*) <span class="kw">from</span> Inner_Join2;<span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-111-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-111-2-tab">
<div class="cell">
<div class="sourceCode" id="cb474"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb474-1"><a href="#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sont appariés les identifiants communs aux deux bases</span></span>
<span id="cb474-2"><a href="#cb474-2" aria-hidden="true" tabindex="-1"></a>innerJoin <span class="ot">&lt;-</span> <span class="fu">merge</span>(jointure_rbase, diplome_rbase, <span class="at">by.x =</span> <span class="st">&quot;identifiant&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;identifiant&quot;</span>)</span>
<span id="cb474-3"><a href="#cb474-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(innerJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-111-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-111-3-tab">
<div class="cell">
<div class="sourceCode" id="cb475"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb475-1"><a href="#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sont appariés les identifiants communs aux deux bases</span></span>
<span id="cb475-2"><a href="#cb475-2" aria-hidden="true" tabindex="-1"></a>innerJoin <span class="ot">&lt;-</span> jointure_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb475-3"><a href="#cb475-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(diplome_tidyverse, <span class="at">by =</span> <span class="st">&quot;identifiant&quot;</span>)</span>
<span id="cb475-4"><a href="#cb475-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(innerJoin)</span>
<span id="cb475-5"><a href="#cb475-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb475-6"><a href="#cb475-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Autres solutions</span></span>
<span id="cb475-7"><a href="#cb475-7" aria-hidden="true" tabindex="-1"></a>innerJoin <span class="ot">&lt;-</span> jointure_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb475-8"><a href="#cb475-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(diplome_tidyverse, <span class="at">by =</span> <span class="fu">join_by</span>(identifiant <span class="sc">==</span> identifiant))</span>
<span id="cb475-9"><a href="#cb475-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(innerJoin)</span>
<span id="cb475-10"><a href="#cb475-10" aria-hidden="true" tabindex="-1"></a>innerJoin <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(jointure_tidyverse, diplome_tidyverse, <span class="at">by =</span> <span class="st">&quot;identifiant&quot;</span>)</span>
<span id="cb475-11"><a href="#cb475-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(innerJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-111-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-111-4-tab">
<div class="cell">
<div class="sourceCode" id="cb476"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb476-1"><a href="#cb476-1" aria-hidden="true" tabindex="-1"></a>innerJoin <span class="ot">&lt;-</span> <span class="fu">merge</span>(jointure_datatable, diplome_datatable, <span class="at">by.x =</span> <span class="st">&quot;identifiant&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;identifiant&quot;</span>)</span>
<span id="cb476-2"><a href="#cb476-2" aria-hidden="true" tabindex="-1"></a>innerJoin <span class="ot">&lt;-</span> jointure_datatable[diplome_datatable, nomatch <span class="ot">=</span> <span class="dv">0</span>, on <span class="ot">=</span> <span class="fu">list</span>(identifiant <span class="sc">==</span> identifiant)]</span>
<span id="cb476-3"><a href="#cb476-3" aria-hidden="true" tabindex="-1"></a>innerJoin <span class="ot">&lt;-</span> jointure_datatable[diplome_datatable, nomatch <span class="ot">=</span> <span class="dv">0</span>, on <span class="ot">=</span> .(identifiant <span class="sc">==</span> identifiant)]</span>
<span id="cb476-4"><a href="#cb476-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(innerJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-111-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-111-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="left-join-les-identifiants-de-la-base-de-gauche" class="level2" data-number="17.3">
<h2 data-number="17.3"><span class="header-section-number">17.3</span> Left join : les identifiants de la base de gauche</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-112-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-112-1" role="tab" aria-controls="tabset-112-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-112-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-112-2" role="tab" aria-controls="tabset-112-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-112-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-112-3" role="tab" aria-controls="tabset-112-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-112-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-112-4" role="tab" aria-controls="tabset-112-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-112-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-112-5" role="tab" aria-controls="tabset-112-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-112-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-112-1-tab">
<div class="sourceCode" id="cb477"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb477-1"><a href="#cb477-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Le tri préalable des bases de données à joindre par la variable de jointure est nécessaire avec la stratégie merge */</span></span>
<span id="cb477-2"><a href="#cb477-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = Diplome;<span class="kw">by</span> identifiant<span class="kw">;run</span>;</span>
<span id="cb477-3"><a href="#cb477-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = Jointure;<span class="kw">by</span> identifiant<span class="kw">;run</span>;</span>
<span id="cb477-4"><a href="#cb477-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Left_Join1;</span>
<span id="cb477-5"><a href="#cb477-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">merge</span> Jointure (<span class="kw">in</span> = a) Diplome (<span class="kw">in</span> = b);</span>
<span id="cb477-6"><a href="#cb477-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> identifiant;</span>
<span id="cb477-7"><a href="#cb477-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> a;</span>
<span id="cb477-8"><a href="#cb477-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb477-9"><a href="#cb477-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-10"><a href="#cb477-10" aria-hidden="true" tabindex="-1"></a><span class="co">/* Autre solution */</span></span>
<span id="cb477-11"><a href="#cb477-11" aria-hidden="true" tabindex="-1"></a><span class="co">/* Le tri préalable des bases de données à joindre n&#39;est pas nécessaire avec la jointure SQL */</span></span>
<span id="cb477-12"><a href="#cb477-12" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb477-13"><a href="#cb477-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> Left_Join2 <span class="kw">as</span></span>
<span id="cb477-14"><a href="#cb477-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> * <span class="kw">from</span> Jointure a <span class="fu">left</span> join Diplome b <span class="kw">on</span> a.identifiant = b.identifiant</span>
<span id="cb477-15"><a href="#cb477-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span> <span class="kw">by</span> a.identifiant;</span>
<span id="cb477-16"><a href="#cb477-16" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb477-17"><a href="#cb477-17" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span> = Left_Join1 (obs = <span class="dv">10</span>)<span class="kw">;run</span>;</span>
<span id="cb477-18"><a href="#cb477-18" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> count(*) <span class="kw">from</span> Left_Join1;<span class="kw">quit</span>;</span>
<span id="cb477-19"><a href="#cb477-19" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> count(*) <span class="kw">from</span> Left_Join2;<span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-112-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-112-2-tab">
<div class="cell">
<div class="sourceCode" id="cb478"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb478-1"><a href="#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sont appariés tous les identifiants de la base de gauche, et les correspondants éventuels de la base de droite</span></span>
<span id="cb478-2"><a href="#cb478-2" aria-hidden="true" tabindex="-1"></a>leftJoin <span class="ot">&lt;-</span> <span class="fu">merge</span>(jointure_rbase, diplome_rbase, <span class="at">by.x =</span> <span class="st">&quot;identifiant&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;identifiant&quot;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb478-3"><a href="#cb478-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(leftJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-112-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-112-3-tab">
<div class="cell">
<div class="sourceCode" id="cb479"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb479-1"><a href="#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sont appariés tous les identifiants de la base de gauche, et les correspondants éventuels de la base de droite</span></span>
<span id="cb479-2"><a href="#cb479-2" aria-hidden="true" tabindex="-1"></a>leftJoin <span class="ot">&lt;-</span> jointure_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb479-3"><a href="#cb479-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(diplome_tidyverse, <span class="at">by =</span> <span class="st">&quot;identifiant&quot;</span>)</span>
<span id="cb479-4"><a href="#cb479-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(leftJoin)</span>
<span id="cb479-5"><a href="#cb479-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-6"><a href="#cb479-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Autres solutions</span></span>
<span id="cb479-7"><a href="#cb479-7" aria-hidden="true" tabindex="-1"></a>leftJoin <span class="ot">&lt;-</span> jointure_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb479-8"><a href="#cb479-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(diplome_tidyverse, <span class="at">by =</span> <span class="fu">join_by</span>(identifiant <span class="sc">==</span> identifiant))</span>
<span id="cb479-9"><a href="#cb479-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(leftJoin)</span>
<span id="cb479-10"><a href="#cb479-10" aria-hidden="true" tabindex="-1"></a>leftJoin <span class="ot">&lt;-</span> <span class="fu">left_join</span>(jointure_tidyverse, diplome_tidyverse, <span class="at">by =</span> <span class="st">&quot;identifiant&quot;</span>)</span>
<span id="cb479-11"><a href="#cb479-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(leftJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-112-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-112-4-tab">
<div class="cell">
<div class="sourceCode" id="cb480"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb480-1"><a href="#cb480-1" aria-hidden="true" tabindex="-1"></a>leftJoin <span class="ot">&lt;-</span> <span class="fu">merge</span>(jointure_datatable, diplome_datatable, <span class="at">by.x =</span> <span class="st">&quot;identifiant&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;identifiant&quot;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb480-2"><a href="#cb480-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(leftJoin)</span>
<span id="cb480-3"><a href="#cb480-3" aria-hidden="true" tabindex="-1"></a>leftJoin <span class="ot">&lt;-</span> diplome_datatable[jointure_datatable, on <span class="ot">=</span> .(identifiant <span class="sc">==</span> identifiant)]</span>
<span id="cb480-4"><a href="#cb480-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(leftJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-112-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-112-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="right-join-les-identifiants-de-la-base-de-droite" class="level2" data-number="17.4">
<h2 data-number="17.4"><span class="header-section-number">17.4</span> Right join : les identifiants de la base de droite</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-113-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-113-1" role="tab" aria-controls="tabset-113-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-113-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-113-2" role="tab" aria-controls="tabset-113-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-113-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-113-3" role="tab" aria-controls="tabset-113-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-113-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-113-4" role="tab" aria-controls="tabset-113-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-113-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-113-5" role="tab" aria-controls="tabset-113-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-113-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-113-1-tab">
<div class="sourceCode" id="cb481"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb481-1"><a href="#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Le tri préalable des bases de données à joindre par la variable de jointure est nécessaire avec la stratégie merge */</span></span>
<span id="cb481-2"><a href="#cb481-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = Diplome;<span class="kw">by</span> identifiant<span class="kw">;run</span>;</span>
<span id="cb481-3"><a href="#cb481-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = Jointure;<span class="kw">by</span> identifiant<span class="kw">;run</span>;</span>
<span id="cb481-4"><a href="#cb481-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Right_Join1;</span>
<span id="cb481-5"><a href="#cb481-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">merge</span> Jointure (<span class="kw">in</span> = a) Diplome (<span class="kw">in</span> = b);</span>
<span id="cb481-6"><a href="#cb481-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> identifiant;</span>
<span id="cb481-7"><a href="#cb481-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> b;</span>
<span id="cb481-8"><a href="#cb481-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb481-9"><a href="#cb481-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb481-10"><a href="#cb481-10" aria-hidden="true" tabindex="-1"></a><span class="co">/* Autre solution */</span></span>
<span id="cb481-11"><a href="#cb481-11" aria-hidden="true" tabindex="-1"></a><span class="co">/* Le tri préalable des bases de données à joindre n&#39;est pas nécessaire avec la jointure SQL */</span></span>
<span id="cb481-12"><a href="#cb481-12" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb481-13"><a href="#cb481-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> Right_Join2 <span class="kw">as</span></span>
<span id="cb481-14"><a href="#cb481-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> * <span class="kw">from</span> Jointure a <span class="fu">right</span> join Diplome b <span class="kw">on</span> a.identifiant = b.identifiant</span>
<span id="cb481-15"><a href="#cb481-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span> <span class="kw">by</span> a.identifiant;</span>
<span id="cb481-16"><a href="#cb481-16" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb481-17"><a href="#cb481-17" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span> = Right_Join1 (obs = <span class="dv">10</span>)<span class="kw">;run</span>;</span>
<span id="cb481-18"><a href="#cb481-18" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> count(*) <span class="kw">from</span> Right_Join1;<span class="kw">quit</span>;</span>
<span id="cb481-19"><a href="#cb481-19" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> count(*) <span class="kw">from</span> Right_Join2;<span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-113-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-113-2-tab">
<div class="cell">
<div class="sourceCode" id="cb482"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb482-1"><a href="#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sont appariés tous les identifiants de la base de droite et les correspondants éventuels de la base de gauche</span></span>
<span id="cb482-2"><a href="#cb482-2" aria-hidden="true" tabindex="-1"></a>rightJoin <span class="ot">&lt;-</span> <span class="fu">merge</span>(jointure_rbase, diplome_rbase, <span class="at">by.x =</span> <span class="st">&quot;identifiant&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;identifiant&quot;</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb482-3"><a href="#cb482-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rightJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-113-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-113-3-tab">
<div class="cell">
<div class="sourceCode" id="cb483"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb483-1"><a href="#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sont appariés tous les identifiants de la base de droite et les correspondants éventuels de la base de gauche</span></span>
<span id="cb483-2"><a href="#cb483-2" aria-hidden="true" tabindex="-1"></a>rightJoin <span class="ot">&lt;-</span> jointure_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb483-3"><a href="#cb483-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(diplome_tidyverse, <span class="at">by =</span> <span class="st">&quot;identifiant&quot;</span>)</span>
<span id="cb483-4"><a href="#cb483-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rightJoin)</span>
<span id="cb483-5"><a href="#cb483-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-6"><a href="#cb483-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb483-7"><a href="#cb483-7" aria-hidden="true" tabindex="-1"></a>rightJoin <span class="ot">&lt;-</span> jointure_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb483-8"><a href="#cb483-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(diplome_tidyverse, <span class="at">by =</span> <span class="fu">join_by</span>(identifiant <span class="sc">==</span> identifiant))</span>
<span id="cb483-9"><a href="#cb483-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rightJoin)</span>
<span id="cb483-10"><a href="#cb483-10" aria-hidden="true" tabindex="-1"></a>rightJoin <span class="ot">&lt;-</span> <span class="fu">right_join</span>(jointure_tidyverse, diplome_tidyverse, <span class="at">by =</span> <span class="st">&quot;identifiant&quot;</span>)</span>
<span id="cb483-11"><a href="#cb483-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rightJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-113-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-113-4-tab">
<div class="cell">
<div class="sourceCode" id="cb484"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb484-1"><a href="#cb484-1" aria-hidden="true" tabindex="-1"></a>rightJoin <span class="ot">&lt;-</span> <span class="fu">merge</span>(jointure_datatable, diplome_datatable, <span class="at">by.x =</span> <span class="st">&quot;identifiant&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;identifiant&quot;</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb484-2"><a href="#cb484-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rightJoin)</span>
<span id="cb484-3"><a href="#cb484-3" aria-hidden="true" tabindex="-1"></a>rightJoin <span class="ot">&lt;-</span> jointure_datatable[diplome_datatable, on <span class="ot">=</span> .(identifiant <span class="sc">==</span> identifiant)]</span>
<span id="cb484-4"><a href="#cb484-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rightJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-113-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-113-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="full-join-les-identifiants-des-deux-bases" class="level2" data-number="17.5">
<h2 data-number="17.5"><span class="header-section-number">17.5</span> Full join : les identifiants des deux bases</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-114-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-114-1" role="tab" aria-controls="tabset-114-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-114-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-114-2" role="tab" aria-controls="tabset-114-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-114-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-114-3" role="tab" aria-controls="tabset-114-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-114-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-114-4" role="tab" aria-controls="tabset-114-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-114-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-114-5" role="tab" aria-controls="tabset-114-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-114-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-114-1-tab">
<div class="sourceCode" id="cb485"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb485-1"><a href="#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Le tri préalable des bases de données à joindre par la variable de jointure est nécessaire avec la stratégie merge */</span></span>
<span id="cb485-2"><a href="#cb485-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = Diplome;<span class="kw">by</span> identifiant<span class="kw">;run</span>;</span>
<span id="cb485-3"><a href="#cb485-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = Jointure;<span class="kw">by</span> identifiant<span class="kw">;run</span>;</span>
<span id="cb485-4"><a href="#cb485-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Full_Join1;</span>
<span id="cb485-5"><a href="#cb485-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">merge</span> Jointure (<span class="kw">in</span> = a) Diplome (<span class="kw">in</span> = b);</span>
<span id="cb485-6"><a href="#cb485-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> identifiant;</span>
<span id="cb485-7"><a href="#cb485-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> a <span class="kw">or</span> b;</span>
<span id="cb485-8"><a href="#cb485-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb485-9"><a href="#cb485-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb485-10"><a href="#cb485-10" aria-hidden="true" tabindex="-1"></a><span class="co">/* Autre solution */</span></span>
<span id="cb485-11"><a href="#cb485-11" aria-hidden="true" tabindex="-1"></a><span class="co">/* Le tri préalable des bases de données à joindre n&#39;est pas nécessaire avec la jointure SQL */</span></span>
<span id="cb485-12"><a href="#cb485-12" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb485-13"><a href="#cb485-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> Full_Join2 <span class="kw">as</span></span>
<span id="cb485-14"><a href="#cb485-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> coalesce(a.identifiant, b.identifiant) <span class="kw">as</span> Identifiant, *</span>
<span id="cb485-15"><a href="#cb485-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> Jointure a full outer join Diplome b <span class="kw">on</span> a.identifiant = b.identifiant</span>
<span id="cb485-16"><a href="#cb485-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span> <span class="kw">by</span> calculated identifiant;</span>
<span id="cb485-17"><a href="#cb485-17" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb485-18"><a href="#cb485-18" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span> = Full_Join1 (obs = <span class="dv">10</span>)<span class="kw">;run</span>;</span>
<span id="cb485-19"><a href="#cb485-19" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> count(*) <span class="kw">from</span> Full_Join1;<span class="kw">quit</span>;</span>
<span id="cb485-20"><a href="#cb485-20" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> count(*) <span class="kw">from</span> Full_Join2;<span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-114-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-114-2-tab">
<div class="cell">
<div class="sourceCode" id="cb486"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb486-1"><a href="#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sont appariés les identifiants des deux bases</span></span>
<span id="cb486-2"><a href="#cb486-2" aria-hidden="true" tabindex="-1"></a>fullJoin <span class="ot">&lt;-</span> <span class="fu">merge</span>(jointure_rbase, diplome_rbase, <span class="at">by.x =</span> <span class="st">&quot;identifiant&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;identifiant&quot;</span>, <span class="at">all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb486-3"><a href="#cb486-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(fullJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-114-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-114-3-tab">
<div class="cell">
<div class="sourceCode" id="cb487"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb487-1"><a href="#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sont appariés les identifiants des deux bases</span></span>
<span id="cb487-2"><a href="#cb487-2" aria-hidden="true" tabindex="-1"></a>fullJoin <span class="ot">&lt;-</span> jointure_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb487-3"><a href="#cb487-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(diplome_tidyverse, <span class="at">by =</span> <span class="st">&quot;identifiant&quot;</span>)</span>
<span id="cb487-4"><a href="#cb487-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(fullJoin)</span>
<span id="cb487-5"><a href="#cb487-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-6"><a href="#cb487-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb487-7"><a href="#cb487-7" aria-hidden="true" tabindex="-1"></a>fullJoin <span class="ot">&lt;-</span> jointure_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb487-8"><a href="#cb487-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(diplome_tidyverse, <span class="at">by =</span> <span class="fu">join_by</span>(identifiant <span class="sc">==</span> identifiant))</span>
<span id="cb487-9"><a href="#cb487-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(fullJoin)</span>
<span id="cb487-10"><a href="#cb487-10" aria-hidden="true" tabindex="-1"></a>fullJoin <span class="ot">&lt;-</span> <span class="fu">full_join</span>(jointure_tidyverse, diplome_tidyverse, <span class="at">by =</span> <span class="st">&quot;identifiant&quot;</span>)</span>
<span id="cb487-11"><a href="#cb487-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(fullJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-114-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-114-4-tab">
<div class="cell">
<div class="sourceCode" id="cb488"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb488-1"><a href="#cb488-1" aria-hidden="true" tabindex="-1"></a>fullJoin <span class="ot">&lt;-</span> <span class="fu">merge</span>(jointure_datatable, diplome_datatable, <span class="at">by.x =</span> <span class="st">&quot;identifiant&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;identifiant&quot;</span>, <span class="at">all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb488-2"><a href="#cb488-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(fullJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-114-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-114-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="jointure-de-3-bases-ou-plus-en-une-seule-opération-exemple-avec-inner-join" class="level2" data-number="17.6">
<h2 data-number="17.6"><span class="header-section-number">17.6</span> Jointure de 3 bases ou plus en une seule opération (exemple avec inner join)</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-115-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-115-1" role="tab" aria-controls="tabset-115-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-115-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-115-2" role="tab" aria-controls="tabset-115-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-115-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-115-3" role="tab" aria-controls="tabset-115-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-115-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-115-4" role="tab" aria-controls="tabset-115-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-115-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-115-5" role="tab" aria-controls="tabset-115-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-115-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-115-1-tab">
<div class="sourceCode" id="cb489"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb489-1"><a href="#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = Jointure;<span class="kw">by</span> identifiant<span class="kw">;run</span>;</span>
<span id="cb489-2"><a href="#cb489-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = Diplome;<span class="kw">by</span> identifiant<span class="kw">;run</span>;</span>
<span id="cb489-3"><a href="#cb489-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = Entrevue;<span class="kw">by</span> identifiant<span class="kw">;run</span>;</span>
<span id="cb489-4"><a href="#cb489-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Inner_Join3;</span>
<span id="cb489-5"><a href="#cb489-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">merge</span> Jointure (<span class="kw">in</span> = a) Diplome (<span class="kw">in</span> = b) Entrevue (<span class="kw">in</span> = c);</span>
<span id="cb489-6"><a href="#cb489-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span> identifiant;</span>
<span id="cb489-7"><a href="#cb489-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> a <span class="kw">and</span> b <span class="kw">and</span> c;</span>
<span id="cb489-8"><a href="#cb489-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb489-9"><a href="#cb489-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-10"><a href="#cb489-10" aria-hidden="true" tabindex="-1"></a><span class="co">/* Autre solution */</span></span>
<span id="cb489-11"><a href="#cb489-11" aria-hidden="true" tabindex="-1"></a><span class="co">/* Le tri préalable des bases de données à joindre n&#39;est pas nécessaire avec la jointure SQL */</span></span>
<span id="cb489-12"><a href="#cb489-12" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb489-13"><a href="#cb489-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> Inner_Join4 <span class="kw">as</span></span>
<span id="cb489-14"><a href="#cb489-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> * <span class="kw">from</span> Jointure a inner join Diplome b <span class="kw">on</span> a.identifiant = b.identifiant</span>
<span id="cb489-15"><a href="#cb489-15" aria-hidden="true" tabindex="-1"></a>                           inner join Entrevue c <span class="kw">on</span> a.identifiant = c.identifiant</span>
<span id="cb489-16"><a href="#cb489-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span> <span class="kw">by</span> a.identifiant;</span>
<span id="cb489-17"><a href="#cb489-17" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb489-18"><a href="#cb489-18" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span> = Inner_Join4 (obs = <span class="dv">10</span>)<span class="kw">;run</span>;</span>
<span id="cb489-19"><a href="#cb489-19" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> count(*) <span class="kw">from</span> Inner_Join3;<span class="kw">quit</span>;</span>
<span id="cb489-20"><a href="#cb489-20" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> count(*) <span class="kw">from</span> Inner_Join4;<span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-115-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-115-2-tab">
<div class="cell">
<div class="sourceCode" id="cb490"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb490-1"><a href="#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilisation de la fonction Reduce</span></span>
<span id="cb490-2"><a href="#cb490-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Elle applique successivement (et non simultanément, comme do.call) à tous les éléments d&#39;une liste une fonction</span></span>
<span id="cb490-3"><a href="#cb490-3" aria-hidden="true" tabindex="-1"></a>innerJoin2 <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(<span class="cf">function</span>(x, y) <span class="fu">merge</span>(x, y, <span class="at">all =</span> <span class="cn">FALSE</span>, <span class="at">by.x =</span> <span class="st">&quot;identifiant&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;identifiant&quot;</span>),</span>
<span id="cb490-4"><a href="#cb490-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">list</span>(jointure_rbase, diplome_rbase, entrevue_rbase))</span>
<span id="cb490-5"><a href="#cb490-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(innerJoin2)</span></code></pre></div>
</div>
</div>
<div id="tabset-115-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-115-3-tab">
<div class="cell">
<div class="sourceCode" id="cb491"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb491-1"><a href="#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilisation de la fonction reduce de purrr</span></span>
<span id="cb491-2"><a href="#cb491-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Elle applique successivement (et non simultanément, comme do.call) à tous les éléments d&#39;une liste une fonction</span></span>
<span id="cb491-3"><a href="#cb491-3" aria-hidden="true" tabindex="-1"></a>innerJoin2 <span class="ot">&lt;-</span> <span class="fu">list</span>(jointure_tidyverse, diplome_tidyverse, entrevue_tidyverse) <span class="sc">%&gt;%</span> </span>
<span id="cb491-4"><a href="#cb491-4" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">reduce</span>(dplyr<span class="sc">::</span>inner_join, <span class="at">by =</span> <span class="fu">join_by</span>(identifiant <span class="sc">==</span> identifiant))</span>
<span id="cb491-5"><a href="#cb491-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(innerJoin2)</span></code></pre></div>
</div>
</div>
<div id="tabset-115-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-115-4-tab">
<div class="cell">
<div class="sourceCode" id="cb492"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb492-1"><a href="#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilisation de la fonction Reduce : elle applique successivement (et non simultanément, comme do.call) à tous les éléments d&#39;une liste une fonction</span></span>
<span id="cb492-2"><a href="#cb492-2" aria-hidden="true" tabindex="-1"></a>innerJoin2 <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(<span class="cf">function</span>(x, y) <span class="fu">merge</span>(x, y, <span class="at">all =</span> <span class="cn">FALSE</span>, <span class="at">by.x =</span> <span class="st">&quot;identifiant&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;identifiant&quot;</span>),</span>
<span id="cb492-3"><a href="#cb492-3" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">list</span>(jointure_datatable, diplome_datatable, entrevue_datatable))</span>
<span id="cb492-4"><a href="#cb492-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(innerJoin2)</span></code></pre></div>
</div>
</div>
<div id="tabset-115-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-115-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="jointure-sur-inégalités" class="level2" data-number="17.7">
<h2 data-number="17.7"><span class="header-section-number">17.7</span> Jointure sur inégalités</h2>
<p>On cherche à obtenir les entrevues qui se sont déroulées durant le contrat. On cherche alors à apparier les bases Jointure et Entrevue par identifiant si la date d’entrevue de la base Entrevue est comprise entre la date d’entrée et la date de sortie de la base Jointure.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-116-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-116-1" role="tab" aria-controls="tabset-116-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-116-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-116-2" role="tab" aria-controls="tabset-116-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-116-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-116-3" role="tab" aria-controls="tabset-116-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-116-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-116-4" role="tab" aria-controls="tabset-116-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-116-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-116-5" role="tab" aria-controls="tabset-116-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-116-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-116-1-tab">
<div class="sourceCode" id="cb493"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb493-1"><a href="#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* On associe l&#39;entrevue au contrat au cours duquel elle a eu lieu */</span></span>
<span id="cb493-2"><a href="#cb493-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb493-3"><a href="#cb493-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> Inner_Join_Inegalite <span class="kw">as</span></span>
<span id="cb493-4"><a href="#cb493-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> *</span>
<span id="cb493-5"><a href="#cb493-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> Jointure a inner join Entrevue b</span>
<span id="cb493-6"><a href="#cb493-6" aria-hidden="true" tabindex="-1"></a>       <span class="kw">on</span> a.identifiant = b.identifiant <span class="kw">and</span> a.date_entree &lt;= b.date_entrevue &lt;= a.date_sortie</span>
<span id="cb493-7"><a href="#cb493-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span> <span class="kw">by</span> a.identifiant;</span>
<span id="cb493-8"><a href="#cb493-8" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb493-9"><a href="#cb493-9" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> print<span class="kw"> data</span> = Inner_Join_Inegalite (obs = <span class="dv">10</span>)<span class="kw">;run</span>;</span>
<span id="cb493-10"><a href="#cb493-10" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> count(*) <span class="kw">from</span> Inner_Join_Inegalite;<span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-116-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-116-2-tab">
<div class="cell">
<div class="sourceCode" id="cb494"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb494-1"><a href="#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ne semble pas natif en R-Base.</span></span>
<span id="cb494-2"><a href="#cb494-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Une proposition indicative où on applique la sélection après la jointure, ce qui ne doit pas être très efficace ...</span></span>
<span id="cb494-3"><a href="#cb494-3" aria-hidden="true" tabindex="-1"></a>innerJoinInegalite <span class="ot">&lt;-</span> <span class="fu">merge</span>(jointure_rbase, entrevue_rbase, <span class="at">by =</span> <span class="st">&quot;identifiant&quot;</span>)</span>
<span id="cb494-4"><a href="#cb494-4" aria-hidden="true" tabindex="-1"></a>innerJoinInegalite <span class="ot">&lt;-</span> <span class="fu">with</span>(innerJoinInegalite,</span>
<span id="cb494-5"><a href="#cb494-5" aria-hidden="true" tabindex="-1"></a>                           innerJoinInegalite[<span class="fu">which</span>(date_entree <span class="sc">&lt;=</span> date_entrevue <span class="sc">&amp;</span> date_entrevue <span class="sc">&lt;=</span> date_sortie), ])</span>
<span id="cb494-6"><a href="#cb494-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(innerJoinInegalite)</span></code></pre></div>
</div>
</div>
<div id="tabset-116-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-116-3-tab">
<div class="cell">
<div class="sourceCode" id="cb495"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb495-1"><a href="#cb495-1" aria-hidden="true" tabindex="-1"></a>innerJoinInegalite <span class="ot">&lt;-</span> jointure_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb495-2"><a href="#cb495-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(entrevue_tidyverse, <span class="fu">join_by</span>(identifiant <span class="sc">==</span> identifiant,</span>
<span id="cb495-3"><a href="#cb495-3" aria-hidden="true" tabindex="-1"></a>                                         date_entree <span class="sc">&lt;=</span> date_entrevue,</span>
<span id="cb495-4"><a href="#cb495-4" aria-hidden="true" tabindex="-1"></a>                                         date_sortie <span class="sc">&gt;=</span> date_entrevue))</span>
<span id="cb495-5"><a href="#cb495-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(innerJoinInegalite)</span></code></pre></div>
</div>
</div>
<div id="tabset-116-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-116-4-tab">
<div class="cell">
<div class="sourceCode" id="cb496"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb496-1"><a href="#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Attention, l&#39;ordre des conditions doit correspondre à l&#39;ordre des bases dans la jointure !</span></span>
<span id="cb496-2"><a href="#cb496-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Il semble que l&#39;on soit forcé de spécifier tous les noms des colonnes, et ce qui est un peu problématique ...</span></span>
<span id="cb496-3"><a href="#cb496-3" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : Peut-on faire plus simplement ??</span></span>
<span id="cb496-4"><a href="#cb496-4" aria-hidden="true" tabindex="-1"></a>innerJoinInegalite <span class="ot">&lt;-</span> jointure_datatable[entrevue_datatable,</span>
<span id="cb496-5"><a href="#cb496-5" aria-hidden="true" tabindex="-1"></a>                                         .(identifiant, sexe, date_entree, date_sortie, date_entrevue),</span>
<span id="cb496-6"><a href="#cb496-6" aria-hidden="true" tabindex="-1"></a>                                         on <span class="ot">=</span> .(identifiant, date_entree <span class="sc">&lt;=</span> date_entrevue, date_sortie <span class="sc">&gt;=</span> date_entrevue),</span>
<span id="cb496-7"><a href="#cb496-7" aria-hidden="true" tabindex="-1"></a>                                         nomatch <span class="ot">=</span> 0L</span>
<span id="cb496-8"><a href="#cb496-8" aria-hidden="true" tabindex="-1"></a>                                         ][<span class="fu">order</span>(identifiant)]</span>
<span id="cb496-9"><a href="#cb496-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(innerJoinInegalite)</span></code></pre></div>
</div>
</div>
<div id="tabset-116-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-116-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="cross-join-toutes-les-combinaisons-possibles-de-csp-sexe-et-diplôme" class="level2" data-number="17.8">
<h2 data-number="17.8"><span class="header-section-number">17.8</span> Cross join : toutes les combinaisons possibles de CSP, sexe et diplôme</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-117-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-117-1" role="tab" aria-controls="tabset-117-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-117-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-117-2" role="tab" aria-controls="tabset-117-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-117-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-117-3" role="tab" aria-controls="tabset-117-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-117-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-117-4" role="tab" aria-controls="tabset-117-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-117-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-117-5" role="tab" aria-controls="tabset-117-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-117-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-117-1-tab">
<div class="sourceCode" id="cb497"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb497-1"><a href="#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb497-2"><a href="#cb497-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> CrossJoin <span class="kw">as</span></span>
<span id="cb497-3"><a href="#cb497-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> *</span>
<span id="cb497-4"><a href="#cb497-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> (<span class="kw">select</span> <span class="kw">distinct</span> CSPF <span class="kw">from</span> donnees_sas)  cross join</span>
<span id="cb497-5"><a href="#cb497-5" aria-hidden="true" tabindex="-1"></a>       (<span class="kw">select</span> <span class="kw">distinct</span> Sexef <span class="kw">from</span> donnees_sas) cross join</span>
<span id="cb497-6"><a href="#cb497-6" aria-hidden="true" tabindex="-1"></a>       (<span class="kw">select</span> <span class="kw">distinct</span> Diplome <span class="kw">from</span> Diplome)</span>
<span id="cb497-7"><a href="#cb497-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span> <span class="kw">by</span> CSPF, Sexef, Diplome;</span>
<span id="cb497-8"><a href="#cb497-8" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb497-9"><a href="#cb497-9" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> count(*) <span class="kw">from</span> CrossJoin;<span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-117-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-117-2-tab">
<div class="cell">
<div class="sourceCode" id="cb498"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb498-1"><a href="#cb498-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Toutes les combinaisons possibles de CSP, sexe et diplome</span></span>
<span id="cb498-2"><a href="#cb498-2" aria-hidden="true" tabindex="-1"></a>crossJoin <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">expand.grid</span>(donnees_rbase<span class="sc">$</span>cspf, donnees_rbase<span class="sc">$</span>sexef, diplome_rbase<span class="sc">$</span>diplome))</span>
<span id="cb498-3"><a href="#cb498-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(crossJoin) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>, <span class="st">&quot;diplome&quot;</span>)</span>
<span id="cb498-4"><a href="#cb498-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(crossJoin)</span>
<span id="cb498-5"><a href="#cb498-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-6"><a href="#cb498-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb498-7"><a href="#cb498-7" aria-hidden="true" tabindex="-1"></a>crossJoin2 <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">merge</span>(donnees_rbase[, <span class="fu">c</span>(<span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>)], diplome_rbase[, <span class="st">&quot;diplome&quot;</span>], <span class="at">by =</span> <span class="cn">NULL</span>))</span>
<span id="cb498-8"><a href="#cb498-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(crossJoin2)</span>
<span id="cb498-9"><a href="#cb498-9" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/10600060/how-to-do-cross-join-in-r</span></span></code></pre></div>
</div>
</div>
<div id="tabset-117-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-117-3-tab">
<div class="cell">
<div class="sourceCode" id="cb499"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb499-1"><a href="#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Toutes les combinaisons possibles de CSP, sexe et diplome</span></span>
<span id="cb499-2"><a href="#cb499-2" aria-hidden="true" tabindex="-1"></a>crossJoin <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb499-3"><a href="#cb499-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cspf, sexef) <span class="sc">%&gt;%</span> </span>
<span id="cb499-4"><a href="#cb499-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cross_join</span>(diplome_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(diplome)) <span class="sc">%&gt;%</span> </span>
<span id="cb499-5"><a href="#cb499-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb499-6"><a href="#cb499-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(crossJoin)</span>
<span id="cb499-7"><a href="#cb499-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-8"><a href="#cb499-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb499-9"><a href="#cb499-9" aria-hidden="true" tabindex="-1"></a>crossJoin <span class="ot">&lt;-</span> <span class="fu">cross_join</span>(donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(cspf, sexef), diplome_tidyverse <span class="sc">%&gt;%</span> <span class="fu">select</span>(diplome)) <span class="sc">%&gt;%</span> </span>
<span id="cb499-10"><a href="#cb499-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb499-11"><a href="#cb499-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(crossJoin)</span>
<span id="cb499-12"><a href="#cb499-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-13"><a href="#cb499-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb499-14"><a href="#cb499-14" aria-hidden="true" tabindex="-1"></a>crossJoin <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb499-15"><a href="#cb499-15" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(cspf, sexef, diplome_tidyverse<span class="sc">$</span>diplome) <span class="sc">%&gt;%</span></span>
<span id="cb499-16"><a href="#cb499-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb499-17"><a href="#cb499-17" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(crossJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-117-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-117-4-tab">
<div class="cell">
<div class="sourceCode" id="cb500"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb500-1"><a href="#cb500-1" aria-hidden="true" tabindex="-1"></a>crossJoin <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">CJ</span>(donnees_datatable<span class="sc">$</span>cspf, donnees_datatable<span class="sc">$</span>sexef, diplome_datatable<span class="sc">$</span>diplome, <span class="at">unique =</span> <span class="cn">TRUE</span>)</span>
<span id="cb500-2"><a href="#cb500-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(crossJoin) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>, <span class="st">&quot;diplome&quot;</span>)</span>
<span id="cb500-3"><a href="#cb500-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(crossJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-117-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-117-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="semi-join" class="level2" data-number="17.9">
<h2 data-number="17.9"><span class="header-section-number">17.9</span> Semi join</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-118-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-118-1" role="tab" aria-controls="tabset-118-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-118-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-118-2" role="tab" aria-controls="tabset-118-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-118-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-118-3" role="tab" aria-controls="tabset-118-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-118-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-118-4" role="tab" aria-controls="tabset-118-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-118-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-118-5" role="tab" aria-controls="tabset-118-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-118-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-118-1-tab">
<div class="sourceCode" id="cb501"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb501-1"><a href="#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Identifiants de la base de gauche qui ont un correspondant dans la base de droite */</span></span>
<span id="cb501-2"><a href="#cb501-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb501-3"><a href="#cb501-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> Semi_Join <span class="kw">as</span> <span class="kw">select</span> * <span class="kw">from</span> donnees_sas</span>
<span id="cb501-4"><a href="#cb501-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span> Identifiant <span class="kw">in</span> (<span class="kw">select</span> <span class="kw">distinct</span> Identifiant <span class="kw">from</span> Diplome);</span>
<span id="cb501-5"><a href="#cb501-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> count(*) <span class="kw">from</span> Semi_Join;</span>
<span id="cb501-6"><a href="#cb501-6" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb501-7"><a href="#cb501-7" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb501-8"><a href="#cb501-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> Semi_Join <span class="kw">as</span> <span class="kw">select</span> * <span class="kw">from</span> donnees_sas a</span>
<span id="cb501-9"><a href="#cb501-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span> exists (<span class="kw">select</span> * <span class="kw">from</span> Diplome b <span class="kw">where</span> (a.Identifiant = b.Identifiant));</span>
<span id="cb501-10"><a href="#cb501-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> count(*) <span class="kw">from</span> Semi_Join;</span>
<span id="cb501-11"><a href="#cb501-11" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-118-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-118-2-tab">
<div class="cell">
<div class="sourceCode" id="cb502"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb502-1"><a href="#cb502-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants de la base de gauche qui ont un correspondant dans la base de droite</span></span>
<span id="cb502-2"><a href="#cb502-2" aria-hidden="true" tabindex="-1"></a>semiJoin <span class="ot">&lt;-</span> donnees_rbase[donnees_rbase<span class="sc">$</span>identifiant <span class="sc">%in%</span> diplome_rbase<span class="sc">$</span>identifiant, ]</span>
<span id="cb502-3"><a href="#cb502-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(semiJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-118-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-118-3-tab">
<div class="cell">
<div class="sourceCode" id="cb503"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb503-1"><a href="#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants de la base de gauche qui ont un correspondant dans la base de droite</span></span>
<span id="cb503-2"><a href="#cb503-2" aria-hidden="true" tabindex="-1"></a>semiJoin <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb503-3"><a href="#cb503-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(diplome_tidyverse, <span class="fu">join_by</span>(identifiant <span class="sc">==</span> identifiant))</span>
<span id="cb503-4"><a href="#cb503-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(semiJoin)</span>
<span id="cb503-5"><a href="#cb503-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb503-6"><a href="#cb503-6" aria-hidden="true" tabindex="-1"></a>semiJoin <span class="ot">&lt;-</span> <span class="fu">semi_join</span>(donnees_tidyverse, diplome_tidyverse, <span class="fu">join_by</span>(identifiant <span class="sc">==</span> identifiant))</span>
<span id="cb503-7"><a href="#cb503-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(semiJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-118-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-118-4-tab">
<div class="cell">
<div class="sourceCode" id="cb504"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb504-1"><a href="#cb504-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants de la base de gauche qui ont un correspondant dans la base de droite</span></span>
<span id="cb504-2"><a href="#cb504-2" aria-hidden="true" tabindex="-1"></a>semiJoin <span class="ot">&lt;-</span> donnees_datatable[identifiant <span class="sc">%in%</span> diplome_datatable<span class="sc">$</span>identifiant, ]</span>
<span id="cb504-3"><a href="#cb504-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(semiJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-118-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-118-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="anti-join" class="level2" data-number="17.10">
<h2 data-number="17.10"><span class="header-section-number">17.10</span> Anti join</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-119-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-119-1" role="tab" aria-controls="tabset-119-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-119-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-119-2" role="tab" aria-controls="tabset-119-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-119-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-119-3" role="tab" aria-controls="tabset-119-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-119-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-119-4" role="tab" aria-controls="tabset-119-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-119-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-119-5" role="tab" aria-controls="tabset-119-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-119-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-119-1-tab">
<div class="sourceCode" id="cb505"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb505-1"><a href="#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Identifiants de la base de gauche qui n&#39;ont pas de correspondant dans la base de droite */</span></span>
<span id="cb505-2"><a href="#cb505-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb505-3"><a href="#cb505-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> Anti_Join <span class="kw">as</span> <span class="kw">select</span> * <span class="kw">from</span> donnees_sas</span>
<span id="cb505-4"><a href="#cb505-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span> Identifiant <span class="kw">not</span> <span class="kw">in</span> (<span class="kw">select</span> <span class="kw">distinct</span> Identifiant <span class="kw">from</span> Diplome);</span>
<span id="cb505-5"><a href="#cb505-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> count(*) <span class="kw">from</span> Anti_Join;</span>
<span id="cb505-6"><a href="#cb505-6" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb505-7"><a href="#cb505-7" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb505-8"><a href="#cb505-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">table</span> Anti_Join <span class="kw">as</span> <span class="kw">select</span> * <span class="kw">from</span> donnees_sas a</span>
<span id="cb505-9"><a href="#cb505-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span> <span class="kw">not</span> exists (<span class="kw">select</span> * <span class="kw">from</span> Diplome b <span class="kw">where</span> (a.Identifiant = b.Identifiant);</span>
<span id="cb505-10"><a href="#cb505-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> count(*) <span class="kw">from</span> Anti_Join;</span>
<span id="cb505-11"><a href="#cb505-11" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-119-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-119-2-tab">
<div class="cell">
<div class="sourceCode" id="cb506"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb506-1"><a href="#cb506-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants de la base de gauche qui n&#39;ont pas de correspondant dans la base de droite</span></span>
<span id="cb506-2"><a href="#cb506-2" aria-hidden="true" tabindex="-1"></a>antiJoin <span class="ot">&lt;-</span> donnees_rbase[<span class="sc">!</span> donnees_rbase<span class="sc">$</span>identifiant <span class="sc">%in%</span> diplome_rbase<span class="sc">$</span>identifiant, ]</span>
<span id="cb506-3"><a href="#cb506-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(antiJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-119-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-119-3-tab">
<div class="cell">
<div class="sourceCode" id="cb507"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb507-1"><a href="#cb507-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants de la base de gauche qui n&#39;ont pas de correspondant dans la base de droite</span></span>
<span id="cb507-2"><a href="#cb507-2" aria-hidden="true" tabindex="-1"></a>antiJoin <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb507-3"><a href="#cb507-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(diplome_tidyverse, <span class="fu">join_by</span>(identifiant <span class="sc">==</span> identifiant))</span>
<span id="cb507-4"><a href="#cb507-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(antiJoin)</span>
<span id="cb507-5"><a href="#cb507-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb507-6"><a href="#cb507-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb507-7"><a href="#cb507-7" aria-hidden="true" tabindex="-1"></a>antiJoin <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(donnees_tidyverse, diplome_tidyverse, <span class="fu">join_by</span>(identifiant <span class="sc">==</span> identifiant))</span>
<span id="cb507-8"><a href="#cb507-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(antiJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-119-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-119-4-tab">
<div class="cell">
<div class="sourceCode" id="cb508"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb508-1"><a href="#cb508-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants de la base de gauche qui n&#39;ont pas de correspondant dans la base de droite</span></span>
<span id="cb508-2"><a href="#cb508-2" aria-hidden="true" tabindex="-1"></a>antiJoin <span class="ot">&lt;-</span> donnees_datatable[<span class="sc">!</span> identifiant <span class="sc">%in%</span> diplome_datatable<span class="sc">$</span>identifiant, ]</span>
<span id="cb508-3"><a href="#cb508-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(antiJoin)</span></code></pre></div>
</div>
</div>
<div id="tabset-119-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-119-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="autres-fonctions-utiles" class="level2" data-number="17.11">
<h2 data-number="17.11"><span class="header-section-number">17.11</span> Autres fonctions utiles</h2>
<section id="concaténation-des-identifiants" class="level3" data-number="17.11.1">
<h3 data-number="17.11.1"><span class="header-section-number">17.11.1</span> Concaténation des identifiants</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-120-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-120-1" role="tab" aria-controls="tabset-120-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-120-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-120-2" role="tab" aria-controls="tabset-120-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-120-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-120-3" role="tab" aria-controls="tabset-120-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-120-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-120-4" role="tab" aria-controls="tabset-120-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-120-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-120-5" role="tab" aria-controls="tabset-120-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-120-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-120-1-tab">
<div class="sourceCode" id="cb509"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb509-1"><a href="#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb509-2"><a href="#cb509-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Concaténation des identifiants */</span></span>
<span id="cb509-3"><a href="#cb509-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> Identifiant <span class="kw">from</span> Jointure union all</span>
<span id="cb509-4"><a href="#cb509-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> Identifiant <span class="kw">from</span> Diplome <span class="kw">order</span> <span class="kw">by</span> identifiant;</span>
<span id="cb509-5"><a href="#cb509-5" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-120-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-120-2-tab">
<div class="cell">
<div class="sourceCode" id="cb510"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb510-1"><a href="#cb510-1" aria-hidden="true" tabindex="-1"></a><span class="co"># base:: permet de s&#39;assurer que les fonctions proviennent de R base</span></span>
<span id="cb510-2"><a href="#cb510-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Des fonctions du même nom existent en Tidyverse, et tendent à prédominer si le package est lancé</span></span>
<span id="cb510-3"><a href="#cb510-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concaténation des identifiants avec les doublons</span></span>
<span id="cb510-4"><a href="#cb510-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">c</span>(jointure_rbase<span class="sc">$</span>identifiant, diplome_rbase<span class="sc">$</span>identifiant))</span></code></pre></div>
</div>
</div>
<div id="tabset-120-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-120-3-tab">
<div class="cell">
<div class="sourceCode" id="cb511"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb511-1"><a href="#cb511-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dplyr:: permet de s&#39;assurer que ce sont les fonctions du Tidyverse (et non leurs homonymes de R-Base qui sont utilisées)</span></span>
<span id="cb511-2"><a href="#cb511-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb511-3"><a href="#cb511-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concaténation des identifiants</span></span>
<span id="cb511-4"><a href="#cb511-4" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">union_all</span>(jointure_tidyverse<span class="sc">$</span>identifiant, diplome_tidyverse<span class="sc">$</span>identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb511-5"><a href="#cb511-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-120-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-120-4-tab">
<div class="cell">
<div class="sourceCode" id="cb512"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb512-1"><a href="#cb512-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les fonctions spécifiques à data.table fonctionnent avec des formats data.table, d&#39;où la syntaxe un peu différente de R base</span></span>
<span id="cb512-2"><a href="#cb512-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Concaténation des identifiants</span></span>
<span id="cb512-3"><a href="#cb512-3" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;identifiant&quot;</span></span>
<span id="cb512-4"><a href="#cb512-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">c</span>(jointure_datatable[[variable]], diplome_datatable[[variable]]))</span></code></pre></div>
</div>
</div>
<div id="tabset-120-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-120-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="identifiants-uniques-des-2-bases" class="level3" data-number="17.11.2">
<h3 data-number="17.11.2"><span class="header-section-number">17.11.2</span> Identifiants uniques des 2 bases</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-121-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-121-1" role="tab" aria-controls="tabset-121-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-121-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-121-2" role="tab" aria-controls="tabset-121-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-121-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-121-3" role="tab" aria-controls="tabset-121-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-121-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-121-4" role="tab" aria-controls="tabset-121-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-121-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-121-5" role="tab" aria-controls="tabset-121-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-121-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-121-1-tab">
<div class="sourceCode" id="cb513"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb513-1"><a href="#cb513-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb513-2"><a href="#cb513-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Identifiants uniques des 2 bases */</span></span>
<span id="cb513-3"><a href="#cb513-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> <span class="kw">distinct</span> Identifiant <span class="kw">from</span></span>
<span id="cb513-4"><a href="#cb513-4" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">select</span> <span class="kw">distinct</span> Identifiant <span class="kw">from</span> Jointure union <span class="kw">select</span> <span class="kw">distinct</span> Identifiant <span class="kw">from</span> Diplome)</span>
<span id="cb513-5"><a href="#cb513-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span> <span class="kw">by</span> identifiant;</span>
<span id="cb513-6"><a href="#cb513-6" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-121-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-121-2-tab">
<div class="cell">
<div class="sourceCode" id="cb514"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb514-1"><a href="#cb514-1" aria-hidden="true" tabindex="-1"></a><span class="co"># base:: permet de s&#39;assurer que les fonctions proviennent de R base</span></span>
<span id="cb514-2"><a href="#cb514-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Des fonctions du même nom existent en Tidyverse, et tendent à prédominer si le package est lancé</span></span>
<span id="cb514-3"><a href="#cb514-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb514-4"><a href="#cb514-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants uniques des 2 bases</span></span>
<span id="cb514-5"><a href="#cb514-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(base<span class="sc">::</span><span class="fu">union</span>(jointure_rbase<span class="sc">$</span>identifiant, diplome_rbase<span class="sc">$</span>identifiant))</span>
<span id="cb514-6"><a href="#cb514-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(base<span class="sc">::</span><span class="fu">unique</span>(<span class="fu">c</span>(jointure_rbase<span class="sc">$</span>identifiant, diplome_rbase<span class="sc">$</span>identifiant)))</span></code></pre></div>
</div>
</div>
<div id="tabset-121-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-121-3-tab">
<div class="cell">
<div class="sourceCode" id="cb515"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb515-1"><a href="#cb515-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dplyr:: permet de s&#39;assurer que ce sont les fonctions du Tidyverse (et non leurs homonymes de R-Base qui sont utilisées)</span></span>
<span id="cb515-2"><a href="#cb515-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb515-3"><a href="#cb515-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants uniques des 2 bases</span></span>
<span id="cb515-4"><a href="#cb515-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(dplyr<span class="sc">::</span><span class="fu">union_all</span>(jointure_tidyverse<span class="sc">$</span>identifiant, diplome_tidyverse<span class="sc">$</span>identifiant)) <span class="sc">%&gt;%</span> </span>
<span id="cb515-5"><a href="#cb515-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span>
<span id="cb515-6"><a href="#cb515-6" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">union</span>(jointure_tidyverse<span class="sc">$</span>identifiant, diplome_tidyverse<span class="sc">$</span>identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb515-7"><a href="#cb515-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-121-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-121-4-tab">
<div class="cell">
<div class="sourceCode" id="cb516"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb516-1"><a href="#cb516-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les fonctions spécifiques à data.table fonctionnent avec des formats data.table, d&#39;où la syntaxe un peu différente de R base</span></span>
<span id="cb516-2"><a href="#cb516-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb516-3"><a href="#cb516-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants uniques des 2 bases</span></span>
<span id="cb516-4"><a href="#cb516-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">c</span>(jointure_datatable[[variable]], diplome_datatable[[variable]])))</span>
<span id="cb516-5"><a href="#cb516-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">union</span>(jointure_datatable[[variable]], diplome_datatable[[variable]]))</span></code></pre></div>
</div>
</div>
<div id="tabset-121-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-121-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="identifiants-communs-des-2-bases" class="level3" data-number="17.11.3">
<h3 data-number="17.11.3"><span class="header-section-number">17.11.3</span> Identifiants communs des 2 bases</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-122-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-122-1" role="tab" aria-controls="tabset-122-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-122-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-122-2" role="tab" aria-controls="tabset-122-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-122-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-122-3" role="tab" aria-controls="tabset-122-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-122-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-122-4" role="tab" aria-controls="tabset-122-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-122-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-122-5" role="tab" aria-controls="tabset-122-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-122-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-122-1-tab">
<div class="sourceCode" id="cb517"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb517-1"><a href="#cb517-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb517-2"><a href="#cb517-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Identifiants communs des 2 bases */</span></span>
<span id="cb517-3"><a href="#cb517-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> Identifiant <span class="kw">from</span> Jointure intersect <span class="kw">select</span> Identifiant <span class="kw">from</span> Diplome</span>
<span id="cb517-4"><a href="#cb517-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span> <span class="kw">by</span> identifiant;</span>
<span id="cb517-5"><a href="#cb517-5" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-122-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-122-2-tab">
<div class="cell">
<div class="sourceCode" id="cb518"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb518-1"><a href="#cb518-1" aria-hidden="true" tabindex="-1"></a><span class="co"># base:: permet de s&#39;assurer que les fonctions proviennent de R base</span></span>
<span id="cb518-2"><a href="#cb518-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Des fonctions du même nom existent en Tidyverse, et tendent à prédominer si le package est lancé</span></span>
<span id="cb518-3"><a href="#cb518-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb518-4"><a href="#cb518-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants communs des 2 bases</span></span>
<span id="cb518-5"><a href="#cb518-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(base<span class="sc">::</span><span class="fu">intersect</span>(jointure_rbase<span class="sc">$</span>identifiant, diplome_rbase<span class="sc">$</span>identifiant))</span></code></pre></div>
</div>
</div>
<div id="tabset-122-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-122-3-tab">
<div class="cell">
<div class="sourceCode" id="cb519"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb519-1"><a href="#cb519-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dplyr:: permet de s&#39;assurer que ce sont les fonctions du Tidyverse (et non leurs homonymes de R-Base qui sont utilisées)</span></span>
<span id="cb519-2"><a href="#cb519-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb519-3"><a href="#cb519-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants communs des 2 bases</span></span>
<span id="cb519-4"><a href="#cb519-4" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">intersect</span>(jointure_tidyverse<span class="sc">$</span>identifiant, diplome_tidyverse<span class="sc">$</span>identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb519-5"><a href="#cb519-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-122-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-122-4-tab">
<div class="cell">
<div class="sourceCode" id="cb520"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb520-1"><a href="#cb520-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les fonctions spécifiques à data.table fonctionnent avec des formats data.table, d&#39;où la syntaxe un peu différente de R base</span></span>
<span id="cb520-2"><a href="#cb520-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb520-3"><a href="#cb520-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants communs des 2 bases</span></span>
<span id="cb520-4"><a href="#cb520-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fintersect</span>(jointure_datatable[, ..variable], diplome_datatable[, ..variable])[<span class="fu">order</span>(identifiant)]</span></code></pre></div>
</div>
</div>
<div id="tabset-122-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-122-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="identifiants-dans-jointure-mais-pas-diplome" class="level3" data-number="17.11.4">
<h3 data-number="17.11.4"><span class="header-section-number">17.11.4</span> Identifiants dans Jointure mais pas Diplome</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-123-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-123-1" role="tab" aria-controls="tabset-123-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-123-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-123-2" role="tab" aria-controls="tabset-123-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-123-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-123-3" role="tab" aria-controls="tabset-123-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-123-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-123-4" role="tab" aria-controls="tabset-123-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-123-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-123-5" role="tab" aria-controls="tabset-123-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-123-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-123-1-tab">
<div class="sourceCode" id="cb521"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb521-1"><a href="#cb521-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb521-2"><a href="#cb521-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Identifiants dans Jointure mais pas Diplome */</span></span>
<span id="cb521-3"><a href="#cb521-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> <span class="kw">distinct</span> Identifiant <span class="kw">from</span> Jointure <span class="kw">where</span></span>
<span id="cb521-4"><a href="#cb521-4" aria-hidden="true" tabindex="-1"></a>  Identifiant <span class="kw">not</span> <span class="kw">in</span> (<span class="kw">select</span> <span class="kw">distinct</span> Identifiant <span class="kw">from</span> Diplome)</span>
<span id="cb521-5"><a href="#cb521-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span> <span class="kw">by</span> identifiant;</span>
<span id="cb521-6"><a href="#cb521-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> Identifiant <span class="kw">from</span> Jointure except <span class="kw">select</span> Identifiant <span class="kw">from</span> Diplome;</span>
<span id="cb521-7"><a href="#cb521-7" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-123-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-123-2-tab">
<div class="cell">
<div class="sourceCode" id="cb522"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb522-1"><a href="#cb522-1" aria-hidden="true" tabindex="-1"></a><span class="co"># base:: permet de s&#39;assurer que les fonctions proviennent de R base</span></span>
<span id="cb522-2"><a href="#cb522-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Des fonctions du même nom existent en Tidyverse, et tendent à prédominer si le package est lancé</span></span>
<span id="cb522-3"><a href="#cb522-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb522-4"><a href="#cb522-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants dans Jointure mais pas Diplome</span></span>
<span id="cb522-5"><a href="#cb522-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(base<span class="sc">::</span><span class="fu">setdiff</span>(jointure_rbase<span class="sc">$</span>identifiant, diplome_rbase<span class="sc">$</span>identifiant))</span></code></pre></div>
</div>
</div>
<div id="tabset-123-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-123-3-tab">
<div class="cell">
<div class="sourceCode" id="cb523"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb523-1"><a href="#cb523-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dplyr:: permet de s&#39;assurer que ce sont les fonctions du Tidyverse (et non leurs homonymes de R-Base qui sont utilisées)</span></span>
<span id="cb523-2"><a href="#cb523-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb523-3"><a href="#cb523-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants dans Jointure mais pas Diplome</span></span>
<span id="cb523-4"><a href="#cb523-4" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">setdiff</span>(jointure_tidyverse<span class="sc">$</span>identifiant, diplome_tidyverse<span class="sc">$</span>identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb523-5"><a href="#cb523-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-123-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-123-4-tab">
<div class="cell">
<div class="sourceCode" id="cb524"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb524-1"><a href="#cb524-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les fonctions spécifiques à data.table fonctionnent avec des formats data.table, d&#39;où la syntaxe un peu différente de R base</span></span>
<span id="cb524-2"><a href="#cb524-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb524-3"><a href="#cb524-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants dans Jointure mais pas Diplome</span></span>
<span id="cb524-4"><a href="#cb524-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fsetdiff</span>(jointure_datatable[, ..variable], diplome_datatable[, ..variable])[<span class="fu">order</span>(identifiant)]</span></code></pre></div>
</div>
</div>
<div id="tabset-123-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-123-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="identifiants-dans-diplome-mais-pas-jointure" class="level3" data-number="17.11.5">
<h3 data-number="17.11.5"><span class="header-section-number">17.11.5</span> Identifiants dans Diplome mais pas Jointure</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-124-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-124-1" role="tab" aria-controls="tabset-124-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-124-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-124-2" role="tab" aria-controls="tabset-124-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-124-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-124-3" role="tab" aria-controls="tabset-124-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-124-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-124-4" role="tab" aria-controls="tabset-124-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-124-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-124-5" role="tab" aria-controls="tabset-124-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-124-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-124-1-tab">
<div class="sourceCode" id="cb525"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb525-1"><a href="#cb525-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb525-2"><a href="#cb525-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Identifiants dans Diplome mais pas Jointure */</span></span>
<span id="cb525-3"><a href="#cb525-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> <span class="kw">distinct</span> Identifiant <span class="kw">from</span> Diplome</span>
<span id="cb525-4"><a href="#cb525-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span> Identifiant <span class="kw">not</span> <span class="kw">in</span> (<span class="kw">select</span> <span class="kw">distinct</span> Identifiant <span class="kw">from</span> Jointure)</span>
<span id="cb525-5"><a href="#cb525-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span> <span class="kw">by</span> identifiant;</span>
<span id="cb525-6"><a href="#cb525-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> Identifiant <span class="kw">from</span> Diplome except</span>
<span id="cb525-7"><a href="#cb525-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> Identifiant <span class="kw">from</span> Jointure <span class="kw">order</span> <span class="kw">by</span> identifiant;</span>
<span id="cb525-8"><a href="#cb525-8" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-124-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-124-2-tab">
<div class="cell">
<div class="sourceCode" id="cb526"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb526-1"><a href="#cb526-1" aria-hidden="true" tabindex="-1"></a><span class="co"># base:: permet de s&#39;assurer que les fonctions proviennent de R base</span></span>
<span id="cb526-2"><a href="#cb526-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Des fonctions du même nom existent en Tidyverse, et tendent à prédominer si le package est lancé</span></span>
<span id="cb526-3"><a href="#cb526-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb526-4"><a href="#cb526-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants dans Diplome mais pas Jointure</span></span>
<span id="cb526-5"><a href="#cb526-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(base<span class="sc">::</span><span class="fu">setdiff</span>(diplome_rbase<span class="sc">$</span>identifiant, jointure_rbase<span class="sc">$</span>identifiant))</span></code></pre></div>
</div>
</div>
<div id="tabset-124-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-124-3-tab">
<div class="cell">
<div class="sourceCode" id="cb527"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb527-1"><a href="#cb527-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dplyr:: permet de s&#39;assurer que ce sont les fonctions du Tidyverse (et non leurs homonymes de R-Base qui sont utilisées)</span></span>
<span id="cb527-2"><a href="#cb527-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb527-3"><a href="#cb527-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants dans Diplome mais pas Jointure</span></span>
<span id="cb527-4"><a href="#cb527-4" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">setdiff</span>(diplome_tidyverse<span class="sc">$</span>identifiant, jointure_tidyverse<span class="sc">$</span>identifiant) <span class="sc">%&gt;%</span> </span>
<span id="cb527-5"><a href="#cb527-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-124-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-124-4-tab">
<div class="cell">
<div class="sourceCode" id="cb528"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb528-1"><a href="#cb528-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les fonctions spécifiques à data.table fonctionnent avec des formats data.table, d&#39;où la syntaxe un peu différente de R base</span></span>
<span id="cb528-2"><a href="#cb528-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-3"><a href="#cb528-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifiants dans Diplome mais pas Jointure</span></span>
<span id="cb528-4"><a href="#cb528-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fsetdiff</span>(diplome_datatable[, ..variable], jointure_datatable[, ..variable])[<span class="fu">order</span>(identifiant)]</span></code></pre></div>
</div>
</div>
<div id="tabset-124-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-124-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="concaténer-et-empiler-des-bases" class="level1" data-number="18">
<h1 data-number="18"><span class="header-section-number">18</span> Concaténer et empiler des bases</h1>
<section id="concaténer-deux-bases-de-données" class="level2" data-number="18.1">
<h2 data-number="18.1"><span class="header-section-number">18.1</span> Concaténer deux bases de données</h2>
<p>On va juxtaposer le numéro de la ligne à la base de données.</p>
<section id="nombre-de-colonnes-identique-dans-chaque-base" class="level3" data-number="18.1.1">
<h3 data-number="18.1.1"><span class="header-section-number">18.1.1</span> Nombre de colonnes identique dans chaque base</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-125-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-125-1" role="tab" aria-controls="tabset-125-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-125-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-125-2" role="tab" aria-controls="tabset-125-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-125-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-125-3" role="tab" aria-controls="tabset-125-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-125-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-125-4" role="tab" aria-controls="tabset-125-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-125-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-125-5" role="tab" aria-controls="tabset-125-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-125-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-125-1-tab">
<div class="sourceCode" id="cb529"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb529-1"><a href="#cb529-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Numéro de la ligne */</span></span>
<span id="cb529-2"><a href="#cb529-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql noprint;<span class="kw">select</span> count(*) <span class="kw">into</span> :tot <span class="kw">from</span> donnees_sas<span class="kw">;run</span>;</span>
<span id="cb529-3"><a href="#cb529-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Ajout<span class="kw">;do</span> Num_ligne = <span class="dv">1</span> <span class="kw">to</span> <span class="kw">&amp;tot.</span>;<span class="kw">output;end;run</span>;</span>
<span id="cb529-4"><a href="#cb529-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb529-5"><a href="#cb529-5" aria-hidden="true" tabindex="-1"></a><span class="co">/* Le merge sans by va juxtaposer côte à côte les bases */</span></span>
<span id="cb529-6"><a href="#cb529-6" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Concatener;<span class="kw">merge</span> Ajout donnees_sas<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-125-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-125-2-tab">
<div class="cell">
<div class="sourceCode" id="cb530"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb530-1"><a href="#cb530-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Numéro de la ligne</span></span>
<span id="cb530-2"><a href="#cb530-2" aria-hidden="true" tabindex="-1"></a>ajout <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">num_ligne =</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(donnees_rbase)))</span>
<span id="cb530-3"><a href="#cb530-3" aria-hidden="true" tabindex="-1"></a><span class="co"># cbind si les deux bases comprennent le même nombre de lignes</span></span>
<span id="cb530-4"><a href="#cb530-4" aria-hidden="true" tabindex="-1"></a>concatener <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ajout, donnees_rbase)</span></code></pre></div>
</div>
</div>
<div id="tabset-125-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-125-3-tab">
<div class="cell">
<div class="sourceCode" id="cb531"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb531-1"><a href="#cb531-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Numéro de la ligne</span></span>
<span id="cb531-2"><a href="#cb531-2" aria-hidden="true" tabindex="-1"></a>ajout <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">num_ligne =</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(donnees_tidyverse)))</span>
<span id="cb531-3"><a href="#cb531-3" aria-hidden="true" tabindex="-1"></a><span class="co"># cbind si les deux bases comprennent le même nombre de lignes</span></span>
<span id="cb531-4"><a href="#cb531-4" aria-hidden="true" tabindex="-1"></a>concatener <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(ajout)</span></code></pre></div>
</div>
</div>
<div id="tabset-125-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-125-4-tab">
<div class="cell">
<div class="sourceCode" id="cb532"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb532-1"><a href="#cb532-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Numéro de la ligne</span></span>
<span id="cb532-2"><a href="#cb532-2" aria-hidden="true" tabindex="-1"></a>ajout <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">num_ligne =</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(donnees_datatable)))</span>
<span id="cb532-3"><a href="#cb532-3" aria-hidden="true" tabindex="-1"></a><span class="co"># data.frame::cbind si les deux bases comprennent le même nombre de lignes</span></span>
<span id="cb532-4"><a href="#cb532-4" aria-hidden="true" tabindex="-1"></a>concatener <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ajout, donnees_datatable)</span></code></pre></div>
</div>
</div>
<div id="tabset-125-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-125-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="nombre-de-colonnes-différent-dans-chaque-base" class="level3" data-number="18.1.2">
<h3 data-number="18.1.2"><span class="header-section-number">18.1.2</span> Nombre de colonnes différent dans chaque base</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-126-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-126-1" role="tab" aria-controls="tabset-126-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-126-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-126-2" role="tab" aria-controls="tabset-126-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-126-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-126-3" role="tab" aria-controls="tabset-126-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-126-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-126-4" role="tab" aria-controls="tabset-126-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-126-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-126-5" role="tab" aria-controls="tabset-126-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-126-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-126-1-tab">
<div class="sourceCode" id="cb533"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb533-1"><a href="#cb533-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Si l&#39;une des bases comprend plus de ligne que l&#39;autre, ajout d&#39;une ligne de valeurs manquantes */</span></span>
<span id="cb533-2"><a href="#cb533-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql noprint;<span class="kw">select</span> count(*) + <span class="dv">1</span> <span class="kw">into</span> :tot <span class="kw">from</span> donnees_sas<span class="kw">;run</span>;</span>
<span id="cb533-3"><a href="#cb533-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Ajout<span class="kw">;do</span> Num_ligne = <span class="dv">1</span> <span class="kw">to</span> <span class="kw">&amp;tot.</span>;<span class="kw">output;end;run</span>;</span>
<span id="cb533-4"><a href="#cb533-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Concatener;<span class="kw">merge</span> Ajout donnees_sas<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-126-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-126-2-tab">
<div class="cell">
<div class="sourceCode" id="cb534"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb534-1"><a href="#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Erreur si l&#39;une des bases comprend plus de lignes que l&#39;autre</span></span>
<span id="cb534-2"><a href="#cb534-2" aria-hidden="true" tabindex="-1"></a>ajout <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">num_ligne =</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(donnees_rbase) <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb534-3"><a href="#cb534-3" aria-hidden="true" tabindex="-1"></a><span class="co"># donnees_rbase_ajout &lt;- cbind(ajout, donnees_rbase)</span></span>
<span id="cb534-4"><a href="#cb534-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb534-5"><a href="#cb534-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Proposition de solution</span></span>
<span id="cb534-6"><a href="#cb534-6" aria-hidden="true" tabindex="-1"></a>cbind_alt <span class="ot">&lt;-</span> <span class="cf">function</span>(liste) {</span>
<span id="cb534-7"><a href="#cb534-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Nombre maximal de colonnes dans la liste de dataframes</span></span>
<span id="cb534-8"><a href="#cb534-8" aria-hidden="true" tabindex="-1"></a>  maxCol <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(liste, nrow)))</span>
<span id="cb534-9"><a href="#cb534-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ajout d&#39;une colonne de valeurs manquantes pour toutes les bases ayant moins de ligne que le maximum</span></span>
<span id="cb534-10"><a href="#cb534-10" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(liste, <span class="cf">function</span>(x) {</span>
<span id="cb534-11"><a href="#cb534-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(maxCol <span class="sc">-</span> <span class="fu">nrow</span>(x))) {</span>
<span id="cb534-12"><a href="#cb534-12" aria-hidden="true" tabindex="-1"></a>      x[<span class="fu">nrow</span>(x) <span class="sc">+</span> i, ] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb534-13"><a href="#cb534-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb534-14"><a href="#cb534-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(x)</span>
<span id="cb534-15"><a href="#cb534-15" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb534-16"><a href="#cb534-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># On joint les résultats</span></span>
<span id="cb534-17"><a href="#cb534-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">do.call</span>(cbind, res))</span>
<span id="cb534-18"><a href="#cb534-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb534-19"><a href="#cb534-19" aria-hidden="true" tabindex="-1"></a>concatener <span class="ot">&lt;-</span> <span class="fu">cbind_alt</span>(<span class="fu">list</span>(ajout, donnees_rbase))</span></code></pre></div>
</div>
</div>
<div id="tabset-126-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-126-3-tab">
<div class="cell">
<div class="sourceCode" id="cb535"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb535-1"><a href="#cb535-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ne fonctionne si l&#39;une des bases comprend plus de lignes que l&#39;autre !</span></span>
<span id="cb535-2"><a href="#cb535-2" aria-hidden="true" tabindex="-1"></a>ajout <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">num_ligne =</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(donnees_tidyverse) <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb535-3"><a href="#cb535-3" aria-hidden="true" tabindex="-1"></a><span class="co">#concatener &lt;- donnees_tidyverse %&gt;% bind_cols(ajout)</span></span>
<span id="cb535-4"><a href="#cb535-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb535-5"><a href="#cb535-5" aria-hidden="true" tabindex="-1"></a><span class="co"># cf. solution proposée dans R-Base</span></span>
<span id="cb535-6"><a href="#cb535-6" aria-hidden="true" tabindex="-1"></a>cbind_alt <span class="ot">&lt;-</span> <span class="cf">function</span>(liste) {</span>
<span id="cb535-7"><a href="#cb535-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Nombre maximal de colonnes dans la liste de dataframes</span></span>
<span id="cb535-8"><a href="#cb535-8" aria-hidden="true" tabindex="-1"></a>  maxCol <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(liste, nrow)))</span>
<span id="cb535-9"><a href="#cb535-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ajout d&#39;une colonne de valeurs manquantes pour toutes les bases ayant moins de ligne que le maximum</span></span>
<span id="cb535-10"><a href="#cb535-10" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(liste, <span class="cf">function</span>(x) {</span>
<span id="cb535-11"><a href="#cb535-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(maxCol <span class="sc">-</span> <span class="fu">nrow</span>(x))) {</span>
<span id="cb535-12"><a href="#cb535-12" aria-hidden="true" tabindex="-1"></a>      x[<span class="fu">nrow</span>(x) <span class="sc">+</span> i, ] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb535-13"><a href="#cb535-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb535-14"><a href="#cb535-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(x)</span>
<span id="cb535-15"><a href="#cb535-15" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb535-16"><a href="#cb535-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># On joint les résultats</span></span>
<span id="cb535-17"><a href="#cb535-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">bind_cols</span>(res))</span>
<span id="cb535-18"><a href="#cb535-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb535-19"><a href="#cb535-19" aria-hidden="true" tabindex="-1"></a>concatener <span class="ot">&lt;-</span> <span class="fu">cbind_alt</span>(<span class="fu">list</span>(ajout, donnees_tidyverse))</span></code></pre></div>
</div>
</div>
<div id="tabset-126-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-126-4-tab">
<div class="cell">
<div class="sourceCode" id="cb536"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb536-1"><a href="#cb536-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fonctionne aussi avec des bases comportement un nombre différent de lignes</span></span>
<span id="cb536-2"><a href="#cb536-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Mais attention, le résultat n&#39;est pas le même que sur SAS, il y a recycling</span></span>
<span id="cb536-3"><a href="#cb536-3" aria-hidden="true" tabindex="-1"></a>ajout <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">num_ligne =</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(donnees_datatable) <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb536-4"><a href="#cb536-4" aria-hidden="true" tabindex="-1"></a>concatener <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ajout, donnees_datatable)</span></code></pre></div>
</div>
</div>
<div id="tabset-126-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-126-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="empiler-deux-bases-de-données" class="level2" data-number="18.2">
<h2 data-number="18.2"><span class="header-section-number">18.2</span> Empiler deux bases de données</h2>
<p>On va empiler la somme des notes en dessous de la base des notes.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-127-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-127-1" role="tab" aria-controls="tabset-127-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-127-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-127-2" role="tab" aria-controls="tabset-127-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-127-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-127-3" role="tab" aria-controls="tabset-127-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-127-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-127-4" role="tab" aria-controls="tabset-127-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-127-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-127-5" role="tab" aria-controls="tabset-127-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-127-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-127-1-tab">
<div class="sourceCode" id="cb537"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb537-1"><a href="#cb537-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* On sélectionne un nombre réduit de variables pour simplifier l&#39;exemple */</span></span>
<span id="cb537-2"><a href="#cb537-2" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> <span class="fu">var</span> = Identifiant Note_Contenu Note_Formateur Note_Moyens Note_Accompagnement Note_Materiel;</span>
<span id="cb537-3"><a href="#cb537-3" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> var2 = <span class="kw">%sysfunc</span>(<span class="fu">tranwrd</span>(<span class="kw">&amp;var.</span>, Identifiant,));</span>
<span id="cb537-4"><a href="#cb537-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Notes;<span class="kw">set</span> donnees_sas (<span class="kw">keep</span> = <span class="kw">&amp;var.</span>)<span class="kw">;run</span>;</span>
<span id="cb537-5"><a href="#cb537-5" aria-hidden="true" tabindex="-1"></a><span class="co">/* Moyenne des notes par individu */</span></span>
<span id="cb537-6"><a href="#cb537-6" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = Notes noprint <span class="fu">mean</span>;<span class="fu">var</span> <span class="kw">&amp;var2.</span>;<span class="kw">output</span> out = Ajout <span class="fu">mean</span> = <span class="kw">&amp;var2.;run</span>;</span>
<span id="cb537-7"><a href="#cb537-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb537-8"><a href="#cb537-8" aria-hidden="true" tabindex="-1"></a><span class="co">/* On concatène avec les données. Valeur manquante si les variables ne correspondent pas */</span></span>
<span id="cb537-9"><a href="#cb537-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb537-10"><a href="#cb537-10" aria-hidden="true" tabindex="-1"></a><span class="co">/* L&#39;instruction set permet de concaténer les bases */</span></span>
<span id="cb537-11"><a href="#cb537-11" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Empiler;<span class="kw">set</span> Notes Ajout (<span class="kw">drop</span> = _type_ _freq_)<span class="kw">;run</span>;</span>
<span id="cb537-12"><a href="#cb537-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb537-13"><a href="#cb537-13" aria-hidden="true" tabindex="-1"></a><span class="co">/* Autre solution, proc append */</span></span>
<span id="cb537-14"><a href="#cb537-14" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Empiler;<span class="kw">set</span> Notes<span class="kw">;run</span>;</span>
<span id="cb537-15"><a href="#cb537-15" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> append base = Empiler<span class="kw"> data</span> = Ajout force<span class="kw">;run</span>;</span>
<span id="cb537-16"><a href="#cb537-16" aria-hidden="true" tabindex="-1"></a><span class="co">/* On renomme la ligne des moyennes ajoutée */</span></span>
<span id="cb537-17"><a href="#cb537-17" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Empiler;</span>
<span id="cb537-18"><a href="#cb537-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> Empiler nobs = nobs;</span>
<span id="cb537-19"><a href="#cb537-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> _N_ = nobs <span class="kw">then</span> Identifiant = <span class="st">&quot;Moyenne&quot;</span>;</span>
<span id="cb537-20"><a href="#cb537-20" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-127-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-127-2-tab">
<div class="cell">
<div class="sourceCode" id="cb538"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb538-1"><a href="#cb538-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On va empiler la somme des notes en dessous de la base des notes</span></span>
<span id="cb538-2"><a href="#cb538-2" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb538-3"><a href="#cb538-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Moyenne des notes par individu</span></span>
<span id="cb538-4"><a href="#cb538-4" aria-hidden="true" tabindex="-1"></a>moyennes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">colMeans</span>(donnees_rbase[, varNotes], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb538-5"><a href="#cb538-5" aria-hidden="true" tabindex="-1"></a><span class="co"># On sélectionne la base des notes</span></span>
<span id="cb538-6"><a href="#cb538-6" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> donnees_rbase[, varNotes]</span>
<span id="cb538-7"><a href="#cb538-7" aria-hidden="true" tabindex="-1"></a><span class="co"># rbind lorsque les bases empilées ont le même nombre de colonne</span></span>
<span id="cb538-8"><a href="#cb538-8" aria-hidden="true" tabindex="-1"></a>empiler <span class="ot">&lt;-</span> <span class="fu">rbind</span>(notes, moyennes)</span>
<span id="cb538-9"><a href="#cb538-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb538-10"><a href="#cb538-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Mais, ne fonctionne plus si l&#39;on concatène des bases de taille différente</span></span>
<span id="cb538-11"><a href="#cb538-11" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> donnees_rbase[, <span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, varNotes)]</span>
<span id="cb538-12"><a href="#cb538-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Ne fonctionne pas</span></span>
<span id="cb538-13"><a href="#cb538-13" aria-hidden="true" tabindex="-1"></a><span class="co">#empiler &lt;- rbind(notes, moyennes)</span></span>
<span id="cb538-14"><a href="#cb538-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Une solution alternative, lorsque le nombre de colonnes diffère entre les deux bases</span></span>
<span id="cb538-15"><a href="#cb538-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Lorsque les variables ne correspondent pas, on les crée avec des valeurs manquantes, via setdiff</span></span>
<span id="cb538-16"><a href="#cb538-16" aria-hidden="true" tabindex="-1"></a>rbind_alt <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb538-17"><a href="#cb538-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(<span class="fu">data.frame</span>(<span class="fu">c</span>(x, <span class="fu">sapply</span>(<span class="fu">setdiff</span>(<span class="fu">names</span>(y), <span class="fu">names</span>(x)), <span class="cf">function</span>(z) <span class="cn">NA</span>))),</span>
<span id="cb538-18"><a href="#cb538-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data.frame</span>(<span class="fu">c</span>(y, <span class="fu">sapply</span>(<span class="fu">setdiff</span>(<span class="fu">names</span>(x), <span class="fu">names</span>(y)), <span class="cf">function</span>(z) <span class="cn">NA</span>)))</span>
<span id="cb538-19"><a href="#cb538-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb538-20"><a href="#cb538-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb538-21"><a href="#cb538-21" aria-hidden="true" tabindex="-1"></a>empiler <span class="ot">&lt;-</span> <span class="fu">rbind_alt</span>(notes, moyennes)</span>
<span id="cb538-22"><a href="#cb538-22" aria-hidden="true" tabindex="-1"></a><span class="co"># On renomme la ligne des moyennes ajoutée</span></span>
<span id="cb538-23"><a href="#cb538-23" aria-hidden="true" tabindex="-1"></a>empiler[<span class="fu">nrow</span>(empiler), <span class="st">&quot;identifiant&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Moyenne&quot;</span></span></code></pre></div>
</div>
</div>
<div id="tabset-127-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-127-3-tab">
<div class="cell">
<div class="sourceCode" id="cb539"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb539-1"><a href="#cb539-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On va empiler la somme des notes en dessous de la base des notes</span></span>
<span id="cb539-2"><a href="#cb539-2" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb539-3"><a href="#cb539-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Moyenne des notes par individu</span></span>
<span id="cb539-4"><a href="#cb539-4" aria-hidden="true" tabindex="-1"></a>moyennes <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb539-5"><a href="#cb539-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(varNotes, <span class="sc">~</span><span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb539-6"><a href="#cb539-6" aria-hidden="true" tabindex="-1"></a>empiler <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb539-7"><a href="#cb539-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(varNotes)) <span class="sc">%&gt;%</span> </span>
<span id="cb539-8"><a href="#cb539-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(moyennes)</span>
<span id="cb539-9"><a href="#cb539-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb539-10"><a href="#cb539-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fonctionne toujours si l&#39;on concatène des bases de taille différente</span></span>
<span id="cb539-11"><a href="#cb539-11" aria-hidden="true" tabindex="-1"></a>empiler <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb539-12"><a href="#cb539-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(identifiant, <span class="fu">all_of</span>(varNotes)) <span class="sc">%&gt;%</span> </span>
<span id="cb539-13"><a href="#cb539-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(moyennes)</span>
<span id="cb539-14"><a href="#cb539-14" aria-hidden="true" tabindex="-1"></a>empiler <span class="ot">&lt;-</span> empiler <span class="sc">%&gt;%</span> </span>
<span id="cb539-15"><a href="#cb539-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># On renomme la ligne des moyennes ajoutée</span></span>
<span id="cb539-16"><a href="#cb539-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">identifiant =</span> <span class="fu">ifelse</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="fu">nrow</span>(empiler),</span>
<span id="cb539-17"><a href="#cb539-17" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;Moyenne&quot;</span>,</span>
<span id="cb539-18"><a href="#cb539-18" aria-hidden="true" tabindex="-1"></a>                              identifiant))</span></code></pre></div>
</div>
</div>
<div id="tabset-127-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-127-4-tab">
<div class="cell">
<div class="sourceCode" id="cb540"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb540-1"><a href="#cb540-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On va empiler la somme des notes en dessous de la base des notes</span></span>
<span id="cb540-2"><a href="#cb540-2" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb540-3"><a href="#cb540-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Moyenne des notes par individu</span></span>
<span id="cb540-4"><a href="#cb540-4" aria-hidden="true" tabindex="-1"></a>moyennes <span class="ot">&lt;-</span> <span class="fu">data.table</span>(donnees_datatable[, <span class="fu">lapply</span>(.SD, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.SDcols =</span> varNotes])</span>
<span id="cb540-5"><a href="#cb540-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb540-6"><a href="#cb540-6" aria-hidden="true" tabindex="-1"></a><span class="co"># On sélectionne la base des notes</span></span>
<span id="cb540-7"><a href="#cb540-7" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">mget</span>(<span class="fu">c</span>(<span class="st">&quot;identifiant&quot;</span>, varNotes))]</span>
<span id="cb540-8"><a href="#cb540-8" aria-hidden="true" tabindex="-1"></a>empiler <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">list</span>(notes, moyennes), <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb540-9"><a href="#cb540-9" aria-hidden="true" tabindex="-1"></a><span class="co"># On renomme la ligne des moyennes ajoutée</span></span>
<span id="cb540-10"><a href="#cb540-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set</span>(empiler, <span class="at">i =</span> <span class="fu">nrow</span>(empiler), <span class="at">j =</span> <span class="st">&quot;identifiant&quot;</span>, <span class="at">value =</span> <span class="st">&quot;Moyenne&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-127-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-127-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="ajouter-une-ligne-de-valeurs-manquantes-à-une-base-de-données" class="level2" data-number="18.3">
<h2 data-number="18.3"><span class="header-section-number">18.3</span> Ajouter une ligne de valeurs manquantes à une base de données</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-128-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-128-1" role="tab" aria-controls="tabset-128-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-128-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-128-2" role="tab" aria-controls="tabset-128-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-128-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-128-3" role="tab" aria-controls="tabset-128-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-128-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-128-4" role="tab" aria-controls="tabset-128-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-128-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-128-5" role="tab" aria-controls="tabset-128-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-128-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-128-1-tab">
<div class="sourceCode" id="cb541"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb541-1"><a href="#cb541-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Ajout<span class="kw">;run</span>;</span>
<span id="cb541-2"><a href="#cb541-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> Ajout_Missing;<span class="kw">set</span> Jointure Ajout<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-128-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-128-2-tab">
<div class="cell">
<div class="sourceCode" id="cb542"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb542-1"><a href="#cb542-1" aria-hidden="true" tabindex="-1"></a>ajout_na <span class="ot">&lt;-</span> donnees_rbase</span>
<span id="cb542-2"><a href="#cb542-2" aria-hidden="true" tabindex="-1"></a>ajout_na[<span class="fu">nrow</span>(ajout_na) <span class="sc">+</span> <span class="dv">1</span>, ] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
</div>
</div>
<div id="tabset-128-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-128-3-tab">
<div class="cell">
<div class="sourceCode" id="cb543"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb543-1"><a href="#cb543-1" aria-hidden="true" tabindex="-1"></a>ajout_na <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb543-2"><a href="#cb543-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="cn">NA</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-128-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-128-4-tab">
<div class="cell">
<div class="sourceCode" id="cb544"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb544-1"><a href="#cb544-1" aria-hidden="true" tabindex="-1"></a>ajout_na <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">list</span>(donnees_datatable, <span class="fu">data.table</span>(<span class="cn">NA</span>)), <span class="at">fill =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-128-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-128-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="statistiques-descriptives" class="level1" data-number="19">
<h1 data-number="19"><span class="header-section-number">19</span> Statistiques descriptives</h1>
<section id="moyenne" class="level2" data-number="19.1">
<h2 data-number="19.1"><span class="header-section-number">19.1</span> Moyenne</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-129-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-129-1" role="tab" aria-controls="tabset-129-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-129-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-129-2" role="tab" aria-controls="tabset-129-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-129-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-129-3" role="tab" aria-controls="tabset-129-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-129-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-129-4" role="tab" aria-controls="tabset-129-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-129-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-129-5" role="tab" aria-controls="tabset-129-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-129-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-129-1-tab">
<div class="sourceCode" id="cb545"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb545-1"><a href="#cb545-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">mean</span>;<span class="fu">var</span> note_contenu<span class="kw">;run</span>;</span>
<span id="cb545-2"><a href="#cb545-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;<span class="kw">select</span> <span class="fu">mean</span>(note_contenu) <span class="kw">from</span> donnees_sas<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-129-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-129-2-tab">
<div class="cell">
<div class="sourceCode" id="cb546"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb546-1"><a href="#cb546-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importance du na.rm = TRUE en cas de variables manquantes</span></span>
<span id="cb546-2"><a href="#cb546-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(donnees_rbase<span class="sc">$</span>note_contenu)</span>
<span id="cb546-3"><a href="#cb546-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(donnees_rbase<span class="sc">$</span>note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-129-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-129-3-tab">
<div class="cell">
<div class="sourceCode" id="cb547"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb547-1"><a href="#cb547-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importance du na.rm = TRUE en cas de variables manquantes</span></span>
<span id="cb547-2"><a href="#cb547-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">pull</span>(note_contenu) <span class="sc">%&gt;%</span> <span class="fu">mean</span>()</span>
<span id="cb547-3"><a href="#cb547-3" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">pull</span>(note_contenu) <span class="sc">%&gt;%</span> <span class="fu">mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb547-4"><a href="#cb547-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb547-5"><a href="#cb547-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Autres solutions</span></span>
<span id="cb547-6"><a href="#cb547-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Le chiffre est arrondi lorsqu&#39;il est affiché, du fait des propriétés des tibbles</span></span>
<span id="cb547-7"><a href="#cb547-7" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">mean</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb547-8"><a href="#cb547-8" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb547-9"><a href="#cb547-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(note_contenu, <span class="sc">~</span><span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb547-10"><a href="#cb547-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb547-11"><a href="#cb547-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Attention, en tidyverse, les syntaxes suivantes ne fonctionnent pas !</span></span>
<span id="cb547-12"><a href="#cb547-12" aria-hidden="true" tabindex="-1"></a><span class="co"># donnees_tidyverse %&gt;% mean(note_contenu)</span></span>
<span id="cb547-13"><a href="#cb547-13" aria-hidden="true" tabindex="-1"></a><span class="co"># donnees_tidyverse %&gt;% mean(note_contenu, na.rm = TRUE)</span></span></code></pre></div>
</div>
</div>
<div id="tabset-129-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-129-4-tab">
<div class="cell">
<div class="sourceCode" id="cb548"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb548-1"><a href="#cb548-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importance du na.rm = TRUE en cas de variables manquantes</span></span>
<span id="cb548-2"><a href="#cb548-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">mean</span>(note_contenu)]</span>
<span id="cb548-3"><a href="#cb548-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">mean</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)]</span></code></pre></div>
</div>
</div>
<div id="tabset-129-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-129-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="moyenne-par-sélection" class="level2" data-number="19.2">
<h2 data-number="19.2"><span class="header-section-number">19.2</span> Moyenne par sélection</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-130-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-130-1" role="tab" aria-controls="tabset-130-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-130-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-130-2" role="tab" aria-controls="tabset-130-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-130-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-130-3" role="tab" aria-controls="tabset-130-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-130-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-130-4" role="tab" aria-controls="tabset-130-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-130-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-130-5" role="tab" aria-controls="tabset-130-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-130-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-130-1-tab">
<div class="sourceCode" id="cb549"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb549-1"><a href="#cb549-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Ici pour les seules femmes */</span></span>
<span id="cb549-2"><a href="#cb549-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">mean</span>;</span>
<span id="cb549-3"><a href="#cb549-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> note_contenu;</span>
<span id="cb549-4"><a href="#cb549-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span> sexef = <span class="st">&quot;Femme&quot;</span>;</span>
<span id="cb549-5"><a href="#cb549-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-130-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-130-2-tab">
<div class="cell">
<div class="sourceCode" id="cb550"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb550-1"><a href="#cb550-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ici, pour les seules femmes</span></span>
<span id="cb550-2"><a href="#cb550-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">subset</span>(donnees_rbase, sexef <span class="sc">==</span> <span class="st">&quot;Femme&quot;</span>), <span class="fu">mean</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-130-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-130-3-tab">
<div class="cell">
<div class="sourceCode" id="cb551"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb551-1"><a href="#cb551-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ici, pour les seules femmes</span></span>
<span id="cb551-2"><a href="#cb551-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb551-3"><a href="#cb551-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sexef <span class="sc">==</span> <span class="st">&quot;Femme&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb551-4"><a href="#cb551-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(note_contenu) <span class="sc">%&gt;%</span></span>
<span id="cb551-5"><a href="#cb551-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb551-6"><a href="#cb551-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb551-7"><a href="#cb551-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Autres solutions</span></span>
<span id="cb551-8"><a href="#cb551-8" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb551-9"><a href="#cb551-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sexef <span class="sc">==</span> <span class="st">&quot;Femme&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb551-10"><a href="#cb551-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">moyenne =</span> <span class="fu">mean</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb551-11"><a href="#cb551-11" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb551-12"><a href="#cb551-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sexef <span class="sc">==</span> <span class="st">&quot;Femme&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb551-13"><a href="#cb551-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(note_contenu, <span class="sc">~</span> <span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb551-14"><a href="#cb551-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Attention, syntaxe qui ne fonctionne qu&#39;avec %&gt;%, pas avec %&gt;% !</span></span>
<span id="cb551-15"><a href="#cb551-15" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb551-16"><a href="#cb551-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sexef <span class="sc">==</span> <span class="st">&quot;Femme&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb551-17"><a href="#cb551-17" aria-hidden="true" tabindex="-1"></a>  {<span class="fu">mean</span>(.<span class="sc">$</span>note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)}</span></code></pre></div>
</div>
</div>
<div id="tabset-130-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-130-4-tab">
<div class="cell">
<div class="sourceCode" id="cb552"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb552-1"><a href="#cb552-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ici, pour les seules femmes</span></span>
<span id="cb552-2"><a href="#cb552-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[sexef <span class="sc">==</span> <span class="st">&quot;Femme&quot;</span>, <span class="fu">mean</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb552-3"><a href="#cb552-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable[sexef <span class="sc">==</span> <span class="st">&quot;Femme&quot;</span>, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), .SDcols <span class="ot">=</span> <span class="st">&quot;note_contenu&quot;</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-130-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-130-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="moyenne-pondérée" class="level2" data-number="19.3">
<h2 data-number="19.3"><span class="header-section-number">19.3</span> Moyenne pondérée</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-131-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-131-1" role="tab" aria-controls="tabset-131-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-131-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-131-2" role="tab" aria-controls="tabset-131-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-131-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-131-3" role="tab" aria-controls="tabset-131-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-131-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-131-4" role="tab" aria-controls="tabset-131-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-131-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-131-5" role="tab" aria-controls="tabset-131-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-131-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-131-1-tab">
<div class="sourceCode" id="cb553"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb553-1"><a href="#cb553-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">mean</span>;</span>
<span id="cb553-2"><a href="#cb553-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> note_contenu;</span>
<span id="cb553-3"><a href="#cb553-3" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb553-4"><a href="#cb553-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-131-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-131-2-tab">
<div class="cell">
<div class="sourceCode" id="cb554"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb554-1"><a href="#cb554-1" aria-hidden="true" tabindex="-1"></a><span class="fu">weighted.mean</span>(donnees_rbase<span class="sc">$</span>note_contenu, donnees_rbase<span class="sc">$</span>poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb554-2"><a href="#cb554-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb554-3"><a href="#cb554-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre méthode, mais attention aux NA !!</span></span>
<span id="cb554-4"><a href="#cb554-4" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_rbase, <span class="fu">sum</span>(note_contenu <span class="sc">*</span> poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>((<span class="sc">!</span><span class="fu">is.na</span>(note_contenu)) <span class="sc">*</span> poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-131-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-131-3-tab">
<div class="cell">
<div class="sourceCode" id="cb555"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb555-1"><a href="#cb555-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb555-2"><a href="#cb555-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(note_contenu, <span class="sc">~</span><span class="fu">weighted.mean</span>(., <span class="at">w =</span> poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span></code></pre></div>
</div>
</div>
<div id="tabset-131-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-131-4-tab">
<div class="cell">
<div class="sourceCode" id="cb556"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb556-1"><a href="#cb556-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">weighted.mean</span>(note_contenu, poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)]</span></code></pre></div>
</div>
</div>
<div id="tabset-131-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-131-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="moyenne-pondérée-par-sélection" class="level2" data-number="19.4">
<h2 data-number="19.4"><span class="header-section-number">19.4</span> Moyenne pondérée par sélection</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-132-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-132-1" role="tab" aria-controls="tabset-132-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-132-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-132-2" role="tab" aria-controls="tabset-132-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-132-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-132-3" role="tab" aria-controls="tabset-132-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-132-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-132-4" role="tab" aria-controls="tabset-132-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-132-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-132-5" role="tab" aria-controls="tabset-132-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-132-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-132-1-tab">
<div class="sourceCode" id="cb557"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb557-1"><a href="#cb557-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Par sélection (ici pour les seules femmes) */</span></span>
<span id="cb557-2"><a href="#cb557-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">mean</span>;</span>
<span id="cb557-3"><a href="#cb557-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> note_contenu;</span>
<span id="cb557-4"><a href="#cb557-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span> sexef = <span class="st">&quot;Femme&quot;</span>;</span>
<span id="cb557-5"><a href="#cb557-5" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb557-6"><a href="#cb557-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-132-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-132-2-tab">
<div class="cell">
<div class="sourceCode" id="cb558"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb558-1"><a href="#cb558-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Par sélection (ici pour les seules femmes)</span></span>
<span id="cb558-2"><a href="#cb558-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">subset</span>(donnees_rbase, sexef <span class="sc">==</span> <span class="st">&quot;Femme&quot;</span>), <span class="fu">sum</span>(note_contenu <span class="sc">*</span> poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb558-3"><a href="#cb558-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-4"><a href="#cb558-4" aria-hidden="true" tabindex="-1"></a><span class="co"># On peut aussi utiliser la fonction crossprod</span></span>
<span id="cb558-5"><a href="#cb558-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Mais ne fonctionne pas dans ce cas, car elle ne prend pas en compte les na.rm = TRUE</span></span>
<span id="cb558-6"><a href="#cb558-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ne pas confondre cumprod et crossprod !!!!</span></span>
<span id="cb558-7"><a href="#cb558-7" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">subset</span>(donnees_rbase, sexef <span class="sc">==</span> <span class="st">&quot;Femme&quot;</span>), <span class="fu">crossprod</span>(note_contenu, poids_sondage) <span class="sc">/</span> <span class="fu">sum</span>(poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-132-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-132-3-tab">
<div class="cell">
<div class="sourceCode" id="cb559"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb559-1"><a href="#cb559-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Par sélection</span></span>
<span id="cb559-2"><a href="#cb559-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb559-3"><a href="#cb559-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sexef <span class="sc">==</span> <span class="st">&quot;Femme&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb559-4"><a href="#cb559-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(note_contenu, <span class="sc">~</span><span class="fu">weighted.mean</span>(., <span class="at">w =</span> poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span></code></pre></div>
</div>
</div>
<div id="tabset-132-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-132-4-tab">
<div class="cell">
<div class="sourceCode" id="cb560"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb560-1"><a href="#cb560-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Par sélection (ici pour les seules femmes)</span></span>
<span id="cb560-2"><a href="#cb560-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[sexef <span class="sc">==</span> <span class="st">&quot;Femme&quot;</span>, <span class="fu">weighted.mean</span>(note_contenu, poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb560-3"><a href="#cb560-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable[sexef <span class="sc">==</span> <span class="st">&quot;Femme&quot;</span>, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">weighted.mean</span>(x, poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), .SDcols <span class="ot">=</span> <span class="st">&quot;note_contenu&quot;</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-132-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-132-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="moyenne-de-plusieurs-variables" class="level2" data-number="19.5">
<h2 data-number="19.5"><span class="header-section-number">19.5</span> Moyenne de plusieurs variables</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-133-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-133-1" role="tab" aria-controls="tabset-133-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-133-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-133-2" role="tab" aria-controls="tabset-133-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-133-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-133-3" role="tab" aria-controls="tabset-133-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-133-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-133-4" role="tab" aria-controls="tabset-133-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-133-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-133-5" role="tab" aria-controls="tabset-133-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-133-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-133-1-tab">
<div class="sourceCode" id="cb561"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb561-1"><a href="#cb561-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> notes = Note_Contenu Note_Formateur Note_Moyens Note_Accompagnement Note_Materiel;</span>
<span id="cb561-2"><a href="#cb561-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">mean</span>;</span>
<span id="cb561-3"><a href="#cb561-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> <span class="kw">&amp;notes.</span>;</span>
<span id="cb561-4"><a href="#cb561-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-133-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-133-2-tab">
<div class="cell">
<div class="sourceCode" id="cb562"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb562-1"><a href="#cb562-1" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">c</span>(<span class="st">&quot;Note_Contenu&quot;</span>, <span class="st">&quot;Note_Formateur&quot;</span>, <span class="st">&quot;Note_Moyens&quot;</span>, <span class="st">&quot;Note_Accompagnement&quot;</span>, <span class="st">&quot;Note_Materiel&quot;</span>))</span>
<span id="cb562-2"><a href="#cb562-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb562-3"><a href="#cb562-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plusieurs solutions</span></span>
<span id="cb562-4"><a href="#cb562-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb562-5"><a href="#cb562-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Sous forme de liste</span></span>
<span id="cb562-6"><a href="#cb562-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(donnees_rbase[, notes], mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb562-7"><a href="#cb562-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb562-8"><a href="#cb562-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Sous forme de vecteur</span></span>
<span id="cb562-9"><a href="#cb562-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(donnees_rbase[, notes], mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb562-10"><a href="#cb562-10" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(donnees_rbase[, notes], <span class="dv">2</span>, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb562-11"><a href="#cb562-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb562-12"><a href="#cb562-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Si l&#39;on souhaite renommer les colonnes</span></span>
<span id="cb562-13"><a href="#cb562-13" aria-hidden="true" tabindex="-1"></a>moyennes <span class="ot">&lt;-</span> <span class="fu">sapply</span>(donnees_rbase[, notes], mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb562-14"><a href="#cb562-14" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(moyennes) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Moyenne&quot;</span>, <span class="fu">names</span>(moyennes), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb562-15"><a href="#cb562-15" aria-hidden="true" tabindex="-1"></a>moyennes</span></code></pre></div>
</div>
</div>
<div id="tabset-133-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-133-3-tab">
<div class="cell">
<div class="sourceCode" id="cb563"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb563-1"><a href="#cb563-1" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">c</span>(<span class="st">&quot;Note_Contenu&quot;</span>, <span class="st">&quot;Note_Formateur&quot;</span>, <span class="st">&quot;Note_Moyens&quot;</span>, <span class="st">&quot;Note_Accompagnement&quot;</span>, <span class="st">&quot;Note_Materiel&quot;</span>))</span>
<span id="cb563-2"><a href="#cb563-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb563-3"><a href="#cb563-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(notes), <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb563-4"><a href="#cb563-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Si l&#39;on souhaite renommer les colonnes</span></span>
<span id="cb563-5"><a href="#cb563-5" aria-hidden="true" tabindex="-1"></a>moyennes <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb563-6"><a href="#cb563-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(notes), <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.names =</span> <span class="st">&quot;Moyenne_{.col}&quot;</span>))</span>
<span id="cb563-7"><a href="#cb563-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb563-8"><a href="#cb563-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Autres solutions</span></span>
<span id="cb563-9"><a href="#cb563-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Obsolètes</span></span>
<span id="cb563-10"><a href="#cb563-10" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb563-11"><a href="#cb563-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_at</span>(notes, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb563-12"><a href="#cb563-12" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span>  </span>
<span id="cb563-13"><a href="#cb563-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;Note&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">&quot;_100&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb563-14"><a href="#cb563-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="at">.funs =</span> <span class="sc">~</span> <span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.vars =</span> notes)</span>
<span id="cb563-15"><a href="#cb563-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Si l&#39;on souhaite renommer les colonnes</span></span>
<span id="cb563-16"><a href="#cb563-16" aria-hidden="true" tabindex="-1"></a>moyennes <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb563-17"><a href="#cb563-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_at</span>(notes, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb563-18"><a href="#cb563-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">paste</span>(<span class="st">&quot;Moyenne&quot;</span>, ., <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-133-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-133-4-tab">
<div class="cell">
<div class="sourceCode" id="cb564"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb564-1"><a href="#cb564-1" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">c</span>(<span class="st">&quot;Note_Contenu&quot;</span>, <span class="st">&quot;Note_Formateur&quot;</span>, <span class="st">&quot;Note_Moyens&quot;</span>, <span class="st">&quot;Note_Accompagnement&quot;</span>, <span class="st">&quot;Note_Materiel&quot;</span>))</span>
<span id="cb564-2"><a href="#cb564-2" aria-hidden="true" tabindex="-1"></a>moyennes <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">lapply</span>(.SD, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .SDcols <span class="ot">=</span> notes]</span>
<span id="cb564-3"><a href="#cb564-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb564-4"><a href="#cb564-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Si l&#39;on souhaite renommer les colonnes</span></span>
<span id="cb564-5"><a href="#cb564-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(moyennes, notes, <span class="fu">paste</span>(<span class="st">&quot;Moyenne&quot;</span>, notes, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>))</span>
<span id="cb564-6"><a href="#cb564-6" aria-hidden="true" tabindex="-1"></a>moyennes</span></code></pre></div>
</div>
</div>
<div id="tabset-133-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-133-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="moyenne-pondérée-de-plusieurs-variables" class="level2" data-number="19.6">
<h2 data-number="19.6"><span class="header-section-number">19.6</span> Moyenne pondérée de plusieurs variables</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-134-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-134-1" role="tab" aria-controls="tabset-134-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-134-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-134-2" role="tab" aria-controls="tabset-134-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-134-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-134-3" role="tab" aria-controls="tabset-134-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-134-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-134-4" role="tab" aria-controls="tabset-134-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-134-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-134-5" role="tab" aria-controls="tabset-134-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-134-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-134-1-tab">
<div class="sourceCode" id="cb565"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb565-1"><a href="#cb565-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> notes = Note_Contenu Note_Formateur Note_Moyens Note_Accompagnement Note_Materiel;</span>
<span id="cb565-2"><a href="#cb565-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">mean</span>;</span>
<span id="cb565-3"><a href="#cb565-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> <span class="kw">&amp;notes.</span>;</span>
<span id="cb565-4"><a href="#cb565-4" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb565-5"><a href="#cb565-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-134-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-134-2-tab">
<div class="cell">
<div class="sourceCode" id="cb566"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb566-1"><a href="#cb566-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_rbase, <span class="fu">sapply</span>(donnees_rbase[, notes], <span class="cf">function</span>(x) <span class="fu">weighted.mean</span>(x, poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span></code></pre></div>
</div>
</div>
<div id="tabset-134-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-134-3-tab">
<div class="cell">
<div class="sourceCode" id="cb567"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb567-1"><a href="#cb567-1" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">c</span>(<span class="st">&quot;Note_Contenu&quot;</span>, <span class="st">&quot;Note_Formateur&quot;</span>, <span class="st">&quot;Note_Moyens&quot;</span>, <span class="st">&quot;Note_Accompagnement&quot;</span>, <span class="st">&quot;Note_Materiel&quot;</span>))</span>
<span id="cb567-2"><a href="#cb567-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb567-3"><a href="#cb567-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(notes, <span class="sc">~</span> <span class="fu">weighted.mean</span>(.x, poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb567-4"><a href="#cb567-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb567-5"><a href="#cb567-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb567-6"><a href="#cb567-6" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb567-7"><a href="#cb567-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_at</span>(notes, <span class="sc">~</span> <span class="fu">weighted.mean</span>(.x, poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-134-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-134-4-tab">
<div class="cell">
<div class="sourceCode" id="cb568"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb568-1"><a href="#cb568-1" aria-hidden="true" tabindex="-1"></a>moyennes <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">weighted.mean</span>(x, poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), .SDcols <span class="ot">=</span> notes]</span>
<span id="cb568-2"><a href="#cb568-2" aria-hidden="true" tabindex="-1"></a>moyennes</span></code></pre></div>
</div>
</div>
<div id="tabset-134-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-134-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="nombreuses-statistiques-somme-moyenne-médiane-mode-etc." class="level2" data-number="19.7">
<h2 data-number="19.7"><span class="header-section-number">19.7</span> Nombreuses statistiques (somme, moyenne, médiane, mode, etc.)</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-135-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-135-1" role="tab" aria-controls="tabset-135-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-135-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-135-2" role="tab" aria-controls="tabset-135-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-135-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-135-3" role="tab" aria-controls="tabset-135-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-135-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-135-4" role="tab" aria-controls="tabset-135-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-135-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-135-5" role="tab" aria-controls="tabset-135-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-135-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-135-1-tab">
<div class="sourceCode" id="cb569"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb569-1"><a href="#cb569-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Petite différence avec SAS sur le nombre de lignes du fait des valeurs manquantes */</span></span>
<span id="cb569-2"><a href="#cb569-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* Somme, moyenne, médiane, minimum, maximum, variance, écart-type, nombre de données non manquantes (n),</span></span>
<span id="cb569-3"><a href="#cb569-3" aria-hidden="true" tabindex="-1"></a><span class="co">   nombre de données manquantes (nmiss), intervalle, mode */</span></span>
<span id="cb569-4"><a href="#cb569-4" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> notes = Note_Contenu Note_Formateur Note_Moyens Note_Accompagnement Note_Materiel;</span>
<span id="cb569-5"><a href="#cb569-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb569-6"><a href="#cb569-6" aria-hidden="true" tabindex="-1"></a><span class="co">/* Par la proc means, en un seul tableau */</span></span>
<span id="cb569-7"><a href="#cb569-7" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">sum</span> <span class="fu">mean</span> median <span class="fu">min</span> <span class="fu">max</span> <span class="fu">var</span> <span class="fu">std</span> <span class="fu">n</span> <span class="fu">nmiss</span> <span class="fu">range</span> mode;</span>
<span id="cb569-8"><a href="#cb569-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> <span class="kw">&amp;notes.</span>;</span>
<span id="cb569-9"><a href="#cb569-9" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb569-10"><a href="#cb569-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb569-11"><a href="#cb569-11" aria-hidden="true" tabindex="-1"></a><span class="co">/* Par la proc univariate, variable par variable */</span></span>
<span id="cb569-12"><a href="#cb569-12" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> univariate<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb569-13"><a href="#cb569-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> <span class="kw">&amp;notes.</span>;</span>
<span id="cb569-14"><a href="#cb569-14" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-135-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-135-2-tab">
<div class="cell">
<div class="sourceCode" id="cb570"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb570-1"><a href="#cb570-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Somme, moyenne, médiane, minimum, maximum, variance, écart-type, nombre de données (manquantes et non manquantes),</span></span>
<span id="cb570-2"><a href="#cb570-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Nombre de valeurs manquantes, Intervalle</span></span>
<span id="cb570-3"><a href="#cb570-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Petite différence avec SAS sur le nombre de lignes du fait des valeurs manquantes</span></span>
<span id="cb570-4"><a href="#cb570-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Une solution pour obtenir le mode en R est d&#39;utiliser fmode du package collapse</span></span>
<span id="cb570-5"><a href="#cb570-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(collapse)</span>
<span id="cb570-6"><a href="#cb570-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(donnees_rbase[, notes], <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="st">&quot;Somme&quot;</span>      <span class="ot">=</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb570-7"><a href="#cb570-7" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Moyenne&quot;</span>    <span class="ot">=</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb570-8"><a href="#cb570-8" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Médiane&quot;</span>    <span class="ot">=</span> <span class="fu">median</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb570-9"><a href="#cb570-9" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Min&quot;</span>        <span class="ot">=</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb570-10"><a href="#cb570-10" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Max&quot;</span>        <span class="ot">=</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb570-11"><a href="#cb570-11" aria-hidden="true" tabindex="-1"></a>                                             <span class="co"># Pour la variance, la somme des carrés est divisée par n - 1, où n est le nombre de données</span></span>
<span id="cb570-12"><a href="#cb570-12" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Variance&quot;</span>   <span class="ot">=</span> <span class="fu">var</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb570-13"><a href="#cb570-13" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Ecart-type&quot;</span> <span class="ot">=</span> <span class="fu">sd</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb570-14"><a href="#cb570-14" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;N&quot;</span>          <span class="ot">=</span> <span class="fu">length</span>(x),</span>
<span id="cb570-15"><a href="#cb570-15" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;NMiss&quot;</span>      <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(x)),</span>
<span id="cb570-16"><a href="#cb570-16" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Intervalle&quot;</span> <span class="ot">=</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb570-17"><a href="#cb570-17" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Mode&quot;</span>       <span class="ot">=</span> collapse<span class="sc">::</span><span class="fu">fmode</span>(x)</span>
<span id="cb570-18"><a href="#cb570-18" aria-hidden="true" tabindex="-1"></a>))</span></code></pre></div>
</div>
</div>
<div id="tabset-135-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-135-3-tab">
<div class="cell">
<div class="sourceCode" id="cb571"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb571-1"><a href="#cb571-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Petite différence avec SAS sur le nombre de lignes du fait des valeurs manquantes</span></span>
<span id="cb571-2"><a href="#cb571-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Une solution pour obtenir le mode en R est d&#39;utiliser fmode du package collapse</span></span>
<span id="cb571-3"><a href="#cb571-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(collapse)</span>
<span id="cb571-4"><a href="#cb571-4" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">c</span>(<span class="st">&quot;Note_Contenu&quot;</span>, <span class="st">&quot;Note_Formateur&quot;</span>, <span class="st">&quot;Note_Moyens&quot;</span>, <span class="st">&quot;Note_Accompagnement&quot;</span>, <span class="st">&quot;Note_Materiel&quot;</span>))</span>
<span id="cb571-5"><a href="#cb571-5" aria-hidden="true" tabindex="-1"></a>StatsDesc_tidyverse <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb571-6"><a href="#cb571-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb571-7"><a href="#cb571-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Somme      =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb571-8"><a href="#cb571-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Moyenne    =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb571-9"><a href="#cb571-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mediane    =</span> <span class="fu">median</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb571-10"><a href="#cb571-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Min        =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb571-11"><a href="#cb571-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Max        =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb571-12"><a href="#cb571-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variance   =</span> <span class="fu">var</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb571-13"><a href="#cb571-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Ecart_type =</span> <span class="fu">sd</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb571-14"><a href="#cb571-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">N          =</span> <span class="fu">length</span>(x),</span>
<span id="cb571-15"><a href="#cb571-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">NMiss      =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(x)),</span>
<span id="cb571-16"><a href="#cb571-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Intervalle =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb571-17"><a href="#cb571-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mode       =</span> collapse<span class="sc">::</span><span class="fu">fmode</span>(x)</span>
<span id="cb571-18"><a href="#cb571-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb571-19"><a href="#cb571-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb571-20"><a href="#cb571-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb571-21"><a href="#cb571-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 1ère solution avec les notes en ligne et les statistiques en colonnes</span></span>
<span id="cb571-22"><a href="#cb571-22" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb571-23"><a href="#cb571-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(notes)) <span class="sc">%&gt;%</span> </span>
<span id="cb571-24"><a href="#cb571-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> <span class="fu">StatsDesc_tidyverse</span>(.x)) <span class="sc">%&gt;%</span> </span>
<span id="cb571-25"><a href="#cb571-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb571-26"><a href="#cb571-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">Note =</span> <span class="fu">c</span>(notes))) <span class="sc">%&gt;%</span> </span>
<span id="cb571-27"><a href="#cb571-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(Note)</span>
<span id="cb571-28"><a href="#cb571-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb571-29"><a href="#cb571-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 2e solution avec les notes en colonne</span></span>
<span id="cb571-30"><a href="#cb571-30" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb571-31"><a href="#cb571-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="fu">across</span>(notes, <span class="sc">~</span> <span class="fu">StatsDesc_tidyverse</span>(.x))) <span class="sc">%&gt;%</span> </span>
<span id="cb571-32"><a href="#cb571-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">Indicateur =</span> <span class="fu">c</span>(<span class="st">&quot;Somme&quot;</span>, <span class="st">&quot;Moyenne&quot;</span>, <span class="st">&quot;Mediane&quot;</span>, <span class="st">&quot;Min&quot;</span>, <span class="st">&quot;Max&quot;</span>, <span class="st">&quot;Variance&quot;</span>,</span>
<span id="cb571-33"><a href="#cb571-33" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;Ecart_type&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;NMiss&quot;</span>, <span class="st">&quot;Intervalle&quot;</span>, <span class="st">&quot;Mode&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb571-34"><a href="#cb571-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(Indicateur)</span></code></pre></div>
</div>
</div>
<div id="tabset-135-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-135-4-tab">
<div class="cell">
<div class="sourceCode" id="cb572"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb572-1"><a href="#cb572-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Petite différence avec SAS sur le nombre de lignes du fait des valeurs manquantes</span></span>
<span id="cb572-2"><a href="#cb572-2" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">c</span>(<span class="st">&quot;Note_Contenu&quot;</span>, <span class="st">&quot;Note_Formateur&quot;</span>, <span class="st">&quot;Note_Moyens&quot;</span>, <span class="st">&quot;Note_Accompagnement&quot;</span>, <span class="st">&quot;Note_Materiel&quot;</span>))</span>
<span id="cb572-3"><a href="#cb572-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Une solution pour obtenir le mode en R est d&#39;utiliser fmode du package collapse</span></span>
<span id="cb572-4"><a href="#cb572-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(collapse)</span>
<span id="cb572-5"><a href="#cb572-5" aria-hidden="true" tabindex="-1"></a>moyennes <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="fu">sum</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb572-6"><a href="#cb572-6" aria-hidden="true" tabindex="-1"></a>                                                          <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb572-7"><a href="#cb572-7" aria-hidden="true" tabindex="-1"></a>                                                          <span class="fu">median</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb572-8"><a href="#cb572-8" aria-hidden="true" tabindex="-1"></a>                                                          <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb572-9"><a href="#cb572-9" aria-hidden="true" tabindex="-1"></a>                                                          <span class="fu">max</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb572-10"><a href="#cb572-10" aria-hidden="true" tabindex="-1"></a>                                                          <span class="fu">var</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb572-11"><a href="#cb572-11" aria-hidden="true" tabindex="-1"></a>                                                          <span class="fu">sd</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb572-12"><a href="#cb572-12" aria-hidden="true" tabindex="-1"></a>                                                          .N,</span>
<span id="cb572-13"><a href="#cb572-13" aria-hidden="true" tabindex="-1"></a>                                                          <span class="fu">sum</span>(<span class="fu">is.na</span>(x)),</span>
<span id="cb572-14"><a href="#cb572-14" aria-hidden="true" tabindex="-1"></a>                                                          <span class="fu">max</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb572-15"><a href="#cb572-15" aria-hidden="true" tabindex="-1"></a>                                                          collapse<span class="sc">::</span><span class="fu">fmode</span>(x)</span>
<span id="cb572-16"><a href="#cb572-16" aria-hidden="true" tabindex="-1"></a>                                                          )),</span>
<span id="cb572-17"><a href="#cb572-17" aria-hidden="true" tabindex="-1"></a>                              .SDcols <span class="ot">=</span> notes]</span>
<span id="cb572-18"><a href="#cb572-18" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">data.table</span>(<span class="at">Nom =</span> <span class="fu">c</span>(<span class="st">&quot;Somme&quot;</span>, <span class="st">&quot;Moyenne&quot;</span>, <span class="st">&quot;Médiane&quot;</span>, <span class="st">&quot;Min&quot;</span>, <span class="st">&quot;Max&quot;</span>, <span class="st">&quot;Variance&quot;</span>, <span class="st">&quot;Ecart_type&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;NMiss&quot;</span>, <span class="st">&quot;Intervalle&quot;</span>, <span class="st">&quot;Mode&quot;</span>)), moyennes)</span>
<span id="cb572-19"><a href="#cb572-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb572-20"><a href="#cb572-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb572-21"><a href="#cb572-21" aria-hidden="true" tabindex="-1"></a>StatsDesc <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb572-22"><a href="#cb572-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb572-23"><a href="#cb572-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variable   =</span> <span class="fu">names</span>(x),</span>
<span id="cb572-24"><a href="#cb572-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">Somme      =</span> <span class="fu">lapply</span>(x, sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb572-25"><a href="#cb572-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">Moyenne    =</span> <span class="fu">lapply</span>(x, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb572-26"><a href="#cb572-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mediane    =</span> <span class="fu">lapply</span>(x, median, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb572-27"><a href="#cb572-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">Min        =</span> <span class="fu">lapply</span>(x, min, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb572-28"><a href="#cb572-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">Max        =</span> <span class="fu">lapply</span>(x, max, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb572-29"><a href="#cb572-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variance   =</span> <span class="fu">lapply</span>(x, var, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb572-30"><a href="#cb572-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">Ecart_type =</span> <span class="fu">lapply</span>(x, sd, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb572-31"><a href="#cb572-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">N          =</span> <span class="fu">lapply</span>(x, <span class="cf">function</span>(x) <span class="fu">length</span>(x)),</span>
<span id="cb572-32"><a href="#cb572-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">NMiss      =</span> <span class="fu">lapply</span>(x, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x))),</span>
<span id="cb572-33"><a href="#cb572-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">Intervalle =</span> <span class="fu">lapply</span>(x, <span class="cf">function</span>(x) <span class="fu">max</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb572-34"><a href="#cb572-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mode       =</span> <span class="fu">lapply</span>(x, collapse<span class="sc">::</span>fmode)</span>
<span id="cb572-35"><a href="#cb572-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb572-36"><a href="#cb572-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb572-37"><a href="#cb572-37" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">StatsDesc</span>(.SD), .SDcols <span class="ot">=</span> notes]</span></code></pre></div>
</div>
</div>
<div id="tabset-135-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-135-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="nombreuses-statistiques-pondérées-somme-moyenne-médiane-mode-etc." class="level2" data-number="19.8">
<h2 data-number="19.8"><span class="header-section-number">19.8</span> Nombreuses statistiques pondérées (somme, moyenne, médiane, mode, etc.)</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-136-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-136-1" role="tab" aria-controls="tabset-136-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-136-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-136-2" role="tab" aria-controls="tabset-136-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-136-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-136-3" role="tab" aria-controls="tabset-136-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-136-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-136-4" role="tab" aria-controls="tabset-136-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-136-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-136-5" role="tab" aria-controls="tabset-136-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-136-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-136-1-tab">
<div class="sourceCode" id="cb573"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb573-1"><a href="#cb573-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Somme, moyenne, médiane, minimum, maximum, variance, écart-type, nombre de données non manquantes (n),</span></span>
<span id="cb573-2"><a href="#cb573-2" aria-hidden="true" tabindex="-1"></a><span class="co">   nombre de données manquantes (nmiss), intervalle, mode */</span></span>
<span id="cb573-3"><a href="#cb573-3" aria-hidden="true" tabindex="-1"></a><span class="co">/* Par la proc means, en un seul tableau */</span></span>
<span id="cb573-4"><a href="#cb573-4" aria-hidden="true" tabindex="-1"></a><span class="co">/* L&#39;option vardef = wgt permet de diviser la variable par la somme des poids et non le nombre de données, pour être cohérent</span></span>
<span id="cb573-5"><a href="#cb573-5" aria-hidden="true" tabindex="-1"></a><span class="co">   avec R */</span></span>
<span id="cb573-6"><a href="#cb573-6" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> notes = Note_Contenu Note_Formateur Note_Moyens Note_Accompagnement Note_Materiel;</span>
<span id="cb573-7"><a href="#cb573-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb573-8"><a href="#cb573-8" aria-hidden="true" tabindex="-1"></a><span class="co">/* Par la proc means, en un seul tableau */</span></span>
<span id="cb573-9"><a href="#cb573-9" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">sum</span> <span class="fu">mean</span> median <span class="fu">min</span> <span class="fu">max</span> <span class="fu">var</span> <span class="fu">std</span> <span class="fu">n</span> <span class="fu">nmiss</span> <span class="fu">range</span> mode vardef = wgt;</span>
<span id="cb573-10"><a href="#cb573-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> <span class="kw">&amp;notes.</span>;</span>
<span id="cb573-11"><a href="#cb573-11" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb573-12"><a href="#cb573-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb573-13"><a href="#cb573-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb573-14"><a href="#cb573-14" aria-hidden="true" tabindex="-1"></a><span class="co">/* Par la proc univariate, variable par variable */</span></span>
<span id="cb573-15"><a href="#cb573-15" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> univariate<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb573-16"><a href="#cb573-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> <span class="kw">&amp;notes.</span>;</span>
<span id="cb573-17"><a href="#cb573-17" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb573-18"><a href="#cb573-18" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-136-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-136-2-tab">
<div class="cell">
<div class="sourceCode" id="cb574"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb574-1"><a href="#cb574-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Une solution pour obtenir les résultats pondérés est d&#39;utiliser les fonctions du package collapse</span></span>
<span id="cb574-2"><a href="#cb574-2" aria-hidden="true" tabindex="-1"></a><span class="co"># L&#39;option na.rm est par défaut à TRUE dans le package</span></span>
<span id="cb574-3"><a href="#cb574-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Attention, dans le package, le poids s&#39;indique par la variable w = </span></span>
<span id="cb574-4"><a href="#cb574-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(collapse)</span>
<span id="cb574-5"><a href="#cb574-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(donnees_rbase[, notes], <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="st">&quot;Somme&quot;</span>      <span class="ot">=</span> collapse<span class="sc">::</span><span class="fu">fsum</span>(x, <span class="at">w =</span> donnees_rbase<span class="sc">$</span>poids_sondage),</span>
<span id="cb574-6"><a href="#cb574-6" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Moyenne&quot;</span>    <span class="ot">=</span> collapse<span class="sc">::</span><span class="fu">fmean</span>(x, <span class="at">w =</span> donnees_rbase<span class="sc">$</span>poids_sondage),</span>
<span id="cb574-7"><a href="#cb574-7" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Médiane&quot;</span>    <span class="ot">=</span> collapse<span class="sc">::</span><span class="fu">fmedian</span>(x, <span class="at">w =</span> donnees_rbase<span class="sc">$</span>poids_sondage),</span>
<span id="cb574-8"><a href="#cb574-8" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Min&quot;</span>        <span class="ot">=</span> collapse<span class="sc">::</span><span class="fu">fmin</span>(x),</span>
<span id="cb574-9"><a href="#cb574-9" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Max&quot;</span>        <span class="ot">=</span> collapse<span class="sc">::</span><span class="fu">fmax</span>(x),</span>
<span id="cb574-10"><a href="#cb574-10" aria-hidden="true" tabindex="-1"></a>                                             <span class="co"># Pour la variance, la somme des carrés est divisée par n - 1, où n est le nombre de données</span></span>
<span id="cb574-11"><a href="#cb574-11" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Variance&quot;</span>   <span class="ot">=</span> collapse<span class="sc">::</span><span class="fu">fvar</span>(x, <span class="at">w =</span> donnees_rbase<span class="sc">$</span>poids_sondage),</span>
<span id="cb574-12"><a href="#cb574-12" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Ecart-type&quot;</span> <span class="ot">=</span> collapse<span class="sc">::</span><span class="fu">fsd</span>(x, <span class="at">w =</span> donnees_rbase<span class="sc">$</span>poids_sondage),</span>
<span id="cb574-13"><a href="#cb574-13" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;N&quot;</span>          <span class="ot">=</span> collapse<span class="sc">::</span><span class="fu">fnobs</span>(x),</span>
<span id="cb574-14"><a href="#cb574-14" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;NMiss&quot;</span>      <span class="ot">=</span> collapse<span class="sc">::</span><span class="fu">fnobs</span>(<span class="fu">is.na</span>(x)),</span>
<span id="cb574-15"><a href="#cb574-15" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Intervalle&quot;</span> <span class="ot">=</span> collapse<span class="sc">::</span><span class="fu">fmax</span>(x) <span class="sc">-</span> collapse<span class="sc">::</span><span class="fu">fmin</span>(x),</span>
<span id="cb574-16"><a href="#cb574-16" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Mode&quot;</span>       <span class="ot">=</span> collapse<span class="sc">::</span><span class="fu">fmode</span>(x, <span class="at">w =</span> donnees_rbase<span class="sc">$</span>poids_sondage)</span>
<span id="cb574-17"><a href="#cb574-17" aria-hidden="true" tabindex="-1"></a>))</span></code></pre></div>
</div>
</div>
<div id="tabset-136-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-136-3-tab">
<div class="cell">
<div class="sourceCode" id="cb575"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb575-1"><a href="#cb575-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Une solution pour obtenir les résultats pondérés est d&#39;utiliser les fonctions du package collapse</span></span>
<span id="cb575-2"><a href="#cb575-2" aria-hidden="true" tabindex="-1"></a><span class="co"># L&#39;option na.rm est par défaut à TRUE dans le package</span></span>
<span id="cb575-3"><a href="#cb575-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Attention, dans le package, le poids s&#39;indique par la variable w = </span></span>
<span id="cb575-4"><a href="#cb575-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(collapse)</span>
<span id="cb575-5"><a href="#cb575-5" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">c</span>(<span class="st">&quot;Note_Contenu&quot;</span>, <span class="st">&quot;Note_Formateur&quot;</span>, <span class="st">&quot;Note_Moyens&quot;</span>, <span class="st">&quot;Note_Accompagnement&quot;</span>, <span class="st">&quot;Note_Materiel&quot;</span>))</span>
<span id="cb575-6"><a href="#cb575-6" aria-hidden="true" tabindex="-1"></a>StatsDescPond_tidyverse <span class="ot">&lt;-</span> <span class="cf">function</span>(x, w) {</span>
<span id="cb575-7"><a href="#cb575-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb575-8"><a href="#cb575-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Somme      =</span> collapse<span class="sc">::</span><span class="fu">fsum</span>(x, <span class="at">w =</span> w),</span>
<span id="cb575-9"><a href="#cb575-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Moyenne    =</span> collapse<span class="sc">::</span><span class="fu">fmean</span>(x, <span class="at">w =</span> w),</span>
<span id="cb575-10"><a href="#cb575-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mediane    =</span> collapse<span class="sc">::</span><span class="fu">fmedian</span>(x, <span class="at">w =</span> w),</span>
<span id="cb575-11"><a href="#cb575-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Min        =</span> collapse<span class="sc">::</span><span class="fu">fmin</span>(x),</span>
<span id="cb575-12"><a href="#cb575-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Max        =</span> collapse<span class="sc">::</span><span class="fu">fmax</span>(x),</span>
<span id="cb575-13"><a href="#cb575-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variance   =</span> collapse<span class="sc">::</span><span class="fu">fvar</span>(x, <span class="at">w =</span> w),</span>
<span id="cb575-14"><a href="#cb575-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Ecart_type =</span> collapse<span class="sc">::</span><span class="fu">fsd</span>(x, <span class="at">w =</span> w),</span>
<span id="cb575-15"><a href="#cb575-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">N          =</span> collapse<span class="sc">::</span><span class="fu">fnobs</span>(x),</span>
<span id="cb575-16"><a href="#cb575-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">NMiss      =</span> collapse<span class="sc">::</span><span class="fu">fnobs</span>(<span class="fu">is.na</span>(x)),</span>
<span id="cb575-17"><a href="#cb575-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Intervalle =</span> collapse<span class="sc">::</span><span class="fu">fmax</span>(x) <span class="sc">-</span> collapse<span class="sc">::</span><span class="fu">fmin</span>(x),</span>
<span id="cb575-18"><a href="#cb575-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mode       =</span> collapse<span class="sc">::</span><span class="fu">fmode</span>(x, <span class="at">w =</span> w)</span>
<span id="cb575-19"><a href="#cb575-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb575-20"><a href="#cb575-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb575-21"><a href="#cb575-21" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb575-22"><a href="#cb575-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="fu">across</span>(notes, <span class="sc">~</span> <span class="fu">StatsDescPond_tidyverse</span>(.x, poids_sondage))) <span class="sc">%&gt;%</span> </span>
<span id="cb575-23"><a href="#cb575-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">Indicateur =</span> <span class="fu">c</span>(<span class="st">&quot;Somme&quot;</span>, <span class="st">&quot;Moyenne&quot;</span>, <span class="st">&quot;Mediane&quot;</span>, <span class="st">&quot;Min&quot;</span>, <span class="st">&quot;Max&quot;</span>, <span class="st">&quot;Variance&quot;</span>,</span>
<span id="cb575-24"><a href="#cb575-24" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;Ecart_type&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;NMiss&quot;</span>, <span class="st">&quot;Intervalle&quot;</span>, <span class="st">&quot;Mode&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb575-25"><a href="#cb575-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(Indicateur)</span>
<span id="cb575-26"><a href="#cb575-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb575-27"><a href="#cb575-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb575-28"><a href="#cb575-28" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb575-29"><a href="#cb575-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(notes)) <span class="sc">%&gt;%</span> </span>
<span id="cb575-30"><a href="#cb575-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span><span class="fu">StatsDescPond_tidyverse</span>(.x, donnees_tidyverse<span class="sc">$</span>poids_sondage)) <span class="sc">%&gt;%</span> </span>
<span id="cb575-31"><a href="#cb575-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>()<span class="sc">%&gt;%</span> </span>
<span id="cb575-32"><a href="#cb575-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">Indicateur =</span> <span class="fu">c</span>(<span class="st">&quot;Somme&quot;</span>, <span class="st">&quot;Moyenne&quot;</span>, <span class="st">&quot;Mediane&quot;</span>, <span class="st">&quot;Min&quot;</span>, <span class="st">&quot;Max&quot;</span>, <span class="st">&quot;Variance&quot;</span>,</span>
<span id="cb575-33"><a href="#cb575-33" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;Ecart_type&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;NMiss&quot;</span>, <span class="st">&quot;Intervalle&quot;</span>, <span class="st">&quot;Mode&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb575-34"><a href="#cb575-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(Indicateur)</span></code></pre></div>
</div>
</div>
<div id="tabset-136-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-136-4-tab">
<div class="cell">
<div class="sourceCode" id="cb576"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb576-1"><a href="#cb576-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Une solution pour obtenir les résultats pondérés est d&#39;utiliser les fonctions du package collapse</span></span>
<span id="cb576-2"><a href="#cb576-2" aria-hidden="true" tabindex="-1"></a><span class="co"># L&#39;option na.rm est par défaut à TRUE dans le package</span></span>
<span id="cb576-3"><a href="#cb576-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Attention, dans le package, le poids s&#39;indique par la variable w = </span></span>
<span id="cb576-4"><a href="#cb576-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(collapse)</span>
<span id="cb576-5"><a href="#cb576-5" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : y-a-t-il plus simple ???</span></span>
<span id="cb576-6"><a href="#cb576-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Est-on obligés d&#39;utiliser systématiquement donnees_datatable$poids_sondage ?</span></span>
<span id="cb576-7"><a href="#cb576-7" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">c</span>(<span class="st">&quot;Note_Contenu&quot;</span>, <span class="st">&quot;Note_Formateur&quot;</span>, <span class="st">&quot;Note_Moyens&quot;</span>, <span class="st">&quot;Note_Accompagnement&quot;</span>, <span class="st">&quot;Note_Materiel&quot;</span>))</span>
<span id="cb576-8"><a href="#cb576-8" aria-hidden="true" tabindex="-1"></a>StatsDescPond <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb576-9"><a href="#cb576-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb576-10"><a href="#cb576-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variables  =</span> <span class="fu">names</span>(x),</span>
<span id="cb576-11"><a href="#cb576-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Somme      =</span> <span class="fu">lapply</span>(x, collapse<span class="sc">::</span>fsum, <span class="at">w =</span> donnees_datatable<span class="sc">$</span>poids_sondage),</span>
<span id="cb576-12"><a href="#cb576-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Moyenne    =</span> <span class="fu">lapply</span>(x, collapse<span class="sc">::</span>fmean, <span class="at">w =</span> donnees_datatable<span class="sc">$</span>poids_sondage),</span>
<span id="cb576-13"><a href="#cb576-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mediane    =</span> <span class="fu">lapply</span>(x, collapse<span class="sc">::</span>fmedian, <span class="at">w =</span> donnees_datatable<span class="sc">$</span>poids_sondage),</span>
<span id="cb576-14"><a href="#cb576-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Min        =</span> <span class="fu">lapply</span>(x, collapse<span class="sc">::</span>fmin),</span>
<span id="cb576-15"><a href="#cb576-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Max        =</span> <span class="fu">lapply</span>(x, collapse<span class="sc">::</span>fmax),</span>
<span id="cb576-16"><a href="#cb576-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variance   =</span> <span class="fu">lapply</span>(x, collapse<span class="sc">::</span>fvar, <span class="at">w =</span> donnees_datatable<span class="sc">$</span>poids_sondage),</span>
<span id="cb576-17"><a href="#cb576-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Ecart_type =</span> <span class="fu">lapply</span>(x, collapse<span class="sc">::</span>fsd, <span class="at">w =</span> donnees_datatable<span class="sc">$</span>poids_sondage),</span>
<span id="cb576-18"><a href="#cb576-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">N          =</span> <span class="fu">lapply</span>(x, collapse<span class="sc">::</span>fnobs),</span>
<span id="cb576-19"><a href="#cb576-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">NMiss      =</span> <span class="fu">lapply</span>(x, <span class="cf">function</span>(x) collapse<span class="sc">::</span><span class="fu">fnobs</span>(<span class="fu">is.na</span>(x))),</span>
<span id="cb576-20"><a href="#cb576-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Intervalle =</span> <span class="fu">lapply</span>(x, <span class="cf">function</span>(x) collapse<span class="sc">::</span><span class="fu">fmax</span>(x) <span class="sc">-</span> collapse<span class="sc">::</span><span class="fu">fmin</span>(x)),</span>
<span id="cb576-21"><a href="#cb576-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mode       =</span> <span class="fu">lapply</span>(x, collapse<span class="sc">::</span>fmode, <span class="at">w =</span> donnees_datatable<span class="sc">$</span>poids_sondage)</span>
<span id="cb576-22"><a href="#cb576-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb576-23"><a href="#cb576-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb576-24"><a href="#cb576-24" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">StatsDescPond</span>(.SD), .SDcols <span class="ot">=</span> notes]</span></code></pre></div>
</div>
</div>
<div id="tabset-136-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-136-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="variance-et-variance-pondérée" class="level2" data-number="19.9">
<h2 data-number="19.9"><span class="header-section-number">19.9</span> Variance et variance pondérée</h2>
<section id="variance" class="level3" data-number="19.9.1">
<h3 data-number="19.9.1"><span class="header-section-number">19.9.1</span> Variance</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-137-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-137-1" role="tab" aria-controls="tabset-137-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-137-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-137-2" role="tab" aria-controls="tabset-137-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-137-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-137-3" role="tab" aria-controls="tabset-137-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-137-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-137-4" role="tab" aria-controls="tabset-137-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-137-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-137-5" role="tab" aria-controls="tabset-137-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-137-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-137-1-tab">
<div class="sourceCode" id="cb577"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb577-1"><a href="#cb577-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">var</span>;</span>
<span id="cb577-2"><a href="#cb577-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> note_contenu;</span>
<span id="cb577-3"><a href="#cb577-3" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-137-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-137-2-tab">
<div class="cell">
<div class="sourceCode" id="cb578"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb578-1"><a href="#cb578-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(collapse)</span>
<span id="cb578-2"><a href="#cb578-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_rbase, <span class="fu">var</span>(note_contenu))</span></code></pre></div>
</div>
</div>
<div id="tabset-137-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-137-3-tab">
<div class="cell">
<div class="sourceCode" id="cb579"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb579-1"><a href="#cb579-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb579-2"><a href="#cb579-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">var =</span> <span class="fu">var</span>(note_contenu))</span></code></pre></div>
</div>
</div>
<div id="tabset-137-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-137-4-tab">
<div class="cell">
<div class="sourceCode" id="cb580"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb580-1"><a href="#cb580-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">var</span>(note_contenu)]</span></code></pre></div>
</div>
</div>
<div id="tabset-137-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-137-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="variance-pondérée" class="level3" data-number="19.9.2">
<h3 data-number="19.9.2"><span class="header-section-number">19.9.2</span> Variance pondérée</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-138-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-138-1" role="tab" aria-controls="tabset-138-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-138-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-138-2" role="tab" aria-controls="tabset-138-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-138-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-138-3" role="tab" aria-controls="tabset-138-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-138-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-138-4" role="tab" aria-controls="tabset-138-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-138-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-138-5" role="tab" aria-controls="tabset-138-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-138-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-138-1-tab">
<div class="sourceCode" id="cb581"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb581-1"><a href="#cb581-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">var</span> vardef = wgt;</span>
<span id="cb581-2"><a href="#cb581-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> note_contenu;</span>
<span id="cb581-3"><a href="#cb581-3" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb581-4"><a href="#cb581-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-138-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-138-2-tab">
<div class="cell">
<div class="sourceCode" id="cb582"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb582-1"><a href="#cb582-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(collapse)</span>
<span id="cb582-2"><a href="#cb582-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_rbase, collapse<span class="sc">::</span><span class="fu">fvar</span>(note_contenu, <span class="at">w =</span> poids_sondage))</span></code></pre></div>
</div>
</div>
<div id="tabset-138-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-138-3-tab">
<div class="cell">
<div class="sourceCode" id="cb583"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb583-1"><a href="#cb583-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(collapse)</span>
<span id="cb583-2"><a href="#cb583-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb583-3"><a href="#cb583-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">var =</span> collapse<span class="sc">::</span><span class="fu">fvar</span>(note_contenu, <span class="at">w =</span> poids_sondage))</span></code></pre></div>
</div>
</div>
<div id="tabset-138-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-138-4-tab">
<div class="cell">
<div class="sourceCode" id="cb584"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb584-1"><a href="#cb584-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(collapse)</span>
<span id="cb584-2"><a href="#cb584-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, collapse<span class="sc">::</span><span class="fu">fvar</span>(note_contenu, <span class="at">w =</span> poids_sondage)]</span></code></pre></div>
</div>
</div>
<div id="tabset-138-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-138-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="calcul-manuel-de-la-variance-pondérée" class="level3" data-number="19.9.3">
<h3 data-number="19.9.3"><span class="header-section-number">19.9.3</span> Calcul “manuel” de la variance pondérée</h3>
<p>La variance pondérée se calcul par la formule : <span class="math display">\[
\frac{\sum_i{w_i \times (x_i - \bar{x}) ^2}}{\sum_i{w_i}} = \frac{\sum_i{w_ix_i^2}} {\sum_i{w_i}} - \bar{x}^2
\]</span></p>
<p>On la calcule “manuellement” pour confirmer le résultat.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-139-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-139-1" role="tab" aria-controls="tabset-139-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-139-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-139-2" role="tab" aria-controls="tabset-139-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-139-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-139-3" role="tab" aria-controls="tabset-139-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-139-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-139-4" role="tab" aria-controls="tabset-139-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-139-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-139-5" role="tab" aria-controls="tabset-139-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-139-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-139-1-tab">
<div class="sourceCode" id="cb585"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb585-1"><a href="#cb585-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">var</span> vardef = wgt;</span>
<span id="cb585-2"><a href="#cb585-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> note_contenu;</span>
<span id="cb585-3"><a href="#cb585-3" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb585-4"><a href="#cb585-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-139-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-139-2-tab">
<div class="cell">
<div class="sourceCode" id="cb586"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb586-1"><a href="#cb586-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(collapse)</span>
<span id="cb586-2"><a href="#cb586-2" aria-hidden="true" tabindex="-1"></a>x_2 <span class="ot">&lt;-</span> <span class="fu">with</span>(donnees_rbase,</span>
<span id="cb586-3"><a href="#cb586-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum</span>(poids_sondage <span class="sc">*</span> note_contenu<span class="sc">**</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">complete.cases</span>(note_contenu, poids_sondage), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb586-4"><a href="#cb586-4" aria-hidden="true" tabindex="-1"></a>x_m <span class="ot">&lt;-</span> <span class="fu">with</span>(donnees_rbase,</span>
<span id="cb586-5"><a href="#cb586-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum</span>(poids_sondage <span class="sc">*</span> note_contenu <span class="sc">*</span> <span class="fu">complete.cases</span>(note_contenu, poids_sondage), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb586-6"><a href="#cb586-6" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">with</span>(donnees_rbase,</span>
<span id="cb586-7"><a href="#cb586-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sum</span>(poids_sondage <span class="sc">*</span> <span class="fu">complete.cases</span>(note_contenu, poids_sondage), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb586-8"><a href="#cb586-8" aria-hidden="true" tabindex="-1"></a>x_2 <span class="sc">/</span> p <span class="sc">-</span> (x_m <span class="sc">/</span> p) <span class="sc">**</span> <span class="dv">2</span></span></code></pre></div>
</div>
</div>
<div id="tabset-139-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-139-3-tab">
<div class="cell">
<div class="sourceCode" id="cb587"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb587-1"><a href="#cb587-1" aria-hidden="true" tabindex="-1"></a>x_2 <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span>  </span>
<span id="cb587-2"><a href="#cb587-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">sum</span>(poids_sondage <span class="sc">*</span> note_contenu<span class="sc">**</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">complete.cases</span>(note_contenu, poids_sondage), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb587-3"><a href="#cb587-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb587-4"><a href="#cb587-4" aria-hidden="true" tabindex="-1"></a>x_m <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span>  </span>
<span id="cb587-5"><a href="#cb587-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">sum</span>(poids_sondage <span class="sc">*</span> note_contenu <span class="sc">*</span> <span class="fu">complete.cases</span>(note_contenu, poids_sondage), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb587-6"><a href="#cb587-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()          </span>
<span id="cb587-7"><a href="#cb587-7" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb587-8"><a href="#cb587-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">sum</span>(poids_sondage <span class="sc">*</span> <span class="fu">complete.cases</span>(note_contenu, poids_sondage), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb587-9"><a href="#cb587-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb587-10"><a href="#cb587-10" aria-hidden="true" tabindex="-1"></a>x_2 <span class="sc">/</span> p <span class="sc">-</span> (x_m <span class="sc">/</span> p) <span class="sc">**</span> <span class="dv">2</span></span></code></pre></div>
</div>
</div>
<div id="tabset-139-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-139-4-tab">
<div class="cell">
<div class="sourceCode" id="cb588"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb588-1"><a href="#cb588-1" aria-hidden="true" tabindex="-1"></a>x_2 <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">sum</span>(poids_sondage <span class="sc">*</span> note_contenu<span class="sc">**</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">complete.cases</span>(note_contenu, poids_sondage),</span>
<span id="cb588-2"><a href="#cb588-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">na.rm =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb588-3"><a href="#cb588-3" aria-hidden="true" tabindex="-1"></a>x_m <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">sum</span>(poids_sondage <span class="sc">*</span> note_contenu <span class="sc">*</span> <span class="fu">complete.cases</span>(note_contenu, poids_sondage),</span>
<span id="cb588-4"><a href="#cb588-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">na.rm =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb588-5"><a href="#cb588-5" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">sum</span>(poids_sondage <span class="sc">*</span> <span class="fu">complete.cases</span>(note_contenu, poids_sondage), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb588-6"><a href="#cb588-6" aria-hidden="true" tabindex="-1"></a>x_2 <span class="sc">/</span> p <span class="sc">-</span> (x_m <span class="sc">/</span> p) <span class="sc">**</span> <span class="dv">2</span></span></code></pre></div>
</div>
</div>
<div id="tabset-139-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-139-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="déciles-et-quantiles" class="level2" data-number="19.10">
<h2 data-number="19.10"><span class="header-section-number">19.10</span> Déciles et quantiles</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-140-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-140-1" role="tab" aria-controls="tabset-140-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-140-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-140-2" role="tab" aria-controls="tabset-140-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-140-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-140-3" role="tab" aria-controls="tabset-140-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-140-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-140-4" role="tab" aria-controls="tabset-140-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-140-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-140-5" role="tab" aria-controls="tabset-140-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-140-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-140-1-tab">
<div class="sourceCode" id="cb589"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb589-1"><a href="#cb589-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* On calcule déjà la moyenne des notes par individu */</span></span>
<span id="cb589-2"><a href="#cb589-2" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> notes = Note_Contenu Note_Formateur Note_Moyens Note_Accompagnement Note_Materiel;</span>
<span id="cb589-3"><a href="#cb589-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb589-4"><a href="#cb589-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb589-5"><a href="#cb589-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 1ère solution */</span></span>
<span id="cb589-6"><a href="#cb589-6" aria-hidden="true" tabindex="-1"></a>  Note_moyenne    = <span class="fu">mean</span>(of <span class="kw">&amp;notes.</span>);</span>
<span id="cb589-7"><a href="#cb589-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* 2e solution : l&#39;équivalent des list-comprehension de Python en SAS */</span></span>
<span id="cb589-8"><a href="#cb589-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%macro</span> List_comprehension;</span>
<span id="cb589-9"><a href="#cb589-9" aria-hidden="true" tabindex="-1"></a>    Note_moyenne2 = <span class="fu">mean</span>(of <span class="kw">%do</span> i = <span class="dv">1</span> <span class="kw">%to</span> <span class="kw">%sysfunc</span>(countw(<span class="kw">&amp;notes.</span>));</span>
<span id="cb589-10"><a href="#cb589-10" aria-hidden="true" tabindex="-1"></a>                                <span class="kw">%let</span> j = <span class="kw">%scan</span>(<span class="kw">&amp;notes.</span>, <span class="kw">&amp;i.</span>);</span>
<span id="cb589-11"><a href="#cb589-11" aria-hidden="true" tabindex="-1"></a>                                          <span class="kw">&amp;j.</span></span>
<span id="cb589-12"><a href="#cb589-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="kw">%end</span>;);;</span>
<span id="cb589-13"><a href="#cb589-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%mend</span> List_comprehension;</span>
<span id="cb589-14"><a href="#cb589-14" aria-hidden="true" tabindex="-1"></a>  %List_comprehension;</span>
<span id="cb589-15"><a href="#cb589-15" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb589-16"><a href="#cb589-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb589-17"><a href="#cb589-17" aria-hidden="true" tabindex="-1"></a><span class="co">/* Déciles et quartiles de la note moyenne */</span></span>
<span id="cb589-18"><a href="#cb589-18" aria-hidden="true" tabindex="-1"></a><span class="co">/* Par la proc means */</span></span>
<span id="cb589-19"><a href="#cb589-19" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas StackODSOutput <span class="fu">Min</span> P10 P20 P30 P40 Median P60 P70 Q3 P80 P90 <span class="fu">Max</span> Q1 Median Q3 QRANGE;</span>
<span id="cb589-20"><a href="#cb589-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> Note_moyenne;</span>
<span id="cb589-21"><a href="#cb589-21" aria-hidden="true" tabindex="-1"></a>  ods <span class="kw">output</span> summary = Deciles_proc_means;</span>
<span id="cb589-22"><a href="#cb589-22" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb589-23"><a href="#cb589-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb589-24"><a href="#cb589-24" aria-hidden="true" tabindex="-1"></a><span class="co">/* Par la proc univariate */</span></span>
<span id="cb589-25"><a href="#cb589-25" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> univariate<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb589-26"><a href="#cb589-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> Note_moyenne;</span>
<span id="cb589-27"><a href="#cb589-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">output</span> out = Deciles_proc_univariate pctlpts=<span class="dv">00</span> <span class="kw">to</span> <span class="dv">100</span> <span class="kw">by</span> <span class="dv">10</span> <span class="dv">25</span> <span class="dv">50</span> <span class="dv">75</span> PCTLPRE=_; </span>
<span id="cb589-28"><a href="#cb589-28" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-140-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-140-2-tab">
<div class="cell">
<div class="sourceCode" id="cb590"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb590-1"><a href="#cb590-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On calcule déjà la moyenne des notes par individu</span></span>
<span id="cb590-2"><a href="#cb590-2" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">c</span>(<span class="st">&quot;Note_Contenu&quot;</span>, <span class="st">&quot;Note_Formateur&quot;</span>, <span class="st">&quot;Note_Moyens&quot;</span>, <span class="st">&quot;Note_Accompagnement&quot;</span>, <span class="st">&quot;Note_Materiel&quot;</span>))</span>
<span id="cb590-3"><a href="#cb590-3" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>note_moyenne <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(donnees_rbase[, notes], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb590-4"><a href="#cb590-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb590-5"><a href="#cb590-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Et les quantiles</span></span>
<span id="cb590-6"><a href="#cb590-6" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(donnees_rbase<span class="sc">$</span>note_moyenne, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), <span class="fl">0.25</span>, <span class="fl">0.75</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb590-7"><a href="#cb590-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb590-8"><a href="#cb590-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Intervalle inter-quartile</span></span>
<span id="cb590-9"><a href="#cb590-9" aria-hidden="true" tabindex="-1"></a><span class="fu">IQR</span>(donnees_rbase<span class="sc">$</span>note_moyenne, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-140-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-140-3-tab">
<div class="cell">
<div class="sourceCode" id="cb591"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb591-1"><a href="#cb591-1" aria-hidden="true" tabindex="-1"></a><span class="co"># on calcule déjà la moyenne des notes par individu</span></span>
<span id="cb591-2"><a href="#cb591-2" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb591-3"><a href="#cb591-3" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb591-4"><a href="#cb591-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">note_moyenne =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(varNotes)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb591-5"><a href="#cb591-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb591-6"><a href="#cb591-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Et les quantiles</span></span>
<span id="cb591-7"><a href="#cb591-7" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb591-8"><a href="#cb591-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(note_moyenne) <span class="sc">%&gt;%</span> </span>
<span id="cb591-9"><a href="#cb591-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(<span class="at">probs =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), <span class="fl">0.25</span>, <span class="fl">0.75</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb591-10"><a href="#cb591-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb591-11"><a href="#cb591-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Intervalle inter-quartile</span></span>
<span id="cb591-12"><a href="#cb591-12" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb591-13"><a href="#cb591-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(note_moyenne) <span class="sc">%&gt;%</span> </span>
<span id="cb591-14"><a href="#cb591-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">IQR</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-140-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-140-4-tab">
<div class="cell">
<div class="sourceCode" id="cb592"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb592-1"><a href="#cb592-1" aria-hidden="true" tabindex="-1"></a><span class="co"># on calcule déjà la moyenne des notes par individu</span></span>
<span id="cb592-2"><a href="#cb592-2" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>,<span class="st">&quot;note_formateur&quot;</span>,<span class="st">&quot;note_moyens&quot;</span>,<span class="st">&quot;note_accompagnement&quot;</span>,<span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb592-3"><a href="#cb592-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, note_moyenne <span class="sc">:</span><span class="er">=</span> <span class="fu">rowMeans</span>(.SD, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .SDcols <span class="ot">=</span> notes]</span>
<span id="cb592-4"><a href="#cb592-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb592-5"><a href="#cb592-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Et les quantiles</span></span>
<span id="cb592-6"><a href="#cb592-6" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">quantile</span>(.SD, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), <span class="fl">0.25</span>, <span class="fl">0.75</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .SDcols <span class="ot">=</span> <span class="st">&quot;note_moyenne&quot;</span>]</span>
<span id="cb592-7"><a href="#cb592-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb592-8"><a href="#cb592-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Intervalle inter-quartile</span></span>
<span id="cb592-9"><a href="#cb592-9" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">IQR</span>(note_moyenne, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb592-10"><a href="#cb592-10" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">IQR</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), .SDcols <span class="ot">=</span> <span class="st">&quot;note_moyenne&quot;</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-140-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-140-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="déciles-et-quantiles-pondérés" class="level2" data-number="19.11">
<h2 data-number="19.11"><span class="header-section-number">19.11</span> Déciles et quantiles pondérés</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-141-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-141-1" role="tab" aria-controls="tabset-141-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-141-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-141-2" role="tab" aria-controls="tabset-141-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-141-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-141-3" role="tab" aria-controls="tabset-141-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-141-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-141-4" role="tab" aria-controls="tabset-141-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-141-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-141-5" role="tab" aria-controls="tabset-141-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-141-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-141-1-tab">
<div class="sourceCode" id="cb593"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb593-1"><a href="#cb593-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* On calcule déjà la moyenne des notes par individu */</span></span>
<span id="cb593-2"><a href="#cb593-2" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> notes = Note_Contenu Note_Formateur Note_Moyens Note_Accompagnement Note_Materiel;</span>
<span id="cb593-3"><a href="#cb593-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb593-4"><a href="#cb593-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb593-5"><a href="#cb593-5" aria-hidden="true" tabindex="-1"></a>  Note_moyenne = <span class="fu">mean</span>(of <span class="kw">&amp;notes.</span>);</span>
<span id="cb593-6"><a href="#cb593-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb593-7"><a href="#cb593-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb593-8"><a href="#cb593-8" aria-hidden="true" tabindex="-1"></a><span class="co">/* Par la proc means */</span></span>
<span id="cb593-9"><a href="#cb593-9" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas StackODSOutput <span class="fu">Min</span> P10 P20 P30 P40 Median P60 P70 Q3 P80 P90 <span class="fu">Max</span> Q1 Median Q3 QRANGE;</span>
<span id="cb593-10"><a href="#cb593-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> Note_moyenne;</span>
<span id="cb593-11"><a href="#cb593-11" aria-hidden="true" tabindex="-1"></a>  ods <span class="kw">output</span> summary = Deciles_proc_means;</span>
<span id="cb593-12"><a href="#cb593-12" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb593-13"><a href="#cb593-13" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb593-14"><a href="#cb593-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb593-15"><a href="#cb593-15" aria-hidden="true" tabindex="-1"></a><span class="co">/* Par la proc univariate */</span></span>
<span id="cb593-16"><a href="#cb593-16" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> univariate<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb593-17"><a href="#cb593-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> Note_moyenne;</span>
<span id="cb593-18"><a href="#cb593-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">output</span> out = Deciles_proc_univariate pctlpts=<span class="dv">00</span> <span class="kw">to</span> <span class="dv">100</span> <span class="kw">by</span> <span class="dv">10</span> <span class="dv">25</span> <span class="dv">50</span> <span class="dv">75</span> PCTLPRE=_;</span>
<span id="cb593-19"><a href="#cb593-19" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb593-20"><a href="#cb593-20" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-141-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-141-2-tab">
<div class="cell">
<div class="sourceCode" id="cb594"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb594-1"><a href="#cb594-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Une solution pour obtenir les résultats pondérés est d&#39;utiliser la fonction fquantile du package collapse</span></span>
<span id="cb594-2"><a href="#cb594-2" aria-hidden="true" tabindex="-1"></a><span class="co"># L&#39;option na.rm est par défaut à TRUE dans le package</span></span>
<span id="cb594-3"><a href="#cb594-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(collapse)</span>
<span id="cb594-4"><a href="#cb594-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-5"><a href="#cb594-5" aria-hidden="true" tabindex="-1"></a><span class="co"># On calcule déjà la moyenne des notes par individu</span></span>
<span id="cb594-6"><a href="#cb594-6" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">c</span>(<span class="st">&quot;Note_Contenu&quot;</span>, <span class="st">&quot;Note_Formateur&quot;</span>, <span class="st">&quot;Note_Moyens&quot;</span>, <span class="st">&quot;Note_Accompagnement&quot;</span>, <span class="st">&quot;Note_Materiel&quot;</span>))</span>
<span id="cb594-7"><a href="#cb594-7" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>note_moyenne <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(donnees_rbase[, notes], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb594-8"><a href="#cb594-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-9"><a href="#cb594-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Les déciles</span></span>
<span id="cb594-10"><a href="#cb594-10" aria-hidden="true" tabindex="-1"></a>collapse<span class="sc">::</span><span class="fu">fquantile</span>(donnees_rbase<span class="sc">$</span>note_moyenne, <span class="at">w =</span> donnees_rbase<span class="sc">$</span>poids_sondage,</span>
<span id="cb594-11"><a href="#cb594-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">probs =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)))</span>
<span id="cb594-12"><a href="#cb594-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-13"><a href="#cb594-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Les quartiles</span></span>
<span id="cb594-14"><a href="#cb594-14" aria-hidden="true" tabindex="-1"></a>collapse<span class="sc">::</span><span class="fu">fquantile</span>(donnees_rbase<span class="sc">$</span>note_moyenne, <span class="at">w =</span> donnees_rbase<span class="sc">$</span>poids_sondage,</span>
<span id="cb594-15"><a href="#cb594-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-141-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-141-3-tab">
<div class="cell">
<div class="sourceCode" id="cb595"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb595-1"><a href="#cb595-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Une solution pour obtenir les résultats pondérés est d&#39;utiliser les fonctions du package collapse</span></span>
<span id="cb595-2"><a href="#cb595-2" aria-hidden="true" tabindex="-1"></a><span class="co"># L&#39;option na.rm est par défaut à TRUE dans le package</span></span>
<span id="cb595-3"><a href="#cb595-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(collapse)</span>
<span id="cb595-4"><a href="#cb595-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-5"><a href="#cb595-5" aria-hidden="true" tabindex="-1"></a><span class="co"># On calcule déjà la moyenne des notes par individu</span></span>
<span id="cb595-6"><a href="#cb595-6" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb595-7"><a href="#cb595-7" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb595-8"><a href="#cb595-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">note_moyenne =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(varNotes)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb595-9"><a href="#cb595-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-10"><a href="#cb595-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Les déciles</span></span>
<span id="cb595-11"><a href="#cb595-11" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb595-12"><a href="#cb595-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(note_moyenne) <span class="sc">%&gt;%</span> </span>
<span id="cb595-13"><a href="#cb595-13" aria-hidden="true" tabindex="-1"></a>  collapse<span class="sc">::</span><span class="fu">fquantile</span>(<span class="at">probs =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)), <span class="at">w =</span> donnees_tidyverse<span class="sc">$</span>poids_sondage)</span>
<span id="cb595-14"><a href="#cb595-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-15"><a href="#cb595-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Les quartiles</span></span>
<span id="cb595-16"><a href="#cb595-16" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb595-17"><a href="#cb595-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(note_moyenne) <span class="sc">%&gt;%</span> </span>
<span id="cb595-18"><a href="#cb595-18" aria-hidden="true" tabindex="-1"></a>  collapse<span class="sc">::</span><span class="fu">fquantile</span>(<span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>), <span class="at">w =</span> donnees_tidyverse<span class="sc">$</span>poids_sondage)</span></code></pre></div>
</div>
</div>
<div id="tabset-141-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-141-4-tab">
<div class="cell">
<div class="sourceCode" id="cb596"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb596-1"><a href="#cb596-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Une solution pour obtenir les résultats pondérés est d&#39;utiliser la fonction fquantile du package collapse</span></span>
<span id="cb596-2"><a href="#cb596-2" aria-hidden="true" tabindex="-1"></a><span class="co"># L&#39;option na.rm est par défaut à TRUE dans le package</span></span>
<span id="cb596-3"><a href="#cb596-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(collapse)</span>
<span id="cb596-4"><a href="#cb596-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb596-5"><a href="#cb596-5" aria-hidden="true" tabindex="-1"></a><span class="co"># On calcule déjà la moyenne des notes par individu</span></span>
<span id="cb596-6"><a href="#cb596-6" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>,<span class="st">&quot;note_formateur&quot;</span>,<span class="st">&quot;note_moyens&quot;</span>,<span class="st">&quot;note_accompagnement&quot;</span>,<span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb596-7"><a href="#cb596-7" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, note_moyenne <span class="sc">:</span><span class="er">=</span> <span class="fu">rowMeans</span>(.SD, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .SDcols <span class="ot">=</span> notes]</span>
<span id="cb596-8"><a href="#cb596-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb596-9"><a href="#cb596-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Les centiles</span></span>
<span id="cb596-10"><a href="#cb596-10" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) collapse<span class="sc">::</span><span class="fu">fquantile</span>(x, <span class="at">w =</span> poids_sondage,</span>
<span id="cb596-11"><a href="#cb596-11" aria-hidden="true" tabindex="-1"></a>                                                                <span class="at">probs =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>))</span>
<span id="cb596-12"><a href="#cb596-12" aria-hidden="true" tabindex="-1"></a>                                                                )),</span>
<span id="cb596-13"><a href="#cb596-13" aria-hidden="true" tabindex="-1"></a>                           .SDcols <span class="ot">=</span> <span class="st">&quot;note_moyenne&quot;</span>]</span>
<span id="cb596-14"><a href="#cb596-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb596-15"><a href="#cb596-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Les quartiles</span></span>
<span id="cb596-16"><a href="#cb596-16" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) collapse<span class="sc">::</span><span class="fu">fquantile</span>(x, <span class="at">w =</span> poids_sondage,</span>
<span id="cb596-17"><a href="#cb596-17" aria-hidden="true" tabindex="-1"></a>                                                                <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>)</span>
<span id="cb596-18"><a href="#cb596-18" aria-hidden="true" tabindex="-1"></a>                                                                )),</span>
<span id="cb596-19"><a href="#cb596-19" aria-hidden="true" tabindex="-1"></a>                           .SDcols <span class="ot">=</span> <span class="st">&quot;note_moyenne&quot;</span>]</span></code></pre></div>
</div>
</div>
<div id="tabset-141-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-141-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="rang-de-la-note" class="level2" data-number="19.12">
<h2 data-number="19.12"><span class="header-section-number">19.12</span> Rang de la note</h2>
<p>Ajouter dans la base le rang de la note par ordre décroissant.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-142-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-142-1" role="tab" aria-controls="tabset-142-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-142-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-142-2" role="tab" aria-controls="tabset-142-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-142-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-142-3" role="tab" aria-controls="tabset-142-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-142-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-142-4" role="tab" aria-controls="tabset-142-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-142-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-142-5" role="tab" aria-controls="tabset-142-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-142-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-142-1-tab">
<div class="sourceCode" id="cb597"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb597-1"><a href="#cb597-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* On calcule déjà la moyenne des notes par individu */</span></span>
<span id="cb597-2"><a href="#cb597-2" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> notes = Note_Contenu Note_Formateur Note_Moyens Note_Accompagnement Note_Materiel;</span>
<span id="cb597-3"><a href="#cb597-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb597-4"><a href="#cb597-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb597-5"><a href="#cb597-5" aria-hidden="true" tabindex="-1"></a>  Note_moyenne = <span class="fu">mean</span>(of <span class="kw">&amp;notes.</span>);</span>
<span id="cb597-6"><a href="#cb597-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb597-7"><a href="#cb597-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb597-8"><a href="#cb597-8" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> <span class="fu">rank</span><span class="kw"> data</span> = donnees_sas out = donnees_sas descending;</span>
<span id="cb597-9"><a href="#cb597-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> note_moyenne;</span>
<span id="cb597-10"><a href="#cb597-10" aria-hidden="true" tabindex="-1"></a>  ranks rang_note_moyenne;</span>
<span id="cb597-11"><a href="#cb597-11" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-142-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-142-2-tab">
<div class="cell">
<div class="sourceCode" id="cb598"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb598-1"><a href="#cb598-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On calcule déjà la moyenne des notes par individu</span></span>
<span id="cb598-2"><a href="#cb598-2" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">c</span>(<span class="st">&quot;Note_Contenu&quot;</span>, <span class="st">&quot;Note_Formateur&quot;</span>, <span class="st">&quot;Note_Moyens&quot;</span>, <span class="st">&quot;Note_Accompagnement&quot;</span>, <span class="st">&quot;Note_Materiel&quot;</span>))</span>
<span id="cb598-3"><a href="#cb598-3" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>note_moyenne <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(donnees_rbase[, notes], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb598-4"><a href="#cb598-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb598-5"><a href="#cb598-5" aria-hidden="true" tabindex="-1"></a>donnees_rbase<span class="sc">$</span>rang_note_moyenne <span class="ot">&lt;-</span> <span class="fu">rank</span>(<span class="sc">-</span>donnees_rbase<span class="sc">$</span>note_moyenne)</span></code></pre></div>
</div>
</div>
<div id="tabset-142-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-142-3-tab">
<div class="cell">
<div class="sourceCode" id="cb599"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb599-1"><a href="#cb599-1" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb599-2"><a href="#cb599-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span></span>
<span id="cb599-3"><a href="#cb599-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">note_moyenne =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(varNotes)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb599-4"><a href="#cb599-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rang_note_moyenne =</span> <span class="fu">rank</span>(<span class="sc">-</span>note_moyenne))</span></code></pre></div>
</div>
</div>
<div id="tabset-142-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-142-4-tab">
<div class="cell">
<div class="sourceCode" id="cb600"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb600-1"><a href="#cb600-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On calcule déjà la moyenne des notes par individu</span></span>
<span id="cb600-2"><a href="#cb600-2" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>,<span class="st">&quot;note_formateur&quot;</span>,<span class="st">&quot;note_moyens&quot;</span>,<span class="st">&quot;note_accompagnement&quot;</span>,<span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb600-3"><a href="#cb600-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, note_moyenne <span class="sc">:</span><span class="er">=</span> <span class="fu">rowMeans</span>(.SD, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .SDcols <span class="ot">=</span> notes]</span>
<span id="cb600-4"><a href="#cb600-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-5"><a href="#cb600-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Attention, en R, rank trie par ordre croissant par défaut, alors que le tri est par ordre décroissant en SAS</span></span>
<span id="cb600-6"><a href="#cb600-6" aria-hidden="true" tabindex="-1"></a><span class="co"># On exprime le rang par ordre décroissant, avec le - devant</span></span>
<span id="cb600-7"><a href="#cb600-7" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, rang_note_moyenne <span class="sc">:</span><span class="er">=</span> <span class="fu">rank</span>(<span class="sc">-</span>note_moyenne)]</span></code></pre></div>
</div>
</div>
<div id="tabset-142-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-142-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="covariance-et-corrélation-linéaire" class="level2" data-number="19.13">
<h2 data-number="19.13"><span class="header-section-number">19.13</span> Covariance et corrélation linéaire</h2>
<section id="covariance-entre-deux-notes" class="level3" data-number="19.13.1">
<h3 data-number="19.13.1"><span class="header-section-number">19.13.1</span> Covariance entre deux notes</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-143-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-143-1" role="tab" aria-controls="tabset-143-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-143-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-143-2" role="tab" aria-controls="tabset-143-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-143-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-143-3" role="tab" aria-controls="tabset-143-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-143-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-143-4" role="tab" aria-controls="tabset-143-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-143-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-143-5" role="tab" aria-controls="tabset-143-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-143-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-143-1-tab">
<div class="sourceCode" id="cb601"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb601-1"><a href="#cb601-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Covariance et corrélation linéaire (Kendall, Pearson, Spearman) */</span></span>
<span id="cb601-2"><a href="#cb601-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> corr<span class="kw"> data</span> = donnees_sas kendall pearson spearman cov;</span>
<span id="cb601-3"><a href="#cb601-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> note_contenu note_formateur;</span>
<span id="cb601-4"><a href="#cb601-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-143-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-143-2-tab">
<div class="cell">
<div class="sourceCode" id="cb602"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb602-1"><a href="#cb602-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Covariance (Kendall, Pearson, Spearman)</span></span>
<span id="cb602-2"><a href="#cb602-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_rbase,</span>
<span id="cb602-3"><a href="#cb602-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">sapply</span>(<span class="fu">c</span>(<span class="st">&quot;pearson&quot;</span>, <span class="st">&quot;spearman&quot;</span>, <span class="st">&quot;kendall&quot;</span>),</span>
<span id="cb602-4"><a href="#cb602-4" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(x) <span class="fu">cov</span>(note_contenu, note_formateur, <span class="at">method =</span> x, <span class="at">use =</span> <span class="st">&quot;complete.obs&quot;</span>)))</span></code></pre></div>
</div>
</div>
<div id="tabset-143-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-143-3-tab">
<div class="cell">
<div class="sourceCode" id="cb603"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb603-1"><a href="#cb603-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Covariance (Kendall, Pearson, Spearman)</span></span>
<span id="cb603-2"><a href="#cb603-2" aria-hidden="true" tabindex="-1"></a>methodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;pearson&quot;</span>, <span class="st">&quot;spearman&quot;</span>, <span class="st">&quot;kendall&quot;</span>)</span>
<span id="cb603-3"><a href="#cb603-3" aria-hidden="true" tabindex="-1"></a>methodes <span class="sc">%&gt;%</span> </span>
<span id="cb603-4"><a href="#cb603-4" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span> </span>
<span id="cb603-5"><a href="#cb603-5" aria-hidden="true" tabindex="-1"></a>    donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb603-6"><a href="#cb603-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">cov =</span> <span class="fu">cov</span>(note_contenu, note_formateur, <span class="at">method =</span> .x, <span class="at">use =</span> <span class="st">&quot;complete.obs&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb603-7"><a href="#cb603-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(methodes) <span class="sc">%&gt;%</span> </span>
<span id="cb603-8"><a href="#cb603-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-143-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-143-4-tab">
<div class="cell">
<div class="sourceCode" id="cb604"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb604-1"><a href="#cb604-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Covariance (Kendall, Pearson, Spearman)</span></span>
<span id="cb604-2"><a href="#cb604-2" aria-hidden="true" tabindex="-1"></a>methodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;pearson&quot;</span>, <span class="st">&quot;spearman&quot;</span>, <span class="st">&quot;kendall&quot;</span>)</span>
<span id="cb604-3"><a href="#cb604-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setNames</span>(donnees_datatable[, <span class="fu">lapply</span>(methodes,</span>
<span id="cb604-4"><a href="#cb604-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">function</span>(x) <span class="fu">cov</span>(note_contenu, note_formateur,</span>
<span id="cb604-5"><a href="#cb604-5" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">method =</span> x,</span>
<span id="cb604-6"><a href="#cb604-6" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">use =</span> <span class="st">&quot;complete.obs&quot;</span>))],</span>
<span id="cb604-7"><a href="#cb604-7" aria-hidden="true" tabindex="-1"></a>         methodes)</span></code></pre></div>
</div>
</div>
<div id="tabset-143-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-143-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="corrélation-linéaire-entre-deux-notes" class="level3" data-number="19.13.2">
<h3 data-number="19.13.2"><span class="header-section-number">19.13.2</span> Corrélation linéaire entre deux notes</h3>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-144-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-144-1" role="tab" aria-controls="tabset-144-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-144-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-144-2" role="tab" aria-controls="tabset-144-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-144-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-144-3" role="tab" aria-controls="tabset-144-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-144-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-144-4" role="tab" aria-controls="tabset-144-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-144-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-144-5" role="tab" aria-controls="tabset-144-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-144-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-144-1-tab">
<div class="sourceCode" id="cb605"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb605-1"><a href="#cb605-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Corrélation linéaire (Kendall, Pearson, Spearman) */</span></span>
<span id="cb605-2"><a href="#cb605-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> corr<span class="kw"> data</span> = donnees_sas kendall pearson spearman cov;</span>
<span id="cb605-3"><a href="#cb605-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> note_contenu note_formateur;</span>
<span id="cb605-4"><a href="#cb605-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-144-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-144-2-tab">
<div class="cell">
<div class="sourceCode" id="cb606"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb606-1"><a href="#cb606-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Corrélation linéaire (Kendall, Pearson, Spearman)</span></span>
<span id="cb606-2"><a href="#cb606-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_rbase,</span>
<span id="cb606-3"><a href="#cb606-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">sapply</span>(<span class="fu">c</span>(<span class="st">&quot;pearson&quot;</span>, <span class="st">&quot;spearman&quot;</span>, <span class="st">&quot;kendall&quot;</span>),</span>
<span id="cb606-4"><a href="#cb606-4" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(x) <span class="fu">cor</span>(note_contenu, note_formateur, <span class="at">method =</span> x, <span class="at">use =</span> <span class="st">&quot;complete.obs&quot;</span>)))</span></code></pre></div>
</div>
</div>
<div id="tabset-144-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-144-3-tab">
<div class="cell">
<div class="sourceCode" id="cb607"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb607-1"><a href="#cb607-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Corrélation linéaire (Kendall, Pearson, Spearman)</span></span>
<span id="cb607-2"><a href="#cb607-2" aria-hidden="true" tabindex="-1"></a>methodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;pearson&quot;</span>, <span class="st">&quot;spearman&quot;</span>, <span class="st">&quot;kendall&quot;</span>)</span>
<span id="cb607-3"><a href="#cb607-3" aria-hidden="true" tabindex="-1"></a>methodes <span class="sc">%&gt;%</span> </span>
<span id="cb607-4"><a href="#cb607-4" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb607-5"><a href="#cb607-5" aria-hidden="true" tabindex="-1"></a>               <span class="fu">summarise</span>(<span class="at">cor =</span> <span class="fu">cor</span>(note_contenu, note_formateur, <span class="at">method =</span> .x, <span class="at">use =</span> <span class="st">&quot;complete.obs&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb607-6"><a href="#cb607-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(methodes) <span class="sc">%&gt;%</span> </span>
<span id="cb607-7"><a href="#cb607-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-144-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-144-4-tab">
<div class="cell">
<div class="sourceCode" id="cb608"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb608-1"><a href="#cb608-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Corrélation linéaire (Kendall, Pearson, Spearman)</span></span>
<span id="cb608-2"><a href="#cb608-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setNames</span>(donnees_datatable[, <span class="fu">lapply</span>(methodes,</span>
<span id="cb608-3"><a href="#cb608-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">function</span>(x) <span class="fu">cor</span>(note_contenu, note_formateur,</span>
<span id="cb608-4"><a href="#cb608-4" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">method =</span> x,</span>
<span id="cb608-5"><a href="#cb608-5" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">use =</span> <span class="st">&quot;complete.obs&quot;</span>))],</span>
<span id="cb608-6"><a href="#cb608-6" aria-hidden="true" tabindex="-1"></a>         methodes)</span></code></pre></div>
</div>
</div>
<div id="tabset-144-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-144-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="tableaux-de-fréquence-proc-freq-de-sas-pour-1-variable" class="level1" data-number="20">
<h1 data-number="20"><span class="header-section-number">20</span> Tableaux de fréquence (proc freq de <code>SAS</code>) pour 1 variable</h1>
<section id="tableaux-de-fréquence-pour-1-variable" class="level2" data-number="20.1">
<h2 data-number="20.1"><span class="header-section-number">20.1</span> Tableaux de fréquence pour 1 variable</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-145-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-145-1" role="tab" aria-controls="tabset-145-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-145-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-145-2" role="tab" aria-controls="tabset-145-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-145-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-145-3" role="tab" aria-controls="tabset-145-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-145-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-145-4" role="tab" aria-controls="tabset-145-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-145-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-145-5" role="tab" aria-controls="tabset-145-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-145-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-145-1-tab">
<div class="sourceCode" id="cb609"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb609-1"><a href="#cb609-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb609-2"><a href="#cb609-2" aria-hidden="true" tabindex="-1"></a>  tables Sexe CSP;</span>
<span id="cb609-3"><a href="#cb609-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb609-4"><a href="#cb609-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-145-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-145-2-tab">
<div class="cell">
<div class="sourceCode" id="cb610"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb610-1"><a href="#cb610-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableaux de fréquence (proc freq) (sans les valeurs manquantes)</span></span>
<span id="cb610-2"><a href="#cb610-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(donnees_rbase<span class="sc">$</span>cspf)</span>
<span id="cb610-3"><a href="#cb610-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(donnees_rbase<span class="sc">$</span>sexef)</span>
<span id="cb610-4"><a href="#cb610-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre syntaxe, donnant une mise en forme différente</span></span>
<span id="cb610-5"><a href="#cb610-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ftable</span>(donnees_rbase<span class="sc">$</span>cspf)</span>
<span id="cb610-6"><a href="#cb610-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour enlever les &quot;donnees_rbase$&quot;, on peut utiliser with pour se placer dans l&#39;environnement de donnees_rbase</span></span>
<span id="cb610-7"><a href="#cb610-7" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_rbase, <span class="fu">table</span>(cspf))</span>
<span id="cb610-8"><a href="#cb610-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb610-9"><a href="#cb610-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour les proportions</span></span>
<span id="cb610-10"><a href="#cb610-10" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(donnees_rbase<span class="sc">$</span>cspf)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb610-11"><a href="#cb610-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb610-12"><a href="#cb610-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Devient plus difficile si l&#39;on souhaite plus (sommes et proportions cumulées par exemple)</span></span>
<span id="cb610-13"><a href="#cb610-13" aria-hidden="true" tabindex="-1"></a>freq <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">as.data.frame</span>(<span class="fu">table</span>(donnees_rbase<span class="sc">$</span>cspf)), <span class="fu">c</span>(<span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;Freq&quot;</span>))</span>
<span id="cb610-14"><a href="#cb610-14" aria-hidden="true" tabindex="-1"></a>freq <span class="ot">&lt;-</span> <span class="fu">transform</span>(freq, <span class="at">Prop =</span> Freq <span class="sc">/</span> <span class="fu">sum</span>(Freq) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb610-15"><a href="#cb610-15" aria-hidden="true" tabindex="-1"></a>freq <span class="ot">&lt;-</span> <span class="fu">transform</span>(freq,</span>
<span id="cb610-16"><a href="#cb610-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Freq_cum =</span> <span class="fu">cumsum</span>(Freq),</span>
<span id="cb610-17"><a href="#cb610-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Prop_cum =</span> <span class="fu">cumsum</span>(Prop))</span>
<span id="cb610-18"><a href="#cb610-18" aria-hidden="true" tabindex="-1"></a>freq</span></code></pre></div>
</div>
</div>
<div id="tabset-145-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-145-3-tab">
<div class="cell">
<div class="sourceCode" id="cb611"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb611-1"><a href="#cb611-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb611-2"><a href="#cb611-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cspf) <span class="sc">%&gt;%</span> </span>
<span id="cb611-3"><a href="#cb611-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb611-4"><a href="#cb611-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_cum =</span> <span class="fu">cumsum</span>(n),</span>
<span id="cb611-5"><a href="#cb611-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_cum =</span> <span class="fu">cumsum</span>(prop))</span>
<span id="cb611-6"><a href="#cb611-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb611-7"><a href="#cb611-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou alors</span></span>
<span id="cb611-8"><a href="#cb611-8" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb611-9"><a href="#cb611-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cspf) <span class="sc">%&gt;%</span> </span>
<span id="cb611-10"><a href="#cb611-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb611-11"><a href="#cb611-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb611-12"><a href="#cb611-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_cum =</span> <span class="fu">cumsum</span>(n),</span>
<span id="cb611-13"><a href="#cb611-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_cum =</span> <span class="fu">cumsum</span>(prop)</span>
<span id="cb611-14"><a href="#cb611-14" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
</div>
<div id="tabset-145-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-145-4-tab">
<div class="cell">
<div class="sourceCode" id="cb612"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb612-1"><a href="#cb612-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableaux de fréquence (proc freq) (avec les valeurs manquantes)</span></span>
<span id="cb612-2"><a href="#cb612-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">table</span>(cspf) ]</span>
<span id="cb612-3"><a href="#cb612-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">table</span>(sexef) ]</span>
<span id="cb612-4"><a href="#cb612-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb612-5"><a href="#cb612-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour les proportions</span></span>
<span id="cb612-6"><a href="#cb612-6" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">prop.table</span>(<span class="fu">table</span>(cspf)) ] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb612-7"><a href="#cb612-7" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, .(<span class="at">Nombre =</span> .N,</span>
<span id="cb612-8"><a href="#cb612-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Pourcentage =</span> .N <span class="sc">/</span> <span class="fu">length</span>(donnees_datatable[, cspf]) <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb612-9"><a href="#cb612-9" aria-hidden="true" tabindex="-1"></a>                  keyby <span class="ot">=</span> cspf]</span>
<span id="cb612-10"><a href="#cb612-10" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, {tot <span class="ot">=</span> .N; .SD[, .(<span class="at">frac =</span> .N <span class="sc">/</span> tot <span class="sc">*</span> <span class="dv">100</span>), keyby <span class="ot">=</span> cspf]} ]</span>
<span id="cb612-11"><a href="#cb612-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb612-12"><a href="#cb612-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre façon d&#39;utiliser les méthodes de data.table, avec les fréquences et proportions cumulés</span></span>
<span id="cb612-13"><a href="#cb612-13" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">dcast</span>(donnees_datatable, cspf <span class="sc">~</span> ., <span class="at">fun =</span> length)</span>
<span id="cb612-14"><a href="#cb612-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tab)[<span class="fu">colnames</span>(tab) <span class="sc">==</span> <span class="st">&quot;.&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Nombre&quot;</span></span>
<span id="cb612-15"><a href="#cb612-15" aria-hidden="true" tabindex="-1"></a>tab[, Prop <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(col) col <span class="sc">/</span> <span class="fu">sum</span>(col) <span class="sc">*</span> <span class="dv">100</span>), .SDcols <span class="ot">=</span> is.numeric]</span>
<span id="cb612-16"><a href="#cb612-16" aria-hidden="true" tabindex="-1"></a>tab[, <span class="fu">c</span>(<span class="st">&quot;Freq_cum&quot;</span>, <span class="st">&quot;Prop_cum&quot;</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">list</span>(<span class="fu">cumsum</span>(Nombre), <span class="fu">cumsum</span>(Prop))]</span></code></pre></div>
</div>
</div>
<div id="tabset-145-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-145-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="tableaux-de-fréquence-avec-les-valeurs-manquantes" class="level2" data-number="20.2">
<h2 data-number="20.2"><span class="header-section-number">20.2</span> Tableaux de fréquence avec les valeurs manquantes</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-146-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-146-1" role="tab" aria-controls="tabset-146-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-146-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-146-2" role="tab" aria-controls="tabset-146-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-146-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-146-3" role="tab" aria-controls="tabset-146-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-146-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-146-4" role="tab" aria-controls="tabset-146-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-146-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-146-5" role="tab" aria-controls="tabset-146-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-146-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-146-1-tab">
<div class="sourceCode" id="cb613"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb613-1"><a href="#cb613-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb613-2"><a href="#cb613-2" aria-hidden="true" tabindex="-1"></a>  tables Sexe CSP / missing;</span>
<span id="cb613-3"><a href="#cb613-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb613-4"><a href="#cb613-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-146-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-146-2-tab">
<div class="cell">
<div class="sourceCode" id="cb614"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb614-1"><a href="#cb614-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(donnees_rbase<span class="sc">$</span>cspf, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span>
<span id="cb614-2"><a href="#cb614-2" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(donnees_rbase<span class="sc">$</span>cspf, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)) <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div>
</div>
</div>
<div id="tabset-146-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-146-3-tab">
<div class="cell">
<div class="sourceCode" id="cb615"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb615-1"><a href="#cb615-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(donnees_rbase<span class="sc">$</span>cspf, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span>
<span id="cb615-2"><a href="#cb615-2" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(donnees_rbase<span class="sc">$</span>cspf, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb615-3"><a href="#cb615-3" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb615-4"><a href="#cb615-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cspf) <span class="sc">%&gt;%</span> </span>
<span id="cb615-5"><a href="#cb615-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-146-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-146-4-tab">
<div class="cell">
<div class="sourceCode" id="cb616"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb616-1"><a href="#cb616-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">table</span>(cspf, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>) ]</span>
<span id="cb616-2"><a href="#cb616-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">prop.table</span>(<span class="fu">table</span>(cspf, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>))] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb616-3"><a href="#cb616-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, .(<span class="at">Nombre =</span> .N,</span>
<span id="cb616-4"><a href="#cb616-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Pourcentage =</span> .N <span class="sc">/</span> <span class="fu">length</span>(donnees_datatable[, cspf]) <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb616-5"><a href="#cb616-5" aria-hidden="true" tabindex="-1"></a>                  keyby <span class="ot">=</span> cspf]</span>
<span id="cb616-6"><a href="#cb616-6" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, {tot <span class="ot">=</span> .N; .SD[, .(<span class="at">frac =</span> .N <span class="sc">/</span> tot <span class="sc">*</span> <span class="dv">100</span>), keyby <span class="ot">=</span> cspf]} ]</span></code></pre></div>
</div>
</div>
<div id="tabset-146-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-146-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="tableaux-de-fréquence-triés-par-la-modalité-la-plus-courante" class="level2" data-number="20.3">
<h2 data-number="20.3"><span class="header-section-number">20.3</span> Tableaux de fréquence triés par la modalité la plus courante</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-147-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-147-1" role="tab" aria-controls="tabset-147-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-147-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-147-2" role="tab" aria-controls="tabset-147-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-147-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-147-3" role="tab" aria-controls="tabset-147-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-147-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-147-4" role="tab" aria-controls="tabset-147-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-147-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-147-5" role="tab" aria-controls="tabset-147-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-147-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-147-1-tab">
<div class="sourceCode" id="cb617"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb617-1"><a href="#cb617-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas <span class="kw">order</span> = freq;</span>
<span id="cb617-2"><a href="#cb617-2" aria-hidden="true" tabindex="-1"></a>  tables Sexe CSP / missing;</span>
<span id="cb617-3"><a href="#cb617-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb617-4"><a href="#cb617-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-147-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-147-2-tab">
<div class="cell">
<div class="sourceCode" id="cb618"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb618-1"><a href="#cb618-1" aria-hidden="true" tabindex="-1"></a>freq <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">as.data.frame</span>(<span class="fu">table</span>(donnees_rbase<span class="sc">$</span>cspf)), <span class="fu">c</span>(<span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;Freq&quot;</span>))</span>
<span id="cb618-2"><a href="#cb618-2" aria-hidden="true" tabindex="-1"></a>freq <span class="ot">&lt;-</span> <span class="fu">transform</span>(freq, <span class="at">Prop =</span> Freq <span class="sc">/</span> <span class="fu">sum</span>(Freq) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb618-3"><a href="#cb618-3" aria-hidden="true" tabindex="-1"></a>freq[<span class="fu">order</span>(<span class="sc">-</span>freq<span class="sc">$</span>Freq), ]</span></code></pre></div>
</div>
</div>
<div id="tabset-147-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-147-3-tab">
<div class="cell">
<div class="sourceCode" id="cb619"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb619-1"><a href="#cb619-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb619-2"><a href="#cb619-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cspf) <span class="sc">%&gt;%</span> </span>
<span id="cb619-3"><a href="#cb619-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb619-4"><a href="#cb619-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb619-5"><a href="#cb619-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_cum =</span> <span class="fu">cumsum</span>(n),</span>
<span id="cb619-6"><a href="#cb619-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_cum =</span> <span class="fu">cumsum</span>(prop))</span>
<span id="cb619-7"><a href="#cb619-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb619-8"><a href="#cb619-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb619-9"><a href="#cb619-9" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb619-10"><a href="#cb619-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cspf, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb619-11"><a href="#cb619-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb619-12"><a href="#cb619-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_cum =</span> <span class="fu">cumsum</span>(n),</span>
<span id="cb619-13"><a href="#cb619-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_cum =</span> <span class="fu">cumsum</span>(prop))</span></code></pre></div>
</div>
</div>
<div id="tabset-147-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-147-4-tab">
<div class="cell">
<div class="sourceCode" id="cb620"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb620-1"><a href="#cb620-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, .(<span class="at">Nombre =</span> .N,</span>
<span id="cb620-2"><a href="#cb620-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Pourcentage =</span> .N <span class="sc">/</span> <span class="fu">length</span>(donnees_datatable[, cspf]) <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb620-3"><a href="#cb620-3" aria-hidden="true" tabindex="-1"></a>                  keyby <span class="ot">=</span> cspf][<span class="fu">order</span>(<span class="sc">-</span>Nombre)]</span></code></pre></div>
</div>
</div>
<div id="tabset-147-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-147-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="tableaux-de-fréquence-avec-la-pondération" class="level2" data-number="20.4">
<h2 data-number="20.4"><span class="header-section-number">20.4</span> Tableaux de fréquence avec la pondération</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-148-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-148-1" role="tab" aria-controls="tabset-148-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-148-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-148-2" role="tab" aria-controls="tabset-148-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-148-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-148-3" role="tab" aria-controls="tabset-148-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-148-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-148-4" role="tab" aria-controls="tabset-148-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-148-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-148-5" role="tab" aria-controls="tabset-148-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-148-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-148-1-tab">
<div class="sourceCode" id="cb621"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb621-1"><a href="#cb621-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb621-2"><a href="#cb621-2" aria-hidden="true" tabindex="-1"></a>  tables Sexe CSP / missing;</span>
<span id="cb621-3"><a href="#cb621-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb621-4"><a href="#cb621-4" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb621-5"><a href="#cb621-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-148-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-148-2-tab">
<div class="cell">
<div class="sourceCode" id="cb622"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb622-1"><a href="#cb622-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(poids_sondage <span class="sc">~</span> cspf, <span class="at">data =</span> donnees_rbase, <span class="at">addNA =</span> <span class="cn">TRUE</span>)</span>
<span id="cb622-2"><a href="#cb622-2" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">xtabs</span>(poids_sondage <span class="sc">~</span> cspf, <span class="at">data =</span> donnees_rbase, <span class="at">addNA =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-148-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-148-3-tab">
<div class="cell">
<div class="sourceCode" id="cb623"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb623-1"><a href="#cb623-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb623-2"><a href="#cb623-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cspf, <span class="at">wt =</span> poids_sondage) <span class="sc">%&gt;%</span> </span>
<span id="cb623-3"><a href="#cb623-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb623-4"><a href="#cb623-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_cum =</span> <span class="fu">cumsum</span>(n),</span>
<span id="cb623-5"><a href="#cb623-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_cum =</span> <span class="fu">cumsum</span>(prop))</span></code></pre></div>
</div>
</div>
<div id="tabset-148-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-148-4-tab">
<div class="cell">
<div class="sourceCode" id="cb624"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb624-1"><a href="#cb624-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">xtabs</span>(poids_sondage <span class="sc">~</span> cspf, <span class="at">data =</span> donnees_datatable, <span class="at">addNA =</span> <span class="cn">TRUE</span>) ]</span>
<span id="cb624-2"><a href="#cb624-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">prop.table</span>(<span class="fu">xtabs</span>(poids_sondage <span class="sc">~</span> cspf, <span class="at">data =</span> donnees_datatable, <span class="at">addNA =</span> <span class="cn">TRUE</span>)) ]</span>
<span id="cb624-3"><a href="#cb624-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, .(<span class="at">prop =</span> <span class="fu">sum</span>(poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(donnees_datatable[, poids_sondage]) <span class="sc">*</span> <span class="dv">100</span>), keyby <span class="ot">=</span> cspf]</span>
<span id="cb624-4"><a href="#cb624-4" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, {tot <span class="ot">=</span> <span class="fu">sum</span>(poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>); .SD[, .(<span class="at">prop =</span> <span class="fu">sum</span>(poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> tot <span class="sc">*</span> <span class="dv">100</span>), by <span class="ot">=</span> cspf]} ]</span></code></pre></div>
</div>
</div>
<div id="tabset-148-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-148-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="tableaux-de-contingence-proc-freq-de-sas-pour-2-variables" class="level1" data-number="21">
<h1 data-number="21"><span class="header-section-number">21</span> Tableaux de contingence (proc freq de <code>SAS</code>) pour 2 variables</h1>
<p>Cette tâche, immédiate en <code>SAS</code>, est plus complexe à réaliser en <code>R</code>. Plusieurs stratégies, avec et sans packages, sont proposées ici.</p>
<section id="tableaux-de-contingence-pour-2-variables" class="level2" data-number="21.1">
<h2 data-number="21.1"><span class="header-section-number">21.1</span> Tableaux de contingence pour 2 variables</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-149-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-149-1" role="tab" aria-controls="tabset-149-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-149-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-149-2" role="tab" aria-controls="tabset-149-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-149-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-149-3" role="tab" aria-controls="tabset-149-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-149-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-149-4" role="tab" aria-controls="tabset-149-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-149-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-149-5" role="tab" aria-controls="tabset-149-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-149-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-149-1-tab">
<div class="sourceCode" id="cb625"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb625-1"><a href="#cb625-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb625-2"><a href="#cb625-2" aria-hidden="true" tabindex="-1"></a>  tables Sexe * CSP / missing;</span>
<span id="cb625-3"><a href="#cb625-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb625-4"><a href="#cb625-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb625-5"><a href="#cb625-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb625-6"><a href="#cb625-6" aria-hidden="true" tabindex="-1"></a><span class="co">/* Tableau de contingence (tableau croisé) sans les proportions lignes, colonnes et totales */</span></span>
<span id="cb625-7"><a href="#cb625-7" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb625-8"><a href="#cb625-8" aria-hidden="true" tabindex="-1"></a>  tables CSP * Sexe  / missing nofreq norow nocol;</span>
<span id="cb625-9"><a href="#cb625-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb625-10"><a href="#cb625-10" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-149-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-149-2-tab">
<div class="cell">
<div class="sourceCode" id="cb626"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb626-1"><a href="#cb626-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau simple</span></span>
<span id="cb626-2"><a href="#cb626-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(donnees_rbase<span class="sc">$</span>cspf, donnees_rbase<span class="sc">$</span>sexef, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span>
<span id="cb626-3"><a href="#cb626-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau avec les sommes</span></span>
<span id="cb626-4"><a href="#cb626-4" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">table</span>(donnees_rbase<span class="sc">$</span>cspf, donnees_rbase<span class="sc">$</span>sexef, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>))</span>
<span id="cb626-5"><a href="#cb626-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions</span></span>
<span id="cb626-6"><a href="#cb626-6" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">table</span>(donnees_rbase<span class="sc">$</span>cspf, donnees_rbase<span class="sc">$</span>sexef, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span>
<span id="cb626-7"><a href="#cb626-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions par case</span></span>
<span id="cb626-8"><a href="#cb626-8" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb626-9"><a href="#cb626-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions par ligne</span></span>
<span id="cb626-10"><a href="#cb626-10" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab, <span class="at">margin =</span> <span class="dv">1</span>)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb626-11"><a href="#cb626-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions par colonne</span></span>
<span id="cb626-12"><a href="#cb626-12" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab, <span class="at">margin =</span> <span class="dv">2</span>)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb626-13"><a href="#cb626-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb626-14"><a href="#cb626-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution alternative, sans pondération</span></span>
<span id="cb626-15"><a href="#cb626-15" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="sc">~</span> cspf <span class="sc">+</span> sexef, <span class="at">data =</span> donnees_rbase)</span>
<span id="cb626-16"><a href="#cb626-16" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb626-17"><a href="#cb626-17" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab, <span class="at">margin =</span> <span class="dv">1</span>), <span class="at">margin =</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb626-18"><a href="#cb626-18" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab, <span class="at">margin =</span> <span class="dv">2</span>), <span class="at">margin =</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div>
</div>
</div>
<div id="tabset-149-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-149-3-tab">
<div class="cell">
<div class="sourceCode" id="cb627"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb627-1"><a href="#cb627-1" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : ajouter une ligne avec les sommes !</span></span>
<span id="cb627-2"><a href="#cb627-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau de fréquence</span></span>
<span id="cb627-3"><a href="#cb627-3" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb627-4"><a href="#cb627-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cspf, sexef) <span class="sc">%&gt;%</span> </span>
<span id="cb627-5"><a href="#cb627-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prop =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">&quot;drop_last&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb627-6"><a href="#cb627-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb627-7"><a href="#cb627-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> prop <span class="sc">/</span> <span class="fu">sum</span>(prop) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb627-8"><a href="#cb627-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(sexef, prop) <span class="sc">%&gt;%</span> </span>
<span id="cb627-9"><a href="#cb627-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Total =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb627-10"><a href="#cb627-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb627-11"><a href="#cb627-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions par ligne</span></span>
<span id="cb627-12"><a href="#cb627-12" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb627-13"><a href="#cb627-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cspf, sexef) <span class="sc">%&gt;%</span> </span>
<span id="cb627-14"><a href="#cb627-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prop =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb627-15"><a href="#cb627-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> prop <span class="sc">/</span> <span class="fu">sum</span>(prop) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb627-16"><a href="#cb627-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(sexef, prop)</span>
<span id="cb627-17"><a href="#cb627-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb627-18"><a href="#cb627-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions par colonne</span></span>
<span id="cb627-19"><a href="#cb627-19" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb627-20"><a href="#cb627-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sexef, cspf) <span class="sc">%&gt;%</span> </span>
<span id="cb627-21"><a href="#cb627-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prop =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb627-22"><a href="#cb627-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> prop <span class="sc">/</span> <span class="fu">sum</span>(prop) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb627-23"><a href="#cb627-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(sexef, prop)</span>
<span id="cb627-24"><a href="#cb627-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb627-25"><a href="#cb627-25" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb627-26"><a href="#cb627-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cspf, sexef, <span class="at">wt =</span> poids_sondage, <span class="at">name =</span> <span class="st">&quot;prop&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb627-27"><a href="#cb627-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb627-28"><a href="#cb627-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> prop <span class="sc">/</span> <span class="fu">sum</span>(prop) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb627-29"><a href="#cb627-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># À FAIRE : pourrait-on sommer directement avec pivot_wider ? Argument values_fn?</span></span>
<span id="cb627-30"><a href="#cb627-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ne semble pas fonctionner, pourqoi ???</span></span>
<span id="cb627-31"><a href="#cb627-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> sexef, <span class="at">values_from =</span> prop) <span class="sc">%&gt;%</span> </span>
<span id="cb627-32"><a href="#cb627-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Somme par ligne</span></span>
<span id="cb627-33"><a href="#cb627-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Total =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb627-34"><a href="#cb627-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution avec rowwise : bien penser à c_across et non across !</span></span>
<span id="cb627-35"><a href="#cb627-35" aria-hidden="true" tabindex="-1"></a><span class="co">#rowwise() %&gt;% </span></span>
<span id="cb627-36"><a href="#cb627-36" aria-hidden="true" tabindex="-1"></a><span class="co">#mutate(Total = sum(c_across(where(is.numeric)), na.rm = T)) %&gt;% </span></span>
<span id="cb627-37"><a href="#cb627-37" aria-hidden="true" tabindex="-1"></a><span class="co">#ungroup()</span></span>
<span id="cb627-38"><a href="#cb627-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Somme par colonne</span></span>
<span id="cb627-39"><a href="#cb627-39" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(tab, tab <span class="sc">%&gt;%</span> </span>
<span id="cb627-40"><a href="#cb627-40" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), \(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb627-41"><a href="#cb627-41" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">across</span>(<span class="fu">where</span>(is.character), <span class="sc">~</span><span class="st">&quot;Total&quot;</span>))</span>
<span id="cb627-42"><a href="#cb627-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb627-43"><a href="#cb627-43" aria-hidden="true" tabindex="-1"></a>tab</span></code></pre></div>
</div>
</div>
<div id="tabset-149-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-149-4-tab">
<div class="cell">
<div class="sourceCode" id="cb628"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb628-1"><a href="#cb628-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau simple</span></span>
<span id="cb628-2"><a href="#cb628-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">table</span>(cspf, sexef, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>) ]</span>
<span id="cb628-3"><a href="#cb628-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau avec les sommes</span></span>
<span id="cb628-4"><a href="#cb628-4" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">addmargins</span>(<span class="fu">table</span>(cspf, sexef, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)) ]</span>
<span id="cb628-5"><a href="#cb628-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions</span></span>
<span id="cb628-6"><a href="#cb628-6" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">table</span>(cspf, sexef, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>) ]</span>
<span id="cb628-7"><a href="#cb628-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions par case</span></span>
<span id="cb628-8"><a href="#cb628-8" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb628-9"><a href="#cb628-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions par ligne</span></span>
<span id="cb628-10"><a href="#cb628-10" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab, <span class="at">margin =</span> <span class="dv">1</span>)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb628-11"><a href="#cb628-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions par colonne</span></span>
<span id="cb628-12"><a href="#cb628-12" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab, <span class="at">margin =</span> <span class="dv">2</span>)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb628-13"><a href="#cb628-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb628-14"><a href="#cb628-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution alternative, sans pondération</span></span>
<span id="cb628-15"><a href="#cb628-15" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">xtabs</span>(<span class="sc">~</span> cspf <span class="sc">+</span> sexef, <span class="at">data =</span> donnees_datatable) ]</span>
<span id="cb628-16"><a href="#cb628-16" aria-hidden="true" tabindex="-1"></a>tab</span>
<span id="cb628-17"><a href="#cb628-17" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb628-18"><a href="#cb628-18" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab, <span class="at">margin =</span> <span class="dv">1</span>), <span class="at">margin =</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb628-19"><a href="#cb628-19" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab, <span class="at">margin =</span> <span class="dv">2</span>), <span class="at">margin =</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb628-20"><a href="#cb628-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb628-21"><a href="#cb628-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution, avec les Grouping sets</span></span>
<span id="cb628-22"><a href="#cb628-22" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">cube</span>(donnees_datatable, .(<span class="at">Nb =</span> .N), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>))</span>
<span id="cb628-23"><a href="#cb628-23" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">dcast</span>(tab, cspf <span class="sc">~</span> sexef, <span class="at">value.var =</span> <span class="st">&quot;Nb&quot;</span>)</span>
<span id="cb628-24"><a href="#cb628-24" aria-hidden="true" tabindex="-1"></a><span class="co"># On harmonise le tableau</span></span>
<span id="cb628-25"><a href="#cb628-25" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">rbind</span>(tab[<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(tab)], tab[<span class="dv">1</span>,])</span>
<span id="cb628-26"><a href="#cb628-26" aria-hidden="true" tabindex="-1"></a><span class="fu">setcolorder</span>(tab, <span class="fu">c</span>(<span class="fu">setdiff</span>(<span class="fu">names</span>(tab), <span class="st">&quot;NA&quot;</span>), <span class="st">&quot;NA&quot;</span>))</span>
<span id="cb628-27"><a href="#cb628-27" aria-hidden="true" tabindex="-1"></a><span class="co"># On renomme la ligne et la colonne des totaux</span></span>
<span id="cb628-28"><a href="#cb628-28" aria-hidden="true" tabindex="-1"></a>tab[<span class="fu">nrow</span>(tab), <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Total&quot;</span></span>
<span id="cb628-29"><a href="#cb628-29" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(tab)[<span class="fu">which</span>(<span class="fu">names</span>(tab) <span class="sc">==</span> <span class="st">&quot;NA&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;Total&quot;</span></span>
<span id="cb628-30"><a href="#cb628-30" aria-hidden="true" tabindex="-1"></a>tab</span>
<span id="cb628-31"><a href="#cb628-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb628-32"><a href="#cb628-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre façon d&#39;utiliser les méthodes de data.table</span></span>
<span id="cb628-33"><a href="#cb628-33" aria-hidden="true" tabindex="-1"></a>tab_prop <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">dcast</span>(donnees_datatable, cspf <span class="sc">~</span> sexef, <span class="at">fun.aggregate =</span> length)</span>
<span id="cb628-34"><a href="#cb628-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion par ligne</span></span>
<span id="cb628-35"><a href="#cb628-35" aria-hidden="true" tabindex="-1"></a>tab_prop[, .SD <span class="sc">/</span> <span class="fu">Reduce</span>(<span class="st">`</span><span class="at">+</span><span class="st">`</span>, .SD), cspf]</span>
<span id="cb628-36"><a href="#cb628-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion par colonne</span></span>
<span id="cb628-37"><a href="#cb628-37" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">unique</span>(donnees_datatable[, (sexef)])</span>
<span id="cb628-38"><a href="#cb628-38" aria-hidden="true" tabindex="-1"></a>tab_prop[, (<span class="fu">lapply</span>(.SD, <span class="cf">function</span>(col) col <span class="sc">/</span> <span class="fu">sum</span>(col))), .SDcols <span class="ot">=</span> cols]</span>
<span id="cb628-39"><a href="#cb628-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb628-40"><a href="#cb628-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour avoir les sommes lignes</span></span>
<span id="cb628-41"><a href="#cb628-41" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : ne marche pas, à revoir !</span></span>
<span id="cb628-42"><a href="#cb628-42" aria-hidden="true" tabindex="-1"></a><span class="co">#tab_prop &lt;- data.table::dcast(donnees_datatable, cspf ~ sexef, fun.aggregate = length)</span></span>
<span id="cb628-43"><a href="#cb628-43" aria-hidden="true" tabindex="-1"></a><span class="co">#tab_prop[, Total := rowSums(.SD), .SDcols = is.numeric]</span></span>
<span id="cb628-44"><a href="#cb628-44" aria-hidden="true" tabindex="-1"></a><span class="co">#tab_prop &lt;- rbind(tab_prop, tab_prop[, c(cspf = &quot;Total&quot;, lapply(.SD, sum, na.rm = TRUE)),</span></span>
<span id="cb628-45"><a href="#cb628-45" aria-hidden="true" tabindex="-1"></a><span class="co">#                                     .SDcols = is.numeric],</span></span>
<span id="cb628-46"><a href="#cb628-46" aria-hidden="true" tabindex="-1"></a><span class="co">#                  fill = TRUE)</span></span>
<span id="cb628-47"><a href="#cb628-47" aria-hidden="true" tabindex="-1"></a><span class="co">#tab_prop[, (lapply(.SD, function(col) col / sum(col))), .SDcols = -1]</span></span>
<span id="cb628-48"><a href="#cb628-48" aria-hidden="true" tabindex="-1"></a><span class="do">## Pour avoir les sommes colonnes</span></span>
<span id="cb628-49"><a href="#cb628-49" aria-hidden="true" tabindex="-1"></a><span class="co">#tab[, sum(.SD), by = 1:nrow(tab), .SDcols = is.numeric]</span></span>
<span id="cb628-50"><a href="#cb628-50" aria-hidden="true" tabindex="-1"></a><span class="co">#tab[, (lapply(.SD, function(col) col / sum(col))), .SDcols = -1]</span></span>
<span id="cb628-51"><a href="#cb628-51" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb628-52"><a href="#cb628-52" aria-hidden="true" tabindex="-1"></a><span class="do">## Autre solution plus pratique avec data.table</span></span>
<span id="cb628-53"><a href="#cb628-53" aria-hidden="true" tabindex="-1"></a><span class="do">## Manipuler des formules sur R</span></span>
<span id="cb628-54"><a href="#cb628-54" aria-hidden="true" tabindex="-1"></a><span class="co">#variable &lt;- c(&quot;cspf&quot;, &quot;sexef&quot;)</span></span>
<span id="cb628-55"><a href="#cb628-55" aria-hidden="true" tabindex="-1"></a><span class="co">#formule &lt;- as.formula(paste(paste(variable, collapse = &quot; + &quot;), &quot;.&quot;, sep = &quot; ~ &quot;))</span></span>
<span id="cb628-56"><a href="#cb628-56" aria-hidden="true" tabindex="-1"></a><span class="co">#tab_prop &lt;- data.table::dcast(donnees_datatable, formule, fun.aggregate = length)</span></span>
<span id="cb628-57"><a href="#cb628-57" aria-hidden="true" tabindex="-1"></a><span class="co">#colnames(tab_prop)[colnames(tab_prop) == &quot;.&quot;] &lt;- &quot;total&quot;</span></span>
<span id="cb628-58"><a href="#cb628-58" aria-hidden="true" tabindex="-1"></a><span class="co">#tab_prop[, prop := total / sum(total)]</span></span>
<span id="cb628-59"><a href="#cb628-59" aria-hidden="true" tabindex="-1"></a><span class="do">## Le tableau est remis sous forme croisée</span></span>
<span id="cb628-60"><a href="#cb628-60" aria-hidden="true" tabindex="-1"></a><span class="co">#tab_prop &lt;- dcast(tab_prop, cspf ~ sexef, value.var = c(&quot;prop&quot;), fill = 0)</span></span></code></pre></div>
</div>
</div>
<div id="tabset-149-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-149-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="tableau-de-contingence-avec-pondération" class="level2" data-number="21.2">
<h2 data-number="21.2"><span class="header-section-number">21.2</span> Tableau de contingence avec pondération</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-150-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-150-1" role="tab" aria-controls="tabset-150-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-150-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-150-2" role="tab" aria-controls="tabset-150-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-150-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-150-3" role="tab" aria-controls="tabset-150-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-150-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-150-4" role="tab" aria-controls="tabset-150-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-150-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-150-5" role="tab" aria-controls="tabset-150-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-150-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-150-1-tab">
<div class="sourceCode" id="cb629"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb629-1"><a href="#cb629-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb629-2"><a href="#cb629-2" aria-hidden="true" tabindex="-1"></a>  tables Sexe * CSP / missing;</span>
<span id="cb629-3"><a href="#cb629-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb629-4"><a href="#cb629-4" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb629-5"><a href="#cb629-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-150-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-150-2-tab">
<div class="cell">
<div class="sourceCode" id="cb630"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb630-1"><a href="#cb630-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(poids_sondage <span class="sc">~</span> cspf <span class="sc">+</span> sexef, <span class="at">data =</span> donnees_rbase, <span class="at">addNA =</span> <span class="cn">TRUE</span>)</span>
<span id="cb630-2"><a href="#cb630-2" aria-hidden="true" tabindex="-1"></a>tab</span>
<span id="cb630-3"><a href="#cb630-3" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb630-4"><a href="#cb630-4" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab, <span class="at">margin =</span> <span class="dv">1</span>), <span class="at">margin =</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb630-5"><a href="#cb630-5" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab, <span class="at">margin =</span> <span class="dv">2</span>), <span class="at">margin =</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div>
</div>
</div>
<div id="tabset-150-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-150-3-tab">
<div class="cell">
<div class="sourceCode" id="cb631"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb631-1"><a href="#cb631-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec la fonction count</span></span>
<span id="cb631-2"><a href="#cb631-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb631-3"><a href="#cb631-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cspf, sexef, <span class="at">wt =</span> poids_sondage, <span class="at">name =</span> <span class="st">&quot;prop&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb631-4"><a href="#cb631-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb631-5"><a href="#cb631-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> prop <span class="sc">/</span> <span class="fu">sum</span>(prop) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb631-6"><a href="#cb631-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(sexef, prop)</span>
<span id="cb631-7"><a href="#cb631-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb631-8"><a href="#cb631-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec la fonction summarise</span></span>
<span id="cb631-9"><a href="#cb631-9" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb631-10"><a href="#cb631-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cspf, sexef) <span class="sc">%&gt;%</span> </span>
<span id="cb631-11"><a href="#cb631-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prop =</span> <span class="fu">sum</span>(poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb631-12"><a href="#cb631-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb631-13"><a href="#cb631-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> prop <span class="sc">/</span> <span class="fu">sum</span>(prop) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb631-14"><a href="#cb631-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(sexef, prop)</span>
<span id="cb631-15"><a href="#cb631-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb631-16"><a href="#cb631-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec ajout des sommes par ligne et colonne</span></span>
<span id="cb631-17"><a href="#cb631-17" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb631-18"><a href="#cb631-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cspf, sexef, <span class="at">wt =</span> poids_sondage, <span class="at">name =</span> <span class="st">&quot;prop&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb631-19"><a href="#cb631-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb631-20"><a href="#cb631-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> prop <span class="sc">/</span> <span class="fu">sum</span>(prop) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb631-21"><a href="#cb631-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># À FAIRE : pourrait-on sommer directement avec pivot_wider ? Argument values_fn?</span></span>
<span id="cb631-22"><a href="#cb631-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ne semble pas fonctionner, pourqoi ???</span></span>
<span id="cb631-23"><a href="#cb631-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> sexef, <span class="at">values_from =</span> prop) <span class="sc">%&gt;%</span> </span>
<span id="cb631-24"><a href="#cb631-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Somme par ligne</span></span>
<span id="cb631-25"><a href="#cb631-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Total =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb631-26"><a href="#cb631-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Autre solution avec rowwise : bien penser à c_across et non across !</span></span>
<span id="cb631-27"><a href="#cb631-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#rowwise() %&gt;% </span></span>
<span id="cb631-28"><a href="#cb631-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(Total = sum(c_across(where(is.numeric)), na.rm = T)) %&gt;% </span></span>
<span id="cb631-29"><a href="#cb631-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ungroup()</span></span>
<span id="cb631-30"><a href="#cb631-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Somme par colonne</span></span>
<span id="cb631-31"><a href="#cb631-31" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(tab, tab <span class="sc">%&gt;%</span> </span>
<span id="cb631-32"><a href="#cb631-32" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb631-33"><a href="#cb631-33" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">across</span>(<span class="fu">where</span>(is.character), <span class="sc">~</span><span class="st">&quot;Total&quot;</span>))</span>
<span id="cb631-34"><a href="#cb631-34" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb631-35"><a href="#cb631-35" aria-hidden="true" tabindex="-1"></a>tab</span></code></pre></div>
</div>
</div>
<div id="tabset-150-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-150-4-tab">
<div class="cell">
<div class="sourceCode" id="cb632"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb632-1"><a href="#cb632-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">xtabs</span>(poids_sondage <span class="sc">~</span> cspf <span class="sc">+</span> sexef, <span class="at">data =</span> donnees_datatable, <span class="at">addNA =</span> <span class="cn">TRUE</span>) ]</span>
<span id="cb632-2"><a href="#cb632-2" aria-hidden="true" tabindex="-1"></a>tab</span>
<span id="cb632-3"><a href="#cb632-3" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb632-4"><a href="#cb632-4" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab, <span class="at">margin =</span> <span class="dv">1</span>), <span class="at">margin =</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb632-5"><a href="#cb632-5" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab, <span class="at">margin =</span> <span class="dv">2</span>), <span class="at">margin =</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div>
</div>
</div>
<div id="tabset-150-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-150-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="copier-coller-le-tableau-dans-un-tableur-excel-etc." class="level2" data-number="21.3">
<h2 data-number="21.3"><span class="header-section-number">21.3</span> Copier-coller le tableau dans un tableur (Excel, etc.)</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-151-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-151-1" role="tab" aria-controls="tabset-151-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-151-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-151-2" role="tab" aria-controls="tabset-151-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-151-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-151-3" role="tab" aria-controls="tabset-151-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-151-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-151-4" role="tab" aria-controls="tabset-151-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-151-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-151-5" role="tab" aria-controls="tabset-151-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-151-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-151-1-tab">
<div class="sourceCode" id="cb633"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb633-1"><a href="#cb633-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Copier-coller le résultat sur la fenêtre html &quot;Results Viewer&quot; */</span></span>
<span id="cb633-2"><a href="#cb633-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb633-3"><a href="#cb633-3" aria-hidden="true" tabindex="-1"></a>  tables Sexe * CSP / missing chisq;</span>
<span id="cb633-4"><a href="#cb633-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb633-5"><a href="#cb633-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-151-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-151-2-tab">
<div class="cell">
<div class="sourceCode" id="cb634"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb634-1"><a href="#cb634-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On utilise les packages knitr et kableExtra</span></span>
<span id="cb634-2"><a href="#cb634-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb634-3"><a href="#cb634-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb634-4"><a href="#cb634-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-5"><a href="#cb634-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Création d&#39;un tableau</span></span>
<span id="cb634-6"><a href="#cb634-6" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="sc">~</span> cspf <span class="sc">+</span> sexef, <span class="at">data =</span> donnees_rbase)</span>
<span id="cb634-7"><a href="#cb634-7" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb634-8"><a href="#cb634-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-9"><a href="#cb634-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher de façon plus jolie un tableau</span></span>
<span id="cb634-10"><a href="#cb634-10" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(tab)</span>
<span id="cb634-11"><a href="#cb634-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-12"><a href="#cb634-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Copier-coller le résultat vers Excel</span></span>
<span id="cb634-13"><a href="#cb634-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Il suffit d&#39;appliquer ce code ....</span></span>
<span id="cb634-14"><a href="#cb634-14" aria-hidden="true" tabindex="-1"></a>kableExtra<span class="sc">::</span><span class="fu">kable_paper</span>(kableExtra<span class="sc">::</span><span class="fu">kbl</span>(tab), <span class="st">&quot;hover&quot;</span>, <span class="at">full_width =</span> F)</span>
<span id="cb634-15"><a href="#cb634-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ... et de copier-coller le résultat de la fenêtre Viewer vers Excel</span></span></code></pre></div>
</div>
</div>
<div id="tabset-151-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-151-3-tab">
<div class="cell">
<div class="sourceCode" id="cb635"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb635-1"><a href="#cb635-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On utilise les packages knitr et kableExtra</span></span>
<span id="cb635-2"><a href="#cb635-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb635-3"><a href="#cb635-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb635-4"><a href="#cb635-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-5"><a href="#cb635-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Création d&#39;un tableau</span></span>
<span id="cb635-6"><a href="#cb635-6" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb635-7"><a href="#cb635-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cspf, sexef) <span class="sc">%&gt;%</span> </span>
<span id="cb635-8"><a href="#cb635-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prop =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">&quot;drop_last&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb635-9"><a href="#cb635-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb635-10"><a href="#cb635-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> prop <span class="sc">/</span> <span class="fu">sum</span>(prop) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb635-11"><a href="#cb635-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(sexef, prop)</span>
<span id="cb635-12"><a href="#cb635-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-13"><a href="#cb635-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher de façon plus jolie un tableau</span></span>
<span id="cb635-14"><a href="#cb635-14" aria-hidden="true" tabindex="-1"></a>tab <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb635-15"><a href="#cb635-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-16"><a href="#cb635-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Copier-coller le résultat vers Excel</span></span>
<span id="cb635-17"><a href="#cb635-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Il suffit d&#39;appliquer ce code ....</span></span>
<span id="cb635-18"><a href="#cb635-18" aria-hidden="true" tabindex="-1"></a>tab <span class="sc">%&gt;%</span> </span>
<span id="cb635-19"><a href="#cb635-19" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb635-20"><a href="#cb635-20" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_paper</span>(<span class="st">&quot;hover&quot;</span>, <span class="at">full_width =</span> F)</span>
<span id="cb635-21"><a href="#cb635-21" aria-hidden="true" tabindex="-1"></a><span class="co"># ... et de copier-coller le résultat de la fenêtre Viewer vers Excel</span></span></code></pre></div>
</div>
</div>
<div id="tabset-151-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-151-4-tab">
<div class="cell">
<div class="sourceCode" id="cb636"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb636-1"><a href="#cb636-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On utilise les packages knitr et kableExtra</span></span>
<span id="cb636-2"><a href="#cb636-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb636-3"><a href="#cb636-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb636-4"><a href="#cb636-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb636-5"><a href="#cb636-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Création d&#39;un tableau</span></span>
<span id="cb636-6"><a href="#cb636-6" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">xtabs</span>(poids_sondage <span class="sc">~</span> cspf <span class="sc">+</span> sexef, <span class="at">data =</span> donnees_datatable, <span class="at">addNA =</span> <span class="cn">TRUE</span>) ]</span>
<span id="cb636-7"><a href="#cb636-7" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> </span>
<span id="cb636-8"><a href="#cb636-8" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(tab)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb636-9"><a href="#cb636-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb636-10"><a href="#cb636-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher de façon plus jolie un tableau</span></span>
<span id="cb636-11"><a href="#cb636-11" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(tab)</span>
<span id="cb636-12"><a href="#cb636-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb636-13"><a href="#cb636-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Copier-coller le résultat vers Excel</span></span>
<span id="cb636-14"><a href="#cb636-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Il suffit d&#39;appliquer ce code ....</span></span>
<span id="cb636-15"><a href="#cb636-15" aria-hidden="true" tabindex="-1"></a>kableExtra<span class="sc">::</span><span class="fu">kable_paper</span>(kableExtra<span class="sc">::</span><span class="fu">kbl</span>(tab), <span class="st">&quot;hover&quot;</span>, <span class="at">full_width =</span> F)</span>
<span id="cb636-16"><a href="#cb636-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ... et de copier-coller le résultat de la fenêtre Viewer vers Excel</span></span></code></pre></div>
</div>
</div>
<div id="tabset-151-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-151-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="tests-dassociaton-chi-deux-etc." class="level2" data-number="21.4">
<h2 data-number="21.4"><span class="header-section-number">21.4</span> Tests d’associaton (Chi-Deux, etc.)</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-152-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-152-1" role="tab" aria-controls="tabset-152-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-152-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-152-2" role="tab" aria-controls="tabset-152-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-152-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-152-3" role="tab" aria-controls="tabset-152-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-152-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-152-4" role="tab" aria-controls="tabset-152-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-152-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-152-5" role="tab" aria-controls="tabset-152-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-152-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-152-1-tab">
<div class="sourceCode" id="cb637"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb637-1"><a href="#cb637-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb637-2"><a href="#cb637-2" aria-hidden="true" tabindex="-1"></a>  tables Sexe * CSP / missing chisq;</span>
<span id="cb637-3"><a href="#cb637-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb637-4"><a href="#cb637-4" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-152-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-152-2-tab">
<div class="cell">
<div class="sourceCode" id="cb638"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb638-1"><a href="#cb638-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test du Khi-Deux</span></span>
<span id="cb638-2"><a href="#cb638-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_rbase, <span class="fu">chisq.test</span>(cspf, sexef))</span>
<span id="cb638-3"><a href="#cb638-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">table</span>(donnees_rbase<span class="sc">$</span>cspf, donnees_rbase<span class="sc">$</span>sexef))</span></code></pre></div>
</div>
</div>
<div id="tabset-152-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-152-3-tab">
<div class="cell">
<div class="sourceCode" id="cb639"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb639-1"><a href="#cb639-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test du Khi-Deux</span></span>
<span id="cb639-2"><a href="#cb639-2" aria-hidden="true" tabindex="-1"></a><span class="co">#donnees_tidyverse %&gt;%</span></span>
<span id="cb639-3"><a href="#cb639-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  summarise(a = chisq.test(sexef, cspf))</span></span>
<span id="cb639-4"><a href="#cb639-4" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : fonctionne, mais pas vraiment Tidyverse</span></span>
<span id="cb639-5"><a href="#cb639-5" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_tidyverse, <span class="fu">chisq.test</span>(cspf, sexef))</span></code></pre></div>
</div>
</div>
<div id="tabset-152-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-152-4-tab">
<div class="cell">
<div class="sourceCode" id="cb640"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb640-1"><a href="#cb640-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test du Khi-Deux</span></span>
<span id="cb640-2"><a href="#cb640-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">chisq.test</span>(cspf, sexef)]</span></code></pre></div>
</div>
</div>
<div id="tabset-152-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-152-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="solutions-avec-package-r-permettant-de-pondérer" class="level2" data-number="21.5">
<h2 data-number="21.5"><span class="header-section-number">21.5</span> Solutions avec package <code>R</code> permettant de pondérer</h2>
<p>Autre possibilité, avec package <code>R</code>, pour avoir la même présentation que la proc freq de <code>SAS</code>.</p>
<p>5 packages paraissent pertinents : descr, flextable, questionr, survey, procs.</p>
<p>Des informations sur l’usage des packages en <code>R</code> sont disponibles sur le site Utilit’R : <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_comment_choisir_un_package.html" class="uri">https://book.utilitr.org/03_Fiches_thematiques/Fiche_comment_choisir_un_package.html</a>.</p>
<section id="package-descr" class="level3" data-number="21.5.1">
<h3 data-number="21.5.1"><span class="header-section-number">21.5.1</span> Package descr</h3>
<p>Lien vers la documentation : <a href="https://cran.r-project.org/web/packages/descr/descr.pdf" class="uri">https://cran.r-project.org/web/packages/descr/descr.pdf</a>.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-153-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-153-1" role="tab" aria-controls="tabset-153-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-153-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-153-2" role="tab" aria-controls="tabset-153-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-153-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-153-3" role="tab" aria-controls="tabset-153-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-153-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-153-4" role="tab" aria-controls="tabset-153-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-153-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-153-5" role="tab" aria-controls="tabset-153-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-153-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-153-1-tab">
<div class="sourceCode" id="cb641"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb641-1"><a href="#cb641-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Sans objet pour SAS */</span></span>
<span id="cb641-2"><a href="#cb641-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb641-3"><a href="#cb641-3" aria-hidden="true" tabindex="-1"></a>  tables Sexe * CSP / missing;</span>
<span id="cb641-4"><a href="#cb641-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb641-5"><a href="#cb641-5" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb641-6"><a href="#cb641-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-153-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-153-2-tab">
<div class="cell">
<div class="sourceCode" id="cb642"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb642-1"><a href="#cb642-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(descr)</span>
<span id="cb642-2"><a href="#cb642-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Non pondéré</span></span>
<span id="cb642-3"><a href="#cb642-3" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_rbase, descr<span class="sc">::</span><span class="fu">crosstab</span>(cspf, sexef,                         <span class="at">prop.r =</span> <span class="cn">TRUE</span>, <span class="at">prop.c =</span> <span class="cn">TRUE</span>, <span class="at">prop.t =</span> <span class="cn">TRUE</span>))</span>
<span id="cb642-4"><a href="#cb642-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pondéré</span></span>
<span id="cb642-5"><a href="#cb642-5" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_rbase, descr<span class="sc">::</span><span class="fu">crosstab</span>(cspf, sexef, <span class="at">weight =</span> poids_sondage, <span class="at">prop.r =</span> <span class="cn">TRUE</span>, <span class="at">prop.c =</span> <span class="cn">TRUE</span>, <span class="at">prop.t =</span> <span class="cn">TRUE</span>))</span>
<span id="cb642-6"><a href="#cb642-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans les proportions par ligne et colonne</span></span>
<span id="cb642-7"><a href="#cb642-7" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_rbase, descr<span class="sc">::</span><span class="fu">crosstab</span>(cspf, sexef, <span class="at">weight =</span> poids_sondage, <span class="at">prop.r =</span> <span class="cn">FALSE</span>, <span class="at">prop.c =</span> <span class="cn">FALSE</span>, <span class="at">prop.t =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-153-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-153-3-tab">
<div class="cell">
<div class="sourceCode" id="cb643"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb643-1"><a href="#cb643-1" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : est-il possible d&#39;appliquer le pipe ???</span></span>
<span id="cb643-2"><a href="#cb643-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(descr)</span>
<span id="cb643-3"><a href="#cb643-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Non pondéré</span></span>
<span id="cb643-4"><a href="#cb643-4" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_tidyverse, descr<span class="sc">::</span><span class="fu">crosstab</span>(cspf, sexef,                         <span class="at">prop.r =</span> <span class="cn">TRUE</span>, <span class="at">prop.c =</span> <span class="cn">TRUE</span>, <span class="at">prop.t =</span> <span class="cn">TRUE</span>))</span>
<span id="cb643-5"><a href="#cb643-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Pondéré</span></span>
<span id="cb643-6"><a href="#cb643-6" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_tidyverse, descr<span class="sc">::</span><span class="fu">crosstab</span>(cspf, sexef, <span class="at">weight =</span> poids_sondage, <span class="at">prop.r =</span> <span class="cn">TRUE</span>, <span class="at">prop.c =</span> <span class="cn">TRUE</span>, <span class="at">prop.t =</span> <span class="cn">TRUE</span>))</span>
<span id="cb643-7"><a href="#cb643-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans les proportions par ligne et colonne</span></span>
<span id="cb643-8"><a href="#cb643-8" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_tidyverse, descr<span class="sc">::</span><span class="fu">crosstab</span>(cspf, sexef, <span class="at">weight =</span> poids_sondage, <span class="at">prop.r =</span> <span class="cn">FALSE</span>, <span class="at">prop.c =</span> <span class="cn">FALSE</span>, <span class="at">prop.t =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-153-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-153-4-tab">
<div class="cell">
<div class="sourceCode" id="cb644"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb644-1"><a href="#cb644-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(descr)</span>
<span id="cb644-2"><a href="#cb644-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Non pondéré</span></span>
<span id="cb644-3"><a href="#cb644-3" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_datatable, descr<span class="sc">::</span><span class="fu">crosstab</span>(cspf, sexef,                         <span class="at">prop.r =</span> <span class="cn">TRUE</span>, <span class="at">prop.c =</span> <span class="cn">TRUE</span>, <span class="at">prop.t =</span> <span class="cn">TRUE</span>))</span>
<span id="cb644-4"><a href="#cb644-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pondéré</span></span>
<span id="cb644-5"><a href="#cb644-5" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_datatable, descr<span class="sc">::</span><span class="fu">crosstab</span>(cspf, sexef, <span class="at">weight =</span> poids_sondage, <span class="at">prop.r =</span> <span class="cn">TRUE</span>, <span class="at">prop.c =</span> <span class="cn">TRUE</span>, <span class="at">prop.t =</span> <span class="cn">TRUE</span>))</span>
<span id="cb644-6"><a href="#cb644-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans les proportions par ligne et colonne</span></span>
<span id="cb644-7"><a href="#cb644-7" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_datatable, descr<span class="sc">::</span><span class="fu">crosstab</span>(cspf, sexef, <span class="at">weight =</span> poids_sondage, <span class="at">prop.r =</span> <span class="cn">FALSE</span>, <span class="at">prop.c =</span> <span class="cn">FALSE</span>, <span class="at">prop.t =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-153-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-153-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="package-flextable" class="level3" data-number="21.5.2">
<h3 data-number="21.5.2"><span class="header-section-number">21.5.2</span> Package flextable</h3>
<p>Lien vers la documentation :</p>
<ul>
<li><a href="https://cran.r-project.org/web/packages/descr/descr.pdf" class="uri">https://cran.r-project.org/web/packages/descr/descr.pdf</a></li>
<li><a href="https://cran.r-project.org/web/packages/flextable/flextable.pdf" class="uri">https://cran.r-project.org/web/packages/flextable/flextable.pdf</a></li>
</ul>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-154-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-154-1" role="tab" aria-controls="tabset-154-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-154-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-154-2" role="tab" aria-controls="tabset-154-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-154-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-154-3" role="tab" aria-controls="tabset-154-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-154-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-154-4" role="tab" aria-controls="tabset-154-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-154-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-154-5" role="tab" aria-controls="tabset-154-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-154-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-154-1-tab">
<div class="sourceCode" id="cb645"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb645-1"><a href="#cb645-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Sans objet pour SAS */</span></span>
<span id="cb645-2"><a href="#cb645-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb645-3"><a href="#cb645-3" aria-hidden="true" tabindex="-1"></a>  tables Sexe * CSP / missing;</span>
<span id="cb645-4"><a href="#cb645-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb645-5"><a href="#cb645-5" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb645-6"><a href="#cb645-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-154-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-154-2-tab">
<div class="cell">
<div class="sourceCode" id="cb646"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb646-1"><a href="#cb646-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb646-2"><a href="#cb646-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Non pondéré</span></span>
<span id="cb646-3"><a href="#cb646-3" aria-hidden="true" tabindex="-1"></a>flextable<span class="sc">::</span><span class="fu">proc_freq</span>(donnees_rbase, <span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>)</span>
<span id="cb646-4"><a href="#cb646-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pondéré</span></span>
<span id="cb646-5"><a href="#cb646-5" aria-hidden="true" tabindex="-1"></a>flextable<span class="sc">::</span><span class="fu">proc_freq</span>(donnees_rbase, <span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>, <span class="at">weight =</span> <span class="st">&quot;poids_sondage&quot;</span>)</span>
<span id="cb646-6"><a href="#cb646-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans les proportions par ligne et colonne</span></span>
<span id="cb646-7"><a href="#cb646-7" aria-hidden="true" tabindex="-1"></a>flextable<span class="sc">::</span><span class="fu">proc_freq</span>(donnees_rbase, <span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>, <span class="at">weight =</span> <span class="st">&quot;poids_sondage&quot;</span>, <span class="at">include.row_percent =</span> <span class="cn">FALSE</span>,</span>
<span id="cb646-8"><a href="#cb646-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">include.column_percent =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-154-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-154-3-tab">
<div class="cell">
<div class="sourceCode" id="cb647"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb647-1"><a href="#cb647-1" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : est-il possible d&#39;appliquer le pipe ???</span></span>
<span id="cb647-2"><a href="#cb647-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb647-3"><a href="#cb647-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Non pondéré</span></span>
<span id="cb647-4"><a href="#cb647-4" aria-hidden="true" tabindex="-1"></a>flextable<span class="sc">::</span><span class="fu">proc_freq</span>(donnees_tidyverse, <span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>)</span>
<span id="cb647-5"><a href="#cb647-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Pondéré</span></span>
<span id="cb647-6"><a href="#cb647-6" aria-hidden="true" tabindex="-1"></a>flextable<span class="sc">::</span><span class="fu">proc_freq</span>(donnees_tidyverse, <span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>, <span class="at">weight =</span> <span class="st">&quot;poids_sondage&quot;</span>)</span>
<span id="cb647-7"><a href="#cb647-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans les proportions par ligne et colonne</span></span>
<span id="cb647-8"><a href="#cb647-8" aria-hidden="true" tabindex="-1"></a>flextable<span class="sc">::</span><span class="fu">proc_freq</span>(donnees_tidyverse, <span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>, <span class="at">weight =</span> <span class="st">&quot;poids_sondage&quot;</span>, <span class="at">include.row_percent =</span> <span class="cn">FALSE</span>,</span>
<span id="cb647-9"><a href="#cb647-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">include.column_percent =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-154-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-154-4-tab">
<div class="cell">
<div class="sourceCode" id="cb648"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb648-1"><a href="#cb648-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb648-2"><a href="#cb648-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Non pondéré</span></span>
<span id="cb648-3"><a href="#cb648-3" aria-hidden="true" tabindex="-1"></a>flextable<span class="sc">::</span><span class="fu">proc_freq</span>(donnees_datatable, <span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>)</span>
<span id="cb648-4"><a href="#cb648-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pondéré</span></span>
<span id="cb648-5"><a href="#cb648-5" aria-hidden="true" tabindex="-1"></a>flextable<span class="sc">::</span><span class="fu">proc_freq</span>(donnees_datatable, <span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>, <span class="at">weight =</span> <span class="st">&quot;poids_sondage&quot;</span>)</span>
<span id="cb648-6"><a href="#cb648-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans les proportions par ligne et colonne</span></span>
<span id="cb648-7"><a href="#cb648-7" aria-hidden="true" tabindex="-1"></a>flextable<span class="sc">::</span><span class="fu">proc_freq</span>(donnees_datatable, <span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>, <span class="at">weight =</span> <span class="st">&quot;poids_sondage&quot;</span>, <span class="at">include.row_percent =</span> <span class="cn">FALSE</span>,</span>
<span id="cb648-8"><a href="#cb648-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">include.column_percent =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-154-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-154-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="package-questionr" class="level3" data-number="21.5.3">
<h3 data-number="21.5.3"><span class="header-section-number">21.5.3</span> Package questionr</h3>
<p>Lien vers la documentation : <a href="https://cran.r-project.org/web/packages/questionr/questionr.pdf" class="uri">https://cran.r-project.org/web/packages/questionr/questionr.pdf</a>.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-155-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-155-1" role="tab" aria-controls="tabset-155-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-155-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-155-2" role="tab" aria-controls="tabset-155-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-155-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-155-3" role="tab" aria-controls="tabset-155-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-155-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-155-4" role="tab" aria-controls="tabset-155-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-155-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-155-5" role="tab" aria-controls="tabset-155-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-155-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-155-1-tab">
<div class="sourceCode" id="cb649"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb649-1"><a href="#cb649-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Sans objet pour SAS */</span></span>
<span id="cb649-2"><a href="#cb649-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb649-3"><a href="#cb649-3" aria-hidden="true" tabindex="-1"></a>  tables Sexe * CSP / missing;</span>
<span id="cb649-4"><a href="#cb649-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb649-5"><a href="#cb649-5" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb649-6"><a href="#cb649-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-155-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-155-2-tab">
<div class="cell">
<div class="sourceCode" id="cb650"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb650-1"><a href="#cb650-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans pondération</span></span>
<span id="cb650-2"><a href="#cb650-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(questionr)</span>
<span id="cb650-3"><a href="#cb650-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau croisé</span></span>
<span id="cb650-4"><a href="#cb650-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans pondération</span></span>
<span id="cb650-5"><a href="#cb650-5" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">with</span>(donnees_rbase, questionr<span class="sc">::</span><span class="fu">wtd.table</span>(cspf, sexef, <span class="at">useNA =</span> <span class="st">&quot;ifany&quot;</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb650-6"><a href="#cb650-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec pondération</span></span>
<span id="cb650-7"><a href="#cb650-7" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">with</span>(donnees_rbase, questionr<span class="sc">::</span><span class="fu">wtd.table</span>(cspf, sexef, <span class="at">weights =</span> poids_sondage, <span class="at">useNA =</span> <span class="st">&quot;ifany&quot;</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb650-8"><a href="#cb650-8" aria-hidden="true" tabindex="-1"></a>tab</span>
<span id="cb650-9"><a href="#cb650-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions</span></span>
<span id="cb650-10"><a href="#cb650-10" aria-hidden="true" tabindex="-1"></a>questionr<span class="sc">::</span><span class="fu">prop</span>(tab)</span>
<span id="cb650-11"><a href="#cb650-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions colonnes</span></span>
<span id="cb650-12"><a href="#cb650-12" aria-hidden="true" tabindex="-1"></a>questionr<span class="sc">::</span><span class="fu">cprop</span>(tab)</span>
<span id="cb650-13"><a href="#cb650-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions lignes</span></span>
<span id="cb650-14"><a href="#cb650-14" aria-hidden="true" tabindex="-1"></a>questionr<span class="sc">::</span><span class="fu">rprop</span>(tab)</span></code></pre></div>
</div>
</div>
<div id="tabset-155-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-155-3-tab">
<div class="cell">
<div class="sourceCode" id="cb651"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb651-1"><a href="#cb651-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans pondération</span></span>
<span id="cb651-2"><a href="#cb651-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(questionr)</span>
<span id="cb651-3"><a href="#cb651-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau croisé</span></span>
<span id="cb651-4"><a href="#cb651-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans pondération</span></span>
<span id="cb651-5"><a href="#cb651-5" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">with</span>(donnees_tidyverse, questionr<span class="sc">::</span><span class="fu">wtd.table</span>(cspf, sexef, <span class="at">useNA =</span> <span class="st">&quot;ifany&quot;</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb651-6"><a href="#cb651-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec pondération</span></span>
<span id="cb651-7"><a href="#cb651-7" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">with</span>(donnees_tidyverse, questionr<span class="sc">::</span><span class="fu">wtd.table</span>(cspf, sexef, <span class="at">weights =</span> poids_sondage, <span class="at">useNA =</span> <span class="st">&quot;ifany&quot;</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb651-8"><a href="#cb651-8" aria-hidden="true" tabindex="-1"></a>tab</span>
<span id="cb651-9"><a href="#cb651-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions</span></span>
<span id="cb651-10"><a href="#cb651-10" aria-hidden="true" tabindex="-1"></a>questionr<span class="sc">::</span><span class="fu">prop</span>(tab)</span>
<span id="cb651-11"><a href="#cb651-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions colonnes</span></span>
<span id="cb651-12"><a href="#cb651-12" aria-hidden="true" tabindex="-1"></a>questionr<span class="sc">::</span><span class="fu">cprop</span>(tab)</span>
<span id="cb651-13"><a href="#cb651-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions lignes</span></span>
<span id="cb651-14"><a href="#cb651-14" aria-hidden="true" tabindex="-1"></a>questionr<span class="sc">::</span><span class="fu">rprop</span>(tab)</span></code></pre></div>
</div>
</div>
<div id="tabset-155-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-155-4-tab">
<div class="cell">
<div class="sourceCode" id="cb652"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb652-1"><a href="#cb652-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans pondération</span></span>
<span id="cb652-2"><a href="#cb652-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(questionr)</span>
<span id="cb652-3"><a href="#cb652-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau croisé</span></span>
<span id="cb652-4"><a href="#cb652-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans pondération</span></span>
<span id="cb652-5"><a href="#cb652-5" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">with</span>(donnees_datatable, questionr<span class="sc">::</span><span class="fu">wtd.table</span>(cspf, sexef, <span class="at">useNA =</span> <span class="st">&quot;ifany&quot;</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb652-6"><a href="#cb652-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec pondération</span></span>
<span id="cb652-7"><a href="#cb652-7" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">with</span>(donnees_datatable, questionr<span class="sc">::</span><span class="fu">wtd.table</span>(cspf, sexef, <span class="at">weights =</span> poids_sondage, <span class="at">useNA =</span> <span class="st">&quot;ifany&quot;</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb652-8"><a href="#cb652-8" aria-hidden="true" tabindex="-1"></a>tab</span>
<span id="cb652-9"><a href="#cb652-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions</span></span>
<span id="cb652-10"><a href="#cb652-10" aria-hidden="true" tabindex="-1"></a>questionr<span class="sc">::</span><span class="fu">prop</span>(tab)</span>
<span id="cb652-11"><a href="#cb652-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions colonnes</span></span>
<span id="cb652-12"><a href="#cb652-12" aria-hidden="true" tabindex="-1"></a>questionr<span class="sc">::</span><span class="fu">cprop</span>(tab)</span>
<span id="cb652-13"><a href="#cb652-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions lignes</span></span>
<span id="cb652-14"><a href="#cb652-14" aria-hidden="true" tabindex="-1"></a>questionr<span class="sc">::</span><span class="fu">rprop</span>(tab)</span></code></pre></div>
</div>
</div>
<div id="tabset-155-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-155-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="package-survey" class="level3" data-number="21.5.4">
<h3 data-number="21.5.4"><span class="header-section-number">21.5.4</span> Package survey</h3>
<p>Lien vers la documentation : <a href="https://cran.r-project.org/web/packages/survey/survey.pdf" class="uri">https://cran.r-project.org/web/packages/survey/survey.pdf</a>.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-156-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-156-1" role="tab" aria-controls="tabset-156-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-156-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-156-2" role="tab" aria-controls="tabset-156-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-156-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-156-3" role="tab" aria-controls="tabset-156-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-156-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-156-4" role="tab" aria-controls="tabset-156-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-156-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-156-5" role="tab" aria-controls="tabset-156-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-156-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-156-1-tab">
<div class="sourceCode" id="cb653"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb653-1"><a href="#cb653-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Sans objet pour SAS */</span></span>
<span id="cb653-2"><a href="#cb653-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb653-3"><a href="#cb653-3" aria-hidden="true" tabindex="-1"></a>  tables Sexe * CSP / missing;</span>
<span id="cb653-4"><a href="#cb653-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb653-5"><a href="#cb653-5" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb653-6"><a href="#cb653-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-156-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-156-2-tab">
<div class="cell">
<div class="sourceCode" id="cb654"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb654-1"><a href="#cb654-1" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : ne fonctionne pas</span></span>
<span id="cb654-2"><a href="#cb654-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb654-3"><a href="#cb654-3" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">svydesign</span>(<span class="at">id =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">weights =</span> <span class="sc">~</span>poids_sondage, <span class="at">data =</span> donnees_rbase)</span>
<span id="cb654-4"><a href="#cb654-4" aria-hidden="true" tabindex="-1"></a>survey<span class="sc">::</span><span class="fu">svytable</span>(poids_sondage <span class="sc">~</span> sexef <span class="sc">+</span> cspf, <span class="at">design =</span> tab)</span></code></pre></div>
</div>
</div>
<div id="tabset-156-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-156-3-tab">
<div class="cell">
<div class="sourceCode" id="cb655"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb655-1"><a href="#cb655-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La syntaxe avec pipe n&#39;est pas compatible avec le package survey</span></span>
<span id="cb655-2"><a href="#cb655-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb655-3"><a href="#cb655-3" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">svydesign</span>(<span class="at">id =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">weights =</span> <span class="sc">~</span>poids_sondage, <span class="at">data =</span> donnees_tidyverse)</span>
<span id="cb655-4"><a href="#cb655-4" aria-hidden="true" tabindex="-1"></a>survey<span class="sc">::</span><span class="fu">svytable</span>(poids_sondage <span class="sc">~</span> sexef <span class="sc">+</span> cspf, <span class="at">design =</span> tab)</span></code></pre></div>
</div>
</div>
<div id="tabset-156-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-156-4-tab">
<div class="cell">
<div class="sourceCode" id="cb656"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb656-1"><a href="#cb656-1" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : ne fonctionne pas</span></span>
<span id="cb656-2"><a href="#cb656-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb656-3"><a href="#cb656-3" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">svydesign</span>(<span class="at">id =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">weights =</span> <span class="sc">~</span>poids_sondage, <span class="at">data =</span> donnees_datatable)</span>
<span id="cb656-4"><a href="#cb656-4" aria-hidden="true" tabindex="-1"></a>survey<span class="sc">::</span><span class="fu">svytable</span>(poids_sondage <span class="sc">~</span> sexef <span class="sc">+</span> cspf, <span class="at">design =</span> tab)</span></code></pre></div>
</div>
</div>
<div id="tabset-156-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-156-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="package-procs" class="level3" data-number="21.5.5">
<h3 data-number="21.5.5"><span class="header-section-number">21.5.5</span> Package procs</h3>
<p>Lien vers la documentation : <a href="https://cran.r-project.org/web/packages/procs/index.html" class="uri">https://cran.r-project.org/web/packages/procs/index.html</a>.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-157-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-157-1" role="tab" aria-controls="tabset-157-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-157-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-157-2" role="tab" aria-controls="tabset-157-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-157-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-157-3" role="tab" aria-controls="tabset-157-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-157-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-157-4" role="tab" aria-controls="tabset-157-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-157-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-157-5" role="tab" aria-controls="tabset-157-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-157-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-157-1-tab">
<div class="sourceCode" id="cb657"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb657-1"><a href="#cb657-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Sans objet pour SAS */</span></span>
<span id="cb657-2"><a href="#cb657-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb657-3"><a href="#cb657-3" aria-hidden="true" tabindex="-1"></a>  tables Sexe * CSP / missing;</span>
<span id="cb657-4"><a href="#cb657-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb657-5"><a href="#cb657-5" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb657-6"><a href="#cb657-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-157-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-157-2-tab">
<div class="cell">
<div class="sourceCode" id="cb658"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb658-1"><a href="#cb658-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(procs)</span>
<span id="cb658-2"><a href="#cb658-2" aria-hidden="true" tabindex="-1"></a>procs<span class="sc">::</span><span class="fu">proc_freq</span>(donnees_rbase, <span class="at">tables =</span> cspf <span class="sc">*</span> sexef, <span class="at">options =</span> <span class="fu">v</span>(missing))</span>
<span id="cb658-3"><a href="#cb658-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ne fonctionne pas avec le poids !!!</span></span>
<span id="cb658-4"><a href="#cb658-4" aria-hidden="true" tabindex="-1"></a><span class="co">#procs::proc_freq(donnees_rbase, tables = cspf * sexef, weight = poids_sondage, options = v(missing))</span></span></code></pre></div>
</div>
</div>
<div id="tabset-157-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-157-3-tab">
<div class="cell">
<div class="sourceCode" id="cb659"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb659-1"><a href="#cb659-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(procs)</span>
<span id="cb659-2"><a href="#cb659-2" aria-hidden="true" tabindex="-1"></a>procs<span class="sc">::</span><span class="fu">proc_freq</span>(donnees_tidyverse, <span class="at">tables =</span> cspf <span class="sc">*</span> sexef, <span class="at">options =</span> <span class="fu">v</span>(missing))</span>
<span id="cb659-3"><a href="#cb659-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ne fonctionne pas avec le poids !!!</span></span>
<span id="cb659-4"><a href="#cb659-4" aria-hidden="true" tabindex="-1"></a><span class="co">#procs::proc_freq(donnees_tidyverse, tables = cspf * sexef, weight = poids_sondage, options = v(missing))</span></span></code></pre></div>
</div>
</div>
<div id="tabset-157-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-157-4-tab">
<div class="cell">
<div class="sourceCode" id="cb660"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb660-1"><a href="#cb660-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(procs)</span>
<span id="cb660-2"><a href="#cb660-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Il semble nécessaire de convertire l&#39;objet en data.frame</span></span>
<span id="cb660-3"><a href="#cb660-3" aria-hidden="true" tabindex="-1"></a>procs<span class="sc">::</span><span class="fu">proc_freq</span>(<span class="fu">setDF</span>(donnees_datatable), <span class="at">tables =</span> cspf <span class="sc">*</span> sexef, <span class="at">options =</span> <span class="fu">v</span>(missing))</span>
<span id="cb660-4"><a href="#cb660-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ne fonctionne pas avec le poids !!!</span></span>
<span id="cb660-5"><a href="#cb660-5" aria-hidden="true" tabindex="-1"></a><span class="co">#procs::proc_freq(setDF(donnees_datatable), tables = cspf * sexef, weight = poids_sondage, options = v(missing))</span></span>
<span id="cb660-6"><a href="#cb660-6" aria-hidden="true" tabindex="-1"></a><span class="co"># On reconvertit en data.table</span></span>
<span id="cb660-7"><a href="#cb660-7" aria-hidden="true" tabindex="-1"></a><span class="fu">setDT</span>(donnees_datatable)</span></code></pre></div>
</div>
</div>
<div id="tabset-157-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-157-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="solutions-avec-package-r-ne-permettant-apparemment-pas-de-pondérer" class="level2" data-number="21.6">
<h2 data-number="21.6"><span class="header-section-number">21.6</span> Solutions avec package R ne permettant apparemment pas de pondérer</h2>
<p>Autres packages, qui semblent quasi-inutiles, ne permettant apparemment pas de pondérer.</p>
<section id="package-janitor" class="level3" data-number="21.6.1">
<h3 data-number="21.6.1"><span class="header-section-number">21.6.1</span> Package Janitor</h3>
<p>Lien vers la documentation : <a href="https://cran.r-project.org/web/packages/janitor/vignettes/tabyls.html" class="uri">https://cran.r-project.org/web/packages/janitor/vignettes/tabyls.html</a>.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-158-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-158-1" role="tab" aria-controls="tabset-158-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-158-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-158-2" role="tab" aria-controls="tabset-158-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-158-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-158-3" role="tab" aria-controls="tabset-158-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-158-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-158-4" role="tab" aria-controls="tabset-158-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-158-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-158-5" role="tab" aria-controls="tabset-158-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-158-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-158-1-tab">
<div class="sourceCode" id="cb661"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb661-1"><a href="#cb661-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Sans objet pour SAS */</span></span>
<span id="cb661-2"><a href="#cb661-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb661-3"><a href="#cb661-3" aria-hidden="true" tabindex="-1"></a>  tables Sexe * CSP / missing;</span>
<span id="cb661-4"><a href="#cb661-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb661-5"><a href="#cb661-5" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb661-6"><a href="#cb661-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-158-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-158-2-tab">
<div class="cell">
<div class="sourceCode" id="cb662"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb662-1"><a href="#cb662-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb662-2"><a href="#cb662-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Attention, la fonction tabyl ne permet pas de pondérer</span></span>
<span id="cb662-3"><a href="#cb662-3" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">tabyl</span>(donnees_rbase, cspf, sexef)</span>
<span id="cb662-4"><a href="#cb662-4" aria-hidden="true" tabindex="-1"></a>tab</span>
<span id="cb662-5"><a href="#cb662-5" aria-hidden="true" tabindex="-1"></a>janitor<span class="sc">::</span><span class="fu">adorn_totals</span>(tab, <span class="fu">c</span>(<span class="st">&quot;row&quot;</span>, <span class="st">&quot;col&quot;</span>))</span>
<span id="cb662-6"><a href="#cb662-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Pourcentages</span></span>
<span id="cb662-7"><a href="#cb662-7" aria-hidden="true" tabindex="-1"></a>janitor<span class="sc">::</span><span class="fu">adorn_percentages</span>(tab, <span class="at">denominator =</span> <span class="st">&quot;all&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb662-8"><a href="#cb662-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Pourcentages lignes</span></span>
<span id="cb662-9"><a href="#cb662-9" aria-hidden="true" tabindex="-1"></a>janitor<span class="sc">::</span><span class="fu">adorn_percentages</span>(tab, <span class="at">denominator =</span> <span class="st">&quot;row&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb662-10"><a href="#cb662-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Pourcentages colonnes</span></span>
<span id="cb662-11"><a href="#cb662-11" aria-hidden="true" tabindex="-1"></a>janitor<span class="sc">::</span><span class="fu">adorn_percentages</span>(tab, <span class="at">denominator =</span> <span class="st">&quot;col&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-158-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-158-3-tab">
<div class="cell">
<div class="sourceCode" id="cb663"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb663-1"><a href="#cb663-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb663-2"><a href="#cb663-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Attention, la fonction tabyl ne permet pas de pondérer</span></span>
<span id="cb663-3"><a href="#cb663-3" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb663-4"><a href="#cb663-4" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">tabyl</span>(cspf, sexef) <span class="sc">%&gt;%</span> </span>
<span id="cb663-5"><a href="#cb663-5" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">adorn_totals</span>(<span class="fu">c</span>(<span class="st">&quot;row&quot;</span>, <span class="st">&quot;col&quot;</span>))</span>
<span id="cb663-6"><a href="#cb663-6" aria-hidden="true" tabindex="-1"></a>tab</span>
<span id="cb663-7"><a href="#cb663-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Pourcentages</span></span>
<span id="cb663-8"><a href="#cb663-8" aria-hidden="true" tabindex="-1"></a>tab <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">adorn_percentages</span>(<span class="at">denominator =</span> <span class="st">&quot;all&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb663-9"><a href="#cb663-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Pourcentages lignes</span></span>
<span id="cb663-10"><a href="#cb663-10" aria-hidden="true" tabindex="-1"></a>tab <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">adorn_percentages</span>(<span class="at">denominator =</span> <span class="st">&quot;row&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb663-11"><a href="#cb663-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Pourcentages colonnes</span></span>
<span id="cb663-12"><a href="#cb663-12" aria-hidden="true" tabindex="-1"></a>tab <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">adorn_percentages</span>(<span class="at">denominator =</span> <span class="st">&quot;col&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-158-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-158-4-tab">
<div class="cell">
<div class="sourceCode" id="cb664"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb664-1"><a href="#cb664-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb664-2"><a href="#cb664-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Attention, la fonction tabyl ne permet pas de pondérer</span></span>
<span id="cb664-3"><a href="#cb664-3" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">tabyl</span>(donnees_datatable, cspf, sexef)</span>
<span id="cb664-4"><a href="#cb664-4" aria-hidden="true" tabindex="-1"></a>tab</span>
<span id="cb664-5"><a href="#cb664-5" aria-hidden="true" tabindex="-1"></a>janitor<span class="sc">::</span><span class="fu">adorn_totals</span>(tab, <span class="fu">c</span>(<span class="st">&quot;row&quot;</span>, <span class="st">&quot;col&quot;</span>))</span>
<span id="cb664-6"><a href="#cb664-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Pourcentages</span></span>
<span id="cb664-7"><a href="#cb664-7" aria-hidden="true" tabindex="-1"></a>janitor<span class="sc">::</span><span class="fu">adorn_percentages</span>(tab, <span class="at">denominator =</span> <span class="st">&quot;all&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb664-8"><a href="#cb664-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Pourcentages lignes</span></span>
<span id="cb664-9"><a href="#cb664-9" aria-hidden="true" tabindex="-1"></a>janitor<span class="sc">::</span><span class="fu">adorn_percentages</span>(tab, <span class="at">denominator =</span> <span class="st">&quot;row&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb664-10"><a href="#cb664-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Pourcentages colonnes</span></span>
<span id="cb664-11"><a href="#cb664-11" aria-hidden="true" tabindex="-1"></a>janitor<span class="sc">::</span><span class="fu">adorn_percentages</span>(tab, <span class="at">denominator =</span> <span class="st">&quot;col&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-158-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-158-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="package-crosstable" class="level3" data-number="21.6.2">
<h3 data-number="21.6.2"><span class="header-section-number">21.6.2</span> Package crosstable</h3>
<p>Lien vers la documentation : <a href="https://cran.r-project.org/web/packages/crosstable/crosstable.pdf" class="uri">https://cran.r-project.org/web/packages/crosstable/crosstable.pdf</a>.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-159-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-159-1" role="tab" aria-controls="tabset-159-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-159-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-159-2" role="tab" aria-controls="tabset-159-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-159-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-159-3" role="tab" aria-controls="tabset-159-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-159-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-159-4" role="tab" aria-controls="tabset-159-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-159-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-159-5" role="tab" aria-controls="tabset-159-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-159-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-159-1-tab">
<div class="sourceCode" id="cb665"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb665-1"><a href="#cb665-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Sans objet pour SAS */</span></span>
<span id="cb665-2"><a href="#cb665-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb665-3"><a href="#cb665-3" aria-hidden="true" tabindex="-1"></a>  tables Sexe * CSP / missing;</span>
<span id="cb665-4"><a href="#cb665-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb665-5"><a href="#cb665-5" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb665-6"><a href="#cb665-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-159-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-159-2-tab">
<div class="cell">
<div class="sourceCode" id="cb666"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb666-1"><a href="#cb666-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(crosstable)</span>
<span id="cb666-2"><a href="#cb666-2" aria-hidden="true" tabindex="-1"></a>crosstable<span class="sc">::</span><span class="fu">crosstable</span>(donnees_rbase, cspf, <span class="at">by =</span> sexef, <span class="at">showNA =</span> <span class="st">&quot;always&quot;</span>, <span class="at">percent_digits =</span> <span class="dv">0</span>, <span class="at">percent_pattern =</span><span class="st">&quot;{n} ({p_col}/{p_row})&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-159-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-159-3-tab">
<div class="cell">
<div class="sourceCode" id="cb667"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb667-1"><a href="#cb667-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(crosstable)</span>
<span id="cb667-2"><a href="#cb667-2" aria-hidden="true" tabindex="-1"></a>crosstable<span class="sc">::</span><span class="fu">crosstable</span>(donnees_tidyverse, cspf, <span class="at">by =</span> sexef, <span class="at">showNA =</span> <span class="st">&quot;always&quot;</span>,</span>
<span id="cb667-3"><a href="#cb667-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">percent_digits =</span> <span class="dv">0</span>, <span class="at">percent_pattern =</span><span class="st">&quot;{n} ({p_col}/{p_row})&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-159-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-159-4-tab">
<div class="cell">
<div class="sourceCode" id="cb668"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb668-1"><a href="#cb668-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(crosstable)</span>
<span id="cb668-2"><a href="#cb668-2" aria-hidden="true" tabindex="-1"></a>crosstable<span class="sc">::</span><span class="fu">crosstable</span>(donnees_datatable, cspf, <span class="at">by =</span> sexef, <span class="at">showNA =</span> <span class="st">&quot;always&quot;</span>,</span>
<span id="cb668-3"><a href="#cb668-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">percent_digits =</span> <span class="dv">0</span>, <span class="at">percent_pattern =</span><span class="st">&quot;{n} ({p_col}/{p_row})&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-159-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-159-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="package-gmodels" class="level3" data-number="21.6.3">
<h3 data-number="21.6.3"><span class="header-section-number">21.6.3</span> Package gmodels</h3>
<p>Lien vers la documentation : <a href="https://cran.r-project.org/web/packages/gmodels/gmodels.pdf" class="uri">https://cran.r-project.org/web/packages/gmodels/gmodels.pdf</a>.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-160-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-160-1" role="tab" aria-controls="tabset-160-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-160-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-160-2" role="tab" aria-controls="tabset-160-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-160-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-160-3" role="tab" aria-controls="tabset-160-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-160-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-160-4" role="tab" aria-controls="tabset-160-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-160-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-160-5" role="tab" aria-controls="tabset-160-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-160-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-160-1-tab">
<div class="sourceCode" id="cb669"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb669-1"><a href="#cb669-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Sans objet pour SAS */</span></span>
<span id="cb669-2"><a href="#cb669-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb669-3"><a href="#cb669-3" aria-hidden="true" tabindex="-1"></a>  tables Sexe * CSP / missing;</span>
<span id="cb669-4"><a href="#cb669-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb669-5"><a href="#cb669-5" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb669-6"><a href="#cb669-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-160-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-160-2-tab">
<div class="cell">
<div class="sourceCode" id="cb670"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb670-1"><a href="#cb670-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span>
<span id="cb670-2"><a href="#cb670-2" aria-hidden="true" tabindex="-1"></a>gmodels<span class="sc">::</span><span class="fu">CrossTable</span>(donnees_rbase<span class="sc">$</span>cspf, donnees_rbase<span class="sc">$</span>sexef)</span></code></pre></div>
</div>
</div>
<div id="tabset-160-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-160-3-tab">
<div class="cell">
<div class="sourceCode" id="cb671"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb671-1"><a href="#cb671-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span>
<span id="cb671-2"><a href="#cb671-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb671-3"><a href="#cb671-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(gmodels<span class="sc">::</span><span class="fu">CrossTable</span>(cspf, sexef))</span></code></pre></div>
</div>
</div>
<div id="tabset-160-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-160-4-tab">
<div class="cell">
<div class="sourceCode" id="cb672"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb672-1"><a href="#cb672-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span>
<span id="cb672-2"><a href="#cb672-2" aria-hidden="true" tabindex="-1"></a>gmodels<span class="sc">::</span><span class="fu">CrossTable</span>(donnees_datatable<span class="sc">$</span>cspf, donnees_datatable<span class="sc">$</span>sexef)</span></code></pre></div>
</div>
</div>
<div id="tabset-160-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-160-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="package-gtsummary" class="level3" data-number="21.6.4">
<h3 data-number="21.6.4"><span class="header-section-number">21.6.4</span> Package gtsummary</h3>
<p>Lien vers la documentation : <a href="https://cran.r-project.org/web/packages/gtsummary/gtsummary.pdf" class="uri">https://cran.r-project.org/web/packages/gtsummary/gtsummary.pdf</a>.</p>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-161-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-161-1" role="tab" aria-controls="tabset-161-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-161-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-161-2" role="tab" aria-controls="tabset-161-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-161-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-161-3" role="tab" aria-controls="tabset-161-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-161-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-161-4" role="tab" aria-controls="tabset-161-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-161-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-161-5" role="tab" aria-controls="tabset-161-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-161-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-161-1-tab">
<div class="sourceCode" id="cb673"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb673-1"><a href="#cb673-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Sans objet pour SAS */</span></span>
<span id="cb673-2"><a href="#cb673-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> freq<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb673-3"><a href="#cb673-3" aria-hidden="true" tabindex="-1"></a>  tables Sexe * CSP / missing;</span>
<span id="cb673-4"><a href="#cb673-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">format</span> Sexe sexef. CSP $cspf.;</span>
<span id="cb673-5"><a href="#cb673-5" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb673-6"><a href="#cb673-6" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-161-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-161-2-tab">
<div class="cell">
<div class="sourceCode" id="cb674"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb674-1"><a href="#cb674-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb674-2"><a href="#cb674-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Pourcentages par case, colonne, ligne</span></span>
<span id="cb674-3"><a href="#cb674-3" aria-hidden="true" tabindex="-1"></a>gtsummary<span class="sc">::</span><span class="fu">tbl_cross</span>(<span class="at">data =</span> donnees_rbase, <span class="at">row =</span> cspf, <span class="at">col =</span> sexef, <span class="at">percent =</span> <span class="fu">c</span>(<span class="st">&quot;cell&quot;</span>),   <span class="at">margin =</span> <span class="fu">c</span>(<span class="st">&quot;column&quot;</span>, <span class="st">&quot;row&quot;</span>), <span class="at">missing =</span> <span class="fu">c</span>(<span class="st">&quot;always&quot;</span>))</span>
<span id="cb674-4"><a href="#cb674-4" aria-hidden="true" tabindex="-1"></a>gtsummary<span class="sc">::</span><span class="fu">tbl_cross</span>(<span class="at">data =</span> donnees_rbase, <span class="at">row =</span> cspf, <span class="at">col =</span> sexef, <span class="at">percent =</span> <span class="fu">c</span>(<span class="st">&quot;column&quot;</span>), <span class="at">margin =</span> <span class="fu">c</span>(<span class="st">&quot;column&quot;</span>, <span class="st">&quot;row&quot;</span>), <span class="at">missing =</span> <span class="fu">c</span>(<span class="st">&quot;always&quot;</span>))</span>
<span id="cb674-5"><a href="#cb674-5" aria-hidden="true" tabindex="-1"></a>gtsummary<span class="sc">::</span><span class="fu">tbl_cross</span>(<span class="at">data =</span> donnees_rbase, <span class="at">row =</span> cspf, <span class="at">col =</span> sexef, <span class="at">percent =</span> <span class="fu">c</span>(<span class="st">&quot;row&quot;</span>),    <span class="at">margin =</span> <span class="fu">c</span>(<span class="st">&quot;column&quot;</span>, <span class="st">&quot;row&quot;</span>), <span class="at">missing =</span> <span class="fu">c</span>(<span class="st">&quot;always&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-161-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-161-3-tab">
<div class="cell">
<div class="sourceCode" id="cb675"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb675-1"><a href="#cb675-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb675-2"><a href="#cb675-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Pourcentages par case, colonne, ligne</span></span>
<span id="cb675-3"><a href="#cb675-3" aria-hidden="true" tabindex="-1"></a>gtsummary<span class="sc">::</span><span class="fu">tbl_cross</span>(<span class="at">data =</span> donnees_tidyverse, <span class="at">row =</span> cspf, <span class="at">col =</span> sexef, <span class="at">percent =</span> <span class="fu">c</span>(<span class="st">&quot;cell&quot;</span>),   <span class="at">margin =</span> <span class="fu">c</span>(<span class="st">&quot;column&quot;</span>, <span class="st">&quot;row&quot;</span>), <span class="at">missing =</span> <span class="fu">c</span>(<span class="st">&quot;always&quot;</span>))</span>
<span id="cb675-4"><a href="#cb675-4" aria-hidden="true" tabindex="-1"></a>gtsummary<span class="sc">::</span><span class="fu">tbl_cross</span>(<span class="at">data =</span> donnees_tidyverse, <span class="at">row =</span> cspf, <span class="at">col =</span> sexef, <span class="at">percent =</span> <span class="fu">c</span>(<span class="st">&quot;column&quot;</span>), <span class="at">margin =</span> <span class="fu">c</span>(<span class="st">&quot;column&quot;</span>, <span class="st">&quot;row&quot;</span>), <span class="at">missing =</span> <span class="fu">c</span>(<span class="st">&quot;always&quot;</span>))</span>
<span id="cb675-5"><a href="#cb675-5" aria-hidden="true" tabindex="-1"></a>gtsummary<span class="sc">::</span><span class="fu">tbl_cross</span>(<span class="at">data =</span> donnees_tidyverse, <span class="at">row =</span> cspf, <span class="at">col =</span> sexef, <span class="at">percent =</span> <span class="fu">c</span>(<span class="st">&quot;row&quot;</span>),    <span class="at">margin =</span> <span class="fu">c</span>(<span class="st">&quot;column&quot;</span>, <span class="st">&quot;row&quot;</span>), <span class="at">missing =</span> <span class="fu">c</span>(<span class="st">&quot;always&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-161-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-161-4-tab">
<div class="cell">
<div class="sourceCode" id="cb676"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb676-1"><a href="#cb676-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb676-2"><a href="#cb676-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Pourcentages par case, colonne, ligne</span></span>
<span id="cb676-3"><a href="#cb676-3" aria-hidden="true" tabindex="-1"></a>gtsummary<span class="sc">::</span><span class="fu">tbl_cross</span>(<span class="at">data =</span> donnees_datatable, <span class="at">row =</span> cspf, <span class="at">col =</span> sexef, <span class="at">percent =</span> <span class="fu">c</span>(<span class="st">&quot;cell&quot;</span>),  </span>
<span id="cb676-4"><a href="#cb676-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">margin =</span> <span class="fu">c</span>(<span class="st">&quot;column&quot;</span>, <span class="st">&quot;row&quot;</span>), <span class="at">missing =</span> <span class="fu">c</span>(<span class="st">&quot;always&quot;</span>))</span>
<span id="cb676-5"><a href="#cb676-5" aria-hidden="true" tabindex="-1"></a>gtsummary<span class="sc">::</span><span class="fu">tbl_cross</span>(<span class="at">data =</span> donnees_datatable, <span class="at">row =</span> cspf, <span class="at">col =</span> sexef, <span class="at">percent =</span> <span class="fu">c</span>(<span class="st">&quot;column&quot;</span>),</span>
<span id="cb676-6"><a href="#cb676-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">margin =</span> <span class="fu">c</span>(<span class="st">&quot;column&quot;</span>, <span class="st">&quot;row&quot;</span>), <span class="at">missing =</span> <span class="fu">c</span>(<span class="st">&quot;always&quot;</span>))</span>
<span id="cb676-7"><a href="#cb676-7" aria-hidden="true" tabindex="-1"></a>gtsummary<span class="sc">::</span><span class="fu">tbl_cross</span>(<span class="at">data =</span> donnees_datatable, <span class="at">row =</span> cspf, <span class="at">col =</span> sexef, <span class="at">percent =</span> <span class="fu">c</span>(<span class="st">&quot;row&quot;</span>),   </span>
<span id="cb676-8"><a href="#cb676-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">margin =</span> <span class="fu">c</span>(<span class="st">&quot;column&quot;</span>, <span class="st">&quot;row&quot;</span>), <span class="at">missing =</span> <span class="fu">c</span>(<span class="st">&quot;always&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-161-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-161-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="statistiques-agrégées-par-groupe" class="level1" data-number="22">
<h1 data-number="22"><span class="header-section-number">22</span> Statistiques agrégées par groupe</h1>
<section id="une-seule-variable-de-groupement-une-seule-variable" class="level2" data-number="22.1">
<h2 data-number="22.1"><span class="header-section-number">22.1</span> Une seule variable de groupement, une seule variable</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-162-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-162-1" role="tab" aria-controls="tabset-162-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-162-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-162-2" role="tab" aria-controls="tabset-162-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-162-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-162-3" role="tab" aria-controls="tabset-162-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-162-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-162-4" role="tab" aria-controls="tabset-162-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-162-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-162-5" role="tab" aria-controls="tabset-162-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-162-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-162-1-tab">
<div class="sourceCode" id="cb677"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb677-1"><a href="#cb677-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Moyenne de note_contenu et nombre de personnes */</span></span>
<span id="cb677-2"><a href="#cb677-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-3"><a href="#cb677-3" aria-hidden="true" tabindex="-1"></a><span class="co">/* 1ère solution */</span></span>
<span id="cb677-4"><a href="#cb677-4" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> cspf<span class="kw">;run</span>;</span>
<span id="cb677-5"><a href="#cb677-5" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">mean</span> <span class="fu">n</span>;<span class="fu">var</span> note_contenu;class cspf<span class="kw">;run</span>;</span>
<span id="cb677-6"><a href="#cb677-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-7"><a href="#cb677-7" aria-hidden="true" tabindex="-1"></a><span class="co">/* 2e solution */</span></span>
<span id="cb677-8"><a href="#cb677-8" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> tabulate<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb677-9"><a href="#cb677-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> note_contenu;</span>
<span id="cb677-10"><a href="#cb677-10" aria-hidden="true" tabindex="-1"></a>  class cspf;</span>
<span id="cb677-11"><a href="#cb677-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">table</span> (cspf all = <span class="st">&quot;Total&quot;</span>), note_contenu * (<span class="fu">mean</span> <span class="fu">n</span>);</span>
<span id="cb677-12"><a href="#cb677-12" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb677-13"><a href="#cb677-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-14"><a href="#cb677-14" aria-hidden="true" tabindex="-1"></a><span class="co">/* 3e solution */</span></span>
<span id="cb677-15"><a href="#cb677-15" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb677-16"><a href="#cb677-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> cspf, <span class="fu">mean</span>(note_contenu) <span class="kw">as</span> note_contenu_moyenne, count(*) <span class="kw">as</span> <span class="fu">N</span></span>
<span id="cb677-17"><a href="#cb677-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> donnees_sas</span>
<span id="cb677-18"><a href="#cb677-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">group</span> <span class="kw">by</span> cspf</span>
<span id="cb677-19"><a href="#cb677-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span> <span class="kw">by</span> cspf;</span>
<span id="cb677-20"><a href="#cb677-20" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb677-21"><a href="#cb677-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-22"><a href="#cb677-22" aria-hidden="true" tabindex="-1"></a><span class="co">/* Avec la pondération */</span></span>
<span id="cb677-23"><a href="#cb677-23" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> cspf<span class="kw">;run</span>;</span>
<span id="cb677-24"><a href="#cb677-24" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">mean</span> <span class="fu">n</span>;</span>
<span id="cb677-25"><a href="#cb677-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> note_contenu;class cspf;</span>
<span id="cb677-26"><a href="#cb677-26" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb677-27"><a href="#cb677-27" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb677-28"><a href="#cb677-28" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> tabulate<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb677-29"><a href="#cb677-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> note_contenu;</span>
<span id="cb677-30"><a href="#cb677-30" aria-hidden="true" tabindex="-1"></a>  class cspf;</span>
<span id="cb677-31"><a href="#cb677-31" aria-hidden="true" tabindex="-1"></a>  weight poids_sondage;</span>
<span id="cb677-32"><a href="#cb677-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">table</span> (cspf all = <span class="st">&quot;Total&quot;</span>), note_contenu * (<span class="fu">mean</span> <span class="fu">n</span>);</span>
<span id="cb677-33"><a href="#cb677-33" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-162-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-162-2-tab">
<div class="cell">
<div class="sourceCode" id="cb678"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb678-1"><a href="#cb678-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Moyenne de note_contenu et nombre de personnes</span></span>
<span id="cb678-2"><a href="#cb678-2" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(note_contenu <span class="sc">~</span> cspf, donnees_rbase, <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">Moyenne =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">Nombre =</span> <span class="fu">length</span>(x)))</span>
<span id="cb678-3"><a href="#cb678-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb678-4"><a href="#cb678-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Moyenne de note_contenu</span></span>
<span id="cb678-5"><a href="#cb678-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Une seule variable, une seule variable de groupe, une seule fonction</span></span>
<span id="cb678-6"><a href="#cb678-6" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(note_contenu <span class="sc">~</span> cspf, donnees_rbase, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb678-7"><a href="#cb678-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb678-8"><a href="#cb678-8" aria-hidden="true" tabindex="-1"></a><span class="co"># rowsum (à ne pas confondre avec rowSums) calcule des sommes, et uniquement des sommes</span></span>
<span id="cb678-9"><a href="#cb678-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rowsum</span>(donnees_rbase<span class="sc">$</span>note_contenu, donnees_rbase<span class="sc">$</span>cspf, <span class="at">recorder =</span> <span class="cn">TRUE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb678-10"><a href="#cb678-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb678-11"><a href="#cb678-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fonctions tapply et by</span></span>
<span id="cb678-12"><a href="#cb678-12" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(donnees_rbase<span class="sc">$</span>note_contenu, donnees_rbase<span class="sc">$</span>cspf, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb678-13"><a href="#cb678-13" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(donnees_rbase, <span class="fu">tapply</span>(note_contenu, cspf, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb678-14"><a href="#cb678-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(donnees_rbase<span class="sc">$</span>note_contenu, donnees_rbase<span class="sc">$</span>cspf, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb678-15"><a href="#cb678-15" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(donnees_rbase<span class="sc">$</span>note_contenu, donnees_rbase<span class="sc">$</span>cspf, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb678-16"><a href="#cb678-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb678-17"><a href="#cb678-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec la pondération : tapply ne fonctionne pas, il faut découper la base en facteurs avec split</span></span>
<span id="cb678-18"><a href="#cb678-18" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">split</span>(donnees_rbase, donnees_rbase<span class="sc">$</span>cspf), <span class="cf">function</span>(x) <span class="fu">weighted.mean</span>(x<span class="sc">$</span>note_contenu, x<span class="sc">$</span>poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb678-19"><a href="#cb678-19" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : autre solution ?</span></span></code></pre></div>
</div>
</div>
<div id="tabset-162-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-162-3-tab">
<div class="cell">
<div class="sourceCode" id="cb679"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb679-1"><a href="#cb679-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Moyenne de note_contenu et nombre de personnes</span></span>
<span id="cb679-2"><a href="#cb679-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb679-3"><a href="#cb679-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cspf) <span class="sc">%&gt;%</span> </span>
<span id="cb679-4"><a href="#cb679-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Nombre =</span> <span class="fu">n</span>(), <span class="at">Moyenne =</span> <span class="fu">mean</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb679-5"><a href="#cb679-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou alors :</span></span>
<span id="cb679-6"><a href="#cb679-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">Nombre =</span> <span class="fu">n</span>(), <span class="at">Moyenne =</span> <span class="fu">mean</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> cspf)</span>
<span id="cb679-7"><a href="#cb679-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-8"><a href="#cb679-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Moyenne de note_contenu</span></span>
<span id="cb679-9"><a href="#cb679-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Une seule variable, une seule variable de groupe, une seule fonction</span></span>
<span id="cb679-10"><a href="#cb679-10" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb679-11"><a href="#cb679-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cspf) <span class="sc">%&gt;%</span> </span>
<span id="cb679-12"><a href="#cb679-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Moyenne =</span> <span class="fu">mean</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb679-13"><a href="#cb679-13" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb679-14"><a href="#cb679-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Moyenne =</span> <span class="fu">mean</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> cspf)</span>
<span id="cb679-15"><a href="#cb679-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-16"><a href="#cb679-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec la pondération</span></span>
<span id="cb679-17"><a href="#cb679-17" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb679-18"><a href="#cb679-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cspf) <span class="sc">%&gt;%</span> </span>
<span id="cb679-19"><a href="#cb679-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Moyenne =</span> <span class="fu">weighted.mean</span>(note_contenu, poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb679-20"><a href="#cb679-20" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb679-21"><a href="#cb679-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Moyenne =</span> <span class="fu">weighted.mean</span>(note_contenu, poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> cspf)</span></code></pre></div>
</div>
</div>
<div id="tabset-162-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-162-4-tab">
<div class="cell">
<div class="sourceCode" id="cb680"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb680-1"><a href="#cb680-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Moyenne de note_contenu et nombre de personnes</span></span>
<span id="cb680-2"><a href="#cb680-2" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, .(<span class="at">note_contenu_moyenne =</span> <span class="fu">mean</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">N =</span> .N), by <span class="ot">=</span> cspf]</span>
<span id="cb680-3"><a href="#cb680-3" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, .(<span class="at">note_contenu_moyenne =</span> <span class="fu">mean</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">N =</span> .N), keyby <span class="ot">=</span> <span class="st">&quot;cspf&quot;</span>]</span>
<span id="cb680-4"><a href="#cb680-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb680-5"><a href="#cb680-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables définies à part</span></span>
<span id="cb680-6"><a href="#cb680-6" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="st">&quot;note_contenu&quot;</span></span>
<span id="cb680-7"><a href="#cb680-7" aria-hidden="true" tabindex="-1"></a>var_groupe <span class="ot">&lt;-</span> <span class="st">&quot;cspf&quot;</span></span>
<span id="cb680-8"><a href="#cb680-8" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : les deux variables sont empilées, pourquoi ??</span></span>
<span id="cb680-9"><a href="#cb680-9" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">list</span>(<span class="at">moyenne =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">n =</span> <span class="fu">length</span>(x))), keyby <span class="ot">=</span> var_groupe,</span>
<span id="cb680-10"><a href="#cb680-10" aria-hidden="true" tabindex="-1"></a>                  .SDcols <span class="ot">=</span> varNotes]</span>
<span id="cb680-11"><a href="#cb680-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb680-12"><a href="#cb680-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec la pondération</span></span>
<span id="cb680-13"><a href="#cb680-13" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">weighted.mean</span>(x, poids_sondage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), keyby <span class="ot">=</span> var_groupe,</span>
<span id="cb680-14"><a href="#cb680-14" aria-hidden="true" tabindex="-1"></a>                  .SDcols <span class="ot">=</span> varNotes]</span></code></pre></div>
</div>
</div>
<div id="tabset-162-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-162-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="plusieurs-variables" class="level2" data-number="22.2">
<h2 data-number="22.2"><span class="header-section-number">22.2</span> Plusieurs variables</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-163-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-163-1" role="tab" aria-controls="tabset-163-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-163-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-163-2" role="tab" aria-controls="tabset-163-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-163-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-163-3" role="tab" aria-controls="tabset-163-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-163-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-163-4" role="tab" aria-controls="tabset-163-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-163-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-163-5" role="tab" aria-controls="tabset-163-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-163-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-163-1-tab">
<div class="sourceCode" id="cb681"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb681-1"><a href="#cb681-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> var_notes = note_contenu note_formateur note_moyens note_accompagnement note_materiel;</span>
<span id="cb681-2"><a href="#cb681-2" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> var_groupe = cspf sexef;</span>
<span id="cb681-3"><a href="#cb681-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sort<span class="kw"> data</span> = donnees_sas;<span class="kw">by</span> <span class="kw">&amp;var_groupe.;run</span>;</span>
<span id="cb681-4"><a href="#cb681-4" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> means<span class="kw"> data</span> = donnees_sas <span class="fu">mean</span> <span class="fu">n</span>;</span>
<span id="cb681-5"><a href="#cb681-5" aria-hidden="true" tabindex="-1"></a>  class <span class="kw">&amp;var_groupe.</span>;</span>
<span id="cb681-6"><a href="#cb681-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> <span class="kw">&amp;var_notes.</span>;</span>
<span id="cb681-7"><a href="#cb681-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">output</span> out = Resultat;</span>
<span id="cb681-8"><a href="#cb681-8" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb681-9"><a href="#cb681-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb681-10"><a href="#cb681-10" aria-hidden="true" tabindex="-1"></a><span class="co">/* Autre solution */</span></span>
<span id="cb681-11"><a href="#cb681-11" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> sel;</span>
<span id="cb681-12"><a href="#cb681-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%global</span> <span class="kw">select</span>;</span>
<span id="cb681-13"><a href="#cb681-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%local</span> i j;</span>
<span id="cb681-14"><a href="#cb681-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%let</span> <span class="kw">select</span> = ;</span>
<span id="cb681-15"><a href="#cb681-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%do</span> i = <span class="dv">1</span> <span class="kw">%to</span> <span class="kw">%sysfunc</span>(countw(<span class="kw">&amp;var_notes.</span>));</span>
<span id="cb681-16"><a href="#cb681-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%let</span> j = <span class="kw">%scan</span>(<span class="kw">&amp;var_notes.</span>, <span class="kw">&amp;i.</span>, <span class="kw">%str</span>( ));</span>
<span id="cb681-17"><a href="#cb681-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%let</span> <span class="kw">select</span> = <span class="kw">&amp;select.</span> <span class="fu">mean</span>(<span class="kw">&amp;j)</span> <span class="kw">as</span> <span class="kw">&amp;j.</span>_moyenne,;</span>
<span id="cb681-18"><a href="#cb681-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%end</span>;</span>
<span id="cb681-19"><a href="#cb681-19" aria-hidden="true" tabindex="-1"></a><span class="kw">%mend</span> sel;</span>
<span id="cb681-20"><a href="#cb681-20" aria-hidden="true" tabindex="-1"></a>%sel;</span>
<span id="cb681-21"><a href="#cb681-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb681-22"><a href="#cb681-22" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> <span class="kw">group</span> = <span class="kw">%sysfunc</span>(<span class="fu">tranwrd</span>(<span class="kw">&amp;var_groupe.</span>, <span class="kw">%str</span>( ), <span class="kw">%str</span>(, )));</span>
<span id="cb681-23"><a href="#cb681-23" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb681-24"><a href="#cb681-24" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> <span class="kw">&amp;group.</span>, <span class="kw">&amp;select.</span> count(*) <span class="kw">as</span> <span class="fu">N</span></span>
<span id="cb681-25"><a href="#cb681-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> donnees_sas</span>
<span id="cb681-26"><a href="#cb681-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">group</span> <span class="kw">by</span> <span class="kw">&amp;group.</span></span>
<span id="cb681-27"><a href="#cb681-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span> <span class="kw">by</span> <span class="kw">&amp;group.</span>;</span>
<span id="cb681-28"><a href="#cb681-28" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-163-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-163-2-tab">
<div class="cell">
<div class="sourceCode" id="cb682"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb682-1"><a href="#cb682-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plusieurs solutions avec aggregate (plutôt lent)</span></span>
<span id="cb682-2"><a href="#cb682-2" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(note_contenu <span class="sc">~</span> cspf <span class="sc">+</span> sexef, donnees_rbase, <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">mean =</span> <span class="fu">mean</span>(x), <span class="at">n =</span> <span class="fu">length</span>(x)))</span>
<span id="cb682-3"><a href="#cb682-3" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(<span class="fu">cbind</span>(note_contenu, note_materiel) <span class="sc">~</span> cspf <span class="sc">+</span> sexef, donnees_rbase, <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">moyenne =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">n =</span> <span class="fu">length</span>(x)))</span>
<span id="cb682-4"><a href="#cb682-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb682-5"><a href="#cb682-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Via les formules</span></span>
<span id="cb682-6"><a href="#cb682-6" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>)</span>
<span id="cb682-7"><a href="#cb682-7" aria-hidden="true" tabindex="-1"></a>varGroupement <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>)</span>
<span id="cb682-8"><a href="#cb682-8" aria-hidden="true" tabindex="-1"></a>formule <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(variable, <span class="fu">paste</span>(varGroupement, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>), <span class="at">sep =</span> <span class="st">&quot; ~ &quot;</span>))</span>
<span id="cb682-9"><a href="#cb682-9" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(formule, donnees_rbase, <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">moyenne =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">n =</span> <span class="fu">length</span>(x)))</span>
<span id="cb682-10"><a href="#cb682-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb682-11"><a href="#cb682-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec by</span></span>
<span id="cb682-12"><a href="#cb682-12" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(donnees_rbase[, variable], donnees_rbase[, varGroupement], <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">mean =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">n =</span> <span class="fu">length</span>(x)))</span>
<span id="cb682-13"><a href="#cb682-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb682-14"><a href="#cb682-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec rowsum (à ne pas confondre avec rowSums) : on ne peut calculer que la somme</span></span>
<span id="cb682-15"><a href="#cb682-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rowsum</span>(donnees_rbase[, variable], <span class="fu">interaction</span>(donnees_rbase[, varGroupement], <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>, <span class="at">lex.order =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-163-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-163-3-tab">
<div class="cell">
<div class="sourceCode" id="cb683"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb683-1"><a href="#cb683-1" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb683-2"><a href="#cb683-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cspf, sexef) <span class="sc">%&gt;%</span> </span>
<span id="cb683-3"><a href="#cb683-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Moyenne =</span> <span class="fu">mean</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">n =</span> <span class="fu">n</span>())</span>
<span id="cb683-4"><a href="#cb683-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb683-5"><a href="#cb683-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution : l&#39;ordre des modalités est modifié</span></span>
<span id="cb683-6"><a href="#cb683-6" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb683-7"><a href="#cb683-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Moyenne =</span> <span class="fu">mean</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(cspf, sexef))</span></code></pre></div>
</div>
</div>
<div id="tabset-163-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-163-4-tab">
<div class="cell">
<div class="sourceCode" id="cb684"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb684-1"><a href="#cb684-1" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, .(<span class="at">note_contenu_moyenne =</span> <span class="fu">mean</span>(note_contenu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">N =</span> .N), keyby <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>)]</span>
<span id="cb684-2"><a href="#cb684-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-3"><a href="#cb684-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb684-4"><a href="#cb684-4" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">dcast</span>(donnees_datatable, cspf <span class="sc">+</span> sexef <span class="sc">~</span> ., <span class="at">value.var =</span> <span class="st">&quot;note_contenu&quot;</span>, <span class="at">fun.aggregate =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb684-5"><a href="#cb684-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-6"><a href="#cb684-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables définies à part</span></span>
<span id="cb684-7"><a href="#cb684-7" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb684-8"><a href="#cb684-8" aria-hidden="true" tabindex="-1"></a>var_groupe <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>)</span>
<span id="cb684-9"><a href="#cb684-9" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : les deux variables sont empilées, pourquoi ??</span></span>
<span id="cb684-10"><a href="#cb684-10" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">list</span>(<span class="at">moyenne =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">n =</span> <span class="fu">length</span>(x))),</span>
<span id="cb684-11"><a href="#cb684-11" aria-hidden="true" tabindex="-1"></a>                  keyby <span class="ot">=</span> var_groupe,</span>
<span id="cb684-12"><a href="#cb684-12" aria-hidden="true" tabindex="-1"></a>                  .SDcols <span class="ot">=</span> varNotes]</span>
<span id="cb684-13"><a href="#cb684-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-14"><a href="#cb684-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Nombre de femmes par CSP</span></span>
<span id="cb684-15"><a href="#cb684-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Il y a un recycling de gender = &quot;M&quot;, utile de le mentionner</span></span>
<span id="cb684-16"><a href="#cb684-16" aria-hidden="true" tabindex="-1"></a>donnees_datatable[, .(<span class="at">Femmes =</span> <span class="fu">sum</span>(sexef <span class="sc">==</span> <span class="st">&quot;Femme&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">Hommes =</span> <span class="fu">sum</span>(sexef <span class="sc">==</span> <span class="st">&quot;Homme&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), by <span class="ot">=</span> .(cspf)]</span>
<span id="cb684-17"><a href="#cb684-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-18"><a href="#cb684-18" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE :</span></span>
<span id="cb684-19"><a href="#cb684-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemple avec les variables dans .SDcols</span></span>
<span id="cb684-20"><a href="#cb684-20" aria-hidden="true" tabindex="-1"></a><span class="co"># data.table::setDT(DF)[, lapply(.SD, mean, na.rm = TRUE), .SDcols = c(&quot;x&quot;, &quot;y&quot;), by = list(g, h)]</span></span>
<span id="cb684-21"><a href="#cb684-21" aria-hidden="true" tabindex="-1"></a><span class="co"># D&#39;autres variations (par exemple, c(x, y) ou list(&quot;x&quot;, &quot;y&quot;) ne fonctionnent pas !)</span></span></code></pre></div>
</div>
</div>
<div id="tabset-163-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-163-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="tableaux-croisés-à-2-variables-de-groupement" class="level2" data-number="22.3">
<h2 data-number="22.3"><span class="header-section-number">22.3</span> Tableaux croisés à 2 variables de groupement</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-164-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-164-1" role="tab" aria-controls="tabset-164-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-164-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-164-2" role="tab" aria-controls="tabset-164-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-164-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-164-3" role="tab" aria-controls="tabset-164-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-164-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-164-4" role="tab" aria-controls="tabset-164-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-164-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-164-5" role="tab" aria-controls="tabset-164-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-164-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-164-1-tab">
<div class="sourceCode" id="cb685"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb685-1"><a href="#cb685-1" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> tabulate<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb685-2"><a href="#cb685-2" aria-hidden="true" tabindex="-1"></a>  class cspf sexef;</span>
<span id="cb685-3"><a href="#cb685-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> note_contenu;</span>
<span id="cb685-4"><a href="#cb685-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">table</span> (cspf all = <span class="st">&quot;Ensemble&quot;</span>), sexef * (note_contenu) * <span class="fu">mean</span>;</span>
<span id="cb685-5"><a href="#cb685-5" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-164-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-164-2-tab">
<div class="cell">
<div class="sourceCode" id="cb686"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb686-1"><a href="#cb686-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau croisé Cspf par Sexef</span></span>
<span id="cb686-2"><a href="#cb686-2" aria-hidden="true" tabindex="-1"></a>varGroupement <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>)</span>
<span id="cb686-3"><a href="#cb686-3" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>)</span>
<span id="cb686-4"><a href="#cb686-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb686-5"><a href="#cb686-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution avec tapply</span></span>
<span id="cb686-6"><a href="#cb686-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(donnees_rbase[, variable], donnees_rbase[varGroupement], <span class="cf">function</span>(x) <span class="at">moyenne =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb686-7"><a href="#cb686-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb686-8"><a href="#cb686-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution avec xtabs</span></span>
<span id="cb686-9"><a href="#cb686-9" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(note_contenu <span class="sc">~</span> cspf <span class="sc">+</span> sexef, <span class="fu">aggregate</span>(note_contenu <span class="sc">~</span> cspf <span class="sc">+</span> sexef, <span class="at">data =</span> donnees_rbase, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb686-10"><a href="#cb686-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou, sous forme de formule</span></span>
<span id="cb686-11"><a href="#cb686-11" aria-hidden="true" tabindex="-1"></a>formule <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(variable, <span class="fu">paste</span>(varGroupement, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>), <span class="at">sep =</span> <span class="st">&quot; ~ &quot;</span>))</span>
<span id="cb686-12"><a href="#cb686-12" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(formule, <span class="fu">aggregate</span>(formule, <span class="at">data =</span> donnees_rbase, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb686-13"><a href="#cb686-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb686-14"><a href="#cb686-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution avec aggregate, en calculant un tableau &quot;long&quot; et en le transformant en &quot;wide&quot;</span></span>
<span id="cb686-15"><a href="#cb686-15" aria-hidden="true" tabindex="-1"></a>tableau <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(note_contenu <span class="sc">~</span> cspf <span class="sc">+</span> sexef, <span class="at">data =</span> donnees_rbase, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb686-16"><a href="#cb686-16" aria-hidden="true" tabindex="-1"></a>tableau <span class="ot">&lt;-</span> <span class="fu">reshape</span>(tableau, </span>
<span id="cb686-17"><a href="#cb686-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">timevar =</span> varGroupement[<span class="dv">2</span>],</span>
<span id="cb686-18"><a href="#cb686-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">idvar =</span> varGroupement[<span class="dv">1</span>],</span>
<span id="cb686-19"><a href="#cb686-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">direction =</span> <span class="st">&quot;wide&quot;</span>)</span>
<span id="cb686-20"><a href="#cb686-20" aria-hidden="true" tabindex="-1"></a>tableau[<span class="fu">is.na</span>(tableau)] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code></pre></div>
</div>
</div>
<div id="tabset-164-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-164-3-tab">
<div class="cell">
<div class="sourceCode" id="cb687"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb687-1"><a href="#cb687-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau croisé Cspf par Sexef</span></span>
<span id="cb687-2"><a href="#cb687-2" aria-hidden="true" tabindex="-1"></a>varGroupement <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>)</span>
<span id="cb687-3"><a href="#cb687-3" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>)</span>
<span id="cb687-4"><a href="#cb687-4" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb687-5"><a href="#cb687-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(varGroupement))) <span class="sc">%&gt;%</span> </span>
<span id="cb687-6"><a href="#cb687-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(variable), <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.names =</span> <span class="st">&quot;Moyenne&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb687-7"><a href="#cb687-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(varGroupement[<span class="dv">2</span>], Moyenne)</span>
<span id="cb687-8"><a href="#cb687-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb687-9"><a href="#cb687-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution</span></span>
<span id="cb687-10"><a href="#cb687-10" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb687-11"><a href="#cb687-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="sc">!!!</span><span class="fu">syms</span>(varGroupement)) <span class="sc">%&gt;%</span> </span>
<span id="cb687-12"><a href="#cb687-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Moyenne =</span> <span class="fu">mean</span>(.data[[variable]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb687-13"><a href="#cb687-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(varGroupement[<span class="dv">2</span>], Moyenne)</span></code></pre></div>
</div>
</div>
<div id="tabset-164-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-164-4-tab">
<div class="cell">
<div class="sourceCode" id="cb688"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb688-1"><a href="#cb688-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau croisé Cspf par Sexef</span></span>
<span id="cb688-2"><a href="#cb688-2" aria-hidden="true" tabindex="-1"></a>varGroupement <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>)</span>
<span id="cb688-3"><a href="#cb688-3" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">&quot;note_contenu&quot;</span></span>
<span id="cb688-4"><a href="#cb688-4" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">dcast</span>(donnees_datatable, cspf <span class="sc">~</span> sexef, <span class="at">value.var =</span> <span class="st">&quot;note_contenu&quot;</span>, <span class="at">fun.aggregate =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb688-5"><a href="#cb688-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb688-6"><a href="#cb688-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec références seulement</span></span>
<span id="cb688-7"><a href="#cb688-7" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">dcast</span>(donnees_datatable, <span class="fu">get</span>(varGroupement[<span class="dv">1</span>]) <span class="sc">~</span> <span class="fu">get</span>(varGroupement[<span class="dv">2</span>]), <span class="at">value.var =</span> variable,</span>
<span id="cb688-8"><a href="#cb688-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fun.aggregate =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb688-9"><a href="#cb688-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb688-10"><a href="#cb688-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Autre solution, plus indirecte</span></span>
<span id="cb688-11"><a href="#cb688-11" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : attention, toujours utiliser lapply, même avec une seule variable ! LE DIRE !!!</span></span>
<span id="cb688-12"><a href="#cb688-12" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> donnees_datatable[, <span class="fu">lapply</span>(.SD, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), keyby <span class="ot">=</span> varGroupement, .SDcols <span class="ot">=</span> <span class="st">&quot;note_contenu&quot;</span>]</span>
<span id="cb688-13"><a href="#cb688-13" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">dcast</span>(tab, <span class="fu">get</span>(varGroupement[<span class="dv">1</span>]) <span class="sc">~</span> <span class="fu">get</span>(varGroupement[<span class="dv">2</span>]), <span class="at">value.var =</span> variable)</span></code></pre></div>
</div>
</div>
<div id="tabset-164-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-164-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="tableaux-croisés-à-3-variables-de-groupement-ou-plus-1-variable-en-ligne-2-en-colonne" class="level2" data-number="22.4">
<h2 data-number="22.4"><span class="header-section-number">22.4</span> Tableaux croisés à 3 variables de groupement ou plus : 1 variable en ligne, 2 en colonne</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-165-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-165-1" role="tab" aria-controls="tabset-165-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-165-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-165-2" role="tab" aria-controls="tabset-165-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-165-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-165-3" role="tab" aria-controls="tabset-165-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-165-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-165-4" role="tab" aria-controls="tabset-165-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-165-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-165-5" role="tab" aria-controls="tabset-165-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-165-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-165-1-tab">
<div class="sourceCode" id="cb689"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb689-1"><a href="#cb689-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Notes par croisement de CSP (en ligne) et de Sexe x Niveau */</span></span>
<span id="cb689-2"><a href="#cb689-2" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> notes = note_contenu note_formateur note_moyens note_accompagnement note_materiel;</span>
<span id="cb689-3"><a href="#cb689-3" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> tabulate<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb689-4"><a href="#cb689-4" aria-hidden="true" tabindex="-1"></a>  class cspf sexef;</span>
<span id="cb689-5"><a href="#cb689-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> <span class="kw">&amp;notes.</span>;</span>
<span id="cb689-6"><a href="#cb689-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">table</span> (cspf all = <span class="st">&quot;Ensemble&quot;</span>), sexef * (<span class="kw">&amp;notes.</span>) * <span class="fu">mean</span>;</span>
<span id="cb689-7"><a href="#cb689-7" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb689-8"><a href="#cb689-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb689-9"><a href="#cb689-9" aria-hidden="true" tabindex="-1"></a><span class="co">/* Note_contenu par croisement de CSP (en ligne) et de Sexe x Niveau */</span></span>
<span id="cb689-10"><a href="#cb689-10" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> tabulate<span class="kw"> data</span> = donnees_sas;</span>
<span id="cb689-11"><a href="#cb689-11" aria-hidden="true" tabindex="-1"></a>  class cspf sexef Niveau;</span>
<span id="cb689-12"><a href="#cb689-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var</span> note_moyenne;</span>
<span id="cb689-13"><a href="#cb689-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">table</span> (cspf all = <span class="st">&quot;Ensemble&quot;</span>), (sexef * Niveau) * (note_moyenne) * <span class="fu">mean</span>;</span>
<span id="cb689-14"><a href="#cb689-14" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-165-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-165-2-tab">
<div class="cell">
<div class="sourceCode" id="cb690"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb690-1"><a href="#cb690-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1er exemple : CSPF en ligne, et chacune des 5 notes croisées avec le sexe en colonne</span></span>
<span id="cb690-2"><a href="#cb690-2" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb690-3"><a href="#cb690-3" aria-hidden="true" tabindex="-1"></a>var_groupe <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>)</span>
<span id="cb690-4"><a href="#cb690-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb690-5"><a href="#cb690-5" aria-hidden="true" tabindex="-1"></a>tableau <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(donnees_rbase[, varNotes], donnees_rbase[var_groupe], <span class="cf">function</span>(x) <span class="at">moyenne =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb690-6"><a href="#cb690-6" aria-hidden="true" tabindex="-1"></a><span class="fu">reshape</span>(tableau, </span>
<span id="cb690-7"><a href="#cb690-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">timevar =</span> var_groupe[<span class="dv">2</span>],</span>
<span id="cb690-8"><a href="#cb690-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">idvar =</span> var_groupe[<span class="dv">1</span>],</span>
<span id="cb690-9"><a href="#cb690-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">direction =</span> <span class="st">&quot;wide&quot;</span>)</span>
<span id="cb690-10"><a href="#cb690-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb690-11"><a href="#cb690-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 2e exemple : CSPF en ligne, et croisement Sexe x Qualifié en colonne, note_contenu sommée</span></span>
<span id="cb690-12"><a href="#cb690-12" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : proposer une fonction ?</span></span>
<span id="cb690-13"><a href="#cb690-13" aria-hidden="true" tabindex="-1"></a>formule <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="st">&quot;note_contenu ~ cspf + sexef + niveau&quot;</span>)</span>
<span id="cb690-14"><a href="#cb690-14" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(formule, <span class="fu">aggregate</span>(formule, <span class="at">data =</span> donnees_rbase, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb690-15"><a href="#cb690-15" aria-hidden="true" tabindex="-1"></a>nomsCol <span class="ot">&lt;-</span> <span class="fu">do.call</span>(paste, <span class="fu">c</span>(<span class="fu">expand.grid</span>(<span class="fu">dimnames</span>(tab)[<span class="sc">-</span>1L]), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>))</span>
<span id="cb690-16"><a href="#cb690-16" aria-hidden="true" tabindex="-1"></a>nomsLig <span class="ot">&lt;-</span> <span class="fu">dimnames</span>(tab)[[1L]]</span>
<span id="cb690-17"><a href="#cb690-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformation du tableau de résultats (en format array) vers un format matrix, puis dataframe</span></span>
<span id="cb690-18"><a href="#cb690-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Permet d&#39;exprimer le array (matrice multidimensionnelle) en un tableau à deux dimensions</span></span>
<span id="cb690-19"><a href="#cb690-19" aria-hidden="true" tabindex="-1"></a><span class="co"># On transforme le tableau en matrice ayant en nombre de lignes dim(tab)[1], c&#39;est-à-dire le nombre de lignes du array</span></span>
<span id="cb690-20"><a href="#cb690-20" aria-hidden="true" tabindex="-1"></a><span class="co"># et en nombre de colonnes le reste des variables</span></span>
<span id="cb690-21"><a href="#cb690-21" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(tab, <span class="at">nrow =</span> <span class="fu">dim</span>(tab)[1L]))</span>
<span id="cb690-22"><a href="#cb690-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Renommage des noms des colonnes de la base</span></span>
<span id="cb690-23"><a href="#cb690-23" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tab) <span class="ot">&lt;-</span> nomsCol</span>
<span id="cb690-24"><a href="#cb690-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Renommage des noms des lignes de la base</span></span>
<span id="cb690-25"><a href="#cb690-25" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(tab) <span class="ot">&lt;-</span> nomsLig</span>
<span id="cb690-26"><a href="#cb690-26" aria-hidden="true" tabindex="-1"></a><span class="co"># On annule les valeurs manquantes</span></span>
<span id="cb690-27"><a href="#cb690-27" aria-hidden="true" tabindex="-1"></a>tab[<span class="fu">is.na</span>(tab)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb690-28"><a href="#cb690-28" aria-hidden="true" tabindex="-1"></a>tab</span>
<span id="cb690-29"><a href="#cb690-29" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : développer autour de cet exemple</span></span>
<span id="cb690-30"><a href="#cb690-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec 3 variables</span></span>
<span id="cb690-31"><a href="#cb690-31" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="fu">cbind</span>(note_contenu, note_materiel) <span class="sc">~</span> cspf <span class="sc">+</span> sexef, donnees_rbase)</span></code></pre></div>
</div>
</div>
<div id="tabset-165-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-165-3-tab">
<div class="cell">
<div class="sourceCode" id="cb691"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb691-1"><a href="#cb691-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1er exemple : CSPF en ligne, et chacune des 5 notes croisées avec le sexe en colonne</span></span>
<span id="cb691-2"><a href="#cb691-2" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb691-3"><a href="#cb691-3" aria-hidden="true" tabindex="-1"></a>var_groupe <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>)</span>
<span id="cb691-4"><a href="#cb691-4" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb691-5"><a href="#cb691-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(var_groupe))) <span class="sc">%&gt;%</span> </span>
<span id="cb691-6"><a href="#cb691-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(varNotes), <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb691-7"><a href="#cb691-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> sexef,</span>
<span id="cb691-8"><a href="#cb691-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="fu">all_of</span>(varNotes))</span>
<span id="cb691-9"><a href="#cb691-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb691-10"><a href="#cb691-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 2e exemple : CSPF en ligne, et croisement Sexe x Qualifié en colonne, note_contenu sommée</span></span>
<span id="cb691-11"><a href="#cb691-11" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>)</span>
<span id="cb691-12"><a href="#cb691-12" aria-hidden="true" tabindex="-1"></a>var_groupe <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>, <span class="st">&quot;niveau&quot;</span>)</span>
<span id="cb691-13"><a href="#cb691-13" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb691-14"><a href="#cb691-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(var_groupe))) <span class="sc">%&gt;%</span> </span>
<span id="cb691-15"><a href="#cb691-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(varNotes), <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb691-16"><a href="#cb691-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="fu">c</span>(sexef, niveau),</span>
<span id="cb691-17"><a href="#cb691-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="fu">all_of</span>(varNotes),</span>
<span id="cb691-18"><a href="#cb691-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_fill =</span> <span class="dv">0</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-165-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-165-4-tab">
<div class="cell">
<div class="sourceCode" id="cb692"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb692-1"><a href="#cb692-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1er exemple : CSPF en ligne, et chacune des 5 notes croisées avec le sexe en colonne</span></span>
<span id="cb692-2"><a href="#cb692-2" aria-hidden="true" tabindex="-1"></a>varNotes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;note_contenu&quot;</span>, <span class="st">&quot;note_formateur&quot;</span>, <span class="st">&quot;note_moyens&quot;</span>, <span class="st">&quot;note_accompagnement&quot;</span>, <span class="st">&quot;note_materiel&quot;</span>)</span>
<span id="cb692-3"><a href="#cb692-3" aria-hidden="true" tabindex="-1"></a>var_groupe <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;cspf&quot;</span>, <span class="st">&quot;sexef&quot;</span>)</span>
<span id="cb692-4"><a href="#cb692-4" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">dcast</span>(donnees_datatable, <span class="fu">get</span>(varGroupement[<span class="dv">1</span>]) <span class="sc">~</span> <span class="fu">get</span>(varGroupement[<span class="dv">2</span>]), <span class="at">value.var =</span> varNotes,</span>
<span id="cb692-5"><a href="#cb692-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fun.aggregate =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb692-6"><a href="#cb692-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb692-7"><a href="#cb692-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2e exemple : CSPF en ligne, et croisement Sexe x Qualifié en colonne, note_contenu sommée</span></span>
<span id="cb692-8"><a href="#cb692-8" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">dcast</span>(donnees_datatable, cspf <span class="sc">~</span> sexef <span class="sc">+</span> niveau, <span class="at">value.var =</span> <span class="st">&quot;note_contenu&quot;</span>,</span>
<span id="cb692-9"><a href="#cb692-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fun.aggregate =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-165-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-165-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="boucles" class="level1" data-number="23">
<h1 data-number="23"><span class="header-section-number">23</span> Boucles</h1>
<section id="boucles-imbriquées" class="level2" data-number="23.1">
<h2 data-number="23.1"><span class="header-section-number">23.1</span> Boucles imbriquées</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-166-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-166-1" role="tab" aria-controls="tabset-166-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-166-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-166-2" role="tab" aria-controls="tabset-166-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-166-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-166-3" role="tab" aria-controls="tabset-166-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-166-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-166-4" role="tab" aria-controls="tabset-166-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-166-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-166-5" role="tab" aria-controls="tabset-166-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-166-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-166-1-tab">
<div class="sourceCode" id="cb693"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb693-1"><a href="#cb693-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> _null_;<span class="kw">call</span> symput(<span class="st">&#39;annee&#39;</span>, strip(<span class="fu">year</span>(<span class="fu">today</span>())))<span class="kw">;run</span>;</span>
<span id="cb693-2"><a href="#cb693-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* Ensemble des premiers jours de chaque mois entre 2020 et le 31 décembre de l&#39;année courante */</span></span>
<span id="cb693-3"><a href="#cb693-3" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> Boucles_Imbriquees(an_debut, an_fin);</span>
<span id="cb693-4"><a href="#cb693-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%local</span> i j;</span>
<span id="cb693-5"><a href="#cb693-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%global</span> liste_mois;</span>
<span id="cb693-6"><a href="#cb693-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%let</span> liste_mois = ;</span>
<span id="cb693-7"><a href="#cb693-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%do</span> i = <span class="kw">&amp;an_debut.</span> <span class="kw">%to</span> <span class="kw">&amp;an_fin.</span>;</span>
<span id="cb693-8"><a href="#cb693-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%do</span> j = <span class="dv">1</span> <span class="kw">%to</span> <span class="dv">12</span>;</span>
<span id="cb693-9"><a href="#cb693-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">%let</span> liste_mois = <span class="kw">&amp;liste_mois.</span> <span class="kw">%sysfunc</span>(<span class="fu">putn</span>(<span class="kw">%sysfunc</span>(<span class="fu">mdy</span>(<span class="kw">&amp;j.</span>, <span class="dv">1</span>, <span class="kw">&amp;i.</span>)), ddmmyy10.));</span>
<span id="cb693-10"><a href="#cb693-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%end</span>;</span>
<span id="cb693-11"><a href="#cb693-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%end</span>;</span>
<span id="cb693-12"><a href="#cb693-12" aria-hidden="true" tabindex="-1"></a><span class="kw">%mend</span> Boucles_Imbriquees;</span>
<span id="cb693-13"><a href="#cb693-13" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> annee = <span class="kw">%sysfunc</span>(<span class="fu">year</span>(<span class="kw">%sysfunc</span>(<span class="fu">today</span>())));</span>
<span id="cb693-14"><a href="#cb693-14" aria-hidden="true" tabindex="-1"></a>%Boucles_Imbriquees(an_debut = 2020, an_fin = &amp;annee.);</span>
<span id="cb693-15"><a href="#cb693-15" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> <span class="kw">&amp;liste_mois.</span>;</span></code></pre></div>
</div>
<div id="tabset-166-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-166-2-tab">
<div class="cell">
<div class="sourceCode" id="cb694"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb694-1"><a href="#cb694-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensemble des premiers jours de chaque mois entre 2020 et l&#39;année courante</span></span>
<span id="cb694-2"><a href="#cb694-2" aria-hidden="true" tabindex="-1"></a>annee <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">year</span>(<span class="fu">Sys.Date</span>())</span>
<span id="cb694-3"><a href="#cb694-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1ère solution avec for (lente, à déconseiller !)</span></span>
<span id="cb694-4"><a href="#cb694-4" aria-hidden="true" tabindex="-1"></a>listeMois <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb694-5"><a href="#cb694-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">2020</span>, annee)) {</span>
<span id="cb694-6"><a href="#cb694-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) {</span>
<span id="cb694-7"><a href="#cb694-7" aria-hidden="true" tabindex="-1"></a>    listeMois <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(listeMois, lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%02d-%02d-01&quot;</span>, i, j))), <span class="at">origin =</span> <span class="st">&quot;1970-01-01&quot;</span>)</span>
<span id="cb694-8"><a href="#cb694-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb694-9"><a href="#cb694-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb694-10"><a href="#cb694-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 2e  solution : 2 fonctions lapply imbriquées</span></span>
<span id="cb694-11"><a href="#cb694-11" aria-hidden="true" tabindex="-1"></a>listeMois <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">seq</span>(<span class="dv">2020</span>, annee), </span>
<span id="cb694-12"><a href="#cb694-12" aria-hidden="true" tabindex="-1"></a>                                   <span class="cf">function</span>(x) <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="cf">function</span>(y) lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%02d-%02d-01&quot;</span>, x, y))))),</span>
<span id="cb694-13"><a href="#cb694-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">origin =</span> <span class="st">&quot;1970-01-01&quot;</span>)</span>
<span id="cb694-14"><a href="#cb694-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 3e solution : expand.grid</span></span>
<span id="cb694-15"><a href="#cb694-15" aria-hidden="true" tabindex="-1"></a>listeMois <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">as.Date</span>(<span class="fu">apply</span>(<span class="fu">expand.grid</span>(<span class="fu">seq</span>(<span class="dv">2020</span>, annee), <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>), <span class="dv">1</span>, </span>
<span id="cb694-16"><a href="#cb694-16" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">function</span>(x) lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%02d-%02d-01&quot;</span>, x[<span class="dv">1</span>], x[<span class="dv">2</span>]))),</span>
<span id="cb694-17"><a href="#cb694-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">origin =</span> <span class="st">&quot;1970-01-01&quot;</span>))</span>
<span id="cb694-18"><a href="#cb694-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 4e solution, la plus simple !</span></span>
<span id="cb694-19"><a href="#cb694-19" aria-hidden="true" tabindex="-1"></a><span class="fu">seq.Date</span>(lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%02d-01-01&quot;</span>, <span class="dv">2020</span>)), lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%02d-12-01&quot;</span>, annee)), <span class="at">by =</span> <span class="st">&quot;month&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-166-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-166-3-tab">
<div class="cell">
<div class="sourceCode" id="cb695"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb695-1"><a href="#cb695-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensemble des premiers jours de chaque mois entre 2020 et l&#39;année courante</span></span>
<span id="cb695-2"><a href="#cb695-2" aria-hidden="true" tabindex="-1"></a>annee <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">year</span>(<span class="fu">Sys.Date</span>())</span>
<span id="cb695-3"><a href="#cb695-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1ère solution : 2 fonctions map imbriquées</span></span>
<span id="cb695-4"><a href="#cb695-4" aria-hidden="true" tabindex="-1"></a>listeMois <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="fu">seq</span>(<span class="dv">2020</span>, annee), </span>
<span id="cb695-5"><a href="#cb695-5" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">function</span>(x) purrr<span class="sc">::</span><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>,</span>
<span id="cb695-6"><a href="#cb695-6" aria-hidden="true" tabindex="-1"></a>                                               <span class="cf">function</span>(y) lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%02d-%02d-01&quot;</span>, x, y)))) <span class="sc">%&gt;%</span> </span>
<span id="cb695-7"><a href="#cb695-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb695-8"><a href="#cb695-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.Date</span>(, <span class="at">origin =</span> <span class="st">&quot;1970-01-01&quot;</span>)</span>
<span id="cb695-9"><a href="#cb695-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb695-10"><a href="#cb695-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 2e solution : expand_grid</span></span>
<span id="cb695-11"><a href="#cb695-11" aria-hidden="true" tabindex="-1"></a>listeMois <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">annee =</span> <span class="fu">seq</span>(<span class="dv">2020</span>, annee), <span class="at">mois =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb695-12"><a href="#cb695-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="dv">1</span>, <span class="cf">function</span>(x) lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%02d-%02d-01&quot;</span>, x[<span class="dv">1</span>], x[<span class="dv">2</span>]))) <span class="sc">%&gt;%</span> </span>
<span id="cb695-13"><a href="#cb695-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.Date</span>(, <span class="at">origin =</span> <span class="st">&quot;1970-01-01&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb695-14"><a href="#cb695-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span>
<span id="cb695-15"><a href="#cb695-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb695-16"><a href="#cb695-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 3e solution, la plus simple</span></span>
<span id="cb695-17"><a href="#cb695-17" aria-hidden="true" tabindex="-1"></a><span class="fu">seq.Date</span>(lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%02d-01-01&quot;</span>, <span class="dv">2020</span>)), lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%02d-12-01&quot;</span>, annee)), <span class="at">by =</span> <span class="st">&quot;month&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-166-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-166-4-tab">
<div class="cell">
<div class="sourceCode" id="cb696"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb696-1"><a href="#cb696-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensemble des premiers jours de chaque mois entre 2020 et l&#39;année courante</span></span>
<span id="cb696-2"><a href="#cb696-2" aria-hidden="true" tabindex="-1"></a>annee <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">year</span>(<span class="fu">Sys.Date</span>())</span>
<span id="cb696-3"><a href="#cb696-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1ère solution avec for (lente, à déconseiller !)</span></span>
<span id="cb696-4"><a href="#cb696-4" aria-hidden="true" tabindex="-1"></a>listeMois <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb696-5"><a href="#cb696-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">2020</span>, annee)) {</span>
<span id="cb696-6"><a href="#cb696-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) {</span>
<span id="cb696-7"><a href="#cb696-7" aria-hidden="true" tabindex="-1"></a>    listeMois <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(listeMois, lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%02d-%02d-01&quot;</span>, i, j))), <span class="at">origin =</span> <span class="st">&quot;1970-01-01&quot;</span>)</span>
<span id="cb696-8"><a href="#cb696-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb696-9"><a href="#cb696-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb696-10"><a href="#cb696-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 2e  solution : 2 fonctions lapply imbriquées</span></span>
<span id="cb696-11"><a href="#cb696-11" aria-hidden="true" tabindex="-1"></a>listeMois <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">seq</span>(<span class="dv">2020</span>, annee), </span>
<span id="cb696-12"><a href="#cb696-12" aria-hidden="true" tabindex="-1"></a>                                   <span class="cf">function</span>(x) <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="cf">function</span>(y) lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%02d-%02d-01&quot;</span>, x, y))))),</span>
<span id="cb696-13"><a href="#cb696-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">origin =</span> <span class="st">&quot;1970-01-01&quot;</span>)</span>
<span id="cb696-14"><a href="#cb696-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 3e solution : expand.grid</span></span>
<span id="cb696-15"><a href="#cb696-15" aria-hidden="true" tabindex="-1"></a>listeMois <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">as.Date</span>(<span class="fu">apply</span>(<span class="fu">expand.grid</span>(<span class="fu">seq</span>(<span class="dv">2020</span>, annee), <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>), <span class="dv">1</span>, </span>
<span id="cb696-16"><a href="#cb696-16" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">function</span>(x) lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%02d-%02d-01&quot;</span>, x[<span class="dv">1</span>], x[<span class="dv">2</span>]))),</span>
<span id="cb696-17"><a href="#cb696-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">origin =</span> <span class="st">&quot;1970-01-01&quot;</span>))</span>
<span id="cb696-18"><a href="#cb696-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 4e solution, la plus simple</span></span>
<span id="cb696-19"><a href="#cb696-19" aria-hidden="true" tabindex="-1"></a><span class="fu">seq.Date</span>(lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%02d-01-01&quot;</span>, <span class="dv">2020</span>)), lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%02d-12-01&quot;</span>, annee)), <span class="at">by =</span> <span class="st">&quot;month&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="tabset-166-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-166-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="boucles-imbriquées-second-exemple" class="level2" data-number="23.2">
<h2 data-number="23.2"><span class="header-section-number">23.2</span> Boucles imbriquées (second exemple)</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-167-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-167-1" role="tab" aria-controls="tabset-167-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-167-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-167-2" role="tab" aria-controls="tabset-167-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-167-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-167-3" role="tab" aria-controls="tabset-167-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-167-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-167-4" role="tab" aria-controls="tabset-167-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-167-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-167-5" role="tab" aria-controls="tabset-167-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-167-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-167-1-tab">
<div class="sourceCode" id="cb697"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb697-1"><a href="#cb697-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Itérer sur toutes les années et les trimestres d&#39;une certaine plage */</span></span>
<span id="cb697-2"><a href="#cb697-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* on va afficher les noms base_AAAA_tT_nmax où AAAA désigne les années, T les trimestres, depuis 2020 */</span></span>
<span id="cb697-3"><a href="#cb697-3" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> iteration(debut, fin);</span>
<span id="cb697-4"><a href="#cb697-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%global</span> liste_an;</span>
<span id="cb697-5"><a href="#cb697-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%let</span> liste_an = ;</span>
<span id="cb697-6"><a href="#cb697-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%do</span> i = <span class="kw">&amp;debut.</span> <span class="kw">%to</span> <span class="kw">&amp;fin.</span>;</span>
<span id="cb697-7"><a href="#cb697-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%let</span> liste_an = <span class="kw">&amp;liste_an.&amp;i.</span>-;</span>
<span id="cb697-8"><a href="#cb697-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%end</span>;</span>
<span id="cb697-9"><a href="#cb697-9" aria-hidden="true" tabindex="-1"></a><span class="kw">%mend</span> iteration;</span>
<span id="cb697-10"><a href="#cb697-10" aria-hidden="true" tabindex="-1"></a>%iteration(debut = 2020, fin = %sysfunc(year(%sysfunc(today()))));</span>
<span id="cb697-11"><a href="#cb697-11" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> <span class="kw">&amp;liste_an.</span>;</span>
<span id="cb697-12"><a href="#cb697-12" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> liste_trim = <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span>;</span>
<span id="cb697-13"><a href="#cb697-13" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> liste_niv = <span class="fu">max</span> <span class="fu">min</span>;</span>
<span id="cb697-14"><a href="#cb697-14" aria-hidden="true" tabindex="-1"></a><span class="co">/* Supposons que nous ayons des noms de fichier suffixés par AXXXX_TY_NZ, avec X l&#39;année, Y le trimestre et</span></span>
<span id="cb697-15"><a href="#cb697-15" aria-hidden="true" tabindex="-1"></a><span class="co">   Z max ou min. Par exemple, A2010_T2_NMax */</span></span>
<span id="cb697-16"><a href="#cb697-16" aria-hidden="true" tabindex="-1"></a><span class="co">/* Pour obtenir l&#39;ensemble de ces noms de 2010 à cette année */</span></span>
<span id="cb697-17"><a href="#cb697-17" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> noms_fichiers(base = temp);</span>
<span id="cb697-18"><a href="#cb697-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%global</span> res;</span>
<span id="cb697-19"><a href="#cb697-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%let</span> res = ;</span>
<span id="cb697-20"><a href="#cb697-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%do</span> j = <span class="dv">1</span> <span class="kw">%to</span> <span class="kw">%sysfunc</span>(countw(<span class="kw">&amp;liste_an.</span>, <span class="st">&quot;-&quot;</span>));</span>
<span id="cb697-21"><a href="#cb697-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%let</span> y = <span class="kw">%scan</span>(<span class="kw">&amp;liste_an.</span>, <span class="kw">&amp;j.</span>, <span class="st">&quot;-&quot;</span>); <span class="co">/* année */</span></span>
<span id="cb697-22"><a href="#cb697-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%do</span> i = <span class="dv">1</span> <span class="kw">%to</span> <span class="dv">4</span>;</span>
<span id="cb697-23"><a href="#cb697-23" aria-hidden="true" tabindex="-1"></a>      <span class="kw">%let</span> t = <span class="kw">%scan</span>(<span class="kw">&amp;liste_trim,</span> <span class="kw">&amp;i.</span>); <span class="co">/* trimestre */</span></span>
<span id="cb697-24"><a href="#cb697-24" aria-hidden="true" tabindex="-1"></a>      <span class="kw">%do</span> g = <span class="dv">1</span> <span class="kw">%to</span> <span class="dv">2</span>;</span>
<span id="cb697-25"><a href="#cb697-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">%let</span> <span class="fu">n</span> = <span class="kw">%scan</span>(<span class="kw">&amp;liste_niv.</span>, <span class="kw">&amp;g.</span>); <span class="co">/* niveau */</span></span>
<span id="cb697-26"><a href="#cb697-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">%let</span> res = <span class="kw">&amp;res.</span> <span class="kw">&amp;base.</span>_<span class="kw">&amp;y.</span>_t<span class="kw">&amp;t.</span>_n<span class="kw">&amp;n.</span>;</span>
<span id="cb697-27"><a href="#cb697-27" aria-hidden="true" tabindex="-1"></a>      <span class="kw">%end</span>;</span>
<span id="cb697-28"><a href="#cb697-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%end</span>;</span>
<span id="cb697-29"><a href="#cb697-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%end</span>;</span>
<span id="cb697-30"><a href="#cb697-30" aria-hidden="true" tabindex="-1"></a><span class="kw">%mend</span> noms_fichiers;</span>
<span id="cb697-31"><a href="#cb697-31" aria-hidden="true" tabindex="-1"></a>%noms_fichiers(base = base);</span>
<span id="cb697-32"><a href="#cb697-32" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> <span class="kw">&amp;res.</span>;</span></code></pre></div>
</div>
<div id="tabset-167-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-167-2-tab">
<div class="cell">
<div class="sourceCode" id="cb698"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb698-1"><a href="#cb698-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Itérer sur toutes les années et les trimestres d&#39;une certaine plage</span></span>
<span id="cb698-2"><a href="#cb698-2" aria-hidden="true" tabindex="-1"></a><span class="co"># on va afficher les noms base_AAAA_tT_nmax où AAAA désigne les années, T les trimestres, depuis 2020 </span></span>
<span id="cb698-3"><a href="#cb698-3" aria-hidden="true" tabindex="-1"></a>debut <span class="ot">&lt;-</span> <span class="dv">2020</span></span>
<span id="cb698-4"><a href="#cb698-4" aria-hidden="true" tabindex="-1"></a>fin <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">year</span>(<span class="fu">Sys.Date</span>())</span>
<span id="cb698-5"><a href="#cb698-5" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(debut<span class="sc">:</span>fin, <span class="cf">function</span>(x) <span class="fu">lapply</span>(<span class="fu">c</span>(<span class="st">&quot;max&quot;</span>, <span class="st">&quot;min&quot;</span>), <span class="cf">function</span>(y)  <span class="fu">sprintf</span>(<span class="st">&quot;base_%4d_t%d_n%s&quot;</span>, x, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, y))))</span></code></pre></div>
</div>
</div>
<div id="tabset-167-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-167-3-tab">
<div class="cell">
<div class="sourceCode" id="cb699"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb699-1"><a href="#cb699-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Itérer sur toutes les années et les trimestres d&#39;une certaine plage</span></span>
<span id="cb699-2"><a href="#cb699-2" aria-hidden="true" tabindex="-1"></a><span class="co"># on va afficher les noms base_AAAA_tT_nmax où AAAA désigne les années, T les trimestres, depuis 2020 </span></span>
<span id="cb699-3"><a href="#cb699-3" aria-hidden="true" tabindex="-1"></a>debut <span class="ot">&lt;-</span> <span class="dv">2020</span></span>
<span id="cb699-4"><a href="#cb699-4" aria-hidden="true" tabindex="-1"></a>fin <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">year</span>(<span class="fu">Sys.Date</span>())</span>
<span id="cb699-5"><a href="#cb699-5" aria-hidden="true" tabindex="-1"></a>listeMois <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(debut<span class="sc">:</span>fin, </span>
<span id="cb699-6"><a href="#cb699-6" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">function</span>(x) purrr<span class="sc">::</span><span class="fu">map</span>(<span class="fu">c</span>(<span class="st">&quot;max&quot;</span>, <span class="st">&quot;min&quot;</span>),</span>
<span id="cb699-7"><a href="#cb699-7" aria-hidden="true" tabindex="-1"></a>                                               <span class="cf">function</span>(y) <span class="fu">sprintf</span>(<span class="st">&quot;base_%4d_t%d_n%s&quot;</span>, x, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, y))) <span class="sc">%&gt;%</span> </span>
<span id="cb699-8"><a href="#cb699-8" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">unlist</span>()</span></code></pre></div>
</div>
</div>
<div id="tabset-167-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-167-4-tab">
<div class="cell">
<div class="sourceCode" id="cb700"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb700-1"><a href="#cb700-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Itérer sur toutes les années et les trimestres d&#39;une certaine plage</span></span>
<span id="cb700-2"><a href="#cb700-2" aria-hidden="true" tabindex="-1"></a><span class="co"># on va afficher les noms base_AAAA_tT_nmax où AAAA désigne les années, T les trimestres, depuis 2020 </span></span>
<span id="cb700-3"><a href="#cb700-3" aria-hidden="true" tabindex="-1"></a>debut <span class="ot">&lt;-</span> <span class="dv">2020</span></span>
<span id="cb700-4"><a href="#cb700-4" aria-hidden="true" tabindex="-1"></a>fin <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">year</span>(<span class="fu">Sys.Date</span>())</span>
<span id="cb700-5"><a href="#cb700-5" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(debut<span class="sc">:</span>fin, <span class="cf">function</span>(x) <span class="fu">lapply</span>(<span class="fu">c</span>(<span class="st">&quot;max&quot;</span>, <span class="st">&quot;min&quot;</span>), <span class="cf">function</span>(y)  <span class="fu">sprintf</span>(<span class="st">&quot;base_%4d_t%d_n%s&quot;</span>, x, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, y))))</span></code></pre></div>
</div>
</div>
<div id="tabset-167-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-167-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="boucles-for" class="level2" data-number="23.3">
<h2 data-number="23.3"><span class="header-section-number">23.3</span> Boucles for</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-168-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-168-1" role="tab" aria-controls="tabset-168-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-168-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-168-2" role="tab" aria-controls="tabset-168-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-168-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-168-3" role="tab" aria-controls="tabset-168-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-168-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-168-4" role="tab" aria-controls="tabset-168-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-168-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-168-5" role="tab" aria-controls="tabset-168-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-168-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-168-1-tab">
<div class="sourceCode" id="cb701"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb701-1"><a href="#cb701-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* On va créer une base par année d&#39;entrée */</span></span>
<span id="cb701-2"><a href="#cb701-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql noprint;</span>
<span id="cb701-3"><a href="#cb701-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> <span class="fu">year</span>(<span class="fu">min</span>(date_entree)), <span class="fu">year</span>(<span class="fu">max</span>(date_entree)) <span class="kw">into</span> :an_min, :an_max</span>
<span id="cb701-4"><a href="#cb701-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> donnees_sas;</span>
<span id="cb701-5"><a href="#cb701-5" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span>
<span id="cb701-6"><a href="#cb701-6" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> Base_par_mois(debut, fin);</span>
<span id="cb701-7"><a href="#cb701-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* %local impose que an n&#39;est pas de signification hors de la macro */</span></span>
<span id="cb701-8"><a href="#cb701-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%local</span> an;</span>
<span id="cb701-9"><a href="#cb701-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* %global impose que nom_bases peut être utilisé en dehors de la macro */</span></span>
<span id="cb701-10"><a href="#cb701-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%global</span> nom_bases;</span>
<span id="cb701-11"><a href="#cb701-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* On initalise la création de la macri-variable nom_bases */</span></span>
<span id="cb701-12"><a href="#cb701-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%let</span> nom_bases = ;</span>
<span id="cb701-13"><a href="#cb701-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* On itère entre &amp;debut. et &amp;fin. */</span></span>
<span id="cb701-14"><a href="#cb701-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%do</span> an = <span class="kw">&amp;debut.</span> <span class="kw">%to</span> <span class="kw">&amp;fin.</span>;</span>
<span id="cb701-15"><a href="#cb701-15" aria-hidden="true" tabindex="-1"></a><span class="kw">    data</span> Entree_<span class="kw">&amp;an.</span>;</span>
<span id="cb701-16"><a href="#cb701-16" aria-hidden="true" tabindex="-1"></a>      <span class="kw">set</span> donnees_sas;</span>
<span id="cb701-17"><a href="#cb701-17" aria-hidden="true" tabindex="-1"></a>      <span class="kw">if</span> <span class="fu">year</span>(date_entree) = <span class="kw">&amp;an.</span>;</span>
<span id="cb701-18"><a href="#cb701-18" aria-hidden="true" tabindex="-1"></a><span class="kw">    run</span>;</span>
<span id="cb701-19"><a href="#cb701-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* On ajoute à la macro-variable le nom de la base */</span></span>
<span id="cb701-20"><a href="#cb701-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%let</span> nom_bases = <span class="kw">&amp;nom_bases.</span> Entree_<span class="kw">&amp;an.</span>;</span>
<span id="cb701-21"><a href="#cb701-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%end</span>;</span>
<span id="cb701-22"><a href="#cb701-22" aria-hidden="true" tabindex="-1"></a><span class="kw">%mend</span> Base_par_mois;</span>
<span id="cb701-23"><a href="#cb701-23" aria-hidden="true" tabindex="-1"></a>%Base_par_mois(debut = &amp;an_min., fin = &amp;an_max.);</span>
<span id="cb701-24"><a href="#cb701-24" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> <span class="kw">&amp;nom_bases.</span>;</span>
<span id="cb701-25"><a href="#cb701-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb701-26"><a href="#cb701-26" aria-hidden="true" tabindex="-1"></a><span class="co">/* On va désormais empiler toutes les bases (concaténation par colonne) */</span></span>
<span id="cb701-27"><a href="#cb701-27" aria-hidden="true" tabindex="-1"></a><span class="co">/* L&#39;instruction set utilisée de cette façon permet cet empilement */</span></span>
<span id="cb701-28"><a href="#cb701-28" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> concatene;</span>
<span id="cb701-29"><a href="#cb701-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> <span class="kw">&amp;nom_bases.</span>;</span>
<span id="cb701-30"><a href="#cb701-30" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span></code></pre></div>
</div>
<div id="tabset-168-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-168-2-tab">
<div class="cell">
<div class="sourceCode" id="cb702"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb702-1"><a href="#cb702-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On va créer une base par année d&#39;entrée</span></span>
<span id="cb702-2"><a href="#cb702-2" aria-hidden="true" tabindex="-1"></a>anMin <span class="ot">&lt;-</span> <span class="fu">min</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(donnees_rbase<span class="sc">$</span>date_entree), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb702-3"><a href="#cb702-3" aria-hidden="true" tabindex="-1"></a>anMax <span class="ot">&lt;-</span> <span class="fu">max</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(donnees_rbase<span class="sc">$</span>date_entree), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb702-4"><a href="#cb702-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> anMin<span class="sc">:</span>anMax) {</span>
<span id="cb702-5"><a href="#cb702-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assign permet de faire passer une chaîne de caractères en variable R</span></span>
<span id="cb702-6"><a href="#cb702-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste</span>(<span class="st">&quot;entree&quot;</span>, i, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>), donnees_rbase[<span class="fu">which</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(donnees_rbase<span class="sc">$</span>date_entree) <span class="sc">==</span> i), ])</span>
<span id="cb702-7"><a href="#cb702-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb702-8"><a href="#cb702-8" aria-hidden="true" tabindex="-1"></a><span class="co"># On va désormais empiler toutes les bases (concaténation par colonne)</span></span>
<span id="cb702-9"><a href="#cb702-9" aria-hidden="true" tabindex="-1"></a><span class="co"># do.call applique la fonction rbind à l&#39;ensemble des bases issues du lapply</span></span>
<span id="cb702-10"><a href="#cb702-10" aria-hidden="true" tabindex="-1"></a><span class="co"># get permet de faire le chemin inverse de assign</span></span>
<span id="cb702-11"><a href="#cb702-11" aria-hidden="true" tabindex="-1"></a>concatene <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">paste</span>(<span class="st">&quot;entree&quot;</span>, anMin<span class="sc">:</span>anMax, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>), get))</span></code></pre></div>
</div>
</div>
<div id="tabset-168-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-168-3-tab">
<div class="cell">
<div class="sourceCode" id="cb703"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb703-1"><a href="#cb703-1" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : problème pour les entrées où la date est manquante</span></span>
<span id="cb703-2"><a href="#cb703-2" aria-hidden="true" tabindex="-1"></a><span class="co"># On va créer une base par année d&#39;entrée</span></span>
<span id="cb703-3"><a href="#cb703-3" aria-hidden="true" tabindex="-1"></a>anMin <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">pull</span>(date_entree) <span class="sc">%&gt;%</span> lubridate<span class="sc">::</span><span class="fu">year</span>() <span class="sc">%&gt;%</span> <span class="fu">min</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb703-4"><a href="#cb703-4" aria-hidden="true" tabindex="-1"></a>anMax <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">pull</span>(date_entree) <span class="sc">%&gt;%</span> lubridate<span class="sc">::</span><span class="fu">year</span>() <span class="sc">%&gt;%</span> <span class="fu">max</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb703-5"><a href="#cb703-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> anMin<span class="sc">:</span>anMax) {</span>
<span id="cb703-6"><a href="#cb703-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assign permet de faire passer une chaîne de caractères en variable R</span></span>
<span id="cb703-7"><a href="#cb703-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste</span>(<span class="st">&quot;entree&quot;</span>, i, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>),</span>
<span id="cb703-8"><a href="#cb703-8" aria-hidden="true" tabindex="-1"></a>         donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">filter</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(date_entree) <span class="sc">==</span> <span class="fu">as.name</span>(i)))</span>
<span id="cb703-9"><a href="#cb703-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb703-10"><a href="#cb703-10" aria-hidden="true" tabindex="-1"></a><span class="co"># On va désormais empiler toutes les bases (concaténation par colonne)</span></span>
<span id="cb703-11"><a href="#cb703-11" aria-hidden="true" tabindex="-1"></a><span class="co"># purrr::reduce applique la fonction bind_rows à l&#39;ensemble des bases issues du purrr::map</span></span>
<span id="cb703-12"><a href="#cb703-12" aria-hidden="true" tabindex="-1"></a><span class="co"># get permet de faire le chemin inverse de assign</span></span>
<span id="cb703-13"><a href="#cb703-13" aria-hidden="true" tabindex="-1"></a>concatene <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="fu">paste</span>(<span class="st">&quot;entree&quot;</span>, anMin<span class="sc">:</span>anMax, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>), get) <span class="sc">%&gt;%</span> </span>
<span id="cb703-14"><a href="#cb703-14" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">reduce</span>(bind_rows)</span></code></pre></div>
</div>
</div>
<div id="tabset-168-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-168-4-tab">
<div class="cell">
<div class="sourceCode" id="cb704"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb704-1"><a href="#cb704-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On va créer une base par année d&#39;entrée</span></span>
<span id="cb704-2"><a href="#cb704-2" aria-hidden="true" tabindex="-1"></a>anMin <span class="ot">&lt;-</span> <span class="fu">min</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(donnees_datatable<span class="sc">$</span>date_entree), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb704-3"><a href="#cb704-3" aria-hidden="true" tabindex="-1"></a>anMax <span class="ot">&lt;-</span> <span class="fu">max</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(donnees_datatable<span class="sc">$</span>date_entree), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb704-4"><a href="#cb704-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> anMin<span class="sc">:</span>anMax) {</span>
<span id="cb704-5"><a href="#cb704-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assign permet de faire passer une chaîne de caractères en variable R</span></span>
<span id="cb704-6"><a href="#cb704-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste</span>(<span class="st">&quot;entree&quot;</span>, i, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>), donnees_datatable[lubridate<span class="sc">::</span><span class="fu">year</span>(donnees_datatable<span class="sc">$</span>date_entree) <span class="sc">==</span> i, ])</span>
<span id="cb704-7"><a href="#cb704-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb704-8"><a href="#cb704-8" aria-hidden="true" tabindex="-1"></a><span class="co"># On va désormais empiler toutes les bases (concaténation par colonne)</span></span>
<span id="cb704-9"><a href="#cb704-9" aria-hidden="true" tabindex="-1"></a><span class="co"># do.call applique la fonction rbind à l&#39;ensemble des bases issues du lapply</span></span>
<span id="cb704-10"><a href="#cb704-10" aria-hidden="true" tabindex="-1"></a><span class="co"># get permet de faire le chemin inverse de assign</span></span>
<span id="cb704-11"><a href="#cb704-11" aria-hidden="true" tabindex="-1"></a>concatene <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">lapply</span>(<span class="fu">paste</span>(<span class="st">&quot;entree&quot;</span>, anMin<span class="sc">:</span>anMax, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>), get))</span></code></pre></div>
</div>
</div>
<div id="tabset-168-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-168-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="boucles-for-second-exemple" class="level2" data-number="23.4">
<h2 data-number="23.4"><span class="header-section-number">23.4</span> Boucles for (second exemple)</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-169-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-169-1" role="tab" aria-controls="tabset-169-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-169-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-169-2" role="tab" aria-controls="tabset-169-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-169-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-169-3" role="tab" aria-controls="tabset-169-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-169-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-169-4" role="tab" aria-controls="tabset-169-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-169-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-169-5" role="tab" aria-controls="tabset-169-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-169-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-169-1-tab">
<div class="sourceCode" id="cb705"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb705-1"><a href="#cb705-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* On recherche toutes les valeurs de CSP différentes et on les met dans une variable.</span></span>
<span id="cb705-2"><a href="#cb705-2" aria-hidden="true" tabindex="-1"></a><span class="co">   On appelle la proc SQL :</span></span>
<span id="cb705-3"><a href="#cb705-3" aria-hidden="true" tabindex="-1"></a><span class="co">   - utilisation du quit et non run à la fin</span></span>
<span id="cb705-4"><a href="#cb705-4" aria-hidden="true" tabindex="-1"></a><span class="co">   - on récupère toutes les valeurs différentes de CSP, séparés par un espace (separated by)</span></span>
<span id="cb705-5"><a href="#cb705-5" aria-hidden="true" tabindex="-1"></a><span class="co">   - s&#39;il y a un espace dans les noms, on le remplace par _ </span></span>
<span id="cb705-6"><a href="#cb705-6" aria-hidden="true" tabindex="-1"></a><span class="co">   - on les met dans la macro-variable liste_csp</span></span>
<span id="cb705-7"><a href="#cb705-7" aria-hidden="true" tabindex="-1"></a><span class="co">   - on trier la liste par valeur de CSP */</span></span>
<span id="cb705-8"><a href="#cb705-8" aria-hidden="true" tabindex="-1"></a><span class="co">/* On crée une variable de CSP formaté sans les accents et les espaces */</span></span>
<span id="cb705-9"><a href="#cb705-9" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> donnees_sas;</span>
<span id="cb705-10"><a href="#cb705-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> donnees_sas;</span>
<span id="cb705-11"><a href="#cb705-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* SAS ne pourra pas créer des bases de données avec des noms accentués */</span></span>
<span id="cb705-12"><a href="#cb705-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* On supprime dans le nom les lettres accentués. On le fait avec la fonction Translate */</span></span>
<span id="cb705-13"><a href="#cb705-13" aria-hidden="true" tabindex="-1"></a>  CSPF2 = <span class="fu">tranwrd</span>(strip(CSPF), <span class="st">&quot; &quot;</span>, <span class="st">&quot;_&quot;</span>);</span>
<span id="cb705-14"><a href="#cb705-14" aria-hidden="true" tabindex="-1"></a>  CSPF2 = <span class="fu">translate</span>(CSPF2, <span class="st">&quot;eeeeaacio&quot;</span>, <span class="st">&quot;éèêëàâçîô&quot;</span>);</span>
<span id="cb705-15"><a href="#cb705-15" aria-hidden="true" tabindex="-1"></a><span class="kw">run</span>;</span>
<span id="cb705-16"><a href="#cb705-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb705-17"><a href="#cb705-17" aria-hidden="true" tabindex="-1"></a><span class="co">/* Boucles et macros en SAS */</span></span>
<span id="cb705-18"><a href="#cb705-18" aria-hidden="true" tabindex="-1"></a><span class="co">/* Les boucles ne peuvent être utilisées que dans le cadre de macros */</span></span>
<span id="cb705-19"><a href="#cb705-19" aria-hidden="true" tabindex="-1"></a><span class="co">/* Ouverture de la macro */</span></span>
<span id="cb705-20"><a href="#cb705-20" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> Boucles(base = donnees_sas, var = CSPF2);</span>
<span id="cb705-21"><a href="#cb705-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Les modalités de la variable */</span></span>
<span id="cb705-22"><a href="#cb705-22" aria-hidden="true" tabindex="-1"></a><span class="kw">  proc</span> sql noprint;<span class="kw">select</span> <span class="kw">distinct</span> <span class="kw">&amp;var.</span> <span class="kw">into</span> :liste separated <span class="kw">by</span> <span class="st">&quot; &quot;</span> <span class="kw">from</span> <span class="kw">&amp;base.</span> <span class="kw">order</span> <span class="kw">by</span> <span class="kw">&amp;var.</span>;<span class="kw">quit</span>;</span>
<span id="cb705-23"><a href="#cb705-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* On affiche la liste de ces modalités */</span></span>
<span id="cb705-24"><a href="#cb705-24" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%put</span> <span class="kw">&amp;liste.</span>;</span>
<span id="cb705-25"><a href="#cb705-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* %let permet à SAS d&#39;affecter une valeur à une variable en dehors d&#39;une manipulation de base de données */</span></span>
<span id="cb705-26"><a href="#cb705-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* %sysfunc indique à SAS qu&#39;il doit utiliser la fonction countw dans le cadre d&#39;une macro (pas important) */</span></span>
<span id="cb705-27"><a href="#cb705-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* countw est une fonction qui compte le nombre de mots (séparés par un espace) d&#39;une chaîne de caractères */</span></span>
<span id="cb705-28"><a href="#cb705-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* =&gt; on compte le nombre de CSP différentes */</span></span>
<span id="cb705-29"><a href="#cb705-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%let</span> nb = <span class="kw">%sysfunc</span>(countw(<span class="kw">&amp;liste.</span>));</span>
<span id="cb705-30"><a href="#cb705-30" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%put</span> Nombre de modalités différentes : <span class="kw">&amp;nb.</span>;</span>
<span id="cb705-31"><a href="#cb705-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* On itère pour chaque CSP différente ... */</span></span>
<span id="cb705-32"><a href="#cb705-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%do</span> i = <span class="dv">1</span> <span class="kw">%to</span> <span class="kw">&amp;nb.</span>;</span>
<span id="cb705-33"><a href="#cb705-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* %scan : donne le i-ème mot de &amp;liste. (les mots sont séparés par un espace) */</span></span>
<span id="cb705-34"><a href="#cb705-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* =&gt; on récupère donc la CSP numéro i */</span></span>
<span id="cb705-35"><a href="#cb705-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%let</span> j = <span class="kw">%scan</span>(<span class="kw">&amp;liste.</span>, <span class="kw">&amp;i.</span>);</span>
<span id="cb705-36"><a href="#cb705-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%put</span> Variable : <span class="kw">&amp;j.</span>;</span>
<span id="cb705-37"><a href="#cb705-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* On crée une base avec seulement les individus de la CSP correspondante */</span></span>
<span id="cb705-38"><a href="#cb705-38" aria-hidden="true" tabindex="-1"></a><span class="kw">    data</span> <span class="kw">&amp;var.</span>;<span class="kw">set</span> donnees_sas;<span class="kw">if</span> <span class="kw">&amp;var.</span> = <span class="st">&quot;&amp;j.&quot;</span><span class="kw">;run</span>;</span>
<span id="cb705-39"><a href="#cb705-39" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%end</span>;</span>
<span id="cb705-40"><a href="#cb705-40" aria-hidden="true" tabindex="-1"></a><span class="co">/* Fermeture de la macro */</span></span>
<span id="cb705-41"><a href="#cb705-41" aria-hidden="true" tabindex="-1"></a><span class="kw">%mend</span> Boucles;</span>
<span id="cb705-42"><a href="#cb705-42" aria-hidden="true" tabindex="-1"></a><span class="co">/* Lancement de la macro */</span></span>
<span id="cb705-43"><a href="#cb705-43" aria-hidden="true" tabindex="-1"></a>%Boucles(base = donnees_sas, var = CSPF2);</span></code></pre></div>
</div>
<div id="tabset-169-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-169-2-tab">
<div class="cell">
<div class="sourceCode" id="cb706"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb706-1"><a href="#cb706-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Base par CSP</span></span>
<span id="cb706-2"><a href="#cb706-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">unique</span>(donnees_rbase<span class="sc">$</span>cspf)) {</span>
<span id="cb706-3"><a href="#cb706-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Met en minuscule et enlève les accents</span></span>
<span id="cb706-4"><a href="#cb706-4" aria-hidden="true" tabindex="-1"></a>  nomBase <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">chartr</span>(<span class="st">&quot;éèêëàâçîô&quot;</span>, <span class="st">&quot;eeeeaacio&quot;</span>, i))</span>
<span id="cb706-5"><a href="#cb706-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assign permet de faire passer une chaîne de caractères en variable R</span></span>
<span id="cb706-6"><a href="#cb706-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(nomBase, donnees_rbase[<span class="fu">which</span>(donnees_rbase<span class="sc">$</span>cspf <span class="sc">==</span> i), ])</span>
<span id="cb706-7"><a href="#cb706-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="tabset-169-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-169-3-tab">
<div class="cell">
<div class="sourceCode" id="cb707"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb707-1"><a href="#cb707-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Base par CSP</span></span>
<span id="cb707-2"><a href="#cb707-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> donnees_tidyverse <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(cspf) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()) {</span>
<span id="cb707-3"><a href="#cb707-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Met en minuscule et enlève les accents</span></span>
<span id="cb707-4"><a href="#cb707-4" aria-hidden="true" tabindex="-1"></a>  nomBase <span class="ot">&lt;-</span> <span class="fu">chartr</span>(<span class="st">&quot;éèêëàâçîô&quot;</span>, <span class="st">&quot;eeeeaacio&quot;</span>, i) <span class="sc">%&gt;%</span> <span class="fu">tolower</span>()</span>
<span id="cb707-5"><a href="#cb707-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assign permet de faire passer une chaîne de caractères en variable R</span></span>
<span id="cb707-6"><a href="#cb707-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(nomBase, donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb707-7"><a href="#cb707-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">filter</span>(cspf <span class="sc">==</span> <span class="fu">as.name</span>(i)))</span>
<span id="cb707-8"><a href="#cb707-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="tabset-169-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-169-4-tab">
<div class="cell">
<div class="sourceCode" id="cb708"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb708-1"><a href="#cb708-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer une base pour chaque individu d&#39;une certaine CSP</span></span>
<span id="cb708-2"><a href="#cb708-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">unique</span>(donnees_datatable<span class="sc">$</span>cspf)) {</span>
<span id="cb708-3"><a href="#cb708-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Met en minuscule et enlève les accents</span></span>
<span id="cb708-4"><a href="#cb708-4" aria-hidden="true" tabindex="-1"></a>  nomBase <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">chartr</span>(<span class="st">&quot;éèêëàâçîô&quot;</span>, <span class="st">&quot;eeeeaacio&quot;</span>, i))</span>
<span id="cb708-5"><a href="#cb708-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assign permet de faire passer une chaîne de caractères en variable R</span></span>
<span id="cb708-6"><a href="#cb708-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(nomBase, donnees_datatable[donnees_datatable<span class="sc">$</span>cspf <span class="sc">==</span> i, ])</span>
<span id="cb708-7"><a href="#cb708-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="tabset-169-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-169-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="autres-transcriptions-de-fonctions-sas-vers-r" class="level2" data-number="23.5">
<h2 data-number="23.5"><span class="header-section-number">23.5</span> Autres transcriptions de fonctions <code>SAS</code> vers <code>R</code></h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-170-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-170-1" role="tab" aria-controls="tabset-170-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-170-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-170-2" role="tab" aria-controls="tabset-170-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-170-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-170-3" role="tab" aria-controls="tabset-170-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-170-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-170-4" role="tab" aria-controls="tabset-170-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-170-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-170-5" role="tab" aria-controls="tabset-170-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-170-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-170-1-tab">
<div class="sourceCode" id="cb709"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb709-1"><a href="#cb709-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* À FAIRE */</span></span></code></pre></div>
</div>
<div id="tabset-170-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-170-2-tab">
<div class="cell">
<div class="sourceCode" id="cb710"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb710-1"><a href="#cb710-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mesurer la durée d&#39;exécution d&#39;un programme</span></span>
<span id="cb710-2"><a href="#cb710-2" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(donnees_rbase <span class="ot">&lt;-</span> donnees_rbase[<span class="fu">order</span>(donnees_rbase<span class="sc">$</span>identifiant, donnees_rbase<span class="sc">$</span>date_entree, <span class="at">na.last =</span> <span class="cn">FALSE</span>), ])</span>
<span id="cb710-3"><a href="#cb710-3" aria-hidden="true" tabindex="-1"></a><span class="co"># En SAS : include(&quot;chemin&quot;)</span></span>
<span id="cb710-4"><a href="#cb710-4" aria-hidden="true" tabindex="-1"></a><span class="co"># En R : source(&quot;chemin&quot;, encoding = &quot;utf-8&quot;, echo = TRUE, max.deparse.length = 1e3)</span></span></code></pre></div>
</div>
</div>
<div id="tabset-170-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-170-3-tab">
<div class="cell">
<div class="sourceCode" id="cb711"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb711-1"><a href="#cb711-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mesurer la durée d&#39;exécution d&#39;un programme</span></span>
<span id="cb711-2"><a href="#cb711-2" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(donnees_tidyverse <span class="ot">&lt;-</span> donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb711-3"><a href="#cb711-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">arrange</span>(identifiant, date_entree))</span>
<span id="cb711-4"><a href="#cb711-4" aria-hidden="true" tabindex="-1"></a><span class="co"># En SAS : include(&quot;chemin&quot;)</span></span>
<span id="cb711-5"><a href="#cb711-5" aria-hidden="true" tabindex="-1"></a><span class="co"># En R : source(&quot;chemin&quot;, encoding = &quot;utf-8&quot;, echo = TRUE, max.deparse.length = 1e3)</span></span></code></pre></div>
</div>
</div>
<div id="tabset-170-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-170-4-tab">
<div class="cell">
<div class="sourceCode" id="cb712"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb712-1"><a href="#cb712-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mesurer la durée d&#39;exécution d&#39;un programme</span></span>
<span id="cb712-2"><a href="#cb712-2" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">setorder</span>(donnees_datatable, <span class="st">&quot;identifiant&quot;</span>, <span class="st">&quot;date_entree&quot;</span>, <span class="at">na.last =</span> <span class="cn">FALSE</span>))</span>
<span id="cb712-3"><a href="#cb712-3" aria-hidden="true" tabindex="-1"></a><span class="co"># En SAS : include(&quot;chemin&quot;)</span></span>
<span id="cb712-4"><a href="#cb712-4" aria-hidden="true" tabindex="-1"></a><span class="co"># En R : source(&quot;chemin&quot;, encoding = &quot;utf-8&quot;, echo = TRUE, max.deparse.length = 1e3)</span></span></code></pre></div>
</div>
</div>
<div id="tabset-170-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-170-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="débogage" class="level1" data-number="24">
<h1 data-number="24"><span class="header-section-number">24</span> Débogage</h1>
<section id="outils-daide-au-débogage" class="level2" data-number="24.1">
<h2 data-number="24.1"><span class="header-section-number">24.1</span> Outils d’aide au débogage</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-171-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-171-1" role="tab" aria-controls="tabset-171-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-171-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-171-2" role="tab" aria-controls="tabset-171-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-171-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-171-3" role="tab" aria-controls="tabset-171-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-171-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-171-4" role="tab" aria-controls="tabset-171-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-171-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-171-5" role="tab" aria-controls="tabset-171-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-171-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-171-1-tab">
<div class="sourceCode" id="cb713"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb713-1"><a href="#cb713-1" aria-hidden="true" tabindex="-1"></a><span class="kw">options</span> symbolgen mprint mlogic;</span>
<span id="cb713-2"><a href="#cb713-2" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> Debogage;</span>
<span id="cb713-3"><a href="#cb713-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%local</span> phrase i j;</span>
<span id="cb713-4"><a href="#cb713-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%let</span> phrase = Voici une phrase;</span>
<span id="cb713-5"><a href="#cb713-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%do</span> i = <span class="dv">1</span> <span class="kw">%to</span> <span class="kw">%sysfunc</span>(countw(<span class="kw">&amp;phrase.</span>));</span>
<span id="cb713-6"><a href="#cb713-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%let</span> j = <span class="kw">%scan</span>(<span class="kw">&amp;phrase.</span>, <span class="kw">&amp;i.</span>);</span>
<span id="cb713-7"><a href="#cb713-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">%put</span> Mot n°<span class="kw">&amp;i.</span> = <span class="kw">&amp;j.</span>;</span>
<span id="cb713-8"><a href="#cb713-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%end</span>;</span>
<span id="cb713-9"><a href="#cb713-9" aria-hidden="true" tabindex="-1"></a><span class="kw">%mend</span> Debogage;</span>
<span id="cb713-10"><a href="#cb713-10" aria-hidden="true" tabindex="-1"></a>%Debogage;</span>
<span id="cb713-11"><a href="#cb713-11" aria-hidden="true" tabindex="-1"></a><span class="kw">options</span> nosymbolgen nomprint nomlogic;</span></code></pre></div>
</div>
<div id="tabset-171-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-171-2-tab">
<div class="cell">
<div class="sourceCode" id="cb714"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb714-1"><a href="#cb714-1" aria-hidden="true" tabindex="-1"></a><span class="co">#phrase &lt;- c(&quot;voici&quot;, &quot;une&quot;, &quot;phrase&quot;)</span></span>
<span id="cb714-2"><a href="#cb714-2" aria-hidden="true" tabindex="-1"></a><span class="co">#options(error=recover)</span></span>
<span id="cb714-3"><a href="#cb714-3" aria-hidden="true" tabindex="-1"></a><span class="co">#for (i in phrase) print(k)</span></span>
<span id="cb714-4"><a href="#cb714-4" aria-hidden="true" tabindex="-1"></a><span class="co">#options(error=NULL)</span></span>
<span id="cb714-5"><a href="#cb714-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb714-6"><a href="#cb714-6" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : autres outils</span></span>
<span id="cb714-7"><a href="#cb714-7" aria-hidden="true" tabindex="-1"></a><span class="co">#traceback()</span></span>
<span id="cb714-8"><a href="#cb714-8" aria-hidden="true" tabindex="-1"></a><span class="co">#browser()</span></span></code></pre></div>
</div>
</div>
<div id="tabset-171-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-171-3-tab">
<div class="cell">
<div class="sourceCode" id="cb715"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb715-1"><a href="#cb715-1" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : creuser</span></span>
<span id="cb715-2"><a href="#cb715-2" aria-hidden="true" tabindex="-1"></a><span class="co">#phrase &lt;- c(&quot;voici&quot;, &quot;une&quot;, &quot;phrase&quot;)</span></span>
<span id="cb715-3"><a href="#cb715-3" aria-hidden="true" tabindex="-1"></a><span class="co">#options(error=recover)</span></span>
<span id="cb715-4"><a href="#cb715-4" aria-hidden="true" tabindex="-1"></a><span class="co">#for (i in phrase) print(k)</span></span>
<span id="cb715-5"><a href="#cb715-5" aria-hidden="true" tabindex="-1"></a><span class="co">#options(error=NULL)</span></span>
<span id="cb715-6"><a href="#cb715-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb715-7"><a href="#cb715-7" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : autres outils</span></span>
<span id="cb715-8"><a href="#cb715-8" aria-hidden="true" tabindex="-1"></a><span class="co">#traceback()</span></span>
<span id="cb715-9"><a href="#cb715-9" aria-hidden="true" tabindex="-1"></a><span class="co">#browser()</span></span></code></pre></div>
</div>
</div>
<div id="tabset-171-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-171-4-tab">
<div class="cell">
<div class="sourceCode" id="cb716"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb716-1"><a href="#cb716-1" aria-hidden="true" tabindex="-1"></a><span class="co">#phrase &lt;- c(&quot;voici&quot;, &quot;une&quot;, &quot;phrase&quot;)</span></span>
<span id="cb716-2"><a href="#cb716-2" aria-hidden="true" tabindex="-1"></a><span class="co">#options(error=recover)</span></span>
<span id="cb716-3"><a href="#cb716-3" aria-hidden="true" tabindex="-1"></a><span class="co">#for (i in phrase) print(k)</span></span>
<span id="cb716-4"><a href="#cb716-4" aria-hidden="true" tabindex="-1"></a><span class="co">#options(error=NULL)</span></span>
<span id="cb716-5"><a href="#cb716-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb716-6"><a href="#cb716-6" aria-hidden="true" tabindex="-1"></a><span class="co"># À FAIRE : autres outils</span></span>
<span id="cb716-7"><a href="#cb716-7" aria-hidden="true" tabindex="-1"></a><span class="co">#traceback()</span></span>
<span id="cb716-8"><a href="#cb716-8" aria-hidden="true" tabindex="-1"></a><span class="co">#browser()</span></span></code></pre></div>
</div>
</div>
<div id="tabset-171-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-171-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
</section>
<section id="points-de-vigilance-en-sas" class="level1" data-number="25">
<h1 data-number="25"><span class="header-section-number">25</span> Points de vigilance en <code>SAS</code></h1>
<section id="emploi-des-guillemets-et-double-guillemets" class="level2" data-number="25.1">
<h2 data-number="25.1"><span class="header-section-number">25.1</span> Emploi des guillemets et double guillemets</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-172-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-172-1" role="tab" aria-controls="tabset-172-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-172-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-172-2" role="tab" aria-controls="tabset-172-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-172-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-172-3" role="tab" aria-controls="tabset-172-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-172-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-172-4" role="tab" aria-controls="tabset-172-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-172-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-172-5" role="tab" aria-controls="tabset-172-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-172-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-172-1-tab">
<div class="sourceCode" id="cb717"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb717-1"><a href="#cb717-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Quelques points de vigilance en SAS (à ne connaître que si on est amené à modifier le programme SAS, pas utiles sinon) */</span></span>
<span id="cb717-2"><a href="#cb717-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* Double guillemets pour les macro-variables */</span></span>
<span id="cb717-3"><a href="#cb717-3" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> a = Bonjour;</span>
<span id="cb717-4"><a href="#cb717-4" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> <span class="st">&#39;&amp;a.&#39;</span>; <span class="co">/* Incorrect */</span></span>
<span id="cb717-5"><a href="#cb717-5" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> <span class="st">&quot;&amp;a.&quot;</span>; <span class="co">/* Correct */</span></span></code></pre></div>
</div>
<div id="tabset-172-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-172-2-tab">
<div class="cell">
<div class="sourceCode" id="cb718"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb718-1"><a href="#cb718-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans objet en R</span></span></code></pre></div>
</div>
</div>
<div id="tabset-172-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-172-3-tab">
<div class="cell">
<div class="sourceCode" id="cb719"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb719-1"><a href="#cb719-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans objet en R</span></span></code></pre></div>
</div>
</div>
<div id="tabset-172-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-172-4-tab">
<div class="cell">
<div class="sourceCode" id="cb720"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb720-1"><a href="#cb720-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans objet en R</span></span></code></pre></div>
</div>
</div>
<div id="tabset-172-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-172-5-tab">
<div class="cell">
<div class="sourceCode" id="cb721"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb721-1"><a href="#cb721-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans objet en R</span></span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="macro-variable-définie-avec-un-statut-global-avant-son-appel-dans-le-cadre-dun-statut-local" class="level2" data-number="25.2">
<h2 data-number="25.2"><span class="header-section-number">25.2</span> Macro-variable définie avec un statut global avant son appel dans le cadre d’un statut local</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-173-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-173-1" role="tab" aria-controls="tabset-173-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-173-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-173-2" role="tab" aria-controls="tabset-173-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-173-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-173-3" role="tab" aria-controls="tabset-173-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-173-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-173-4" role="tab" aria-controls="tabset-173-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-173-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-173-5" role="tab" aria-controls="tabset-173-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-173-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-173-1-tab">
<div class="sourceCode" id="cb722"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb722-1"><a href="#cb722-1" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> test;</span>
<span id="cb722-2"><a href="#cb722-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%let</span> reponse = oui;</span>
<span id="cb722-3"><a href="#cb722-3" aria-hidden="true" tabindex="-1"></a><span class="kw">%mend</span> test;</span>
<span id="cb722-4"><a href="#cb722-4" aria-hidden="true" tabindex="-1"></a>%test;</span>
<span id="cb722-5"><a href="#cb722-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb722-6"><a href="#cb722-6" aria-hidden="true" tabindex="-1"></a><span class="co">/* 1. Erreur car &amp;reponse. n&#39;est défini que dans le cas d&#39;un environnement local */</span> </span>
<span id="cb722-7"><a href="#cb722-7" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> <span class="kw">&amp;reponse.</span>;</span>
<span id="cb722-8"><a href="#cb722-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb722-9"><a href="#cb722-9" aria-hidden="true" tabindex="-1"></a><span class="co">/* 2. Défini auparavant dans un environnement global, elle change de valeur à l&#39;appel de la fonction */</span></span>
<span id="cb722-10"><a href="#cb722-10" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> reponse = non;</span>
<span id="cb722-11"><a href="#cb722-11" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> Reponse : <span class="kw">&amp;reponse.</span>;</span>
<span id="cb722-12"><a href="#cb722-12" aria-hidden="true" tabindex="-1"></a>%test;</span>
<span id="cb722-13"><a href="#cb722-13" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> Reponse après la macro : <span class="kw">&amp;reponse.</span>;</span>
<span id="cb722-14"><a href="#cb722-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb722-15"><a href="#cb722-15" aria-hidden="true" tabindex="-1"></a><span class="co">/* 3. Problème corrigé, en imposant la variable à local dans la macro */</span></span>
<span id="cb722-16"><a href="#cb722-16" aria-hidden="true" tabindex="-1"></a><span class="kw">%macro</span> test2;</span>
<span id="cb722-17"><a href="#cb722-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%local</span> reponse;</span>
<span id="cb722-18"><a href="#cb722-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">%let</span> reponse = oui;</span>
<span id="cb722-19"><a href="#cb722-19" aria-hidden="true" tabindex="-1"></a><span class="kw">%mend</span> test2;</span>
<span id="cb722-20"><a href="#cb722-20" aria-hidden="true" tabindex="-1"></a><span class="kw">%let</span> reponse = non;</span>
<span id="cb722-21"><a href="#cb722-21" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> Reponse : <span class="kw">&amp;reponse.</span>;</span>
<span id="cb722-22"><a href="#cb722-22" aria-hidden="true" tabindex="-1"></a>%test2;</span>
<span id="cb722-23"><a href="#cb722-23" aria-hidden="true" tabindex="-1"></a><span class="kw">%put</span> Année après la macro : <span class="kw">&amp;reponse.</span>;</span></code></pre></div>
</div>
<div id="tabset-173-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-173-2-tab">
<div class="cell">
<div class="sourceCode" id="cb723"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb723-1"><a href="#cb723-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans objet en R</span></span></code></pre></div>
</div>
</div>
<div id="tabset-173-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-173-3-tab">
<div class="cell">
<div class="sourceCode" id="cb724"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb724-1"><a href="#cb724-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans objet en R</span></span></code></pre></div>
</div>
</div>
<div id="tabset-173-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-173-4-tab">
<div class="cell">
<div class="sourceCode" id="cb725"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb725-1"><a href="#cb725-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans objet en R</span></span></code></pre></div>
</div>
</div>
<div id="tabset-173-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-173-5-tab">
<div class="cell">
<div class="sourceCode" id="cb726"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb726-1"><a href="#cb726-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans objet en R</span></span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="fin-du-programme" class="level1" data-number="26">
<h1 data-number="26"><span class="header-section-number">26</span> Fin du programme</h1>
<section id="taille-des-objets-en-mémoire" class="level2" data-number="26.1">
<h2 data-number="26.1"><span class="header-section-number">26.1</span> Taille des objets en mémoire</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-174-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-174-1" role="tab" aria-controls="tabset-174-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-174-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-174-2" role="tab" aria-controls="tabset-174-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-174-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-174-3" role="tab" aria-controls="tabset-174-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-174-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-174-4" role="tab" aria-controls="tabset-174-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-174-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-174-5" role="tab" aria-controls="tabset-174-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-174-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-174-1-tab">
<div class="sourceCode" id="cb727"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb727-1"><a href="#cb727-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Taille d&#39;une base de données */</span></span>
<span id="cb727-2"><a href="#cb727-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> sql;</span>
<span id="cb727-3"><a href="#cb727-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> <span class="kw">libname</span>, memname, filesize <span class="kw">format</span> = sizekmg., filesize <span class="kw">format</span> = sizek.</span>
<span id="cb727-4"><a href="#cb727-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> Dictionary.Tables</span>
<span id="cb727-5"><a href="#cb727-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span> <span class="kw">libname</span> = <span class="st">&quot;WORK&quot;</span> <span class="kw">and</span> memname = <span class="fu">upcase</span>(<span class="st">&quot;donnees_sas&quot;</span>) <span class="kw">and</span> memtype = <span class="st">&quot;DATA&quot;</span>;</span>
<span id="cb727-6"><a href="#cb727-6" aria-hidden="true" tabindex="-1"></a><span class="kw">quit</span>;</span></code></pre></div>
</div>
<div id="tabset-174-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-174-2-tab">
<div class="cell">
<div class="sourceCode" id="cb728"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb728-1"><a href="#cb728-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Taille, en mémoire, d&#39;une base (en Mb)</span></span>
<span id="cb728-2"><a href="#cb728-2" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(<span class="fu">object.size</span>(donnees_rbase), <span class="at">nsmall =</span> <span class="dv">3</span>, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">unit =</span> <span class="st">&quot;Mb&quot;</span>)</span>
<span id="cb728-3"><a href="#cb728-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb728-4"><a href="#cb728-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Taille des objets en mémoire, en Gb</span></span>
<span id="cb728-5"><a href="#cb728-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">sapply</span>(<span class="fu">ls</span>(), <span class="cf">function</span>(x){<span class="fu">object.size</span>(<span class="fu">get</span>(x))}), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)<span class="sc">/</span><span class="dv">10</span><span class="sc">**</span><span class="dv">9</span></span></code></pre></div>
</div>
</div>
<div id="tabset-174-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-174-3-tab">
<div class="cell">
<div class="sourceCode" id="cb729"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb729-1"><a href="#cb729-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Taille, en mémoire, d&#39;une base (en Mb)</span></span>
<span id="cb729-2"><a href="#cb729-2" aria-hidden="true" tabindex="-1"></a>donnees_tidyverse <span class="sc">%&gt;%</span> </span>
<span id="cb729-3"><a href="#cb729-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">object.size</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb729-4"><a href="#cb729-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format</span>(<span class="at">nsmall =</span> <span class="dv">3</span>, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">unit =</span> <span class="st">&quot;Mb&quot;</span>)</span>
<span id="cb729-5"><a href="#cb729-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb729-6"><a href="#cb729-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Taille des objets en mémoire, en Gb</span></span>
<span id="cb729-7"><a href="#cb729-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">sapply</span>(<span class="fu">ls</span>(), <span class="cf">function</span>(x){<span class="fu">object.size</span>(<span class="fu">get</span>(x))}), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)<span class="sc">/</span><span class="dv">10</span><span class="sc">**</span><span class="dv">9</span></span></code></pre></div>
</div>
</div>
<div id="tabset-174-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-174-4-tab">
<div class="cell">
<div class="sourceCode" id="cb730"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb730-1"><a href="#cb730-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Liste des bases de données en mémoire</span></span>
<span id="cb730-2"><a href="#cb730-2" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">tables</span>() </span>
<span id="cb730-3"><a href="#cb730-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb730-4"><a href="#cb730-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Taille, en mémoire, d&#39;une base (en Mb)</span></span>
<span id="cb730-5"><a href="#cb730-5" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(<span class="fu">object.size</span>(donnees_datatable), <span class="at">nsmall =</span> <span class="dv">3</span>, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">unit =</span> <span class="st">&quot;Mb&quot;</span>)</span>
<span id="cb730-6"><a href="#cb730-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb730-7"><a href="#cb730-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Taille des objets en mémoire, en Gb</span></span>
<span id="cb730-8"><a href="#cb730-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">sapply</span>(<span class="fu">ls</span>(), <span class="cf">function</span>(x){<span class="fu">object.size</span>(<span class="fu">get</span>(x))}), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)<span class="sc">/</span><span class="dv">10</span><span class="sc">**</span><span class="dv">9</span></span></code></pre></div>
</div>
</div>
<div id="tabset-174-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-174-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
</section>
<section id="supprimer-des-bases" class="level2" data-number="26.2">
<h2 data-number="26.2"><span class="header-section-number">26.2</span> Supprimer des bases</h2>
<div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-175-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-175-1" role="tab" aria-controls="tabset-175-1" aria-selected="true"><code>SAS</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-175-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-175-2" role="tab" aria-controls="tabset-175-2" aria-selected="false"><code>R base</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-175-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-175-3" role="tab" aria-controls="tabset-175-3" aria-selected="false"><code>tidyverse</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-175-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-175-4" role="tab" aria-controls="tabset-175-4" aria-selected="false"><code>data.table</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-175-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-175-5" role="tab" aria-controls="tabset-175-5" aria-selected="false"><code>arrow/duckdb</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-175-1" class="unnumbered unlisted tab-pane active" role="tabpanel" aria-labelledby="tabset-175-1-tab">
<div class="sourceCode" id="cb731"><pre class="sourceCode sas"><code class="sourceCode sas"><span id="cb731-1"><a href="#cb731-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Supprimer une base */</span></span>
<span id="cb731-2"><a href="#cb731-2" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> datasets lib = work nolist;<span class="kw">delete</span> donnees_sas<span class="kw">;run</span>;</span>
<span id="cb731-3"><a href="#cb731-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb731-4"><a href="#cb731-4" aria-hidden="true" tabindex="-1"></a><span class="co">/* Supprimer toutes les bases dans la work */</span></span>
<span id="cb731-5"><a href="#cb731-5" aria-hidden="true" tabindex="-1"></a><span class="kw">proc</span> datasets lib = work nolist kill<span class="kw">;run</span>;</span></code></pre></div>
</div>
<div id="tabset-175-2" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-175-2-tab">
<div class="cell">
<div class="sourceCode" id="cb732"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb732-1"><a href="#cb732-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer une base</span></span>
<span id="cb732-2"><a href="#cb732-2" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(donnees_rbase)</span></span>
<span id="cb732-3"><a href="#cb732-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb732-4"><a href="#cb732-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer toutes les bases et tous les objets de la mémoire vive</span></span>
<span id="cb732-5"><a href="#cb732-5" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(list = ls())</span></span></code></pre></div>
</div>
</div>
<div id="tabset-175-3" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-175-3-tab">
<div class="cell">
<div class="sourceCode" id="cb733"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb733-1"><a href="#cb733-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer une base</span></span>
<span id="cb733-2"><a href="#cb733-2" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(donnees_tidyverse)</span></span>
<span id="cb733-3"><a href="#cb733-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb733-4"><a href="#cb733-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer toutes les bases et tous les objets de la mémoire vive</span></span>
<span id="cb733-5"><a href="#cb733-5" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(list = ls())</span></span></code></pre></div>
</div>
</div>
<div id="tabset-175-4" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-175-4-tab">
<div class="cell">
<div class="sourceCode" id="cb734"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb734-1"><a href="#cb734-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer une base</span></span>
<span id="cb734-2"><a href="#cb734-2" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(donnees_datatable)</span></span>
<span id="cb734-3"><a href="#cb734-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb734-4"><a href="#cb734-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer toutes les bases et tous les objets de la mémoire vive</span></span>
<span id="cb734-5"><a href="#cb734-5" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(list = ls())</span></span></code></pre></div>
</div>
</div>
<div id="tabset-175-5" class="unnumbered unlisted tab-pane" role="tabpanel" aria-labelledby="tabset-175-5-tab">
<div class="cell">

</div>
</div>
</div>
</div>
<div id="quarto-navigation-envelope" class="hidden">
<p><span class="hidden" data-render-id="quarto-int-sidebar-title">Aide-mémoire SAS - R</span> <span class="hidden" data-render-id="quarto-int-navbar-title">Aide-mémoire SAS - R</span> <span class="hidden" data-render-id="quarto-int-next">Mise en garde</span> <span class="hidden" data-render-id="quarto-int-sidebar:/01-aide_memoire_r_sas.html">Aide-mémoire</span> <span class="hidden" data-render-id="quarto-int-sidebar:/03-mise_en_garde.html">Mise en garde</span> <span class="hidden" data-render-id="quarto-int-sidebar:/Trucs et astuces en R.html">Trucs et astuces</span> <span class="hidden" data-render-id="quarto-int-sidebar:/04-specificites_sas_r.html">Spécificités de SAS et R</span> <span class="hidden" data-render-id="quarto-int-sidebar:/02-avantages_inconvenients_env_R.html">Avantages et inconvénients des environnements R</span> <span class="hidden" data-render-id="footer-right">Ce site a été créé avec <a href="https://quarto.org/">Quarto</a></span></p>
</div>
<div id="quarto-meta-markdown" class="hidden">
<p><span class="hidden" data-render-id="quarto-metatitle">Aide-mémoire SAS - R - Aide-mémoire <code>SAS</code> - <code>R</code></span> <span class="hidden" data-render-id="quarto-twittercardtitle">Aide-mémoire SAS - R - Aide-mémoire <code>SAS</code> - <code>R</code></span> <span class="hidden" data-render-id="quarto-ogcardtitle">Aide-mémoire SAS - R - Aide-mémoire <code>SAS</code> - <code>R</code></span> <span class="hidden" data-render-id="quarto-metasitename">Aide-mémoire SAS - R</span></p>
</div>
<!-- -->
<div class="quarto-embedded-source-code">
<div class="sourceCode" id="cb735" data-shortcodes="false"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb735-1"><a href="#cb735-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb735-2"><a href="#cb735-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &quot;Aide-mémoire `SAS` - `R`&quot;</span></span>
<span id="cb735-3"><a href="#cb735-3" aria-hidden="true" tabindex="-1"></a><span class="an">lang :</span><span class="co"> fr</span></span>
<span id="cb735-4"><a href="#cb735-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb735-5"><a href="#cb735-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Nassab ABDALLAH</span></span>
<span id="cb735-6"><a href="#cb735-6" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Dares/SCS, &lt;nassab.abdallah@travail.gouv.fr&gt;</span></span>
<span id="cb735-7"><a href="#cb735-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Damien EUZENAT</span></span>
<span id="cb735-8"><a href="#cb735-8" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Dares/DIP, &lt;damien.euzenat@travail.gouv.fr&gt;</span></span>
<span id="cb735-9"><a href="#cb735-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Sébastien LI-THIAO-TE</span></span>
<span id="cb735-10"><a href="#cb735-10" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Dares/DFA, &lt;sebastien.li-thiao-te@travail.gouv.fr&gt;</span></span>
<span id="cb735-11"><a href="#cb735-11" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb735-12"><a href="#cb735-12" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb735-13"><a href="#cb735-13" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb735-14"><a href="#cb735-14" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb735-15"><a href="#cb735-15" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-expand: 1</span></span>
<span id="cb735-16"><a href="#cb735-16" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb735-17"><a href="#cb735-17" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb735-18"><a href="#cb735-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb735-19"><a href="#cb735-19" aria-hidden="true" tabindex="-1"></a><span class="co">    smooth-scroll: true</span></span>
<span id="cb735-20"><a href="#cb735-20" aria-hidden="true" tabindex="-1"></a><span class="co">    embed-resources: true</span></span>
<span id="cb735-21"><a href="#cb735-21" aria-hidden="true" tabindex="-1"></a><span class="co">    link-external-icon: true</span></span>
<span id="cb735-22"><a href="#cb735-22" aria-hidden="true" tabindex="-1"></a><span class="co">    link-external-newwindow: true</span></span>
<span id="cb735-23"><a href="#cb735-23" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: full</span></span>
<span id="cb735-24"><a href="#cb735-24" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb735-25"><a href="#cb735-25" aria-hidden="true" tabindex="-1"></a><span class="co"># format : native   </span></span>
<span id="cb735-26"><a href="#cb735-26" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> source</span></span>
<span id="cb735-27"><a href="#cb735-27" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb735-28"><a href="#cb735-28" aria-hidden="true" tabindex="-1"></a><span class="co">  eval: false</span></span>
<span id="cb735-29"><a href="#cb735-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-30"><a href="#cb735-30" aria-hidden="true" tabindex="-1"></a><span class="an">embed-resources:</span><span class="co"> true</span></span>
<span id="cb735-31"><a href="#cb735-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-32"><a href="#cb735-32" aria-hidden="true" tabindex="-1"></a><span class="an">syntax-definitions:</span><span class="co"> </span></span>
<span id="cb735-33"><a href="#cb735-33" aria-hidden="true" tabindex="-1"></a><span class="co">  - sas.xml</span></span>
<span id="cb735-34"><a href="#cb735-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-35"><a href="#cb735-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary for listings and search engines</span></span>
<span id="cb735-36"><a href="#cb735-36" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> |</span></span>
<span id="cb735-37"><a href="#cb735-37" aria-hidden="true" tabindex="-1"></a><span class="co">  Un aide-mémoire pour les statisticiens traduisant des codes standards en `SAS` et en `R`, suivant 4 environnements (`R base`, `tidyverse`, `data.table`, `arrow/duckdb`).</span></span>
<span id="cb735-38"><a href="#cb735-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-39"><a href="#cb735-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Date published</span></span>
<span id="cb735-40"><a href="#cb735-40" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> &quot;`r Sys.Date()`&quot;</span></span>
<span id="cb735-41"><a href="#cb735-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-42"><a href="#cb735-42" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span></span>
<span id="cb735-43"><a href="#cb735-43" aria-hidden="true" tabindex="-1"></a><span class="co">  rmdformats::robobook:</span></span>
<span id="cb735-44"><a href="#cb735-44" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight: tango</span></span>
<span id="cb735-45"><a href="#cb735-45" aria-hidden="true" tabindex="-1"></a><span class="co">    number_sections: true</span></span>
<span id="cb735-46"><a href="#cb735-46" aria-hidden="true" tabindex="-1"></a><span class="co">  </span></span>
<span id="cb735-47"><a href="#cb735-47" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb735-48"><a href="#cb735-48" aria-hidden="true" tabindex="-1"></a><span class="co">  - SAS</span></span>
<span id="cb735-49"><a href="#cb735-49" aria-hidden="true" tabindex="-1"></a><span class="co">  - R</span></span>
<span id="cb735-50"><a href="#cb735-50" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb735-51"><a href="#cb735-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-52"><a href="#cb735-52" aria-hidden="true" tabindex="-1"></a>L&#39;aide-mémoire a pour but de fournir des codes écrits en <span class="in">`SAS`</span> et d&#39;en donner la traduction en <span class="in">`R`</span> de différentes manières possibles :</span>
<span id="cb735-53"><a href="#cb735-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-54"><a href="#cb735-54" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`R base`</span></span>
<span id="cb735-55"><a href="#cb735-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-56"><a href="#cb735-56" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`tidyverse`</span></span>
<span id="cb735-57"><a href="#cb735-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-58"><a href="#cb735-58" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`data.table`</span></span>
<span id="cb735-59"><a href="#cb735-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-60"><a href="#cb735-60" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`arrow/duckdb`</span></span>
<span id="cb735-61"><a href="#cb735-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-62"><a href="#cb735-62" aria-hidden="true" tabindex="-1"></a>Les codes traduits sont typiques de la production statistique ou la réalisation d&#39;études descriptives.</span>
<span id="cb735-63"><a href="#cb735-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-64"><a href="#cb735-64" aria-hidden="true" tabindex="-1"></a>Ce document s&#39;adresse notamment aux utilisateurs de <span class="in">`SAS`</span> qui veulent connaître la traduction du code <span class="in">`SAS`</span> en <span class="in">`R`</span>, aux utilisateurs de <span class="in">`R`</span> qui ont besoin de comprendre le code <span class="in">`SAS`</span>, ainsi qu&#39;aux utilisateurs d&#39;un environnement <span class="in">`R`</span> qui sont intéressés par la traduction dans un autre environnement <span class="in">`R`</span>.</span>
<span id="cb735-65"><a href="#cb735-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-66"><a href="#cb735-66" aria-hidden="true" tabindex="-1"></a>Il se veut complémentaire de la documentation en ligne en français Utilit&#39;R, née à l&#39;Insee (<span class="ot">&lt;https://www.book.utilitr.org/&gt;</span>). Le lecteur est invité à s&#39;y référer pour obtenir des informations importantes sur l&#39;utilisation de <span class="in">`R`</span> et qui ne sont pas discutées dans ce document, comme l&#39;importation de données en <span class="in">`R`</span> (<span class="ot">&lt;https://www.book.utilitr.org/03_fiches_thematiques/fiche_import_fichiers_plats&gt;</span>). </span>
<span id="cb735-67"><a href="#cb735-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-68"><a href="#cb735-68" aria-hidden="true" tabindex="-1"></a>Enfin, si vous souhaitez collaborer à cet aide-mémoire ou nous faire part de votre avis, n&#39;hésitez pas à nous contacter via nos adresses email.</span>
<span id="cb735-69"><a href="#cb735-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-70"><a href="#cb735-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-71"><a href="#cb735-71" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre1.qmd &gt;}}</span>
<span id="cb735-72"><a href="#cb735-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-73"><a href="#cb735-73" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre2.qmd &gt;}}</span>
<span id="cb735-74"><a href="#cb735-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-75"><a href="#cb735-75" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre3.qmd &gt;}}</span>
<span id="cb735-76"><a href="#cb735-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-77"><a href="#cb735-77" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre4.qmd &gt;}}</span>
<span id="cb735-78"><a href="#cb735-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-79"><a href="#cb735-79" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre5.qmd &gt;}}</span>
<span id="cb735-80"><a href="#cb735-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-81"><a href="#cb735-81" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre6.qmd &gt;}}</span>
<span id="cb735-82"><a href="#cb735-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-83"><a href="#cb735-83" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre7.qmd &gt;}}</span>
<span id="cb735-84"><a href="#cb735-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-85"><a href="#cb735-85" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre8.qmd &gt;}}</span>
<span id="cb735-86"><a href="#cb735-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-87"><a href="#cb735-87" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre9.qmd &gt;}}</span>
<span id="cb735-88"><a href="#cb735-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-89"><a href="#cb735-89" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre10.qmd &gt;}}</span>
<span id="cb735-90"><a href="#cb735-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-91"><a href="#cb735-91" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre11.qmd &gt;}}</span>
<span id="cb735-92"><a href="#cb735-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-93"><a href="#cb735-93" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre12.qmd &gt;}}</span>
<span id="cb735-94"><a href="#cb735-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-95"><a href="#cb735-95" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre13.qmd &gt;}}</span>
<span id="cb735-96"><a href="#cb735-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-97"><a href="#cb735-97" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre14.qmd &gt;}}</span>
<span id="cb735-98"><a href="#cb735-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-99"><a href="#cb735-99" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre15.qmd &gt;}}</span>
<span id="cb735-100"><a href="#cb735-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-101"><a href="#cb735-101" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre16.qmd &gt;}}</span>
<span id="cb735-102"><a href="#cb735-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-103"><a href="#cb735-103" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre17.qmd &gt;}}</span>
<span id="cb735-104"><a href="#cb735-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-105"><a href="#cb735-105" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre18.qmd &gt;}}</span>
<span id="cb735-106"><a href="#cb735-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-107"><a href="#cb735-107" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre19.qmd &gt;}}</span>
<span id="cb735-108"><a href="#cb735-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-109"><a href="#cb735-109" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre20.qmd &gt;}}</span>
<span id="cb735-110"><a href="#cb735-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-111"><a href="#cb735-111" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre21.qmd &gt;}}</span>
<span id="cb735-112"><a href="#cb735-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-113"><a href="#cb735-113" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre22.qmd &gt;}}</span>
<span id="cb735-114"><a href="#cb735-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-115"><a href="#cb735-115" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre23.qmd &gt;}}</span>
<span id="cb735-116"><a href="#cb735-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-117"><a href="#cb735-117" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre24.qmd &gt;}}</span>
<span id="cb735-118"><a href="#cb735-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-119"><a href="#cb735-119" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre25.qmd &gt;}}</span>
<span id="cb735-120"><a href="#cb735-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb735-121"><a href="#cb735-121" aria-hidden="true" tabindex="-1"></a>{{&lt; include _Chapitre26.qmd &gt;}}</span></code></pre></div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-right">
      <div class='footer-contents'>Ce site a été créé avec [Quarto](https://quarto.org/)</div>  
    </div>
  </div>
</footer>

</body>

</html>